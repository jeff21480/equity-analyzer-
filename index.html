<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analyz√°tor akci√≠</title>
  <style>
    /* ========= Z√ÅKLADN√ç STYL ========= */
    :root {
      --bg-gradient: radial-gradient(circle at top, #7b5cff, #2d0f5f 60%, #120024);
      --card-gradient: linear-gradient(135deg, #8b5cf6, #ec4899);
      --card-gradient-soft: linear-gradient(135deg, rgba(139,92,246,0.25), rgba(236,72,153,0.25));
      --text-main: #ffffff;
      --text-muted: #c4b5fd;
      --accent: #22c55e;
      --accent-soft: rgba(34,197,94,0.16);
      --danger: #f97373;
      --border-soft: rgba(255,255,255,0.08);
      --shadow-soft: 0 18px 45px rgba(0,0,0,0.45);
      --radius-xl: 28px;
      --radius-lg: 20px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      background: var(--bg-gradient);
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 480px;
      padding: 28px 18px 40px;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 2.2rem;
      font-weight: 800;
      letter-spacing: 0.02em;
    }

    .subtitle {
      font-size: 0.96rem;
      line-height: 1.4;
      color: var(--text-muted);
      margin-bottom: 22px;
    }

    /* ========= SEKCE / ≈†UPL√çKY ========= */
    .section {
      background: rgba(15,23,42,0.65);
      border-radius: var(--radius-xl);
      padding: 16px 16px 6px;
      margin-bottom: 14px;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(18px);
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .section-main-label {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(37,99,235,0.18);
      font-size: 0.73rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: #bfdbfe;
      margin-bottom: 6px;
    }

    .section-main-label span {
      font-size: 1.1rem;
      margin-right: 6px;
    }

    .section-title-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-icon {
      width: 38px;
      height: 38px;
      border-radius: 999px;
      background: var(--card-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      box-shadow: 0 10px 24px rgba(0,0,0,0.45);
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .section-subtitle {
      font-size: 0.80rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .badge-soon {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px dashed rgba(248,250,252,0.45);
      color: rgba(248,250,252,0.85);
      background: rgba(15,23,42,0.6);
    }

    .divider {
      border: none;
      border-top: 1px solid rgba(148,163,184,0.25);
      margin: 10px 0 14px;
    }

    /* ========= FORMUL√Å≈òE ========= */

    label {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 6px;
      color: #e5e7eb;
    }

    .hint {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    input, select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.85);
      color: #f9fafb;
      font-size: 0.9rem;
      outline: none;
    }

    input:focus, select:focus {
      border-color: #a855f7;
      box-shadow: 0 0 0 1px rgba(168,85,247,0.7);
    }

    .form-row {
      margin-bottom: 10px;
    }

    .form-row-inline {
      display: flex;
      gap: 8px;
    }

    .btn-primary {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 12px 18px;
      background: var(--accent);
      color: #052e16;
      font-size: 1rem;
      font-weight: 700;
      margin: 4px 0 10px;
      box-shadow: 0 18px 35px rgba(22,163,74,0.7);
    }

    .btn-secondary {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.65);
      padding: 10px 16px;
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
      font-size: 0.86rem;
      margin-bottom: 6px;
    }

    .btn-secondary-inline {
      width: auto;
      padding: 6px 12px;
      margin-top: 4px;
      font-size: 0.78rem;
    }

    .btn-danger {
      background: rgba(248,113,113,0.14);
      border-color: rgba(248,113,113,0.88);
      color: #fecaca;
      box-shadow: none;
    }

    .result-card {
      margin-top: 4px;
      padding: 12px 14px;
      border-radius: var(--radius-lg);
      background: radial-gradient(circle at top left, rgba(34,197,94,0.22), rgba(15,23,42,0.96));
      border: 1px solid rgba(34,197,94,0.5);
      font-size: 0.9rem;
    }

    .result-main {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .result-label {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.72rem;
      background: var(--accent-soft);
      color: #bbf7d0;
      margin-top: 4px;
      gap: 4px;
    }

    /* ========= LISTY ========= */

    .list {
      margin: 4px 0 8px;
      padding: 0;
      list-style: none;
      max-height: 220px;
      overflow-y: auto;
    }

    .list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 7px 10px;
      margin-bottom: 4px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.35);
      font-size: 0.82rem;
    }

    .tag {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      color: rgba(226,232,240,0.9);
      margin-left: 6px;
    }

    .list-item small {
      color: var(--text-muted);
    }

    .totals {
      font-size: 0.82rem;
      margin-top: 4px;
      color: var(--text-muted);
    }

    @media (max-width: 360px) {
      h1 {
        font-size: 1.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- HLAVN√ç TITULEK -->
    <h1>Analyz√°tor akci√≠</h1>
    <p class="subtitle">
      Zadej z√°kladn√≠ p≈ôedpoklady a spoƒç√≠tej orientaƒçn√≠ vnit≈ôn√≠ (f√©rovou) hodnotu akcie.
      V≈°echno je jen informaƒçn√≠, nejde o investiƒçn√≠ doporuƒçen√≠.
    </p>

    <!-- ========== 1) HLAVN√ç PANEL ‚Äì V√ùPOƒåET VNIT≈òN√ç HODNOTY ========== -->
    <section class="section" id="section-main">
      <div class="section-main-label">
        <span>‚≠ê</span> HLAVN√ç PANEL
      </div>
      <div class="section-header">
        <div class="section-title-wrap">
          <div class="section-icon">üìä</div>
          <div>
            <div class="section-title">V√Ωpoƒçet vnit≈ôn√≠ (f√©rov√©) ceny</div>
            <div class="section-subtitle">
              Rychl√Ω DCF model + prostor pro chatbot a pokroƒçil√Ω DCF.
            </div>
          </div>
        </div>
      </div>

      <hr class="divider" />

      <!-- Rychl√Ω DCF form -->
      <form id="dcf-form">
        <div class="form-row">
          <label for="ticker">Ticker (jen n√°zev, neovliv≈àuje v√Ωpoƒçet)</label>
          <input id="ticker" type="text" placeholder="Nap≈ô. AAPL" />
        </div>

        <div class="form-row">
          <label for="eps">Aktu√°ln√≠ zisk na akcii (EPS) <span class="hint">(v USD)</span></label>
          <input id="eps" type="number" step="0.01" value="6" />
        </div>

        <div class="form-row">
          <label for="growth">Oƒçek√°van√Ω roƒçn√≠ r≈Øst zisk≈Ø (%)</label>
          <input id="growth" type="number" step="0.1" value="10" />
        </div>

        <div class="form-row">
          <label for="years">Poƒçet let progn√≥zy</label>
          <input id="years" type="number" value="10" />
        </div>

        <div class="form-row">
          <label for="discount">Diskontn√≠ sazba (%) ‚Äì po≈æadovan√Ω v√Ωnos</label>
          <input id="discount" type="number" step="0.1" value="9" />
        </div>

        <div class="form-row">
          <label for="terminalPE">C√≠lov√Ω P/E na konci obdob√≠</label>
          <input id="terminalPE" type="number" step="0.1" value="15" />
        </div>

        <div class="form-row">
          <label for="margin">Bezpeƒçnostn√≠ rezerva (%) ‚Äì sleva pro n√°kup</label>
          <input id="margin" type="number" step="1" value="25" />
        </div>

        <button type="submit" class="btn-primary">Spoƒç√≠tat f√©rovou cenu</button>
      </form>

      <button id="add-to-watchlist" class="btn-secondary btn-secondary-inline">
        ‚ûï P≈ôidat tento ticker do watchlistu
      </button>

      <div id="dcf-result" class="result-card" style="display:none;">
        <div class="result-main" id="dcf-price-main"></div>
        <div class="result-label" id="dcf-price-detail"></div>
        <div class="pill">
          üí° Orientaƒçn√≠ v√Ωpoƒçet ‚Äì pro vlastn√≠ anal√Ωzu, ne doporuƒçen√≠.
        </div>
      </div>

      <hr class="divider" />

      <div class="section-subtitle">
        üéØ <strong>Pokroƒçil√Ω DCF model</strong> a integrovan√Ω <strong>chatbot</strong> budou
        v dal≈°√≠ verzi. Tady u≈æ m√°≈° ale funkƒçn√≠ z√°klad ‚Äì rychl√Ω orientaƒçn√≠ odhad vnit≈ôn√≠ hodnoty.
      </div>
    </section>

    <!-- ========== 2) WATCHLIST ========== -->
    <section class="section" id="section-watchlist">
      <div class="section-header">
        <div class="section-title-wrap">
          <div class="section-icon">üìà</div>
          <div>
            <div class="section-title">Watchlist & v√Ωsledky</div>
            <div class="section-subtitle">
              Jednoduch√Ω seznam sledovan√Ωch akci√≠ ‚Äì ukl√°d√° se do za≈ô√≠zen√≠.
            </div>
          </div>
        </div>
      </div>

      <div class="form-row form-row-inline">
        <div style="flex:1;">
          <label for="watchlist-input">Ticker</label>
          <input id="watchlist-input" type="text" placeholder="Nap≈ô. MSFT" />
        </div>
        <button id="watchlist-add-btn" class="btn-secondary btn-secondary-inline">P≈ôidat</button>
      </div>

      <ul id="watchlist-list" class="list"></ul>

      <button id="watchlist-clear-btn" class="btn-secondary btn-danger">
        üßπ Vymazat cel√Ω watchlist
      </button>
    </section>

    <!-- ========== 3) EARNINGS KALEND√Å≈ò ========== -->
    <section class="section" id="section-earnings">
      <div class="section-header">
        <div class="section-title-wrap">
          <div class="section-icon">üóìÔ∏è</div>
          <div>
            <div class="section-title">Earnings kalend√°≈ô</div>
            <div class="section-subtitle">
              P≈ôehled term√≠n≈Ø v√Ωsledk≈Ø firem, kter√© tƒõ zaj√≠maj√≠.
            </div>
          </div>
        </div>
        <span class="badge-soon">Brzy</span>
      </div>

      <p class="section-subtitle">
        Tahle sekce zat√≠m ƒçek√° na napojen√≠ na extern√≠ API.
        Do budoucna tady uvid√≠≈° nadch√°zej√≠c√≠ v√Ωsledky firem z tv√©ho watchlistu.
      </p>
    </section>

    <!-- ========== 4) KALKULAƒåKA SLO≈ΩEN√âHO √öROƒåEN√ç ========== -->
    <section class="section" id="section-compound">
      <div class="section-header">
        <div class="section-title-wrap">
          <div class="section-icon">üßÆ</div>
          <div>
            <div class="section-title">Kalkulaƒçka slo≈æen√©ho √∫roƒçen√≠</div>
            <div class="section-subtitle">
              Vypoƒç√≠tej si, kolik m≈Ø≈æe vyr≈Øst tvoje investice v ƒçase.
            </div>
          </div>
        </div>
      </div>

      <form id="compound-form">
        <div class="form-row">
          <label for="comp-start">Poƒç√°teƒçn√≠ ƒç√°stka (CZK)</label>
          <input id="comp-start" type="number" step="100" value="100000" />
        </div>

        <div class="form-row">
          <label for="comp-monthly">Mƒõs√≠ƒçn√≠ vklad (CZK)</label>
          <input id="comp-monthly" type="number" step="100" value="5000" />
        </div>

        <div class="form-row">
          <label for="comp-rate">Pr≈Ømƒõrn√© roƒçn√≠ zhodnocen√≠ (%)</label>
          <input id="comp-rate" type="number" step="0.1" value="8" />
        </div>

        <div class="form-row">
          <label for="comp-years">Poƒçet let</label>
          <input id="comp-years" type="number" value="20" />
        </div>

        <button type="submit" class="btn-primary">Spoƒç√≠tat slo≈æen√© √∫roƒçen√≠</button>
      </form>

      <div id="compound-result" class="result-card" style="display:none;">
        <div class="result-main" id="compound-total"></div>
        <div class="result-label" id="compound-detail"></div>
      </div>
    </section>

    <!-- ========== 5) MOJE PORTFOLIO ========== -->
    <section class="section" id="section-portfolio">
      <div class="section-header">
        <div class="section-title-wrap">
          <div class="section-icon">üíº</div>
          <div>
            <div class="section-title">Moje portfolio</div>
            <div class="section-subtitle">
              Rychl√Ω p≈ôehled tv√Ωch pozic ‚Äì ƒçistƒõ orientaƒçn√≠, ulo≈æen√© jen v tomto za≈ô√≠zen√≠.
            </div>
          </div>
        </div>
      </div>

      <form id="portfolio-form">
        <div class="form-row form-row-inline">
          <div style="flex:1;">
            <label for="pf-ticker">Ticker</label>
            <input id="pf-ticker" type="text" placeholder="Nap≈ô. AAPL" />
          </div>
          <div style="width:90px;">
            <label for="pf-shares">Kus≈Ø</label>
            <input id="pf-shares" type="number" step="1" />
          </div>
        </div>

        <div class="form-row">
          <label for="pf-price">N√°kupn√≠ cena za akcii (USD)</label>
          <input id="pf-price" type="number" step="0.01" />
        </div>

        <button type="submit" class="btn-secondary">P≈ôidat pozici</button>
      </form>

      <ul id="portfolio-list" class="list"></ul>
      <div id="portfolio-totals" class="totals"></div>

      <button id="portfolio-clear-btn" class="btn-secondary btn-danger">
        üßπ Vymazat cel√© portfolio
      </button>
    </section>
  </div>

  <script>
    // ===================== RYCHL√ù DCF V√ùPOƒåET =====================
    const dcfForm = document.getElementById('dcf-form');
    const dcfResultCard = document.getElementById('dcf-result');
    const dcfPriceMain = document.getElementById('dcf-price-main');
    const dcfPriceDetail = document.getElementById('dcf-price-detail');
    const addToWatchlistBtn = document.getElementById('add-to-watchlist');
    const tickerInput = document.getElementById('ticker');

    function calculateDCF(e) {
      e.preventDefault();

      const eps = parseFloat(document.getElementById('eps').value || '0');
      const growth = parseFloat(document.getElementById('growth').value || '0') / 100;
      const years = parseInt(document.getElementById('years').value || '0', 10);
      const discount = parseFloat(document.getElementById('discount').value || '0') / 100;
      const terminalPE = parseFloat(document.getElementById('terminalPE').value || '0');
      const margin = parseFloat(document.getElementById('margin').value || '0') / 100;

      if (!eps || !years || !discount || !terminalPE) {
        alert('Vypl≈à pros√≠m EPS, poƒçet let, diskontn√≠ sazbu a c√≠lov√© P/E.');
        return;
      }

      let intrinsic = 0;
      let currentEPS = eps;

      for (let t = 1; t <= years; t++) {
        currentEPS = currentEPS * (1 + growth);
        const discounted = currentEPS / Math.pow(1 + discount, t);
        intrinsic += discounted;
      }

      // Termin√°ln√≠ hodnota
      const terminalValue = currentEPS * terminalPE;
      intrinsic += terminalValue / Math.pow(1 + discount, years);

      const fairValue = intrinsic;
      const buyPrice = fairValue * (1 - margin);

      dcfPriceMain.textContent =
        `Odhad f√©rov√© ceny: ${fairValue.toFixed(2)} USD / akcii`;

      dcfPriceDetail.textContent =
        `Orientaƒçn√≠ n√°kupn√≠ cena po zapoƒçten√≠ bezpeƒçnostn√≠ rezervy ` +
        `(${(margin * 100).toFixed(0)} %): ${buyPrice.toFixed(2)} USD / akcii.`;

      dcfResultCard.style.display = 'block';
    }

    dcfForm.addEventListener('submit', calculateDCF);

    // ===================== WATCHLIST =====================
    const WATCHLIST_KEY = 'equity_analyzer_watchlist_v1';
    const watchlistInput = document.getElementById('watchlist-input');
    const watchlistList = document.getElementById('watchlist-list');
    const watchlistAddBtn = document.getElementById('watchlist-add-btn');
    const watchlistClearBtn = document.getElementById('watchlist-clear-btn');

    function loadWatchlist() {
      try {
        const stored = localStorage.getItem(WATCHLIST_KEY);
        return stored ? JSON.parse(stored) : [];
      } catch {
        return [];
      }
    }

    function saveWatchlist(list) {
      localStorage.setItem(WATCHLIST_KEY, JSON.stringify(list));
    }

    function renderWatchlist() {
      const list = loadWatchlist();
      watchlistList.innerHTML = '';
      if (!list.length) {
        const li = document.createElement('li');
        li.className = 'list-item';
        li.textContent = 'Watchlist je pr√°zdn√Ω.';
        watchlistList.appendChild(li);
        return;
      }

      list.forEach(ticker => {
        const li = document.createElement('li');
        li.className = 'list-item';
        const span = document.createElement('span');
        span.textContent = ticker;
        span.style.fontWeight = '600';

        const small = document.createElement('small');
        small.textContent = 'sledov√°no';

        li.appendChild(span);
        li.appendChild(small);
        watchlistList.appendChild(li);
      });
    }

    function addToWatchlist(manualTicker) {
      const t = (manualTicker || tickerInput.value || watchlistInput.value || '').trim().toUpperCase();
      if (!t) {
        alert('Zadej pros√≠m ticker.');
        return;
      }
      const list = loadWatchlist();
      if (!list.includes(t)) {
        list.push(t);
        saveWatchlist(list);
        renderWatchlist();
      }
      watchlistInput.value = '';
    }

    watchlistAddBtn.addEventListener('click', (e) => {
      e.preventDefault();
      addToWatchlist();
    });

    addToWatchlistBtn.addEventListener('click', (e) => {
      e.preventDefault();
      addToWatchlist();
    });

    watchlistClearBtn.addEventListener('click', () => {
      if (confirm('Opravdu chce≈° vymazat cel√Ω watchlist?')) {
        saveWatchlist([]);
        renderWatchlist();
      }
    });

    // ===================== KALKULAƒåKA SLO≈ΩEN√âHO √öROƒåEN√ç =====================
    const compoundForm = document.getElementById('compound-form');
    const compoundResult = document.getElementById('compound-result');
    const compoundTotal = document.getElementById('compound-total');
    const compoundDetail = document.getElementById('compound-detail');

    function calculateCompound(e) {
      e.preventDefault();

      const start = parseFloat(document.getElementById('comp-start').value || '0');
      const monthly = parseFloat(document.getElementById('comp-monthly').value || '0');
      const rate = parseFloat(document.getElementById('comp-rate').value || '0') / 100;
      const years = parseInt(document.getElementById('comp-years').value || '0', 10);

      if (years <= 0) {
        alert('Poƒçet let mus√≠ b√Ωt vƒõt≈°√≠ ne≈æ 0.');
        return;
      }

      const months = years * 12;
      const monthlyRate = Math.pow(1 + rate, 1 / 12) - 1;

      // r≈Øst poƒç√°teƒçn√≠ ƒç√°stky
      let futureValue = start * Math.pow(1 + monthlyRate, months);

      // mƒõs√≠ƒçn√≠ vklady
      if (monthly > 0) {
        futureValue += monthly * ((Math.pow(1 + monthlyRate, mon
