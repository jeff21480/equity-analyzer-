o<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1020" />
  <title>Anal√Ωza akci√≠</title>
  <style>
:root{
  --bg0:#070a12;
  --bg1:#0b1020;
  --card:#0e1730cc;
  --card2:#0c142b;
  --stroke:#a78bfa33;
  --stroke2:#a78bfa22;
  --text:#eaf0ff;
  --muted:#c4b5fdcc;
  --muted2:#9aa6c8;
  --accent1:#7c3aed;
  --accent2:#a78bfa;
  --good:#31d17b;
  --bad:#ff5a7a;
  --warn:#ffcc66;
  --shadow: 0 18px 45px rgba(...);
}
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
    background: linear-gradient(180deg, #070016 0%, #0b0a2a 45%, #1a0a3f 100%);
  min-height: 100%;
  background-attachment: fixed;  
    }

    a{color:inherit}
    .app{min-height:100%; display:flex; justify-content:center;}
    .wrap{width:100%; max-width:var(--max); padding: 18px 14px 40px;}
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      
  radial-gradient(900px 700px at 80% 35%, rgba(139,92,246,.18), transparent 60%),
  linear-gradient(180deg, var(--bg0), var(--bg1));olor:var(--muted); font-size:13px;
      backdrop-filter: blur(8px);
    }
    .dot{width:10px;height:10px;border-radius:50%; background:var(--good); box-shadow:0 0 0 4px rgba(49,209,123,.14)}
    h1{margin:16px 0 8px; font-size:44px; letter-spacing:-.02em}
    .sub{color:var(--muted); margin:0 0 18px; line-height:1.35}
    .grid{display:grid; gap:14px; margin-top:18px}
    @media (min-width:700px){ .grid{grid-template-columns:1fr 1fr;} h1{font-size:54px} }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--stroke);
      border-radius: var(--r2);
      padding:16px 16px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .menu-card{
      display:flex; align-items:center; justify-content:space-between;
      padding:16px 16px;
      border-radius: 22px;
      border:1px solid var(--stroke2);
      background: linear-gradient(180deg, rgba(14,23,48,.70), rgba(14,23,48,.25));
      box-shadow: 0 16px 40px rgba(0,0,0,.45);
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, border-color .15s ease;
    }
    .menu-card:active{transform: scale(.995)}
    .menu-left{display:flex; align-items:center; gap:12px}
    .icon{
      width:46px; height:46px; border-radius:16px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.06);
      border:1px solid var(--stroke);
    }
    .menu-title{font-weight:700; font-size:18px; margin:0}
    .menu-sub{margin:2px 0 0; color:var(--muted); font-size:13px}
    .arrow{font-size:22px; color: #dfe7ff; opacity:.9}

    /* Screens */
    section.screen{display:none;}
    section.screen.active{display:block;}

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding: 10px 4px 16px;
    }
    .back-btn{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.22);
      color:var(--text);
      cursor:pointer;
      user-select:none;
    }
    .title-block .main{font-weight:800; font-size:18px}
    .title-block .sub{margin:2px 0 0; font-size:12px; color:var(--muted)}
    .pill{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      color:var(--muted);
      font-size:12px;
    }

    .panel{
      border-radius: var(--r2);
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      padding: 14px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .panel-head{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px}
    .panel-title{font-weight:800; letter-spacing:-.01em}
    .panel-sub{color:var(--muted); font-size:12px}
    .row{display:grid; grid-template-columns:1fr; gap:12px}
    @media (min-width:700px){ .row.two{grid-template-columns:1fr 1fr;} .row.three{grid-template-columns:1fr 1fr 1fr;} }

    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px}
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color:var(--text);
      outline:none;
    }
    input:focus, textarea:focus{border-color: rgba(38,198,255,.55)}
    textarea{min-height:120px; resize:vertical}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:12px 14px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
      user-select:none;
    }
    .btn.primary{
      border-color: rgba(38,198,255,.55);
      background: linear-gradient(180deg, rgba(38,198,255,.20), rgba(109,94,252,.16));
    }
    .btn.danger{
      border-color: rgba(255,90,122,.45);
      background: rgba(255,90,122,.10);
      color:#ffe9ee;
    }
    .btn:active{transform: translateY(1px)}
    .btnline{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}

    .result-box{
      margin-top:12px;
      border-radius: 18px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.22);
      padding: 12px;
    }
    .result-main{font-size:18px; font-weight:800}
    .result-note{color:var(--muted); font-size:12px; margin-top:4px}

    table{width:100%; border-collapse: collapse; margin-top:10px; overflow:hidden}
    th,td{padding:10px 10px; border-bottom:1px solid rgba(255,255,255,.08); text-align:left; font-size:13px}
    th{color:var(--muted); font-weight:700}
    .tag{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      font-size:12px; color:var(--muted);
    }
    .good{color:var(--good)}
    .bad{color:var(--bad)}
    .muted{color:var(--muted)}
    .hr{height:1px; background: rgba(255,255,255,.10); margin:12px 0}
    .small{font-size:12px; color:var(--muted)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
    .list{display:grid; gap:10px; margin-top:10px}
    .list-item{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      border-radius: 18px;
      padding: 12px;
    }
    .li-top{display:flex; align-items:flex-start; justify-content:space-between; gap:10px}
    .li-title{font-weight:800}
    .li-sub{font-size:12px; color:var(--muted); margin-top:3px}
    .li-actions{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .kbd{
      padding:2px 6px; border-radius:8px; border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      font-size:12px;
    }
  </style>
</head>

<body>
<div class="app">
  <div class="wrap">

    <!-- HOME -->
    <section id="home" class="screen active">
      <div class="badge"><span class="dot"></span> Anal√Ωza akci√≠ ‚Ä¢ Beta</div>
      <h1>Anal√Ωza akci√≠</h1>
      <p class="sub">Modern√≠ n√°stroje pro investory: v√Ωpoƒçet vnit≈ôn√≠ hodnoty (DCF), watchlist, slo≈æen√© √∫roƒçen√≠ a jednoduch√© vysvƒõtlen√≠ metodiky.</p>

      <div class="grid">
        <div class="menu-card" data-target="screen-analyzer">
          <div class="menu-left">
            <div class="icon">üìà</div>
            <div>
              <p class="menu-title">Analyz√°tor</p>
              <p class="menu-sub">Odhad vnit≈ôn√≠ hodnoty (Bear / Base / Bull)</p>
            </div>
          </div>
          <div class="arrow">‚Ä∫</div>
        </div>

        <div class="menu-card" data-target="screen-compound">
          <div class="menu-left">
            <div class="icon">üßÆ</div>
            <div>
              <p class="menu-title">Kalkulaƒçka</p>
              <p class="menu-sub">Slo≈æen√© √∫roƒçen√≠</p>
            </div>
          </div>
          <div class="arrow">‚Ä∫</div>
        </div>

        <div class="menu-card" data-target="screen-watchlist">
          <div class="menu-left">
            <div class="icon">üëÄ</div>
            <div>
              <p class="menu-title">Watchlist</p>
              <p class="menu-sub">Ulo≈æen√© anal√Ωzy (datum + v√Ωsledky)</p>
            </div>
          </div>
          <div class="arrow">‚Ä∫</div>
        </div>

        <div class="menu-card" data-target="screen-how">
          <div class="menu-left">
            <div class="icon">‚ÑπÔ∏è</div>
            <div>
              <p class="menu-title">Jak to funguje</p>
              <p class="menu-sub">Metodika, vysvƒõtlen√≠, proƒç a jak appku pou≈æ√≠vat</p>
            </div>
          </div>
          <div class="arrow">‚Ä∫</div>
        </div>
      </div>
    </section>

    <!-- ANALYZER -->
    <section id="screen-analyzer" class="screen">
      <div class="topbar">
        <div class="back-btn" data-back="home">‚Üê Zpƒõt</div>
        <div class="title-block">
          <div class="main">Analyz√°tor</div>
          <div class="sub">DCF ‚Ä¢ t≈ôi sc√©n√°≈ôe</div>
        </div>
        <div class="pill">MVP</div>
      </div>

      <div class="panel">
        <div class="panel-head">
          <div>
            <div class="panel-title">Vstupy</div>
            <div class="panel-sub">Zadej Base p≈ôedpoklady. Bear/Bull se dopoƒç√≠taj√≠ jako √∫pravy.</div>
          </div>
          <span class="tag">Tip: m≈Ø≈æe≈° ps√°t i s ƒç√°rkou (nap≈ô. 9,5)</span>
        </div>

        <div class="row two">
          <div>
            <label>Ticker / n√°zev (nap≈ô. MSFT)</label>
            <input id="a_ticker" placeholder="MSFT" />
          </div>
          <div>
            <label>Aktu√°ln√≠ cena (na akcii)</label>
            <input id="a_price" inputmode="decimal" placeholder="nap≈ô. 420" />
          </div>
        </div>

        <div class="row two">
          <div>
            <label>FCF na akcii (poƒç√°teƒçn√≠) *</label>
            <input id="a_fcf" inputmode="decimal" placeholder="nap≈ô. 10" />
          </div>
          <div>
            <label>Poƒçet let projekce</label>
            <select id="a_years">
              <option value="10" selected>10 let</option>
              <option value="7">7 let</option>
              <option value="5">5 let</option>
            </select>
          </div>
        </div>

        <div class="hr"></div>

        <div class="row three">
          <div>
            <label>Base r≈Øst FCF (%)</label>
            <input id="a_g" inputmode="decimal" placeholder="nap≈ô. 8" value="8" />
          </div>
          <div>
            <label>Base diskont (%)</label>
            <input id="a_r" inputmode="decimal" placeholder="nap≈ô. 9" value="9" />
          </div>
          <div>
            <label>Base termin√°l (%)</label>
            <input id="a_tg" inputmode="decimal" placeholder="nap≈ô. 3" value="3" />
          </div>
        </div>

        <div class="hr"></div>

        <div class="row three">
          <div>
            <label>Bear √∫prava r≈Østu (p.b.)</label>
            <input id="a_bear_g" inputmode="decimal" value="-2" />
          </div>
          <div>
            <label>Bear √∫prava diskontu (p.b.)</label>
            <input id="a_bear_r" inputmode="decimal" value="+1" />
          </div>
          <div>
            <label>Bear √∫prava termin√°lu (p.b.)</label>
            <input id="a_bear_tg" inputmode="decimal" value="-0.5" />
          </div>
        </div>

        <div class="row three">
          <div>
            <label>Bull √∫prava r≈Østu (p.b.)</label>
            <input id="a_bull_g" inputmode="decimal" value="+2" />
          </div>
          <div>
            <label>Bull √∫prava diskontu (p.b.)</label>
            <input id="a_bull_r" inputmode="decimal" value="-1" />
          </div>
          <div>
            <label>Bull √∫prava termin√°lu (p.b.)</label>
            <input id="a_bull_tg" inputmode="decimal" value="+0.5" />
          </div>
        </div>

        <div class="btnline">
          <button class="btn primary" id="a_calc">Spoƒç√≠tat</button>
          <button class="btn" id="a_save">Ulo≈æit do Watchlistu</button>
          <span class="small">* FCF na akcii = zjednodu≈°en√Ω vstup pro MVP (bez tah√°n√≠ dat).</span>
        </div>

        <div class="result-box">
          <div class="result-main" id="a_result_main">Vypl≈à hodnoty a stiskni ‚ÄûSpoƒç√≠tat‚Äú.</div>
          <div class="result-note" id="a_result_note">Uvid√≠≈° Bear/Base/Bull a rozd√≠l v≈Øƒçi cenƒõ.</div>
        </div>

        <div id="a_table_wrap"></div>
      </div>
    </section>

    <!-- WATCHLIST -->
    <section id="screen-watchlist" class="screen">
      <div class="topbar">
        <div class="back-btn" data-back="home">‚Üê Zpƒõt</div>
        <div class="title-block">
          <div class="main">Watchlist</div>
          <div class="sub">Ulo≈æen√© anal√Ωzy</div>
        </div>
        <div class="pill">localStorage</div>
      </div>

      <div class="panel">
        <div class="panel-head">
          <div>
            <div class="panel-title">Ulo≈æen√© polo≈æky</div>
            <div class="panel-sub">Jednoduch√Ω archiv: datum + sc√©n√°≈ôe (Bear/Base/Bull). ≈Ω√°dn√° slo≈æit√° historie.</div>
          </div>
          <button class="btn danger" id="wl_clear">Smazat v≈°e</button>
        </div>

        <div class="small">
          Tip: polo≈æky se ukl√°daj√≠ v za≈ô√≠zen√≠ (prohl√≠≈æeƒç). Kdy≈æ sma≈æe≈° data prohl√≠≈æeƒçe, watchlist zmiz√≠.
        </div>

        <div class="list" id="wl_list"></div>
      </div>
    </section>

    <!-- COMPOUND -->
    <section id="screen-compound" class="screen">
      <div class="topbar">
        <div class="back-btn" data-back="home">‚Üê Zpƒõt</div>
        <div class="title-block">
          <div class="main">Kalkulaƒçka</div>
          <div class="sub">Slo≈æen√© √∫roƒçen√≠</div>
        </div>
        <div class="pill">rychle</div>
      </div>

      <div class="panel">
        <div class="panel-head">
          <div>
            <div class="panel-title">Slo≈æen√© √∫roƒçen√≠</div>
            <div class="panel-sub">Jednoduch√Ω v√Ωpoƒçet bez zbyteƒçnost√≠.</div>
          </div>
        </div>

        <div class="row two">
          <div>
            <label>Poƒç√°teƒçn√≠ vklad</label>
            <input id="c_start" inputmode="decimal" placeholder="nap≈ô. 10000" value="10000" />
          </div>
          <div>
            <label>Mƒõs√≠ƒçn√≠ vklad</label>
            <input id="c_monthly" inputmode="decimal" placeholder="nap≈ô. 2000" value="2000" />
          </div>
        </div>

        <div class="row two">
          <div>
            <label>Roky</label>
            <input id="c_years" inputmode="decimal" placeholder="nap≈ô. 10" value="10" />
          </div>
          <div>
            <label>Roƒçn√≠ zhodnocen√≠ (%)</label>
            <input id="c_rate" inputmode="decimal" placeholder="nap≈ô. 7" value="7" />
          </div>
        </div>

        <div class="btnline">
          <button class="btn primary" id="c_calc">Spoƒç√≠tat</button>
        </div>

        <div class="result-box">
          <div class="result-main" id="c_result_main">‚Äî</div>
          <div class="result-note" id="c_result_note">‚Äî</div>
        </div>
      </div>
    </section>

    <!-- HOW -->
    <section id="screen-how" class="screen">
      <div class="topbar">
        <div class="back-btn" data-back="home">‚Üê Zpƒõt</div>
        <div class="title-block">
          <div class="main">Jak to funguje</div>
          <div class="sub">struƒçnƒõ a srozumitelnƒõ</div>
        </div>
        <div class="pill">ƒçti 2 min</div>
      </div>

      <div class="panel">
        <div class="panel-head">
          <div>
            <div class="panel-title">O ƒçem aplikace je</div>
            <div class="panel-sub">Nejsme AI, co rad√≠ investovat. Jsme discipl√≠na zabalen√° do aplikace.</div>
          </div>
        </div>

        <div class="card" style="margin-bottom:12px">
          <div class="panel-title">Jedna vƒõta</div>
          <div class="sub">Nejd≈Øle≈æitƒõj≈°√≠ nen√≠ ƒç√≠slo. Nejd≈Øle≈æitƒõj≈°√≠ je d≈Øvod, proƒç ti vy≈°lo.</div>
        </div>

        <div class="row">
          <div class="card">
            <div class="panel-title">Jak postupovat</div>
            <ol class="sub" style="margin:10px 0 0; padding-left:18px">
              <li>Zad√°≈° vstupy (Base)</li>
              <li>Pod√≠v√°≈° se na sc√©n√°≈ôe (Bear / Base / Bull)</li>
              <li>Ulo≈æ√≠≈° v√Ωsledek do Watchlistu</li>
              <li>Vr√°t√≠≈° se pozdƒõji a porovn√°≈° se sebou v ƒçase</li>
            </ol>
          </div>

          <div class="card">
            <div class="panel-title">Co jsou sc√©n√°≈ôe</div>
            <div class="sub" style="margin-top:10px; line-height:1.45">
              Sc√©n√°≈ô = sada p≈ôedpoklad≈Ø. Ne predikce.  
              V√Ωpoƒçet je stejn√Ω, mƒõn√≠ se jen r≈Øst / diskont / termin√°l.
            </div>
          </div>

          <div class="card">
            <div class="panel-title">Co aplikace nen√≠</div>
            <ul class="sub" style="margin:10px 0 0; padding-left:18px">
              <li>Investiƒçn√≠ poradenstv√≠</li>
              <li>‚ÄûSign√°ly‚Äú kdy koupit/prodat</li>
              <li>Jedno spr√°vn√© ƒç√≠slo pro v≈°echny</li>
            </ul>
          </div>

          <div class="card">
            <div class="panel-title">Proƒç m√° smysl ukl√°dat</div>
            <div class="sub" style="margin-top:10px; line-height:1.45">
              Bez ukl√°d√°n√≠ je to jen kalkulaƒçka.  
              S ukl√°d√°n√≠m je to n√°stroj ‚Äì vrac√≠≈° se k my≈°len√≠, ne k ƒç√≠sl≈Øm.
            </div>
          </div>

          <div class="small">
            Pozn.: To je MVP. Pozdƒõji m≈Ø≈æe p≈ôib√Ωt export (PDF/CSV) a historie zmƒõn. Teƒè dr≈æ√≠me jednoduchost.
          </div>
        </div>
      </div>
    </section>

  </div>
</div>

<script>
  // -----------------------
  // Helpers
  // -----------------------
  const $ = (id) => document.getElementById(id);

  function parseNum(v){
    if (v === null || v === undefined) return NaN;
    const s = String(v).trim()
      .replace(/\s+/g, '')
      .replace(',', '.'); // CZ decimal
    if (!s) return NaN;
    const n = Number(s);
    return Number.isFinite(n) ? n : NaN;
  }

  function fmtMoney(n){
    if (!Number.isFinite(n)) return "‚Äî";
    return n.toLocaleString("cs-CZ", { maximumFractionDigits: 2 });
  }

  function fmtPct(n){
    if (!Number.isFinite(n)) return "‚Äî";
    const sign = n > 0 ? "+" : "";
    return sign + n.toLocaleString("cs-CZ", { maximumFractionDigits: 1 }) + " %";
  }

  function nowStamp(){
    const d = new Date();
    return d.toLocaleString("cs-CZ", { year:"numeric", month:"2-digit", day:"2-digit", hour:"2-digit", minute:"2-digit" });
  }
// -----------------------------
  // Navigation (screens)
  // -----------------------------
  function showScreen(id) {
    // hide all
    document.querySelectorAll("section.screen").forEach((s) => {
      s.classList.remove("active");
    });

    // show target
    const el = document.getElementById(id);
    if (el) el.classList.add("active");

    // nicer UX
    window.scrollTo({ top: 0, behavior: "instant" });
  }

  // menu cards -> open screens
  document.querySelectorAll(".menu-card").forEach((card) => {
    card.addEventListener("click", () => {
      const target = card.getAttribute("data-target");
      if (!target) return;

      showScreen(target);

      // refresh watchlist when entering
      if (target === "screen-watchlist") {
        if (typeof renderWatchlist === "function") renderWatchlist();
      }
    });
  });

  // back buttons
  document.querySelectorAll("[data-back]").forEach((btn) => {
    btn.addEventListener("click", () => {
      const back = btn.getAttribute("data-back") || "home";
      showScreen(back);
    });
  });

  // start screen
  showScreen("home");
  

  // -----------------------
  // DCF logic
  // -----------------------
  function dcfValue({ price, fcf, gPct, rPct, tgPct, years }){
    const g = gPct / 100;
    const r = rPct / 100;
    const tg = tgPct / 100;

    // guardrails
    if (!(Number.isFinite(price) && Number.isFinite(fcf) && Number.isFinite(g) && Number.isFinite(r) && Number.isFinite(tg))) return null;
    if (years <= 0) return null;
    if (r <= -0.99) return null; // nonsense

    let pv = 0;
    let cashFlow = fcf;

    for (let t = 1; t <= years; t++){
      cashFlow *= (1 + g);
      pv += cashFlow / Math.pow(1 + r, t);
    }

    // Gordon requires r > tg (otherwise terminal blows up)
    if (r <= tg) return { fairValue: NaN, diffPct: NaN, warn: "Pozor: diskont mus√≠ b√Ωt > termin√°l (r > tg)." };

    const terminalValue = (cashFlow * (1 + tg)) / (r - tg);
    const pvTerminal = terminalValue / Math.pow(1 + r, years);

    const fairValue = pv + pvTerminal;
    const diffPct = (fairValue / price - 1) * 100;

    return { fairValue, diffPct, warn: null };
  }

  function rowScenario(name, g, r, tg, res){
    const fv = res?.fairValue;
    const dp = res?.diffPct;
    const cls = Number.isFinite(dp) ? (dp >= 0 ? "good" : "bad") : "muted";
    return `
      <tr>
        <td><span class="tag">${name}</span></td>
        <td>${fmtPct(g)}</td>
        <td>${fmtPct(r)}</td>
        <td>${fmtPct(tg)}</td>
        <td class="mono">${fmtMoney(fv)}</td>
        <td class="${cls} mono">${fmtPct(dp)}</td>
      </tr>
    `;
  }

  function computeAnalyzer(){
    const ticker = $("a_ticker").value.trim();
    const price = parseNum($("a_price").value);
    const fcf = parseNum($("a_fcf").value);
    const years = parseInt($("a_years").value, 10) || 10;

    const baseG = parseNum($("a_g").value);
    const baseR = parseNum($("a_r").value);
    const baseTg = parseNum($("a_tg").value);

    const bearG = baseG + parseNum($("a_bear_g").value);
    const bearR = baseR + parseNum($("a_bear_r").value);
    const bearTg = baseTg + parseNum($("a_bear_tg").value);

    const bullG = baseG + parseNum($("a_bull_g").value);
    const bullR = baseR + parseNum($("a_bull_r").value);
    const bullTg = baseTg + parseNum($("a_bull_tg").value);

    // validate essential
    if (![price, fcf, baseG, baseR, baseTg].every(Number.isFinite)){
      $("a_result_main").textContent = "Dopl≈à pros√≠m cenu, FCF a Base p≈ôedpoklady.";
      $("a_result_note").textContent = "Tip: m≈Ø≈æe≈° ps√°t i s ƒç√°rkou (nap≈ô. 9,5).";
      $("a_table_wrap").innerHTML = "";
      return null;
    }

    const bear = dcfValue({ price, fcf, gPct: bearG, rPct: bearR, tgPct: bearTg, years });
    const base = dcfValue({ price, fcf, gPct: baseG, rPct: baseR, tgPct: baseTg, years });
    const bull = dcfValue({ price, fcf, gPct: bullG, rPct: bullR, tgPct: bullTg, years });

    const values = [bear?.fairValue, base?.fairValue, bull?.fairValue].filter(Number.isFinite);
    const minV = values.length ? Math.min(...values) : NaN;
    const maxV = values.length ? Math.max(...values) : NaN;

    const rangeText = Number.isFinite(minV) && Number.isFinite(maxV)
      ? `${fmtMoney(minV)} ‚Äì ${fmtMoney(maxV)}`
      : "‚Äî";

    $("a_result_main").textContent = `Rozmez√≠ f√©rov√© hodnoty: ${rangeText}`;
    $("a_result_note").textContent = `Ticker: ${ticker || "‚Äî"} ‚Ä¢ Projekce: ${years} let ‚Ä¢ Cena: ${fmtMoney(price)}`;

    const warn = bear?.warn || base?.warn || bull?.warn;
    const warnRow = warn ? `<div class="small" style="margin-top:10px; color: var(--warn)">‚ö†Ô∏è ${warn}</div>` : "";

    $("a_table_wrap").innerHTML = `
      <table>
        <thead>
          <tr>
            <th>Sc√©n√°≈ô</th>
            <th>R≈Øst</th>
            <th>Diskont</th>
            <th>Termin√°l</th>
            <th>F√©rov√° hodnota</th>
            <th>Vs. cena</th>
          </tr>
        </thead>
        <tbody>
          ${rowScenario("Bear", bearG, bearR, bearTg, bear)}
          ${rowScenario("Base", baseG, baseR, baseTg, base)}
          ${rowScenario("Bull", bullG, bullR, bullTg, bull)}
        </tbody>
      </table>
      ${warnRow}
      <div class="small" style="margin-top:8px">Pozn.: MVP poƒç√≠t√° s FCF ‚Äûna akcii‚Äú jako vstupem, aby to bylo rychl√© a bez API.</div>
    `;

    return {
      ticker,
      price,
      fcf,
      years,
      base: { g: baseG, r: baseR, tg: baseTg, fairValue: base?.fairValue, diffPct: base?.diffPct },
      bear: { g: bearG, r: bearR, tg: bearTg, fairValue: bear?.fairValue, diffPct: bear?.diffPct },
      bull: { g: bullG, r: bullR, tg: bullTg, fairValue: bull?.fairValue, diffPct: bull?.diffPct },
      savedAt: nowStamp()
    };
  }

  $("a_calc").addEventListener("click", () => computeAnalyzer());

  // -----------------------
  // Watchlist storage
  // -----------------------
  const WL_KEY = "equity_analyzer_watchlist_v1";

  function loadWatchlist(){
    try{
      const raw = localStorage.getItem(WL_KEY);
      const data = raw ? JSON.parse(raw) : [];
      return Array.isArray(data) ? data : [];
    }catch(e){
      return [];
    }
  }

  function saveWatchlist(list){
    localStorage.setItem(WL_KEY, JSON.stringify(list));
  }

  function addToWatchlist(entry){
    const list = loadWatchlist();
    list.unshift(entry);
    saveWatchlist(list);
    renderWatchlist();
  }

  function removeFromWatchlist(idx){
    const list = loadWatchlist();
    list.splice(idx, 1);
    saveWatchlist(list);
    renderWatchlist();
  }

  function clearWatchlist(){
    saveWatchlist([]);
    renderWatchlist();
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function renderWatchlist(){
    const list = loadWatchlist();
    const box = $("wl_list");

    if (!box) return;

    if (!list.length){
      box.innerHTML = `
        <div class="list-item">
          <div class="li-title">Zat√≠m tu nic nen√≠.</div>
          <div class="li-sub">V analyz√°toru spoƒç√≠tej sc√©n√°≈ôe a dej ‚ÄûUlo≈æit do Watchlistu‚Äú.</div>
        </div>
      `;
      return;
    }

    box.innerHTML = list.map((it, idx) => {
      const t = (it.ticker || "‚Äî").trim() || "‚Äî";
      const price = fmtMoney(it.price);
      const baseFV = fmtMoney(it.base?.fairValue);
      const range = (() => {
        const vals = [it.bear?.fairValue, it.base?.fairValue, it.bull?.fairValue].filter(Number.isFinite);
        if (!vals.length) return "‚Äî";
        const minV = Math.min(...vals), maxV = Math.max(...vals);
        return `${fmtMoney(minV)} ‚Äì ${fmtMoney(maxV)}`;
      })();

      const baseDiff = it.base?.diffPct;
      const diffCls = Number.isFinite(baseDiff) ? (baseDiff >= 0 ? "good" : "bad") : "muted";

      return `
        <div class="list-item">
          <div class="li-top">
            <div>
              <div class="li-title">${escapeHtml(t)} <span class="kbd mono">${it.savedAt || ""}</span></div>
              <div class="li-sub">Cena: <span class="mono">${price}</span> ‚Ä¢ Rozmez√≠ FV: <span class="mono">${range}</span> ‚Ä¢ Base FV: <span class="mono">${baseFV}</span> ‚Ä¢ <span class="${diffCls} mono">${fmtPct(baseDiff)}</span></div>
            </div>
            <div class="li-actions">
              <button class="btn" onclick="fillAnalyzerFromWatch(${idx})">Naƒç√≠st</button>
              <button class="btn danger" onclick="deleteWatch(${idx})">Smazat</button>
            </div>
          </div>

          <div class="hr"></div>

          <table>
            <thead>
              <tr>
                <th>Sc√©n√°≈ô</th><th>R≈Øst</th><th>Diskont</th><th>Termin√°l</th><th>FV</th><th>Vs. cena</th>
              </tr>
            </thead>
            <tbody>
              ${rowScenario("Bear", it.bear?.g, it.bear?.r, it.bear?.tg, { fairValue: it.bear?.fairValue, diffPct: it.bear?.diffPct })}
              ${rowScenario("Base", it.base?.g, it.base?.r, it.base?.tg, { fairValue: it.base?.fairValue, diffPct: it.base?.diffPct })}
              ${rowScenario("Bull", it.bull?.g, it.bull?.r, it.bull?.tg, { fairValue: it.bull?.fairValue, diffPct: it.bull?.diffPct })}
            </tbody>
          </table>
        </div>
      `;
    }).join("");
  }

  // global funcs for inline buttons
  window.deleteWatch = (idx) => removeFromWatchlist(idx);

  window.fillAnalyzerFromWatch = (idx) => {
    const list = loadWatchlist();
    const it = list[idx];
    if (!it) return;

    $("a_ticker").value = it.ticker || "";
    $("a_price").value = it.price ?? "";
    $("a_fcf").value = it.fcf ?? "";
    $("a_years").value = String(it.years || 10);

    // base assumptions
    $("a_g").value = it.base?.g ?? 8;
    $("a_r").value = it.base?.r ?? 9;
    $("a_tg").value = it.base?.tg ?? 3;

    showScreen("screen-analyzer");
    computeAnalyzer();
  };

  $("wl_clear").addEventListener("click", () => {
    if (confirm("Opravdu smazat cel√Ω Watchlist?")) clearWatchlist();
  });

  // Save from analyzer
  $("a_save").addEventListener("click", () => {
    const entry = computeAnalyzer();
    if (!entry) return;

    if (!entry.ticker){
      if (!confirm("Ticker nen√≠ vyplnƒõn. Ulo≈æit i tak?")) return;
    }

    addToWatchlist(entry);
    $("a_result_note").textContent = `Ulo≈æeno do Watchlistu ‚Ä¢ ${entry.savedAt}`;
  });

  // -----------------------
  // Compound calculator
  // -----------------------
  function computeCompound(){
    const start = parseNum($("c_start").value);
    const monthly = parseNum($("c_monthly").value);
    const years = parseNum($("c_years").value);
    const rate = parseNum($("c_rate").value) / 100;

    if (![start, monthly, years].every(Number.isFinite) || !Number.isFinite(rate)){
      $("c_result_main").textContent = "Dopl≈à pros√≠m v≈°echny hodnoty.";
      $("c_result_note").textContent = "‚Äî";
      return;
    }

    const months = Math.max(0, Math.round(years * 12));
    const mRate = rate / 12;

    let value = start;
    let contrib = start;

    for (let i = 1; i <= months; i++){
      value *= (1 + mRate);
      value += monthly;
      contrib += monthly;
    }

    const gain = value - contrib;

    $("c_result_main").textContent = `Koneƒçn√° hodnota: ${fmtMoney(value)}`;
    $("c_result_note").textContent = `Vlo≈æeno celkem: ${fmtMoney(contrib)} ‚Ä¢ Zisk: ${fmtMoney(gain)}`;
  }

  $("c_calc").addEventListener("click", computeCompound);
// ------------------------
// Init
// ------------------------
$("a_calc").addEventListener("click", computeAnalyzer);
renderWatchlist();
</script>
</body>
</html>
