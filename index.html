<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eqity Analyzér</title>

  <!-- Google font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Ikony -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

  <style>
    :root {
      --bg-main: #020617;
      --bg-card: rgba(15, 23, 42, 0.96);
      --bg-card-soft: rgba(15, 23, 42, 0.9);
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.25);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.4);
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.75);
      --radius-xl: 20px;
      --radius-2xl: 26px;
      --transition-fast: 0.18s ease-out;
      --error: #f97373;
      --success: #22c55e;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top, rgba(129, 140, 248, 0.25), transparent 55%),
        radial-gradient(circle at bottom, rgba(56, 189, 248, 0.16), transparent 55%),
        #020617;
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .app-shell {
      width: 100%;
      max-width: 1200px;
      background: radial-gradient(circle at top, #0b1220, #020617);
      border-radius: 28px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      box-shadow: var(--shadow-soft);
      padding: 22px 22px 26px;
      backdrop-filter: blur(18px);
      position: relative;
      overflow: hidden;
    }

    .app-shell::before {
      content: "";
      position: absolute;
      inset: -120px;
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.3), transparent 55%),
        radial-gradient(circle at bottom right, rgba(129, 140, 248, 0.32), transparent 60%);
      opacity: 0.85;
      z-index: -1;
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-pill {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #e0f2fe, #0ea5e9);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0f172a;
      font-weight: 800;
      font-size: 18px;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.6),
        0 12px 28px rgba(15, 23, 42, 0.9);
    }

    .app-title {
      font-size: 20px;
      font-weight: 600;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .app-badge {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--text-muted);
      background: rgba(15, 23, 42, 0.95);
    }

    .app-subtitle {
      font-size: 13px;
      color: var(--text-muted);
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border-radius: 999px;
      padding: 6px 11px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.96);
      font-size: 11px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.25);
    }

    .status-label {
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .status-text {
      font-size: 11px;
      color: var(--text-main);
    }

    .cards-grid {
      margin-top: 10px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }

    .card {
      position: relative;
      background: linear-gradient(135deg, #1d2345, #111827);
      border-radius: 999px;
      padding: 14px 18px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 11px 30px rgba(15, 23, 42, 0.9);
      cursor: pointer;
      overflow: hidden;
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        border-color var(--transition-fast),
        background var(--transition-fast);
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.32), transparent 55%);
      opacity: 0;
      transition: opacity var(--transition-fast);
      pointer-events: none;
    }

    .card:hover {
      transform: translateY(-3px);
      border-color: rgba(56, 189, 248, 0.8);
      box-shadow: 0 17px 40px rgba(15, 23, 42, 0.95);
      background: linear-gradient(135deg, #272a5a, #020617);
    }

    .card:hover::before {
      opacity: 1;
    }

    .card-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .card-main {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: 16px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: #e0f2fe;
      flex-shrink: 0;
    }

    .card-texts {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
    }

    .card-desc {
      font-size: 12px;
      color: #cbd5f5;
    }

    .card-side {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }

    .card-tag {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      color: var(--text-muted);
      background: rgba(15, 23, 42, 0.96);
    }

    .card-cta {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      font-weight: 500;
      color: #e0f2fe;
    }

    .card-cta i {
      font-size: 11px;
    }

    .view {
      display: none;
      animation: fadeIn 0.2s ease-out;
    }

    .view.active {
      display: block;
    }

    #main-view {
      animation: fadeInUp 0.22s ease-out;
    }

    .room-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
    }

    .room-title-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .room-title {
      font-size: 18px;
      font-weight: 600;
    }

    .room-subtitle {
      font-size: 13px;
      color: var(--text-muted);
    }

    .back-btn {
      border-radius: 999px;
      padding: 7px 11px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.96);
      color: var(--text-main);
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition:
        background var(--transition-fast),
        border-color var(--transition-fast),
        transform var(--transition-fast);
    }

    .back-btn:hover {
      background: rgba(15, 23, 42, 1);
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .room-body {
      border-radius: var(--radius-2xl);
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(2, 6, 23, 0.98));
      padding: 16px;
      min-height: 280px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .section-note {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-bottom: 12px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }

    .field label {
      color: var(--text-muted);
    }

    .field input,
    .field select,
    .field textarea {
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: var(--bg-card-soft);
      padding: 6px 8px;
      color: var(--text-main);
      font-size: 13px;
      outline: none;
    }

    .field textarea {
      resize: vertical;
      min-height: 60px;
    }

    .field input:focus,
    .field textarea:focus,
    .field select:focus {
      border-color: var(--accent);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border-radius: 999px;
      padding: 7px 12px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: linear-gradient(135deg, #0ea5e9, #6366f1);
      color: #0b1120;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 4px;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.8);
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        filter var(--transition-fast);
    }

    .btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.03);
      box-shadow: 0 16px 30px rgba(15, 23, 42, 0.9);
    }

    .btn.secondary {
      background: rgba(15, 23, 42, 0.96);
      color: var(--text-main);
      border-color: rgba(148, 163, 184, 0.8);
      box-shadow: none;
    }

    .btn.secondary:hover {
      border-color: var(--accent);
    }

    .result-box {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.96);
      font-size: 12px;
    }

    .result-line {
      margin: 2px 0;
    }

    .result-label {
      color: var(--text-muted);
    }

    .result-value {
      font-weight: 600;
    }

    .result-highlight {
      color: var(--accent);
      font-size: 13px;
    }

    .result-good {
      color: var(--success);
    }

    .result-bad {
      color: var(--error);
    }

    .table-wrapper {
      margin-top: 10px;
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      overflow: auto;
      max-height: 260px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      min-width: 480px;
    }

    th,
    td {
      padding: 6px 8px;
      border-bottom: 1px solid rgba(55, 65, 81, 0.9);
    }

    th {
      text-align: left;
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
    }

    tr:nth-child(even) td {
      background: rgba(15, 23, 42, 0.9);
    }

    tr:nth-child(odd) td {
      background: rgba(15, 23, 42, 0.96);
    }

    .tag-pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--text-muted);
    }

    .small-link {
      font-size: 11px;
      color: var(--accent);
    }

    .flex-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .mt-8 {
      margin-top: 8px;
    }

    .mt-4 {
      margin-top: 4px;
    }

    .mb-4 {
      margin-bottom: 4px;
    }

    .info-line {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .badge-soft {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 4px 8px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.96);
      font-size: 11px;
      color: var(--text-muted);
    }

    .switch-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 6px;
      font-size: 13px;
    }

    .switch-row label {
      color: var(--text-muted);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @media (max-width: 720px) {
      .app-shell {
        padding: 18px 12px 20px;
        border-radius: 22px;
      }

      .app-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .status-pill {
        align-self: flex-start;
      }

      .card {
        border-radius: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- HLAVNÍ MENU -->
    <div id="main-view" class="view active">
      <header class="app-header">
        <div class="title-block">
          <div class="title-row">
            <div class="logo-pill">E</div>
            <div class="app-title">
              Eqity Analyzér
              <span class="app-badge">All-in-one hub</span>
            </div>
          </div>
          <div class="app-subtitle">
            5 šuplíků, jeden QR kód. Všechny nástroje pro analýzu akcií na jednom místě.
          </div>
        </div>
        <div class="status-pill">
          <span class="status-dot"></span>
          <span class="status-label">Verze 1.0</span>
          <span class="status-text">Základní verze – připraveno na živá data</span>
        </div>
      </header>

      <section class="cards-grid">
        <!-- DCF -->
        <article class="card" onclick="openView('view-dcf')">
          <div class="card-inner">
            <div class="card-main">
              <div class="card-icon">
                <i class="fa-solid fa-calculator"></i>
              </div>
              <div class="card-texts">
                <div class="card-title">Výpočet vnitřní hodnoty (DCF)</div>
                <div class="card-desc">Manuální výpočet férové ceny akcie.</div>
              </div>
            </div>
            <div class="card-side">
              <span class="card-tag">Šuplík A1</span>
              <span class="card-cta">Otevřít <i class="fa-solid fa-arrow-right"></i></span>
            </div>
          </div>
        </article>

        <!-- Earnings -->
        <article class="card" onclick="openView('view-earnings')">
          <div class="card-inner">
            <div class="card-main">
              <div class="card-icon">
                <i class="fa-solid fa-calendar-days"></i>
              </div>
              <div class="card-texts">
                <div class="card-title">Earnings kalendář</div>
                <div class="card-desc">Přehled výsledků firem po týdnech a měsících.</div>
              </div>
            </div>
            <div class="card-side">
              <span class="card-tag">Šuplík A2</span>
              <span class="card-cta">Otevřít <i class="fa-solid fa-arrow-right"></i></span>
            </div>
          </div>
        </article>

        <!-- Portfolio -->
        <article class="card" onclick="openView('view-portfolio')">
          <div class="card-inner">
            <div class="card-main">
              <div class="card-icon">
                <i class="fa-solid fa-chart-line"></i>
              </div>
              <div class="card-texts">
                <div class="card-title">Moje portfolio</div>
                <div class="card-desc">Nahrání CSV, přehled pozic a hodnoty portfolia.</div>
              </div>
            </div>
            <div class="card-side">
              <span class="card-tag">Šuplík A3</span>
              <span class="card-cta">Otevřít <i class="fa-solid fa-arrow-right"></i></span>
            </div>
          </div>
        </article>

        <!-- Watchlist -->
        <article class="card" onclick="openView('view-watchlist')">
          <div class="card-inner">
            <div class="card-main">
              <div class="card-icon">
                <i class="fa-solid fa-eye"></i>
              </div>
              <div class="card-texts">
                <div class="card-title">Watchlist & nápady</div>
                <div class="card-desc">Místo pro akcie v hledáčku a poznámky.</div>
              </div>
            </div>
            <div class="card-side">
              <span class="card-tag">Šuplík A4</span>
              <span class="card-cta">Otevřít <i class="fa-solid fa-arrow-right"></i></span>
            </div>
          </div>
        </article>

        <!-- Nastavení -->
        <article class="card" onclick="openView('view-settings')">
          <div class="card-inner">
            <div class="card-main">
              <div class="card-icon">
                <i class="fa-solid fa-sliders"></i>
              </div>
              <div class="card-texts">
                <div class="card-title">Nastavení & nápověda</div>
                <div class="card-desc">Informace o aplikaci a plán dalších funkcí.</div>
              </div>
            </div>
            <div class="card-side">
              <span class="card-tag">Šuplík A5</span>
              <span class="card-cta">Otevřít <i class="fa-solid fa-arrow-right"></i></span>
            </div>
          </div>
        </article>
      </section>
    </div>

    <!-- MÍSTNOST: DCF -->
    <div id="view-dcf" class="view">
      <div class="room-header">
        <div class="room-title-group">
          <div class="room-title">Výpočet vnitřní hodnoty (DCF)</div>
          <div class="room-subtitle">
            Jednoduchý DCF model – zadáš vstupy, dostaneš odhad férové ceny.
          </div>
        </div>
        <button class="back-btn" onclick="goHome()">
          <i class="fa-solid fa-arrow-left"></i>
          Zpět na kostky
        </button>
      </div>

      <div class="room-body">
        <div class="section-title">Základní vstupy</div>
        <div class="section-note">
          Všechna čísla piš v <b>čistých hodnotách</b> (bez tečky/čárky u tisíců), procenta jako číslo (např. 9 = 9&nbsp;%).
        </div>

        <div class="form-grid">
          <div class="field">
            <label for="dcf-name">Název / ticker</label>
            <input id="dcf-name" type="text" placeholder="Např. SOFI" />
          </div>
          <div class="field">
            <label for="dcf-fcf">Volný cashflow v 1. roce (FCF1)</label>
            <input id="dcf-fcf" type="number" placeholder="např. 100000000" />
          </div>
          <div class="field">
            <label for="dcf-growth">Roční růst FCF (g, %)</label>
            <input id="dcf-growth" type="number" placeholder="např. 10" />
          </div>
          <div class="field">
            <label for="dcf-years">Počet let explicitní projekce (N)</label>
            <input id="dcf-years" type="number" value="10" />
          </div>
        </div>

        <div class="form-grid">
          <div class="field">
            <label for="dcf-discount">Diskontní sazba (r, %)</label>
            <input id="dcf-discount" type="number" value="9" />
          </div>
      <div class="form-grid">
          <div class="field">
            <label for="dcf-terminal">Terminální růst po roce N (g<sub>term</sub>, %)</label>
            <input id="dcf-terminal" type="number" value="2" />
          </div>
          <div class="field">
            <label for="dcf-shares">Počet akcií</label>
            <input id="dcf-shares" type="number" placeholder="např. 900000000" />
          </div>
          <div class="field">
            <label for="dcf-mos">Bezpečnostní marže (%)</label>
            <input id="dcf-mos" type="number" value="30" />
          </div>
        </div>

        <div class="form-grid">
          <div class="field">
            <label for="dcf-debt">Čistý dluh (–) nebo hotovost (+)</label>
            <input id="dcf-debt" type="number" value="0" />
          </div>
          <div class="field">
            <label for="dcf-price">Aktuální cena akcie (pro porovnání)</label>
            <input id="dcf-price" type="number" placeholder="nepovinné" />
          </div>
        </div>

        <button class="btn mt-4" onclick="calculateDCF()">
          <i class="fa-solid fa-calculator"></i>
          Spočítat férovou cenu
        </button>

        <div id="dcf-result" class="result-box" style="margin-top: 12px;">
          <div class="result-line">
            <span class="result-label">Výsledek se objeví zde po výpočtu.</span>
          </div>
        </div>

        <div class="info-line">
          <span class="badge-soft">
            <i class="fa-solid fa-plug"></i>
            Připraveno na napojení na internet – později sem doplníme automatické načtení FCF a počtu akcií.
          </span>
        </div>
      </div>
    </div>

    <!-- MÍSTNOST: EARNINGS -->
    <div id="view-earnings" class="view">
      <div class="room-header">
        <div class="room-title-group">
          <div class="room-title">Earnings kalendář</div>
          <div class="room-subtitle">
            Ruční přehled výsledků tvých firem. Data se ukládají do prohlížeče.
          </div>
        </div>
        <button class="back-btn" onclick="goHome()">
          <i class="fa-solid fa-arrow-left"></i>
          Zpět na kostky
        </button>
      </div>

      <div class="room-body">
        <div class="section-title">Přidat nový záznam</div>
        <div class="section-note">
          Až budeme chtít, můžeme tyto údaje tahat automaticky z internetu – teď je to ruční, ale přehledné.
        </div>

        <div class="form-grid">
          <div class="field">
            <label for="earn-ticker">Ticker / firma</label>
            <input id="earn-ticker" type="text" placeholder="např. PLTR" />
          </div>
          <div class="field">
            <label for="earn-date">Datum výsledků</label>
            <input id="earn-date" type="date" />
          </div>
          <div class="field">
            <label for="earn-time">Čas (před/po trhu)</label>
            <select id="earn-time">
              <option value="">Neuvedeno</option>
              <option value="Before open">Before open</option>
              <option value="After close">After close</option>
            </select>
          </div>
          <div class="field">
            <label for="earn-note">Poznámka</label>
            <input id="earn-note" type="text" placeholder="např. důležité pro vstup" />
          </div>
        </div>

        <button class="btn mt-4" onclick="addEarnings()">
          <i class="fa-solid fa-plus"></i>
          Přidat do kalendáře
        </button>

        <div class="table-wrapper mt-8">
          <table>
            <thead>
              <tr>
                <th>Ticker</th>
                <th>Datum</th>
                <th>Čas</th>
                <th>Poznámka</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="earnings-table">
              <!-- dynamicky -->
            </tbody>
          </table>
        </div>

        <div class="info-line">
          <span class="badge-soft">
            <i class="fa-solid fa-cloud-arrow-down"></i>
            Později sem můžeme napojit API (např. pro automatický import earnings).
          </span>
        </div>
      </div>
    </div>

    <!-- MÍSTNOST: PORTFOLIO -->
    <div id="view-portfolio" class="view">
      <div class="room-header">
        <div class="room-title-group">
          <div class="room-title">Moje portfolio</div>
          <div class="room-subtitle">
            Nahraj CSV a podívej se na přehled pozic a celkovou hodnotu.
          </div>
        </div>
        <button class="back-btn" onclick="goHome()">
          <i class="fa-solid fa-arrow-left"></i>
          Zpět na kostky
        </button>
      </div>

      <div class="room-body">
        <div class="section-title">Načtení portfolia z CSV</div>
        <div class="section-note">
          CSV by mělo mít hlavičku: <b>ticker,ks,nakupni_cena,aktualni_cena</b>.<br />
          Aktuální cenu můžeme zatím zadat ručně – internet doplníme později.
        </div>

        <div class="flex-row mt-4">
          <input id="portfolio-file" type="file" accept=".csv" />
          <button class="btn secondary" onclick="loadPortfolioFromCsv()">
            <i class="fa-solid fa-file-import"></i>
            Načíst CSV
          </button>
        </div>

        <div class="info-line">
          Pokud nechceš CSV, můžeš pozice přidávat i ručně:
        </div>

        <div class="form-grid mt-4">
          <div class="field">
            <label for="pf-ticker">Ticker</label>
            <input id="pf-ticker" type="text" placeholder="např. NEE" />
          </div>
          <div class="field">
            <label for="pf-qty">Počet kusů</label>
            <input id="pf-qty" type="number" />
          </div>
          <div class="field">
            <label for="pf-buy">Nákupní cena</label>
            <input id="pf-buy" type="number" />
          </div>
          <div class="field">
            <label for="pf-current">Aktuální cena</label>
            <input id="pf-current" type="number" />
          </div>
        </div>
        <button class="btn mt-4" onclick="addManualPosition()">
          <i class="fa-solid fa-plus"></i>
          Přidat pozici
        </button>

        <div class="table-wrapper mt-8">
          <table>
            <thead>
              <tr>
                <th>Ticker</th>
                <th>Ks</th>
                <th>Nákupní cena</th>
                <th>Aktuální cena</th>
                <th>Investice</th>
                <th>Hodnota</th>
                <th>P/L</th>
              </tr>
            </thead>
            <tbody id="portfolio-table"></tbody>
          </table>
        </div>

        <div id="portfolio-summary" class="result-box mt-4">
          <div class="result-line">
            <span class="result-label">Souhrn portfolia se objeví po přidání pozic.</span>
          </div>
        </div>

        <div class="info-line">
          <span class="badge-soft">
            <i class="fa-solid fa-plug-circle-bolt"></i>
            Připravený háček pro živé ceny: u každého tickeru můžeme později zavolat funkci
            <span style="font-family: monospace;">fetchLivePrice(ticker)</span>.
          </span>
        </div>
      </div>
    </div>

    <!-- MÍSTNOST: WATCHLIST -->
    <div id="view-watchlist" class="view">
      <div class="room-header">
        <div class="room-title-group">
          <div class="room-title">Watchlist & nápady</div>
          <div class="room-subtitle">
            Akcie v hledáčku – jednoduchý přehled, ukládá se do prohlížeče.
          </div>
        </div>
        <button class="back-btn" onclick="goHome()">
          <i class="fa-solid fa-arrow-left"></i>
          Zpět na kostky
        </button>
      </div>

      <div class="room-body">
        <div class="section-title">Přidat sledovanou firmu</div>

        <div class="form-grid">
          <div class="field">
            <label for="wl-ticker">Ticker</label>
            <input id="wl-ticker" type="text" placeholder="např. AVGO" />
          </div>
          <div class="field">
            <label for="wl-thesis">Jednovětá investiční teze</label>
            <input id="wl-thesis" type="text" placeholder="např. růst cloud čipů" />
          </div>
          <div class="field">
            <label for="wl-price">Cílová nákupní cena</label>
            <input id="wl-price" type="number" placeholder="např. 750" />
          </div>
          <div class="field">
            <label for="wl-note">Poznámka</label>
            <input id="wl-note" type="text" placeholder="např. vyčkat na korekci" />
          </div>
        </div>

        <button class="btn mt-4" onclick="addWatchItem()">
          <i class="fa-solid fa-plus"></i>
          Přidat do watchlistu
        </button>

        <div class="table-wrapper mt-8">
          <table>
            <thead>
              <tr>
                <th>Ticker</th>
                <th>Teze</th>
                <th>Cílová cena</th>
                <th>Poznámka</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="watchlist-table"></tbody>
          </table>
        </div>

        <div class="info-line">
          Watchlist se ukládá v tomto zařízení (localStorage).  
          Později můžeme přidat export/import nebo napojení na účet u brokera.
        </div>
      </div>
    </div>

    <!-- MÍSTNOST: NASTAVENÍ -->
    <div id="view-settings" class="view">
      <div class="room-header">
        <div class="room-title-group">
          <div class="room-title">Nastavení & nápověda</div>
          <div class="room-subtitle">
            Informace o aplikaci, jednoduché nastavení a plán rozšíření.
          </div>
        </div>
        <button class="back-btn" onclick="goHome()">
          <i class="fa-solid fa-arrow-left"></i>
          Zpět na kostky
        </button>
      </div>

      <div class="room-body">
        <div class="section-title">O aplikaci</div>
        <div class="section-note">
          Tohle je osobní hub pro analýzu akcií. Běží jako statická stránka na GitHub Pages
          – ideální pro QR kód a rychlé použití z mobilu.
        </div>

        <div class="result-box">
          <div class="result-line">
            <span class="result-label">Verze:</span>
            <span class="result-value">1.0 (offline jádro, připravené na online napojení)</span>
          </div>
          <div class="result-line">
            <span class="result-label">Moduly:</span>
            <span class="result-value">DCF, Earnings, Portfolio, Watchlist, Nastavení</span>
          </div>
          <div class="result-line">
            <span class="result-label">Hosting:</span>
            <span class="result-value">GitHub Pages – jeden QR kód pro všechno.</span>
          </div>
        </div>

        <div class="section-title mt-8">Jednoduché nastavení vzhledu</div>
        <div class="switch-row">
          <label for="setting-compact">Kompaktnější tabulky</label>
          <input id="setting-compact" type="checkbox" onchange="toggleCompactTables(this)" />
        </div>

        <div class="section-title mt-8">Plán rozšíření</div>
        <ul style="font-size: 12px; color: var(--text-muted); margin-top: 4px; padding-left: 18px;">
          <li>automatické načítání finančních dat pro DCF (API),</li>
          <li>živé ceny akcií pro portfolio,</li>
          <li>earnings kalendář napojený na externí zdroj,</li>
          <li>možnost exportu dat a záloh watchlistu.</li>
        </ul>

        <div class="info-line mt-4">
          Všechen kód běží jen v prohlížeči – žádné přihlašování, žádné ukládání na server.
        </div>
      </div>
    </div>
  </div>

  <script>
    // Přepínání mezi kostkami / místnostmi
    function openView(viewId) {
      document.querySelectorAll(".view").forEach((v) => v.classList.remove("active"));
      const target = document.getElementById(viewId);
      if (target) target.classList.add("active");
    }

    function goHome() {
      document.querySelectorAll(".view").forEach((v) => v.classList.remove("active"));
      document.getElementById("main-view").classList.add("active");
    }

    // DCF výpočet
    function calculateDCF() {
      const fcf1 = parseFloat(document.getElementById("dcf-fcf").value);
      const g = parseFloat(document.getElementById("dcf-growth").value) / 100;
      const years = parseInt(document.getElementById("dcf-years").value, 10);
      const r = parseFloat(document.getElementById("dcf-discount").value) / 100;
      const gTerm = parseFloat(document.getElementById("dcf-terminal").value) / 100;
      const shares = parseFloat(document.getElementById("dcf-shares").value);
      const mos = parseFloat(document.getElementById("dcf-mos").value) / 100;
      const netDebt = parseFloat(document.getElementById("dcf-debt").value || 0);
      const marketPrice = parseFloat(document.getElementById("dcf-price").value || "NaN");
      const name = document.getElementById("dcf-name").value || "Firma";

      const box = document.getElementById("dcf-result");

      if (
        isNaN(fcf1) ||
        isNaN(g) ||
        isNaN(years) ||
        isNaN(r) ||
        isNaN(gTerm) ||
        isNaN(shares)
      ) {
        box.innerHTML =
          '<span class="result-bad">Zkontroluj prosím, že máš vyplněná všechna povinná čísla (FCF, růst, roky, diskont, terminální růst, počet akcií).</span>';
        return;
      }

      if (r <= gTerm) {
        box.innerHTML =
          '<span class="result-bad">Diskontní sazba musí být větší než terminální růst, jinak DCF nedává smysl.</span>';
        return;
      }

      let pvSum = 0;
      let fcf = fcf1;

      for (let t = 1; t <= years; t++) {
        if (t > 1) fcf = fcf * (1 + g);
        const pv = fcf / Math.pow(1 + r, t);
        pvSum += pv;
      }

      const fcfN = fcf * (1 + g); // FCF v roce N+1
      const terminalValue = fcfN / (r - gTerm);
      const pvTerminal = terminalValue / Math.pow(1 + r, years);

      const firmValue = pvSum + pvTerminal + netDebt; // netDebt může být +hotovost / -dluh
      const valuePerShare = firmValue / shares;
      const mosPrice = valuePerShare * (1 - mos);

      let comparisonLine = "";
      if (!isNaN(marketPrice)) {
        const diff = ((valuePerShare - marketPrice) / marketPrice) * 100;
        const cls = diff > 0 ? "result-good" : "result-bad";
        const word = diff > 0 ? "podhodnocená" : "nadhodnocená";
        comparisonLine =
          '<div class="result-line"><span class="result-label">Oproti trhu:</span> ' +
          '<span class="' + cls + '">Akcie je přibližně ' +
          (diff > 0 ? "+" : "") +
          diff.toFixed(1) +
          "% " + word + '.</span></div>';
      }

      box.innerHTML =
        '<div class="result-line">' +
        '<span class="result-label">Firma:</span> ' +
        '<span class="result-value">' + name + "</span></div>" +
        '<div class="result-line">' +
        '<span class="result-label">Součet diskontovaných FCF:</span> ' +
        '<span class="result-value">' + pvSum.toFixed(0) + "</span></div>" +
        '<div class="result-line">' +
        '<span class="result-label">Diskontovaná terminální hodnota:</span> ' +
        '<span class="result-value">' + pvTerminal.toFixed(0) + "</span></div>" +
        '<div class="result-line">' +
        '<span class="result-label">Hodnota firmy (equity) celkem:</span> ' +
        '<span class="result-value">' + firmValue.toFixed(0) + "</span></div>" +
        '<div class="result-line">' +
        '<span class="result-label">Férová hodnota na akcii:</span> ' +
        '<span class="result-highlight">' + valuePerShare.toFixed(2) + "</span></div>" +
        '<div class="result-line">' +
        '<span class="result-label">Cílová nákupní cena (po bezpečnostní marži):</span> ' +
        '<span class="result-highlight">' + mosPrice.toFixed(2) + "</span></div>" +
        comparisonLine;
    }

    // Earnings kalendář
    const EARNINGS_KEY = "eqity_earnings";

    function loadEarnings() {
      let data = [];
      try {
        const raw = localStorage.getItem(EARNINGS_KEY);
        if (raw) data = JSON.parse(raw);
      } catch (e) {}
      renderEarnings(data);
    }

    function saveEarnings(data) {
      localStorage.setItem(EARNINGS_KEY, JSON.stringify(data));
      renderEarnings(data);
    }

    function renderEarnings(data) {
      const tbody = document.getElementById("earnings-table");
      if (!tbody) return;
      tbody.innerHTML = "";
      data
        .sort((a, b) => (a.date || "").localeCompare(b.date || ""))
        .forEach((row, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML =
            "<td>" + (row.ticker || "") + "</td>" +
            "<td>" + (row.date || "") + "</td>" +
            "<td>" + (row.time || "") + "</td>" +
            "<td>" + (row.note || "") + "</td>" +
            '<td><a href="#" class="small-link" onclick="deleteEarnings(' + idx + ');return false;">Smazat</a></td>';
          tbody.appendChild(tr);
        });
    }

    function addEarnings() {
      const ticker = document.getElementById("earn-ticker").value.trim();
      const date = document.getElementById("earn-date").value;
      const time = document.getElementById("earn-time").value;
      const note = document.getElementById("earn-note").value.trim();

      if (!ticker || !date) {
        alert("Vyplň prosím minimálně ticker a datum.");
        return;
      }

      let data = [];
      try {
        const raw = localStorage.getItem(EARNINGS_KEY);
        if (raw) data = JSON.parse(raw);
      } catch (e) {}

      data.push({ ticker, date, time, note });
      saveEarnings(data);

      document.getElementById("earn-ticker").value = "";
      document.getElementById("earn-date").value = "";
      document.getElementById("earn-time").value = "";
      document.getElementById("earn-note").value = "";
    }

    function deleteEarnings(index) {
      let data = [];
      try {
        const raw = localStorage.getItem(EARNINGS_KEY);
        if (raw) data = JSON.parse(raw);
      } catch (e) {}
      data.splice(index, 1);
      saveEarnings(data);
    }

    // Portfolio
    let portfolio = [];

    function addPosition(ticker, qty, buy, current) {
      if (!ticker || isNaN(qty) || isNaN(buy)) return;
      portfolio.push({
        ticker: ticker.toUpperCase(),
        qty,
        buy,
        current: isNaN(current) ? null : current
      });
      renderPortfolio();
    }

    function addManualPosition() {
      const t = document.getElementById("pf-ticker").value.trim();
      const q = parseFloat(document.getElementById("pf-qty").value);
      const b = parseFloat(document.getElementById("pf-buy").value);
      const c = parseFloat(document.getElementById("pf-current").value);

      if (!t || isNaN(q) || isNaN(b)) {
        alert("Vyplň prosím ticker, počet a nákupní cenu.");
        return;
      }

      addPosition(t, q, b, c);

      document.getElementById("pf-ticker").value = "";
      document.getElementById("pf-qty").value = "";
      document.getElementById("pf-buy").value = "";
      document.getElementById("pf-current").value = "";
    }

    function renderPortfolio() {
      const tbody = document.getElementById("portfolio-table");
      const summaryBox = document.getElementById("portfolio-summary");
      if (!tbody || !summaryBox) return;

      tbody.innerHTML = "";
      let totalInvested = 0;
      let totalValue = 0;

      portfolio.forEach((p) => {
        const invested = p.qty * p.buy;
        const hasCurrent = p.current != null && !isNaN(p.current);
        const value = hasCurrent ? p.qty * p.current : 0;

        totalInvested += invested;
        if (hasCurrent) totalValue += value;

        const diff = hasCurrent ? value - invested : null;
        const diffPct = hasCurrent ? (diff / invested) * 100 : null;

        const tr = document.createElement("tr");
        tr.innerHTML =
          "<td>" + p.ticker + "</td>" +
          "<td>" + p.qty + "</td>" +
          "<td>" + p.buy.toFixed(2) + "</td>" +
          "<td>" + (hasCurrent ? p.current.toFixed(2) : "-") + "</td>" +
          "<td>" + invested.toFixed(2) + "</td>" +
          "<td>" + (hasCurrent ? value.toFixed(2) : "-") + "</td>" +
          "<td>" +
          (diff != null
            ? '<span class="' + (diff >= 0 ? "result-good" : "result-bad") + '">' +
              (diff >= 0 ? "+" : "") +
              diff.toFixed(2) +
              " (" +
              (diff >= 0 ? "+" : "") +
              diffPct.toFixed(1) +
              "%)</span>"
            : "-") +
          "</td>";
        tbody.appendChild(tr);
      });

      if (portfolio.length === 0) {
        summaryBox.innerHTML =
          '<span class="result-label">Souhrn portfolia se objeví po přidání pozic.</span>';
        return;
      }

      let summaryHtml =
        '<div class="result-line"><span class="result-label">Celkem investováno:</span> ' +
        '<span class="result-value">' + totalInvested.toFixed(2) + "</span></div>";

      if (totalValue > 0) {
        const diff = totalValue - totalInvested;
        const diffPct = (diff / totalInvested) * 100;
        summaryHtml +=
          '<div class="result-line"><span class="result-label">Aktuální hodnota:</span> ' +
          '<span class="result-value">' + totalValue.toFixed(2) + "</span></div>" +
          '<div class="result-line"><span class="result-label">Celkový P/L:</span> ' +
          '<span class="' + (diff >= 0 ? "result-good" : "result-bad") + '">' +
          (diff >= 0 ? "+" : "") +
          diff.toFixed(2) +
          " (" +
          (diff >= 0 ? "+" : "") +
          diffPct.toFixed(1) +
          "%)</span></div>";
      } else {
        summaryHtml +=
          '<div class="result-line"><span class="result-label">Aktuální ceny zatím chybí.</span></div>';
      }

      summaryBox.innerHTML = summaryHtml;
    }

    function loadPortfolioFromCsv() {
      const input = document.getElementById("portfolio-file");
      if (!input.files || !input.files[0]) {
        alert("Vyber prosím CSV soubor.");
        return;
      }

      const file = input.files[0];
      const reader = new FileReader();
      reader.onload = function (e) {
        const text = e.target.result;
        parsePortfolioCsv(text);
      };
      reader.readAsText(file);
    }

    function parsePortfolioCsv(text) {
      const lines = text.split(/\r?\n/).filter((l) => l.trim().length > 0);
      if (lines.length <= 1) {
        alert("CSV neobsahuje žádná data.");
        return;
      }

      portfolio = []; // reset
      for (let i = 1; i < lines.length; i++) {
        const cols = lines[i].split(",");
        if (cols.length < 3) continue;
        const ticker = cols[0].trim();
        const qty = parseFloat(cols[1]);
        const buy = parseFloat(cols[2]);
        const current = cols[3] ? parseFloat(cols[3]) : NaN;
        if (!ticker || isNaN(qty) || isNaN(buy)) continue;
        addPosition(ticker, qty, buy, current);
      }
    }

    // Watchlist
    const WATCH_KEY = "eqity_watchlist";

    function loadWatchlist() {
      let data = [];
      try {
        const raw = localStorage.getItem(WATCH_KEY);
        if (raw) data = JSON.parse(raw);
      } catch (e) {}
      renderWatchlist(data);
    }

    function saveWatchlist(data) {
      localStorage.setItem(WATCH_KEY, JSON.stringify(data));
      renderWatchlist(data);
    }

    function renderWatchlist(data) {
      const tbody = document.getElementById("watchlist-table");
      if (!tbody) return;
      tbody.innerHTML = "";
      data.forEach((row, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML =
          "<td>" + (row.ticker || "") + "</td>" +
          "<td>" + (row.thesis || "") + "</td>" +
          "<td>" + (row.targetPrice != null ? row.targetPrice : "") + "</td>" +
          "<td>" + (row.note || "") + "</td>" +
          '<td><a href="#" class="small-link" onclick="deleteWatchItem(' + idx + ');return false;">Smazat</a></td>';
        tbody.appendChild(tr);
      });
    }

    function addWatchItem() {
      const ticker = document.getElementById("wl-ticker").value.trim();
      const thesis = document.getElementById("wl-thesis").value.trim();
      const targetPrice = parseFloat(document.getElementById("wl-price").value);
      const note = document.getElementById("wl-note").value.trim();

      if (!ticker) {
        alert("Vyplň prosím ticker.");
        return;
      }

      let data = [];
      try {
        const raw = localStorage.getItem(WATCH_KEY);
        if (raw) data = JSON.parse(raw);
      } catch (e) {}

      data.push({
        ticker: ticker.toUpperCase(),
        thesis,
        targetPrice: isNaN(targetPrice) ? null : targetPrice,
        note
      });
      saveWatchlist(data);

      document.getElementById("wl-ticker").value = "";
      document.getElementById("wl-thesis").value = "";
      document.getElementById("wl-price").value = "";
      document.getElementById("wl-note").value = "";
    }

    function deleteWatchItem(index) {
      let data = [];
      try {
        const raw = localStorage.getItem(WATCH_KEY);
        if (raw) data = JSON.parse(raw);
      } catch (e) {}
      data.splice(index, 1);
      saveWatchlist(data);
    }

    // Nastavení
    function toggleCompactTables(chk) {
      const compact = chk.checked;
      document.querySelectorAll("table").forEach((t) => {
        t.style.fontSize = compact ? "11px" : "12px";
      });
    }

    // Inicializace
    document.addEventListener("DOMContentLoaded", function () {
      loadEarnings();
      loadWatchlist();
      renderPortfolio();
    });
  </script>
</body>
</html>
