<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Equity Analyz√©r ‚Äì DCF & Watchlist</title>

  <style>
    :root{
      --bg0:#050513;
      --bg1:#0a0a1f;
      --card:#0f1030;
      --card2:#131440;
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.16);

      --txt:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.72);
      --faint:rgba(255,255,255,.55);

      --purple:#8b5cf6;
      --purple2:#a78bfa;
      --blue:#60a5fa;
      --cyan:#22d3ee;

      --bear:#60a5fa;   /* modr√° */
      --base:#a78bfa;   /* fialov√° */
      --bull:#22d3ee;   /* cyan */

      --good:#34d399;
      --bad:#fb7185;

      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --r16:16px;
      --r20:20px;
      --r24:24px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(139,92,246,.28), transparent 60%),
        radial-gradient(900px 650px at 85% 20%, rgba(96,165,250,.22), transparent 60%),
        radial-gradient(900px 650px at 50% 95%, rgba(34,211,238,.16), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    .wrap{
      max-width:1080px;
      margin:0 auto;
      padding:18px 14px 40px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px 16px;
      background: linear-gradient(180deg, rgba(15,16,48,.75), rgba(10,10,31,.55));
      border:1px solid var(--stroke);
      border-radius: var(--r24);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .brand{
      display:flex; align-items:center; gap:12px;
      min-width: 0;
    }
    .logo{
      width:44px; height:44px; border-radius:14px;
      background: radial-gradient(circle at 30% 30%, rgba(167,139,250,.95), rgba(96,165,250,.65) 55%, rgba(34,211,238,.35));
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 14px 30px rgba(0,0,0,.35);
      flex: 0 0 auto;
    }
    .titleBox{ min-width:0; }
    .h1{
      margin:0;
      font-size:18px;
      letter-spacing:.3px;
      line-height:1.15;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .sub{
      margin:2px 0 0;
      font-size:13px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(15,16,48,.55);
      color:var(--muted);
      font-size:13px;
      user-select:none;
      flex: 0 0 auto;
    }

    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }

    .card{
      grid-column: span 12;
      border-radius: var(--r24);
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(19,20,64,.82), rgba(15,16,48,.62));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .card::before{
      content:"";
      position:absolute; inset:-1px;
      background:
        radial-gradient(700px 240px at 15% 10%, rgba(167,139,250,.22), transparent 60%),
        radial-gradient(600px 240px at 85% 20%, rgba(96,165,250,.18), transparent 60%);
      pointer-events:none;
    }

    .cardBtn{
      width:100%;
      padding:18px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background: transparent;
      border:0;
      color: var(--txt);
      cursor:pointer;
      position:relative;
      z-index:1;
    }

    .cardLeft{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }

    .icon{
      width:44px; height:44px;
      border-radius: 16px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
    }
    .icon.dcf{ background: rgba(167,139,250,.14); }
    .icon.wl{  background: rgba(96,165,250,.14); }
    .icon.about{ background: rgba(34,211,238,.12); }

    .cardText{ min-width:0; }
    .cardTitle{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
    }
    .cardDesc{
      margin:4px 0 0;
      font-size:13px;
      color:var(--muted);
      line-height:1.35;
    }

    .chev{
      width:36px; height:36px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      display:grid;
      place-items:center;
      color:var(--muted);
      background: rgba(255,255,255,.03);
      flex: 0 0 auto;
    }/* screens (m√≠stnosti) */
    .screen{
      display:none;
      margin-top:14px;
      border-radius: var(--r24);
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(19,20,64,.86), rgba(10,10,31,.70));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .screen.active{ display:block; }

    .screenTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:16px 16px;
      border-bottom:1px solid var(--stroke);
      background: rgba(10,10,31,.35);
    }
    .screenTitle{
      margin:0;
      font-size:18px;
      letter-spacing:.2px;
    }
    .backBtn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.05);
      color: var(--txt);
      cursor:pointer;
      font-weight:700;
    }
    .backBtn:hover{ background: rgba(255,255,255,.08); }

    .content{
      padding:16px;
    }

    .row{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
      align-items:start;
    }
    .col6{ grid-column: span 12; }
    .col12{ grid-column: span 12; }

    @media (min-width: 860px){
      .card{ grid-column: span 6; }
      .col6{ grid-column: span 6; }
    }

    .panel{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      border-radius: var(--r20);
      padding:14px;
    }

    .panel h3{
      margin:0 0 10px;
      font-size:14px;
      color:var(--muted);
      letter-spacing:.2px;
      text-transform:uppercase;
    }

    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin: 0 0 6px;
      letter-spacing:.2px;
    }

    .field{
      display:flex;
      align-items:center;
      gap:8px;
    }

    input, select{
      width:100%;
      padding:11px 12px;
      border-radius: 14px;
      border:1px solid var(--stroke2);
      background: rgba(8,8,25,.55);
      color: var(--txt);
      outline:none;
    }
    input::placeholder{ color: rgba(255,255,255,.35); }

    .helpBtn{
      width:36px; height:36px;
      border-radius: 14px;
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.05);
      color: var(--txt);
      cursor:pointer;
      flex: 0 0 auto;
      font-weight:900;
    }

    .helpBox{
      margin-top:8px;
      display:none;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      border-radius: 14px;
      padding:10px 12px;
      color: var(--muted);
      font-size:13px;
      line-height:1.45;
    }
    .helpBox.open{ display:block; }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .btn{
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.06);
      color: var(--txt);
      padding:11px 14px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:800;
      letter-spacing:.2px;
    }
    .btn:hover{ background: rgba(255,255,255,.10); }

    .btn.primary{
      background: linear-gradient(135deg, rgba(167,139,250,.95), rgba(96,165,250,.85));
      border-color: rgba(255,255,255,.18);
      color:#0a0a1f;
    }

    .tagRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .tag{
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size:12px;
    }

    .resultBox{
      border-radius: var(--r20);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      padding:14px;
      margin-top:12px;
    }

    .resultGrid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:10px;
    }
    .metric{
      grid-column: span 12;
      border-radius: 16px;
      border:1px solid var(--stroke);
      background: rgba(10,10,31,.35);
      padding:12px;
    }
    @media (min-width: 860px){
      .metric{ grid-column: span 4; }
    }

    .metric .k{
      font-size:12px;
      color:var(--muted);
      margin:0 0 6px;
      letter-spacing:.2px;
    }
    .metric .v{
      margin:0;
      font-size:20px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .metric.bear{ border-color: rgba(96,165,250,.35); }
    .metric.base{ border-color: rgba(167,139,250,.40); }
    .metric.bull{ border-color: rgba(34,211,238,.35); }

    .delta{
      margin-top:6px;
      font-size:13px;
      font-weight:800;
    }
    .delta.good{ color: var(--good); }
    .delta.bad{ color: var(--bad); }

    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius: var(--r20);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
    }
    th, td{
      padding:12px 10px;
      border-bottom:1px solid var(--stroke);
      font-size:13px;
      color: var(--txt);
      text-align:left;
      vertical-align:top;
      white-space:nowrap;
    }
    th{
      color: var(--muted);
      font-weight:800;
      background: rgba(10,10,31,.35);
    }
    tr:last-child td{ border-bottom:0; }

    .miniBtn{
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.06);
      color: var(--txt);
      cursor:pointer;
      font-weight:900;
    }

    .note{
      margin-top:10px;
      color: var(--muted);
      font-size:13px;
      line-height:1.45;
    }
  </style>
</head><body>
  <div class="wrap">

    <div class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div class="titleBox">
          <p class="h1">Equity Analyz√©r</p>
          <p class="sub">DCF v√Ωpoƒçet (3 sc√©n√°≈ôe) + Watchlist (LocalStorage)</p>
        </div>
      </div>
      <div class="pill">Stabiln√≠ verze ‚Ä¢ 3 ≈°upl√≠ky</div>
    </div>

    <!-- HOME: 3 ≈°upl√≠ky -->
    <div id="home" class="grid">
      <div class="card">
        <button class="cardBtn" data-open="dcf">
          <div class="cardLeft">
            <div class="icon dcf">üìà</div>
            <div class="cardText">
              <p class="cardTitle">DCF model</p>
              <p class="cardDesc">Rychl√Ω v√Ωpoƒçet f√©rov√© ceny akcie (BEAR/BASE/BULL) + ulo≈æen√≠ do Watchlistu.</p>
            </div>
          </div>
          <div class="chev">‚Ä∫</div>
        </button>
      </div>

      <div class="card">
        <button class="cardBtn" data-open="watchlist">
          <div class="cardLeft">
            <div class="icon wl">üßæ</div>
            <div class="cardText">
              <p class="cardTitle">Watchlist</p>
              <p class="cardDesc">Ulo≈æen√© v√Ωpoƒçty. Ka≈æd√Ω ≈ô√°dek lze odstranit zvl√°≈°≈•.</p>
            </div>
          </div>
          <div class="chev">‚Ä∫</div>
        </button>
      </div>

      <div class="card">
        <button class="cardBtn" data-open="about">
          <div class="cardLeft">
            <div class="icon about">üí°</div>
            <div class="cardText">
              <p class="cardTitle">O aplikaci</p>
              <p class="cardDesc">Pro koho je, jak funguje a co znamenaj√≠ vstupy v DCF.</p>
            </div>
          </div>
          <div class="chev">‚Ä∫</div>
        </button>
      </div>
    </div>

    <!-- SCREEN: DCF -->
    <section id="screen-dcf" class="screen" aria-hidden="true">
      <div class="screenTop">
        <h2 class="screenTitle">DCF model ‚Äì f√©rov√° cena (3 sc√©n√°≈ôe)</h2>
        <button class="backBtn" data-back>‚Üê Zpƒõt</button>
      </div>

      <div class="content">
        <div class="row">
          <div class="col6">
            <div class="panel">
              <h3>Vstupy</h3>

              <div class="row">
                <div class="col6">
                  <label>Ticker</label>
                  <div class="field">
                    <input id="in_ticker" placeholder="nap≈ô. AAPL" />
                    <button class="helpBtn" data-help="h_ticker">?</button>
                  </div>
                  <div id="h_ticker" class="helpBox">
                    Zkratka akcie (ticker). Slou≈æ√≠ pro ulo≈æen√≠ do Watchlistu.
                  </div>
                </div>

                <div class="col6">
                  <label>Mƒõna</label>
                  <div class="field">
                    <select id="in_ccy">
                      <option value="USD">USD</option>
                      <option value="EUR">EUR</option>
                    </select>
                    <button class="helpBtn" data-help="h_ccy">?</button>
                  </div>
                  <div id="h_ccy" class="helpBox">
                    Zvol mƒõnu, ve kter√© zad√°v√°≈° FCF a cenu akcie.
                  </div>
                </div>

                <div class="col6">
                  <label>Aktu√°ln√≠ cena akcie</label>
                  <div class="field">
                    <input id="in_price" placeholder="nap≈ô. 180.50" />
                    <button class="helpBtn" data-help="h_price">?</button>
                  </div>
                  <div id="h_price" class="helpBox">
                    Aktu√°ln√≠ tr≈æn√≠ cena. Pou≈æije se pro v√Ωpoƒçet % podhodnocen√≠/nadhodnocen√≠.
                  </div>
                </div>

                <div class="col6">
                  <label>Free Cash Flow (TTM)</label>
                  <div class="field">
                    <input id="in_fcf" placeholder="nap≈ô. 1000000000" />
                    <button class="helpBtn" data-help="h_fcf">?</button>
                  </div>
                  <div id="h_fcf" class="helpBox">
                    Roƒçn√≠ voln√Ω cash flow (TTM). Zad√°vej v absolutn√≠ hodnotƒõ (nap≈ô. 1 000 000 000).
                    M≈Ø≈æe≈° ps√°t s mezerami, ƒç√°rkou i teƒçkou.
                  </div>
                </div>

                <div class="col6">
                  <label>Poƒçet akci√≠ (Shares Outstanding)</label>
                  <div class="field">
                    <input id="in_shares" placeholder="nap≈ô. 16000000000" />
                    <button class="helpBtn" data-help="h_shares">?</button>
                  </div>
                  <div id="h_shares" class="helpBox">
                    Celkov√Ω poƒçet akci√≠. V√Ωpoƒçet dƒõl√≠ hodnotu firmy poƒçtem akci√≠ ‚Üí cena na akcii.
                  </div>
                </div>

                <div class="col6">
                  <label>ƒåist√Ω dluh (Net Debt) ‚Äì voliteln√©</label>
                  <div class="field">
                    <input id="in_netdebt" placeholder="nap≈ô. 5000000000 (nebo 0)" />
                    <button class="helpBtn" data-help="h_netdebt">?</button>
                  </div>
                  <div id="h_netdebt" class="helpBox">
                    Net Debt (dluh minus hotovost). Odeƒç√≠t√° se od hodnoty firmy (EV ‚Üí Equity). Nev√≠≈°-li, dej 0.
                  </div>
                </div>

                <div class="col6">
                  <label>Diskontn√≠ sazba (r)</label>
                  <div class="field">
                    <input id="in_discount" placeholder="nap≈ô. 0.09" />
                    <button class="helpBtn" data-help="h_discount">?</button>
                  </div>
                  <div id="h_discount" class="helpBox">
                    Diskontn√≠ sazba (nap≈ô. 0.09 = 9 %). Pou≈æijeme pro diskont budouc√≠ch cash flow.
                  </div>
                </div>

                <div class="col6">
                  <label>Termin√°ln√≠ r≈Øst (g<sub>t</sub>)</label>
                  <div class="field">
                    <input id="in_tg" placeholder="nap≈ô. 0.02" />
                    <button class="helpBtn" data-help="h_tg">?</button>
                  </div>
                  <div id="h_tg" class="helpBox">
                    Dlouhodob√Ω r≈Øst po projekƒçn√≠m obdob√≠ (typicky 0.01‚Äì0.03). Mus√≠ b√Ωt men≈°√≠ ne≈æ diskontn√≠ sazba.
                  </div>
                </div>

                <div class="col6">
                  <label>Poƒçet let projekce</label>
                  <div class="field">
                    <input id="in_years" placeholder="nap≈ô. 10" />
                    <button class="helpBtn" data-help="h_years">?</button>
                  </div>
                  <div id="h_years" class="helpBox">
                    Kolik let prom√≠t√°me budouc√≠ cash flow (typicky 5‚Äì10).
                  </div>
                </div>

                <div class="col12">
                  <label>R≈Øst FCF ‚Äì 3 sc√©n√°≈ôe (BEAR / BASE / BULL)</label>
                  <div class="row">
                    <div class="col6">
                      <div class="field">
                        <input id="in_g_bear" placeholder="BEAR nap≈ô. 0.02" />
                        <button class="helpBtn" data-help="h_g_bear">?</button>
                      </div>
                      <div id="h_g_bear" class="helpBox">
                        Konzervativn√≠ r≈Øst FCF (nap≈ô. 2 % roƒçnƒõ).
                      </div>
                    </div>
                    <div class="col6">
                      <div class="field">
                        <input id="in_g_base" placeholder="BASE nap≈ô. 0.05" />
                        <button class="helpBtn" data-help="h_g_base">?</button>
                      </div>
                      <div id="h_g_base" class="helpBox">
                        Realistick√Ω r≈Øst FCF (nap≈ô. 5 % roƒçnƒõ).
                      </div>
                    </div>
                    <div class="col6">
                      <div class="field">
                        <input id="in_g_bull" placeholder="BULL nap≈ô. 0.08" />
                        <button class="helpBtn" data-help="h_g_bull">?</button>
                      </div>
                      <div id="h_g_bull" class="helpBox">
                        Optimistick√Ω r≈Øst FCF (nap≈ô. 8 % roƒçnƒõ).
                      </div>
                    </div>
                    <div class="col6">
                      <div class="field">
                        <select id="in_mos_on">
                          <option value="off">Margin of Safety: vypnuto</option>
                          <option value="on">Margin of Safety: zapnuto</option>
                        </select>
                        <button class="helpBtn" data-help="h_mos">?</button>
                      </div>
                      <div id="h_mos" class="helpBox">
                        Pokud zapne≈°, uk√°≈æeme i ‚Äúc√≠lovou cenu‚Äù jako 20% pod BASE (konzervativn√≠ n√°kupn√≠ cena).
                      </div>
                    </div>
                  </div>
                </div>

              </div>

              <div class="btnRow">
                <button id="btn_calc" class="btn primary">Spoƒç√≠tat</button>
                <button id="btn_save" class="btn">Ulo≈æit do Watchlistu</button>
              </div>

              <div class="note" id="dcf_msg"></div>
            </div>
          </div>

          <div class="col6">
            <div class="panel">
              <h3>V√Ωsledek</h3>
              <div id="resultWrap" class="resultBox">
                <div class="note">Zadej vstupy a klikni na <b>Spoƒç√≠tat</b>. Zobraz√≠ se f√©rov√° cena pro BEAR/BASE/BULL + % rozd√≠l v≈Øƒçi aktu√°ln√≠ cenƒõ.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section><!-- SCREEN: WATCHLIST -->
    <section id="screen-watchlist" class="screen" aria-hidden="true">
      <div class="screenTop">
        <h2 class="screenTitle">Watchlist ‚Äì ulo≈æen√© v√Ωpoƒçty</h2>
        <button class="backBtn" data-back>‚Üê Zpƒõt</button>
      </div>

      <div class="content">
        <div class="panel">
          <h3>Ulo≈æen√© polo≈æky</h3>

          <div class="btnRow" style="margin-top:0;">
            <button id="btn_export_csv" class="btn">Export CSV</button>
            <button id="btn_clear_all" class="btn">Smazat v≈°e</button>
          </div>

          <div style="margin-top:12px; overflow:auto;">
            <table>
              <thead>
                <tr>
                  <th>Datum</th>
                  <th>Ticker</th>
                  <th>Mƒõna</th>
                  <th>BEAR</th>
                  <th>BASE</th>
                  <th>BULL</th>
                  <th>MoS (BASE-20%)</th>
                  <th>Akce</th>
                </tr>
              </thead>
              <tbody id="wl_body">
                <tr><td colspan="8" style="color:rgba(255,255,255,.65);">Zat√≠m nic ulo≈æen√©ho.</td></tr>
              </tbody>
            </table>
          </div>

          <div class="note">
            Ka≈ædou polo≈æku m≈Ø≈æe≈° smazat zvl√°≈°≈• tlaƒç√≠tkem <b>‚úï</b>. Data se ukl√°daj√≠ do prohl√≠≈æeƒçe (LocalStorage).
          </div>
        </div>
      </div>
    </section>

    <!-- SCREEN: ABOUT -->
    <section id="screen-about" class="screen" aria-hidden="true">
      <div class="screenTop">
        <h2 class="screenTitle">O aplikaci</h2>
        <button class="backBtn" data-back>‚Üê Zpƒõt</button>
      </div>

      <div class="content">
        <div class="panel">
          <h3>Pro koho je</h3>
          <p class="note" style="margin-top:0;">
            Tato aplikace je pro investory, kte≈ô√≠ chtƒõj√≠ umƒõt <b>sami</b> odhadnout f√©rovou cenu akcie pomoc√≠ DCF (Discounted Cash Flow).
            Nen√≠ to ‚Äúmagick√° AI rada‚Äù. Je to n√°stroj, kter√Ω tƒõ vede k tomu, abys rozumƒõl tomu, <b>co zad√°v√°≈°</b> a proƒç.
          </p>

          <h3>Jak funguje DCF v t√©to aplikaci</h3>
          <p class="note" style="margin-top:0;">
            Vezmeme v√Ωchoz√≠ <b>Free Cash Flow (TTM)</b>, prom√≠tneme ho do budoucnosti po zadan√Ω poƒçet let (projekce) a ka≈æd√Ω rok ho diskontujeme diskontn√≠ sazbou <b>r</b>.
            Po skonƒçen√≠ projekce spoƒç√≠t√°me <b>termin√°ln√≠ hodnotu</b> (Gordon≈Øv model) pomoc√≠ termin√°ln√≠ho r≈Østu <b>g<sub>t</sub></b>.
            Nakonec odeƒçteme <b>Net Debt</b> a vydƒõl√≠me poƒçtem akci√≠ ‚Üí v√Ωsledkem je <b>f√©rov√° cena na akcii</b>.
          </p>

          <h3>Co znamenaj√≠ vstupy (rychl√© vysvƒõtlen√≠)</h3>
          <ul class="note" style="margin-top:0;">
            <li><b>FCF (TTM)</b>: hotovost, kterou firma re√°lnƒõ generuje po investic√≠ch (z√°klad DCF).</li>
            <li><b>Shares Outstanding</b>: poƒçet akci√≠ ‚Äî p≈ôevod z hodnoty firmy na cenu 1 akcie.</li>
            <li><b>Diskontn√≠ sazba (r)</b>: ‚Äúcena rizika‚Äù ‚Äî ƒç√≠m vy≈°≈°√≠, t√≠m konzervativnƒõj≈°√≠ v√Ωsledek.</li>
            <li><b>R≈Øst (BEAR/BASE/BULL)</b>: t≈ôi varianty budoucnosti ‚Äî konzervativn√≠ / realistick√° / optimistick√°.</li>
            <li><b>Termin√°ln√≠ r≈Øst</b>: dlouhodob√Ω r≈Øst po projekci (typicky n√≠zk√Ω, stabiln√≠).</li>
            <li><b>Net Debt</b>: dluh minus hotovost ‚Äî odeƒç√≠t√° se od hodnoty pro akcion√°≈ôe.</li>
          </ul>

          <h3>Pozn√°mka</h3>
          <p class="note" style="margin-top:0;">
            V√Ωstup je odhad, ne jistota. DCF je citliv√Ω na vstupy ‚Äî proto tu m√°≈° 3 sc√©n√°≈ôe a volitelnƒõ Margin of Safety (20 % pod BASE).
          </p>
        </div>
      </div>
    </section>

  </div>

  <script>// ====== Utilities (stabiln√≠ parse, ≈æ√°dn√© rozbit√≠ na ƒç√°rce) ======
    const $ = (id) => document.getElementById(id);

    function parseNum(v){
      const s = String(v ?? "")
        .trim()
        .replace(/\s+/g, "")   // mezery pryƒç
        .replace(",", ".");    // ƒç√°rka -> teƒçka
      if(!s) return NaN;
      const n = Number(s);
      return Number.isFinite(n) ? n : NaN;
    }

    function fmtMoney(x, ccy){
      if(!Number.isFinite(x)) return "‚Äî";
      try{
        return new Intl.NumberFormat("cs-CZ", { style:"currency", currency: ccy, maximumFractionDigits:2 }).format(x);
      }catch{
        return `${x.toFixed(2)} ${ccy}`;
      }
    }

    function fmtPct(x){
      if(!Number.isFinite(x)) return "‚Äî";
      const sign = x > 0 ? "+" : "";
      return `${sign}${(x*100).toFixed(1)} %`;
    }

    function nowId(){
      return `${Date.now()}_${Math.random().toString(16).slice(2,8)}`;
    }

    function formatDate(ts){
      const d = new Date(ts);
      return d.toLocaleString("cs-CZ", { year:"numeric", month:"2-digit", day:"2-digit", hour:"2-digit", minute:"2-digit" });
    }

    // ====== Storage (jedno m√≠sto pravdy) ======
    const WL_KEY = "ea_watchlist_v1";

    function wlLoad(){
      try{
        const raw = localStorage.getItem(WL_KEY);
        if(!raw) return { version:1, items:[] };
        const data = JSON.parse(raw);
        if(!data || !Array.isArray(data.items)) return { version:1, items:[] };
        return data;
      }catch{
        return { version:1, items:[] };
      }
    }

    function wlSave(data){
      localStorage.setItem(WL_KEY, JSON.stringify(data));
    }

    function wlAdd(item){
      const data = wlLoad();
      data.items.unshift(item);
      wlSave(data);
    }

    function wlRemove(id){
      const data = wlLoad();
      data.items = data.items.filter(x => x.id !== id);
      wlSave(data);
    }

    function wlClear(){
      wlSave({ version:1, items:[] });
    }

    // ====== DCF core ======
    function dcfPerShare({ fcf, shares, netDebt, r, tg, years, g }){
      // projekce + diskont
      let pv = 0;
      let f = fcf;

      for(let t=1; t<=years; t++){
        f = f * (1 + g);
        pv += f / Math.pow(1 + r, t);
      }

      // terminal value (Gordon)
      const fN = f;
      const tv = (fN * (1 + tg)) / (r - tg);
      const pvTv = tv / Math.pow(1 + r, years);

      const equityValue = (pv + pvTv) - netDebt;
      return equityValue / shares;
    }

    let lastCalc = null; // ukl√°d√°me a≈æ po √∫spƒõ≈°n√©m v√Ωpoƒçtu

    function calcAndRender(){
      const ticker = String($("in_ticker").value || "").trim().toUpperCase();
      const ccy = $("in_ccy").value;

      const price = parseNum($("in_price").value);
      const fcf = parseNum($("in_fcf").value);
      const shares = parseNum($("in_shares").value);
      const netDebt = parseNum($("in_netdebt").value) || 0;

      const r = parseNum($("in_discount").value);
      const tg = parseNum($("in_tg").value);
      const years = Math.round(parseNum($("in_years").value));

      const gBear = parseNum($("in_g_bear").value);
      const gBase = parseNum($("in_g_base").value);
      const gBull = parseNum($("in_g_bull").value);

      const mosOn = $("in_mos_on").value === "on";

      // Validace (pevn√° ‚Äì ≈æ√°dn√© ‚Äúchyb√≠ fcf‚Äù kv≈Øli ID)
      const msg = $("dcf_msg");
      msg.textContent = "";

      if(!ticker){
        msg.textContent = "Zadej ticker (nap≈ô. AAPL).";
        return;
      }
      if(!Number.isFinite(price) || price <= 0){
        msg.textContent = "Zadej aktu√°ln√≠ cenu akcie (kladn√© ƒç√≠slo).";
        return;
      }
      if(!Number.isFinite(fcf) || fcf <= 0){
        msg.textContent = "Zadej Free Cash Flow (TTM) ‚Äì kladn√© ƒç√≠slo.";
        return;
      }
      if(!Number.isFinite(shares) || shares <= 0){
        msg.textContent = "Zadej poƒçet akci√≠ (Shares Outstanding) ‚Äì kladn√© ƒç√≠slo.";
        return;
      }
      if(!Number.isFinite(r) || r <= 0 || r >= 1){
        msg.textContent = "Diskontn√≠ sazba (r) mus√≠ b√Ωt mezi 0 a 1 (nap≈ô. 0.09).";
        return;
      }
      if(!Number.isFinite(tg) || tg < 0 || tg >= r){
        msg.textContent = "Termin√°ln√≠ r≈Øst (g‚Çú) mus√≠ b√Ωt >= 0 a men≈°√≠ ne≈æ r (nap≈ô. 0.02).";
        return;
      }
      if(!Number.isFinite(years) || years < 1 || years > 30){
        msg.textContent = "Poƒçet let projekce zadej jako rozumn√© cel√© ƒç√≠slo (1‚Äì30).";
        return;
      }
      if(!Number.isFinite(gBear) || !Number.isFinite(gBase) || !Number.isFinite(gBull)){
        msg.textContent = "Vypl≈à r≈Østy BEAR/BASE/BULL (nap≈ô. 0.02 / 0.05 / 0.08).";
        return;
      }

      // v√Ωpoƒçet 3 sc√©n√°≈ô≈Ø
      let bear, base, bull;
      try{
        bear = dcfPerShare({ fcf, shares, netDebt, r, tg, years, g:gBear });
        base = dcfPerShare({ fcf, shares, netDebt, r, tg, years, g:gBase });
        bull = dcfPerShare({ fcf, shares, netDebt, r, tg, years, g:gBull });
      }catch{
        msg.textContent = "V√Ωpoƒçet selhal ‚Äì zkontroluj, zda m√°≈° r > g‚Çú a rozumn√© vstupy.";
        return;
      }

      // % vs aktu√°ln√≠ cena (kladn√© = podhodnocen√©)
      const dBear = (bear/price) - 1;
      const dBase = (base/price) - 1;
      const dBull = (bull/price) - 1;

      const mosPrice = mosOn ? (base * 0.80) : NaN; // 20% pod BASE
      const mosDelta = mosOn ? ((mosPrice/price) - 1) : NaN;

      lastCalc = {
        id: nowId(),
        createdAt: Date.now(),
        ticker,
        currency: ccy,
        inputs: { price, fcf, shares, netDebt, r, tg, years, growth:{ bear:gBear, base:gBase, bull:gBull }, mosOn },
        results: { perShare:{ bear, base, bull }, delta:{ bear:dBear, base:dBase, bull:dBull }, mosPrice, mosDelta }
      };

      renderResult(lastCalc);
      msg.textContent = "Hotovo. M≈Ø≈æe≈° ulo≈æit do Watchlistu.";
    }

    function renderResult(calc){
      const ccy = calc.currency;
      const { bear, base, bull } = calc.results.perShare;
      const { bear:db, base:ds, bull:du } = calc.results.delta;

      const mosOn = calc.inputs.mosOn;
      const mosPrice = calc.results.mosPrice;
      const mosDelta = calc.results.mosDelta;

      const deltaClass = (x) => (x >= 0 ? "good" : "bad");
      const deltaTxt = (x) => (x >= 0 ? "Podhodnocen√©" : "Nadhodnocen√©");

      const mosHtml = mosOn ? `
        <div class="metric base">
          <p class="k">C√≠lov√° cena (MoS 20% pod BASE)</p>
          <p class="v">${fmtMoney(mosPrice, ccy)}</p>
          <div class="delta ${deltaClass(mosDelta)}">${deltaTxt(mosDelta)} ‚Ä¢ ${fmtPct(mosDelta)}</div>
        </div>
      ` : "";

      $("resultWrap").innerHTML = `
        <div class="resultGrid">
          <div class="metric bear">
            <p class="k">BEAR (konzervativn√≠)</p>
            <p class="v">${fmtMoney(bear, ccy)}</p>
            <div class="delta ${deltaClass(db)}">${deltaTxt(db)} ‚Ä¢ ${fmtPct(db)}</div>
          </div>

          <div class="metric base">
            <p class="k">BASE (realistick√Ω)</p>
            <p class="v">${fmtMoney(base, ccy)}</p>
            <div class="delta ${deltaClass(ds)}">${deltaTxt(ds)} ‚Ä¢ ${fmtPct(ds)}</div>
          </div>

          <div class="metric bull">
            <p class="k">BULL (optimistick√Ω)</p>
            <p class="v">${fmtMoney(bull, ccy)}</p>
            <div class="delta ${deltaClass(du)}">${deltaTxt(du)} ‚Ä¢ ${fmtPct(du)}</div>
          </div>

          ${mosHtml}
        </div>

        <div class="tagRow">
          <span class="tag">Ticker: <b>${calc.ticker}</b></span>
          <span class="tag">Cena: <b>${fmtMoney(calc.inputs.price, ccy)}</b></span>
          <span class="tag">r: <b>${(calc.inputs.r*100).toFixed(2)}%</b></span>
          <span class="tag">g‚Çú: <b>${(calc.inputs.tg*100).toFixed(2)}%</b></span>
          <span class="tag">Roky: <b>${calc.inputs.years}</b></span>
        </div>
      `;
    }// ====== Watchlist render + delete + export ======
    function wlRender(){
      const data = wlLoad();
      const body = $("wl_body");

      if(data.items.length === 0){
        body.innerHTML = `<tr><td colspan="8" style="color:rgba(255,255,255,.65);">Zat√≠m nic ulo≈æen√©ho.</td></tr>`;
        return;
      }

      body.innerHTML = data.items.map(it => {
        const ccy = it.currency || "USD";
        const bear = it.results?.perShare?.bear;
        const base = it.results?.perShare?.base;
        const bull = it.results?.perShare?.bull;
        const mos = it.results?.mosPrice;

        return `
          <tr>
            <td>${formatDate(it.createdAt)}</td>
            <td><b>${it.ticker}</b></td>
            <td>${ccy}</td>
            <td>${fmtMoney(bear, ccy)}</td>
            <td>${fmtMoney(base, ccy)}</td>
            <td>${fmtMoney(bull, ccy)}</td>
            <td>${Number.isFinite(mos) ? fmtMoney(mos, ccy) : "‚Äî"}</td>
            <td>
              <button class="miniBtn" data-del="${it.id}">‚úï</button>
            </td>
          </tr>
        `;
      }).join("");

      // bind delete buttons
      body.querySelectorAll("[data-del]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-del");
          wlRemove(id);
          wlRender();
        });
      });
    }

    function exportCSV(){
      const data = wlLoad();
      if(!data.items.length){
        alert("Watchlist je pr√°zdn√Ω.");
        return;
      }
      const rows = [["createdAt","date","ticker","currency","bear","base","bull","mosBaseMinus20"]];
      data.items.forEach(it=>{
        const ccy = it.currency || "USD";
        rows.push([
          it.createdAt,
          formatDate(it.createdAt),
          it.ticker,
          ccy,
          it.results?.perShare?.bear ?? "",
          it.results?.perShare?.base ?? "",
          it.results?.perShare?.bull ?? "",
          it.results?.mosPrice ?? ""
        ]);
      });

      const csv = rows.map(r => r.map(v => `"${String(v).replaceAll('"','""')}"`).join(",")).join("\n");
      const blob = new Blob([csv], { type:"text/csv;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "watchlist.csv";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    // ====== Navigation (≈°upl√≠ky = screens) ======
    const screens = {
      dcf: $("screen-dcf"),
      watchlist: $("screen-watchlist"),
      about: $("screen-about")
    };

    function openScreen(key){
      // hide home
      $("home").style.display = "none";
      // hide all screens
      Object.values(screens).forEach(s => {
        s.classList.remove("active");
        s.setAttribute("aria-hidden","true");
      });
      // show selected
      const sc = screens[key];
      sc.classList.add("active");
      sc.setAttribute("aria-hidden","false");

      if(key === "watchlist") wlRender();
      window.scrollTo({ top:0, behavior:"instant" });
    }

    function goHome(){
      Object.values(screens).forEach(s => {
        s.classList.remove("active");
        s.setAttribute("aria-hidden","true");
      });
      $("home").style.display = "";
      window.scrollTo({ top:0, behavior:"instant" });
    }

    // ====== Events ======
    document.querySelectorAll("[data-open]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        openScreen(btn.getAttribute("data-open"));
      });
    });

    document.querySelectorAll("[data-back]").forEach(btn=>{
      btn.addEventListener("click", goHome);
    });

    // Help toggles
    document.querySelectorAll("[data-help]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = btn.getAttribute("data-help");
        const box = $(id);
        box.classList.toggle("open");
      });
    });

    $("btn_calc").addEventListener("click", calcAndRender);

    $("btn_save").addEventListener("click", ()=>{
      const msg = $("dcf_msg");
      if(!lastCalc){
        msg.textContent = "Nejd≈ô√≠v klikni na Spoƒç√≠tat, a≈æ pak ukl√°dej.";
        return;
      }
      wlAdd(lastCalc);
      msg.textContent = "Ulo≈æeno do Watchlistu.";
    });

    $("btn_clear_all").addEventListener("click", ()=>{
      if(confirm("Opravdu smazat cel√Ω Watchlist?")){
        wlClear();
        wlRender();
      }
    });

    $("btn_export_csv").addEventListener("click", exportCSV);

    // init
    wlRender();
  </script>
</body>
</html>

    

    



        



      
    

    
      
  

    



    





  
  


  





        


        



  


 

            

        




          

        

          





  

  

  


  


    


      

  

    

          
    

    

    
    


    





    

    

  
        

    
    

  

  





