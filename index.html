<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Anal√Ωza akci√≠ ‚Äì MVP</title>

  <style>
    :root{
      --bgA:#0b0a16;
      --bgB:#12102a;
      --bgC:#1a1238;

      --cardHome: rgba(20, 14, 45, .85);
      --cardHome2: rgba(20, 14, 45, .72);

      --stroke: rgba(178, 140, 255, .28);
      --stroke2: rgba(0,0,0,.35);

      --text: rgba(255,255,255,.95);
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.55);

      --radius: 22px;
      --shadow: 0 22px 70px rgba(5,3,20,.75);
      --shadow2: 0 14px 40px rgba(5,3,20,.60);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", sans-serif;
      color:var(--text);
      overflow-x:hidden;
      background:
        radial-gradient(900px 600px at 20% -10%, rgba(160,150,255,.28), transparent 60%),
        radial-gradient(900px 700px at 80% 30%, rgba(90,140,255,.20), transparent 65%),
        radial-gradient(1100px 800px at 50% 78%, rgba(220,130,255,.20), transparent 62%),
        linear-gradient(180deg, #1a1435 0%, #120f2b 55%, #0b0a1a 100%);
    }

    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:18px 14px 50px;
    }

    .screen{ display:none; }
    .screen.active{ display:block; animation: pop .18s ease-out; }

    @keyframes pop{
      from{ transform: translateY(6px); opacity:0; }
      to{ transform: translateY(0); opacity:1; }
    }

    /* HERO */
    .hero{
      background:
        linear-gradient(180deg, rgba(178,140,255,.10), rgba(20,14,45,.65));
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 28px;
      box-shadow: var(--shadow2);
      padding: 18px 18px 16px;
      backdrop-filter: blur(14px);
    }

    .topRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:10px;
    }

    .pill{
      opacity:.92;
      font-weight:900;
      letter-spacing:.6px;
      padding: 8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.20);
      background: rgba(0,0,0,.12);
      backdrop-filter: blur(10px);
      flex:0 0 auto;
      font-size:12px;
    }

    h1{
      margin:6px 0 8px;
      font-size: clamp(34px, 6vw, 54px);
      line-height:1.05;
      letter-spacing:.2px;
    }

    .sub{
      margin:0;
      color:var(--muted);
      line-height:1.5;
      max-width:65ch;
      font-size:16px;
    }

    /* HOME CARDS */
    .stack{ margin-top:14px; display:flex; flex-direction:column; gap:12px; }

    .homeCard{
      width:100%;
      border-radius:26px;
      padding:16px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      cursor:pointer;
      color:var(--text);
      text-decoration:none;
      background:
        radial-gradient(900px 240px at 0% 50%, rgba(124,92,255,.18), transparent 60%),
        radial-gradient(900px 240px at 100% 50%, rgba(220,130,255,.14), transparent 60%),
        linear-gradient(180deg, rgba(178,140,255,.10), rgba(20,14,45,.86)),
        var(--cardHome);
      border:1px solid var(--stroke);
      box-shadow:var(--shadow2);
      transition:.18s ease;
    }
    .homeCard:hover{ transform:translateY(-2px); box-shadow:var(--shadow); }

    .homeLeft{ display:flex; align-items:center; gap:14px; min-width:0; }
    .homeIcon{
      width:44px; height:44px; border-radius:14px;
      display:flex; align-items:center; justify-content:center;
      font-size:20px;
      background:linear-gradient(135deg,#7c5cff,#3a2a88);
      box-shadow:0 8px 24px rgba(124,92,255,.45);
      flex:0 0 auto;
    }
    .homeText{ min-width:0; }
    .homeTitle{
      margin:0;
      font-weight:900;
      font-size:22px;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .homeSub{
      margin:2px 0 0;
      font-size:13px;
      color:var(--muted2);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .chev{
      opacity:.7;
      font-size:22px;
      padding:4px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      flex:0 0 auto;
    }

    /* CARDS */
    .card{
      background:
        radial-gradient(700px 260px at 20% 0%, rgba(220,130,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(178,140,255,.08), rgba(20,14,45,.92)),
        var(--cardHome2);
      border:1px solid rgba(255,255,255,.12);
      border-radius:28px;
      padding:18px;
      box-shadow:var(--shadow2);
      margin:14px 0 16px;
    }

    .bar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:12px;
    }

    .title{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
      letter-spacing:.2px;
      font-size:18px;
      margin:0;
    }

    .btnRow{ display:flex; gap:10px; flex-wrap:wrap; }

    .btn{
      padding:10px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.22);
      color:var(--text);
      cursor:pointer;
      font-weight:800;
      letter-spacing:.2px;
    }
    .btn.primary{
      border:none;
      background: linear-gradient(135deg,#7c5cff,#4b3acb);
      box-shadow:0 14px 30px rgba(124,92,255,.25);
    }
    .btn.ghost{
      background: rgba(255,255,255,.06);
    }
    .btn.danger{
      background: rgba(255,80,80,.14);
      border-color: rgba(255,107,107,.55);
    }

    .hint{
      font-size:12px;
      color:var(--muted2);
      margin: 6px 0 0;
    }

    /* FORM */
    .grid{ display:grid; grid-template-columns:1fr; gap:12px; }
    .row2{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media (max-width:520px){ .row2{ grid-template-columns:1fr; } }

    label{ font-size:13px; color:var(--muted); display:flex; align-items:center; gap:8px; }
    .q{
      width:22px; height:22px; border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      cursor:pointer;
      flex:0 0 auto;
    }
    input, select{
      width:100%;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(178,140,255,.22);
      background: rgba(0,0,0,.30);
      color: var(--text);
      outline:none;
    }
    .note{ font-size:12px; color:var(--muted2); margin-top:4px; }

    /* RESULTS */
    .results{ display:grid; grid-template-columns:1fr; gap:12px; }
    .res{
      border-radius:22px;
      padding:14px;
      border:1px solid rgba(178,140,255,.22);
      background: rgba(0,0,0,.28);
    }
    .resHead{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .tag{
      font-size:12px;
      font-weight:900;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
    }
    .tag.bear{ border-color: rgba(255,155,155,.35); color:#ffb0b0; }
    .tag.base{ border-color: rgba(155,182,255,.35); color:#b6caff; }
    .tag.bull{ border-color: rgba(155,255,180,.30); color:#b8ffd1; }

    .big{
      font-size:28px;
      font-weight:950;
      margin:6px 0 8px;
      letter-spacing:.2px;
    }
    .line{
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-size:13px;
      color: var(--muted2);
    }

    /* WATCHLIST */
    .list{ display:flex; flex-direction:column; gap:10px; }
    .item{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding:14px;
      border-radius:18px;
      background: rgba(0,0,0,.28);
      border:1px solid rgba(178,140,255,.22);
    }
    .itemTitle{ margin:0; font-weight:950; }
    .itemMeta{ margin:2px 0 0; font-size:13px; color:var(--muted2); }

    /* MODAL */
    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
      padding:18px;
    }
    .modalBack.show{ display:flex; }
    .modal{
      width:min(92vw, 520px);
      border-radius:24px;
      background:
        linear-gradient(180deg, rgba(178,140,255,.14), rgba(20,14,45,.95));
      border:1px solid rgba(178,140,255,.28);
      padding:16px;
      box-shadow: var(--shadow);
    }
    .modalTop{ display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .modalTitle{ margin:0; font-weight:950; }
    .modalBody{
      margin-top:10px;
      font-size:14px;
      color: var(--muted2);
      white-space: pre-wrap;
      line-height:1.55;
    }
    .x{
      background:none; border:none;
      color: var(--text);
      font-size:18px;
      cursor:pointer;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
    }

    .footerNav{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:12px;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- HOME -->
    <section id="screen-home" class="screen active">
      <div class="hero">
        <div class="topRow">
          <div class="pill">‚óè Anal√Ωza akci√≠ ‚Ä¢ Beta</div>
          <div class="pill">MVP</div>
        </div>
        <h1>Anal√Ωza akci√≠</h1>
        <p class="sub">
          Appka pro investory: DCF odhad vnit≈ôn√≠ hodnoty (Bear/Base/Bull) + Watchlist ulo≈æen√Ωch v√Ωsledk≈Ø.
        </p>

        <div class="stack">
          <a class="homeCard" href="#" onclick="go('dcf'); return false;">
            <div class="homeLeft">
              <div class="homeIcon">üìà</div>
              <div class="homeText">
                <div class="homeTitle">DCF Anal√Ωza</div>
                <div class="homeSub">Vnit≈ôn√≠ hodnota ‚Ä¢ Bear / Base / Bull</div>
              </div>
            </div>
            <div class="chev">‚Ä∫</div>
          </a>

          <a class="homeCard" href="#" onclick="go('watch'); return false;">
            <div class="homeLeft">
              <div class="homeIcon">üëÄ</div>
              <div class="homeText">
                <div class="homeTitle">Watchlist</div>
                <div class="homeSub">Ulo≈æen√© anal√Ωzy ‚Ä¢ maz√°n√≠ po jedn√©</div>
              </div>
            </div>
            <div class="chev">‚Ä∫</div>
          </a>

          <a class="homeCard" href="#" onclick="go('about'); return false;">
            <div class="homeLeft">
              <div class="homeIcon">‚ÑπÔ∏è</div>
              <div class="homeText">
                <div class="homeTitle">O aplikaci</div>
                <div class="homeSub">Metodika ‚Ä¢ jak funguje DCF ‚Ä¢ tipy</div>
              </div>
            </div>
            <div class="chev">‚Ä∫</div>
          </a>
        </div>
      </div>
    </section>

    <!-- DCF -->
    <section id="screen-dcf" class="screen">
      <div class="card">
        <div class="bar">
          <h2 class="title">
            DCF Anal√Ωza
            <span class="q" onclick="help('dcf_overview')">?</span>
          </h2>
          <div class="btnRow">
            <button class="btn ghost" onclick="go('home')">‚Üê Zpƒõt</button>
            <button class="btn primary" onclick="runDCF()">Spoƒç√≠tat</button>
            <button class="btn" onclick="saveToWatchlist()">Ulo≈æit</button>
          </div>
        </div>

        <div class="grid form">
          <div class="row2">
            <div>
              <label>Ticker / n√°zev <span class="q" onclick="help('ticker')">?</span></label>
              <input id="inp_ticker" placeholder="nap≈ô. SOFI / Palantir / Broadcom" />
              <div class="note">Jen pro pojmenov√°n√≠ v√Ωsledku ve Watchlistu.</div>
            </div>
            <div>
              <label>Mƒõna <span class="q" onclick="help('currency')">?</span></label>
              <select id="inp_ccy">
                <option value="USD">USD</option>
                <option value="EUR">EUR</option>
                <option value="CZK">CZK</option>
              </select>
              <div class="note">Mƒõna se pou≈æije jen pro zobrazen√≠.</div>
            </div>
          </div>

          <div class="row2">
            <div>
              <label>Poƒçet akci√≠ (shares) <span class="q" onclick="help('shares')">?</span></label>
              <input id="inp_shares" type="number" step="any" placeholder="nap≈ô. 900000000" />
              <div class="note">Pou≈æije se pro v√Ωpoƒçet fair value na 1 akcii.</div>
            </div>
            <div>
              <label>ƒåist√Ω dluh (net debt) <span class="q" onclick="help('netdebt')">?</span></label>
              <input id="inp_netdebt" type="number" step="any" placeholder="nap≈ô. 2000000000" />
              <div class="note">Dluh minus hotovost (m≈Ø≈æe b√Ωt i z√°porn√Ω).</div>
            </div>
          </div>

          <div class="row2">
            <div>
              <label>FCF nyn√≠ (TTM / posledn√≠ rok) <span class="q" onclick="help('fcf')">?</span></label>
              <input id="inp_fcf" type="number" step="any" placeholder="nap≈ô. 1200000000" />
              <div class="note">Free Cash Flow v absolutn√≠ hodnotƒõ.</div>
            </div>
            <div>
              <label>Diskontn√≠ sazba (WACC) <span class="q" onclick="help('wacc')">?</span></label>
              <input id="inp_wacc" type="number" step="0.01" placeholder="nap≈ô. 9" />
              <div class="note">Zadej v % (nap≈ô. 9 = 9%).</div>
            </div>
          </div>

          <div class="row2">
            <div>
              <label>Termin√°ln√≠ r≈Øst (g) <span class="q" onclick="help('tgrowth')">?</span></label>
              <input id="inp_tg" type="number" step="0.01" placeholder="nap≈ô. 2.5" />
              <div class="note">Dlouhodob√Ω r≈Øst po projekci (typicky 1‚Äì3%).</div>
            </div>
            <div>
              <label>Poƒçet let projekce <span class="q" onclick="help('years')">?</span></label>
              <input id="inp_years" type="number" step="1" value="5" />
              <div class="note">Standardnƒõ 5 let (m≈Ø≈æe≈° d√°t 7‚Äì10).</div>
            </div>
          </div>

          <div class="row2">
            <div>
              <label>Bear r≈Øst FCF (roƒçnƒõ) <span class="q" onclick="help('bear')">?</span></label>
              <input id="inp_bear" type="number" step="0.01" placeholder="nap≈ô. 6" />
              <div class="note">V % roƒçnƒõ.</div>
            </div>
            <div>
              <label>Base r≈Øst FCF (roƒçnƒõ) <span class="q" onclick="help('base')">?</span></label>
              <input id="inp_base" type="number" step="0.01" placeholder="nap≈ô. 12" />
              <div class="note">V % roƒçnƒõ.</div>
            </div>
          </div>

          <div class="row2">
            <div>
              <label>Bull r≈Øst FCF (roƒçnƒõ) <span class="q" onclick="help('bull')">?</span></label>
              <input id="inp_bull" type="number" step="0.01" placeholder="nap≈ô. 18" />
              <div class="note">V % roƒçnƒõ.</div>
            </div>
            <div>
              <label>Aktu√°ln√≠ cena (voliteln√©) <span class="q" onclick="help('price')">?</span></label>
              <input id="inp_price" type="number" step="0.01" placeholder="nap≈ô. 9.50" />
              <div class="note">Pro v√Ωpoƒçet upside/downside.</div>
            </div>
          </div>

          <div class="hint">
            Tip: kdy≈æ nev√≠≈°, dej r≈Østy nap≈ô. Bear 6%, Base 12%, Bull 18% a WACC kolem 9%.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="bar">
          <h2 class="title">V√Ωsledky</h2>
          <button class="btn" onclick="help('results')">Vysvƒõtlivka</button>
        </div>

        <div class="results" id="resultsBox">
          <div class="res">
            <div class="resHead">
              <div class="tag base">Base</div>
              <div class="line"><span>Fair value / akcie</span><span>‚Äî</span></div>
            </div>
            <div class="big">‚Äî</div>
            <div class="line"><span>Enterprise value</span><span>‚Äî</span></div>
            <div class="line"><span>Equity value</span><span>‚Äî</span></div>
            <div class="line"><span>Upside vs. cena</span><span>‚Äî</span></div>
          </div>
        </div>

        <div class="footerNav">
          <button class="btn ghost" onclick="go('watch')">Otev≈ô√≠t Watchlist</button>
          <button class="btn ghost" onclick="go('about')">O aplikaci</button>
        </div>
      </div>
    </section>

    <!-- WATCHLIST -->
    <section id="screen-watch" class="screen">
      <div class="card">
        <div class="bar">
          <h2 class="title">Watchlist <span class="q" onclick="help('watchlist')">?</span></h2>
          <div class="btnRow">
            <button class="btn ghost" onclick="go('home')">‚Üê Zpƒõt</button>
            <button class="btn" onclick="renderWatchlist()">Obnovit</button>
            <button class="btn danger" onclick="clearWatchlist()">Smazat v≈°e</button>
          </div>
        </div>

        <div class="list" id="watchList"></div>
        <div class="hint">Ulo≈æen√© polo≈æky jsou ulo≈æen√© v prohl√≠≈æeƒçi (localStorage).</div>
      </div>
    </section>

    <!-- ABOUT -->
    <section id="screen-about" class="screen">
      <div class="card">
        <div class="bar">
          <h2 class="title">O aplikaci <span class="q" onclick="help('about')">?</span></h2>
          <button class="btn ghost" onclick="go('home')">‚Üê Zpƒõt</button>
        </div>

        <div class="grid">
          <div class="res">
            <div class="big" style="font-size:20px;">Pro koho to je</div>
            <div class="modalBody" style="margin-top:8px;">
Pro investory, kte≈ô√≠ chtƒõj√≠ rychle a srozumitelnƒõ odhadnout f√©rovou hodnotu akcie pomoc√≠ DCF.
Aplikace je MVP ‚Äì poƒç√≠t√° jednoduch√Ω DCF z FCF a r≈Østu (Bear/Base/Bull).
            </div>
          </div>

          <div class="res">
            <div class="big" style="font-size:20px;">Jak funguje DCF</div>
            <div class="modalBody" style="margin-top:8px;">
1) Zad√°≈° FCF (posledn√≠ rok) a roƒçn√≠ r≈Øst pro projekƒçn√≠ obdob√≠ (nap≈ô. 5 let).
2) Ka≈æd√Ω rok se FCF prom√≠tne a diskontuje WACC.
3) Po posledn√≠m roce se spoƒç√≠t√° termin√°ln√≠ hodnota (perpetuita) s termin√°ln√≠m r≈Østem g.
4) Enterprise value = souƒçet diskontovan√Ωch FCF + diskontovan√° termin√°ln√≠ hodnota.
5) Equity value = Enterprise value - Net debt.
6) Fair value na akcii = Equity value / poƒçet akci√≠.
            </div>
          </div>

          <div class="res">
            <div class="big" style="font-size:20px;">Tipy</div>
            <div class="modalBody" style="margin-top:8px;">
- WACC typicky 8‚Äì11 % (u kvalitn√≠ch / stabiln√≠ch firem ni≈æ≈°√≠, u rizikov√Ωch vy≈°≈°√≠).
- Termin√°ln√≠ r≈Øst g obvykle 1‚Äì3 %.
- Bear/Base/Bull si nastav podle realistick√Ωch sc√©n√°≈ô≈Ø firmy.
- Watchlist slou≈æ√≠ na ukl√°d√°n√≠ v√≠ce firem a rychl√© porovn√°n√≠.
            </div>
          </div>
        </div>
      </div>
    </section>

  </div>

  <!-- MODAL -->
  <div class="modalBack" id="modalBack" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modalTop">
        <h3 class="modalTitle" id="modalTitle">Vysvƒõtlivka</h3>
        <button class="x" onclick="closeModal()">‚úï</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <script>
  // ----- NAV -----
  function go(name){
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('screen-' + name).classList.add('active');
    if(name === 'watch') renderWatchlist();
    window.scrollTo({top:0, behavior:'smooth'});
  }

  // ----- HELP TEXTS -----
  const HELP = {
    dcf_overview: {
      t: "DCF Anal√Ωza (co to je)",
      b:
`DCF (Discounted Cash Flow) odhaduje hodnotu firmy z budouc√≠ch penƒõ≈æn√≠ch tok≈Ø (FCF).
Tady pou≈æ√≠v√°me jednoduch√Ω model:
- Projekce FCF na X let (Bear/Base/Bull r≈Øst)
- Diskontov√°n√≠ WACC
- Termin√°ln√≠ hodnota s r≈Østem g
V√Ωsledek = f√©rov√° cena na akcii.`
    },
    ticker:{t:"Ticker / n√°zev", b:"Pouze n√°zev v√Ωsledku ve Watchlistu (nem√° vliv na v√Ωpoƒçet)."},
    currency:{t:"Mƒõna", b:"Mƒõna je jen pro zobrazen√≠ ƒç√°stek (v√Ωpoƒçet je stejn√Ω)."},
    shares:{t:"Poƒçet akci√≠", b:"Kolik akci√≠ je v obƒõhu (diluted shares). Slou≈æ√≠ pro v√Ωpoƒçet hodnoty na 1 akcii."},
    netdebt:{t:"ƒåist√Ω dluh (Net debt)", b:"Dluh minus hotovost. Pokud m√° firma v√≠c hotovosti ne≈æ dluhu, m≈Ø≈æe b√Ωt z√°porn√Ω."},
    fcf:{t:"FCF (Free Cash Flow)", b:"Voln√© cash flow za posledn√≠ rok (TTM). V absolutn√≠ hodnotƒõ."},
    wacc:{t:"Diskontn√≠ sazba (WACC)", b:"Sazba, kterou diskontuje≈° budouc√≠ cash flow. Vy≈°≈°√≠ WACC = ni≈æ≈°√≠ hodnota."},
    tgrowth:{t:"Termin√°ln√≠ r≈Øst (g)", b:"Dlouhodob√Ω r≈Øst po skonƒçen√≠ projekce. Typicky 1‚Äì3 %."},
    years:{t:"Poƒçet let projekce", b:"Kolik let dop≈ôedu prom√≠t√°me r≈Øst FCF, ne≈æ p≈ôejdeme na termin√°ln√≠ hodnotu."},
    bear:{t:"Bear r≈Øst", b:"Konzervativn√≠ sc√©n√°≈ô r≈Østu FCF (ni≈æ≈°√≠ r≈Øst, vy≈°≈°√≠ opatrnost)."},
    base:{t:"Base r≈Øst", b:"St≈ôedn√≠ sc√©n√°≈ô, kter√Ω pova≈æuje≈° za nejpravdƒõpodobnƒõj≈°√≠."},
    bull:{t:"Bull r≈Øst", b:"Optimistick√Ω sc√©n√°≈ô (lep≈°√≠ mar≈æe, rychlej≈°√≠ r≈Øst)."},
    price:{t:"Aktu√°ln√≠ cena", b:"Voliteln√©. Pokud vypln√≠≈°, spoƒç√≠t√°me upside/downside v %."},
    results:{t:"V√Ωsledky ‚Äì co znamenaj√≠", b:"Ukazujeme EV, Equity a fair value na akcii pro Bear/Base/Bull. Upside je jen pokud zad√°≈° aktu√°ln√≠ cenu."},
    watchlist:{t:"Watchlist", b:"Ulo≈æen√© v√Ωsledky do prohl√≠≈æeƒçe. M≈Ø≈æe≈° mazat polo≈æky po jedn√© nebo v≈°e."},
    about:{t:"O aplikaci", b:"Tady je popis pro koho to je a jak funguje v√Ωpoƒçet."}
  };

  function help(key){
    const h = HELP[key] || {t:"Vysvƒõtlivka", b:"(nen√≠ definov√°no)"};
    openModal(h.t, h.b);
  }

  // ----- MODAL -----
  function openModal(title, body){
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalBody').textContent = body;
    document.getElementById('modalBack').classList.add('show');
  }

  function closeModal(){
    document.getElementById('modalBack').classList.remove('show');
  }

  // Pokud m√°≈° v HTML modalBack onclick="closeModal(event)"
  // tak tohle umo≈æn√≠ zav≈ôen√≠ po kliknut√≠ mimo okno:
  function closeModalFromBg(evt){
    if(evt && evt.target && evt.target.id === 'modalBack') closeModal();
  }

  // ----- DCF -----
  function num(id){
    const v = document.getElementById(id).value;
    if(v === "" || v === null || v === undefined) return NaN;
    return Number(v);
  }

  function fmt(n, ccy){
    if(!isFinite(n)) return "‚Äî";
    const abs = Math.abs(n);
    let s;
    if(abs >= 1e12) s = (n/1e12).toFixed(2) + " T";
    else if(abs >= 1e9) s = (n/1e9).toFixed(2) + " B";
    else if(abs >= 1e6) s = (n/1e6).toFixed(2) + " M";
    else s = n.toFixed(2);
    return s + " " + (ccy || "");
  }

  function pct(n){
    if(!isFinite(n)) return "‚Äî";
    return (n*100).toFixed(1) + " %";
  }

  function dcfScenario({fcf0, growth, years, wacc, tg}){
    let pvSum = 0;
    let fcf = fcf0;

    for(let t=1; t<=years; t++){
      fcf = fcf * (1 + growth);
      const disc = Math.pow(1 + wacc, t);
      pvSum += fcf / disc;
    }

    const fcfN = fcf;
    const tv = (fcfN * (1 + tg)) / (wacc - tg); // Gordon Growth
    const pvTV = tv / Math.pow(1 + wacc, years);

    const ev = pvSum + pvTV;
    return { ev, pvSum, pvTV };
  }

  let LAST = null;

  function runDCF(){
    const ticker = (document.getElementById('inp_ticker').value || "").trim() || "Bez n√°zvu";
    const ccy = document.getElementById('inp_ccy').value;

    const shares = num('inp_shares');
    const netdebt = num('inp_netdebt');
    const fcf0 = num('inp_fcf');

    const waccP = num('inp_wacc');
    const tgP = num('inp_tg');
    const years = Math.max(1, Math.floor(num('inp_years') || 5));

    const bearP = num('inp_bear');
    const baseP = num('inp_base');
    const bullP = num('inp_bull');

    const price = num('inp_price');

    if(!isFinite(shares) || shares <= 0) return openModal("Chyb√≠ data", "Dopl≈à pros√≠m poƒçet akci√≠ (shares) > 0.");
    if(!isFinite(fcf0)) return openModal("Chyb√≠ data", "Dopl≈à pros√≠m FCF (posledn√≠ rok).");
    if(!isFinite(waccP)) return openModal("Chyb√≠ data", "Dopl≈à pros√≠m WACC v % (nap≈ô. 9).");
    if(!isFinite(tgP)) return openModal("Chyb√≠ data", "Dopl≈à pros√≠m termin√°ln√≠ r≈Øst g v % (nap≈ô. 2).");
    if(!(waccP/100 > tgP/100)) return openModal("Neplatn√© nastaven√≠", "WACC mus√≠ b√Ωt vƒõt≈°√≠ ne≈æ termin√°ln√≠ r≈Øst g (jinak nevych√°z√≠ perpetuita).");

    const wacc = waccP/100;
    const tg = tgP/100;

    function pack(label, gP){
      const growth = (isFinite(gP) ? gP : 0)/100;
      const { ev } = dcfScenario({fcf0, growth, years, wacc, tg});
      const equity = ev - (isFinite(netdebt) ? netdebt : 0);
      const fair = equity / shares;
      const up = isFinite(price) ? (fair/price - 1) : NaN;
      return { label, growthP:gP, ev, equity, fair, up };
    }

    const bear = pack("Bear", bearP);
    const base = pack("Base", baseP);
    const bull = pack("Bull", bullP);

    LAST = {
      ts: Date.now(),
      ticker, ccy,
      inputs: { shares, netdebt, fcf0, waccP, tgP, years, bearP, baseP, bullP, price: isFinite(price)?price:null },
      out: { bear, base, bull }
    };

    renderResults(LAST);
  }

  function renderResults(state){
    const ccy = state.ccy;
    const price = state.inputs.price;

    function block(s, cls){
      const upTxt = isFinite(s.up) ? pct(s.up) : "‚Äî";
      const priceTxt = isFinite(price) ? (price + " " + ccy) : "‚Äî";

      return `
        <div class="res">
          <div class="resHead">
            <div class="tag ${cls}">${s.label}</div>
            <div class="line"><span>Fair value / akcie</span><span>${fmt(s.fair, ccy)}</span></div>
          </div>
          <div class="big">${fmt(s.fair, ccy)}</div>
          <div class="line"><span>Enterprise value</span><span>${fmt(s.ev, ccy)}</span></div>
          <div class="line"><span>Equity value</span><span>${fmt(s.equity, ccy)}</span></div>
          <div class="line"><span>Aktu√°ln√≠ cena</span><span>${priceTxt}</span></div>
          <div class="line"><span>Upside vs. cena</span><span>${upTxt}</span></div>
        </div>
      `;
    }

    const html =
      block(state.out.bear, "bear") +
      block(state.out.base, "base") +
      block(state.out.bull, "bull");

    document.getElementById('resultsBox').innerHTML = html;
  }

  // ----- WATCHLIST (localStorage) -----
  const KEY = "equity_analyzer_watchlist_v1";

  function loadWL(){
    try{ return JSON.parse(localStorage.getItem(KEY) || "[]"); }
    catch(e){ return []; }
  }

  function saveWL(arr){
    localStorage.setItem(KEY, JSON.stringify(arr));
  }

  function saveToWatchlist(){
    if(!LAST) return openModal("Nejd≈ô√≠v spoƒç√≠tej", "Nejd≈ô√≠v klikni na ‚ÄûSpoƒç√≠tat‚Äú, a≈æ potom ukl√°dej do Watchlistu.");
    const wl = loadWL();
    wl.unshift(LAST);
    saveWL(wl);
    openModal("Ulo≈æeno", `V√Ωsledek pro ‚Äû${LAST.ticker}‚Äú je ulo≈æen√Ω ve Watchlistu.`);
  }

  function clearWatchlist(){
    if(!confirm("Opravdu smazat cel√Ω Watchlist?")) return;
    saveWL([]);
    renderWatchlist();
  }

  function delOne(ts){
    const wl = loadWL().filter(x => x.ts !== ts);
    saveWL(wl);
    renderWatchlist();
  }

  function renderWatchlist(){
    const box = document.getElementById('watchList');
    const wl = loadWL();

    if(!wl.length){
      box.innerHTML = `<div class="item"><div><p class="itemTitle">Nic tu nen√≠</p><p class="itemMeta">Ulo≈æ si v√Ωsledek z DCF Anal√Ωzy.</p></div></div>`;
      return;
    }

    box.innerHTML = wl.map(x => {
      const ccy = x.ccy;
      const b = x.out.base;
      const price = x.inputs.price;
      const up = isFinite(b.up) ? pct(b.up) : "‚Äî";
      const priceTxt = isFinite(price) ? (price + " " + ccy) : "‚Äî";

      return `
        <div class="item">
          <div style="min-width:0;">
            <p class="itemTitle">${escapeHtml(x.ticker)}</p>
            <p class="itemMeta">
              Base FV: <b>${fmt(b.fair, ccy)}</b> ‚Ä¢ EV: ${fmt(b.ev, ccy)} ‚Ä¢ Cena: ${priceTxt} ‚Ä¢ Upside: ${up}
            </p>
            <p class="itemMeta">
              Bear/Base/Bull r≈Øst: ${x.inputs.bearP ?? "‚Äî"}% / ${x.inputs.baseP ?? "‚Äî"}% / ${x.inputs.bullP ?? "‚Äî"}%
              ‚Ä¢ WACC: ${x.inputs.waccP ?? "‚Äî"}% ‚Ä¢ g: ${x.inputs.tgP ?? "‚Äî"}% ‚Ä¢ roky: ${x.inputs.years ?? "‚Äî"}
            </p>
          </div>
          <div class="btnRow" style="align-items:flex-start;">
            <button class="btn" onclick="openSaved(${x.ts})">Detail</button>
            <button class="btn danger" onclick="delOne(${x.ts})">Smazat</button>
          </div>
        </div>
      `;
    }).join("");
  }

  function openSaved(ts){
    const wl = loadWL();
    const x = wl.find(i => i.ts === ts);
    if(!x) return;

    document.getElementById('inp_ticker').value = x.ticker || "";
    document.getElementById('inp_ccy').value = x.ccy || "USD";
    document.getElementById('inp_shares').value = x.inputs.shares ?? "";
    document.getElementById('inp_netdebt').value = x.inputs.netdebt ?? "";
    document.getElementById('inp_fcf').value = x.inputs.fcf0 ?? "";
    document.getElementById('inp_wacc').value = x.inputs.waccP ?? "";
    document.getElementById('inp_tg').value = x.inputs.tgP ?? "";
    document.getElementById('inp_years').value = x.inputs.years ?? 5;
    document.getElementById('inp_bear').value = x.inputs.bearP ?? "";
    document.getElementById('inp_base').value = x.inputs.baseP ?? "";
    document.getElementById('inp_bull').value = x.inputs.bullP ?? "";
    document.getElementById('inp_price').value = x.inputs.price ?? "";

    LAST = x;
    go('dcf');
    renderResults(x);
    openModal("Naƒçteno", `Naƒçten√Ω ulo≈æen√Ω v√Ωsledek ‚Äû${x.ticker}‚Äú. M≈Ø≈æe≈° p≈ôepoƒç√≠tat nebo znovu ulo≈æit.`);
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;");
  }

  // init
  renderWatchlist();
</script>

</body>
</html>// ----- HELP TEXTS -----
const HELP = {
  ticker: {
    title: "Ticker / N√°zev",
    body: `
      <p><b>Ticker</b> je zkratka akcie (nap≈ô. AAPL, MSFT). Slou≈æ√≠ jen pro ulo≈æen√≠ do Watchlistu.</p>
      <p>M≈Ø≈æe≈° vyplnit i n√°zev firmy, ale doporuƒçuji ticker.</p>
    `
  },
  fcf: {
    title: "FCF (Free Cash Flow)",
    body: `
      <p><b>FCF</b> (voln√© cash flow) je hotovost, kter√° firmƒõ z≈Østane po investic√≠ch do provozu a CAPEX.</p>
      <p>V DCF se typicky diskontuj√≠ budouc√≠ FCF.</p>
      <p><i>Tip:</i> Ber posledn√≠ roƒçn√≠ FCF (TTM nebo posledn√≠ FY).</p>
    `
  },
  growth: {
    title: "R≈Øst FCF (CAGR)",
    body: `
      <p>Zadej oƒçek√°van√Ω roƒçn√≠ r≈Øst FCF (nap≈ô. 12 = 12 %).</p>
      <p>M√°≈° 3 sc√©n√°≈ôe: <b>Bear / Base / Bull</b>.</p>
    `
  },
  years: {
    title: "Poƒçet let projekce",
    body: `
      <p>Kolik let dop≈ôedu projektujeme FCF (typicky 5‚Äì10).</p>
      <p>ƒå√≠m del≈°√≠ horizont, t√≠m v√≠ce nejistoty.</p>
    `
  },
  wacc: {
    title: "Diskontn√≠ sazba (WACC / r)",
    body: `
      <p>Diskontn√≠ sazba vyjad≈ôuje po≈æadovan√Ω v√Ωnos (riziko).</p>
      <p>Ty jsi chtƒõl pou≈æ√≠vat kolem <b>9 %</b> jako default.</p>
      <p>Vy≈°≈°√≠ sazba = ni≈æ≈°√≠ f√©rov√° hodnota.</p>
    `
  },
  tg: {
    title: "Terminal growth (dlouhodob√Ω r≈Øst)",
    body: `
      <p>Dlouhodob√Ω r≈Øst po skonƒçen√≠ projekce (typicky 2‚Äì4 %).</p>
      <p>Nemƒõl by dlouhodobƒõ v√Ωraznƒõ p≈ôevy≈°ovat r≈Øst ekonomiky.</p>
    `
  },
  netDebt: {
    title: "Net debt / Cash √∫prava",
    body: `
      <p>Pokud model poƒç√≠t√° Enterprise Value, je pot≈ôeba odeƒç√≠st <b>net debt</b> (dluh - cash).</p>
      <p>Pokud u≈æ poƒç√≠t√°≈° p≈ô√≠mo equity value, m≈Ø≈æe b√Ωt 0.</p>
    `
  },
  shares: {
    title: "Poƒçet akci√≠ (Shares outstanding)",
    body: `
      <p>Poƒçet akci√≠ pro p≈ôepoƒçet na cenu za 1 akcii.</p>
      <p>Pou≈æij diluted shares (≈ôedƒõn√©) pro konzervativnƒõj≈°√≠ v√Ωsledek.</p>
    `
  },
  price: {
    title: "Aktu√°ln√≠ cena",
    body: `
      <p>Slou≈æ√≠ pro porovn√°n√≠, jestli je akcie pod/ nad f√©rovou hodnotou.</p>
      <p>Pokud nevypln√≠≈°, po≈ô√°d spoƒç√≠t√°me f√©rovou cenu ‚Äì jen nebude srovn√°n√≠.</p>
    `
  },
  watch: {
    title: "Watchlist",
    body: `
      <p>Ulo≈æ√≠ v√Ωsledek v√Ωpoƒçtu (Bear/Base/Bull) spolu s parametry.</p>
      <p>V seznamu m≈Ø≈æe≈° polo≈æky mazat <b>po jedn√©</b> nebo je znovu naƒç√≠st do kalkulaƒçky.</p>
    `
  },
  about: {
    title: "O aplikaci",
    body: `
      <p>Jednoduch√Ω DCF odhad vnit≈ôn√≠ hodnoty akcie ve 3 sc√©n√°≈ô√≠ch: <b>Bear / Base / Bull</b>.</p>
      <p>Urƒçeno pro rychl√© porovn√°n√≠, ne jako jedin√Ω zdroj investiƒçn√≠ho rozhodnut√≠.</p>
      <ul>
        <li>DCF v√Ωpoƒçet + vysvƒõtlivky</li>
        <li>Watchlist ulo≈æen√Ωch anal√Ωz</li>
        <li>Mo≈ænost smazat polo≈æky po jedn√©</li>
      </ul>
    `
  }
};

// Otev≈ôen√≠ n√°povƒõdy podle kl√≠ƒçe
function help(key){
  const item = HELP[key];
  if(!item){
    openModal("N√°povƒõda", `<p>N√°povƒõda pro kl√≠ƒç <b>${escapeHtml(key)}</b> nebyla nalezena.</p>`);
    return;
  }
  openModal(item.title, item.body);
}

// ----- MODAL -----
function openModal(title, html){
  const back = document.getElementById('modalBack');
  const t = document.getElementById('modalTitle');
  const b = document.getElementById('modalBody');
  if(!back || !t || !b) return;

  t.textContent = title;
  b.innerHTML = html;
  back.classList.add('show');
}

function closeModal(){
  const back = document.getElementById('modalBack');
  if(back) back.classList.remove('show');
}

function closeModalFromBg(e){
  // zav≈ôe jen kdy≈æ klikne≈° na pozad√≠, ne na samotn√Ω modal
  if(e && e.target && e.target.id === 'modalBack') closeModal();
}

// ----- RESULTS RENDER -----
function fmt(n){
  if(n === null || n === undefined || Number.isNaN(n)) return "‚Äî";
  const x = Number(n);
  return x.toLocaleString('cs-CZ', { maximumFractionDigits: 2 });
}

function renderResults(res){
  // res = {bear, base, bull, price?}
  const box = document.getElementById('resultsBox');
  if(!box) return;

  const price = res.price ?? null;

  const badge = (fair) => {
    if(price === null || price === undefined || Number.isNaN(Number(price))) return '';
    const p = Number(price);
    const f = Number(fair);
    if(!isFinite(p) || !isFinite(f) || f<=0) return '';
    const diff = (f - p) / p * 100;
    const sign = diff >= 0 ? "+" : "";
    return `<span class="chip">${sign}${fmt(diff)} % vs cena</span>`;
  };

  box.innerHTML = `
    <div class="resultsGrid">
      <div class="resCard">
        <div class="resTop">
          <div class="resLabel">Bear</div>
          ${badge(res.bear)}
        </div>
        <div class="resValue">${fmt(res.bear)}</div>
      </div>

      <div class="resCard">
        <div class="resTop">
          <div class="resLabel">Base</div>
          ${badge(res.base)}
        </div>
        <div class="resValue">${fmt(res.base)}</div>
      </div>

      <div class="resCard">
        <div class="resTop">
          <div class="resLabel">Bull</div>
          ${badge(res.bull)}
        </div>
        <div class="resValue">${fmt(res.bull)}</div>
      </div>
    </div>
  `;
}

// ----- WATCHLIST (localStorage) -----
const STORE_KEY = 'equity_analyzer_watchlist';
let LAST = null;

function loadWatch(){
  try{
    const raw = localStorage.getItem(STORE_KEY);
    const arr = raw ? JSON.parse(raw) : [];
    return Array.isArray(arr) ? arr : [];
  }catch{
    return [];
  }
}

function saveWatch(arr){
  localStorage.setItem(STORE_KEY, JSON.stringify(arr));
}

function addToWatchlist(item){
  const arr = loadWatch();
  arr.unshift(item);          // nov√© nahoru
  saveWatch(arr);
  renderWatchlist();
}

function removeFromWatchlist(idx){
  const arr = loadWatch();
  arr.splice(idx, 1);
  saveWatch(arr);
  renderWatchlist();
}

function renderWatchlist(){
  const box = document.getElementById('watchList');
  if(!box) return;

  const arr = loadWatch();
  if(!arr.length){
    box.innerHTML = `<div class="empty">Zat√≠m nic ulo≈æen√©ho. Spoƒç√≠tej DCF a klikni ‚ÄûUlo≈æit do Watchlistu‚Äú.</div>`;
    return;
  }

  box.innerHTML = arr.map((it, i) => {
    const title = escapeHtml(it.ticker || it.name || `Polo≈æka #${i+1}`);
    const date = it.ts ? new Date(it.ts).toLocaleString('cs-CZ') : '';
    return `
      <div class="watchItem">
        <div class="watchMain" onclick="loadItem(${i})">
          <div class="watchTitle">${title}</div>
          <div class="watchSub">${escapeHtml(date)}</div>
          <div class="watchVals">
            <span>Bear: <b>${fmt(it.bear)}</b></span>
            <span>Base: <b>${fmt(it.base)}</b></span>
            <span>Bull: <b>${fmt(it.bull)}</b></span>
          </div>
        </div>
        <button class="btnDel" onclick="event.stopPropagation(); removeFromWatchlist(${i});">Smazat</button>
      </div>
    `;
  }).join('');
}

// naƒçten√≠ polo≈æky do input≈Ø (aby ≈°la upravit / p≈ôepoƒç√≠tat)
function loadItem(i){
  const arr = loadWatch();
  const it = arr[i];
  if(!it) return;

  // tyhle ID mus√≠≈° m√≠t v HTML ‚Äì pokud se jmenuj√≠ jinak, uprav je tady
  if(document.getElementById('inp_ticker')) document.getElementById('inp_ticker').value = it.ticker ?? '';
  if(document.getElementById('inp_fcf')) document.getElementById('inp_fcf').value = it.fcf ?? '';
  if(document.getElementById('inp_wacc')) document.getElementById('inp_wacc').value = it.wacc ?? '';
  if(document.getElementById('inp_tg')) document.getElementById('inp_tg').value = it.tg ?? '';
  if(document.getElementById('inp_years')) document.getElementById('inp_years').value = it.years ?? '';
  if(document.getElementById('inp_bear')) document.getElementById('inp_bear').value = it.bearG ?? '';
  if(document.getElementById('inp_base')) document.getElementById('inp_base').value = it.baseG ?? '';
  if(document.getElementById('inp_bull')) document.getElementById('inp_bull').value = it.bullG ?? '';
  if(document.getElementById('inp_price')) document.getElementById('inp_price').value = it.price ?? '';

  LAST = {
    bear: it.bear,
    base: it.base,
    bull: it.bull,
    price: it.price ?? null
  };

  go('dcf');
  renderResults(LAST);
  openModal("Naƒçteno", `<p>Naƒçteno z Watchlistu: <b>${escapeHtml(it.ticker || it.name || '')}</b>.</p>`);
}

// vol√°n√≠ z tlaƒç√≠tka ‚ÄûUlo≈æit do Watchlistu‚Äú
function saveCurrent(){
  if(!LAST){
    openModal("Nelze ulo≈æit", "<p>Nejd≈ô√≠v spoƒç√≠tej v√Ωsledek (Bear/Base/Bull).</p>");
    return;
  }

  const item = {
    ts: Date.now(),
    ticker: (document.getElementById('inp_ticker')?.value || '').trim(),
    fcf: document.getElementById('inp_fcf')?.value ?? '',
    wacc: document.getElementById('inp_wacc')?.value ?? '',
    tg: document.getElementById('inp_tg')?.value ?? '',
    years: document.getElementById('inp_years')?.value ?? '',
    bearG: document.getElementById('inp_bear')?.value ?? '',
    baseG: document.getElementById('inp_base')?.value ?? '',
    bullG: document.getElementById('inp_bull')?.value ?? '',
    price: document.getElementById('inp_price')?.value ?? '',
    bear: LAST.bear,
    base: LAST.base,
    bull: LAST.bull
  };

  addToWatchlist(item);
  openModal("Ulo≈æeno", "<p>V√Ωsledek byl ulo≈æen do Watchlistu.</p>");
}

// ----- NAV -----
function go(name){
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  const el = document.getElementById('screen-' + name);
  if(el) el.classList.add('active');
  if(name === 'watch') renderWatchlist();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// bezpeƒçn√© escapov√°n√≠ do HTML
function escapeHtml(s){
  return String(s)
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;");
}

// init
renderWatchlist();
</script>

</body>
    </html>
    



    

        
    

    

    

    
        


        

    
    
    

      



    
        








    

    

    

 


        


        



  


 

            

        




          

        

          





  

  

  


  


    


      

  

    

          
    

    

    
    


    





    

    

  
        

    
    

  

  





