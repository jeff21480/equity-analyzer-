<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#5b2cff" />
  <meta name="description" content="Equity Analyzer — multi-model fair value calculator (educational tool)." />

  <title>Equity Analyzer</title>

  <!-- PWA / ICONS (adjust paths if needed) -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <style>
    :root{
      /* saturated “purple/blue” palette */
      --bg0:#07081b;
      --bg1:#0b0c25;
      --card:#14163a;
      --card2:#171a45;
      --stroke:rgba(255,255,255,.14);
      --stroke2:rgba(255,255,255,.22);

      --text:#f2f4ff;
      --muted:rgba(242,244,255,.72);

      --acc:#6b35ff;
      --acc2:#3aa6ff;

      --good:#27d07d;
      --warn:#ffcc4a;
      --bad:#ff4d6d;

      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 10px 30px rgba(0,0,0,.45);

      --r:22px;
      --r2:18px;

      --pad:16px;
      --gap:12px;

      --inputH:56px; /* bigger rows */
      --fsTitle:40px; /* big headline */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 20% -10%, rgba(107,53,255,.55), transparent 60%),
        radial-gradient(900px 650px at 85% 0%, rgba(58,166,255,.35), transparent 55%),
        radial-gradient(900px 650px at 50% 120%, rgba(107,53,255,.22), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }

    .wrap{
      width:min(980px, 92vw);
      margin: 22px auto 50px auto;
      padding-bottom: 30px;
    }

    /* HERO / HEADER */
    .hero{
      border-radius: 28px;
      padding: 26px 22px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .brand{
      font-size: var(--fsTitle);
      font-weight: 900;
      letter-spacing: .2px;
      line-height: 1.05;
      margin: 0 0 6px 0;
      text-shadow: 0 10px 40px rgba(0,0,0,.55);
    }
    .sub{
      margin: 0 0 18px 0;
      color: var(--muted);
      font-weight: 600;
      letter-spacing: .2px;
    }
    .topControls{
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .pill{
      flex: 1 1 240px;
      min-width: 240px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding: 14px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--stroke);
    }
    .pill .k{
      color: var(--muted);
      font-weight: 700;
    }
    .pill select{
      appearance:none;
      border: 1px solid var(--stroke2);
      background: rgba(0,0,0,.15);
      color: var(--text);
      height: 44px;
      padding: 0 14px;
      border-radius: 999px;
      font-weight: 800;
      outline:none;
      min-width: 140px;
    }

    /* ACCORDION SHELL */
    .accordion{ margin-top: 16px; display:flex; flex-direction:column; gap: 14px; }
    .acc{
      border-radius: 26px;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .acc .head{
      cursor:pointer;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content: space-between;
      padding: 18px 18px;
      gap: 12px;
    }
    .acc .title{
      display:flex;
      flex-direction:column;
      gap: 6px;
    }
    .acc .titleRow{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .acc .h{
      font-size: 26px;
      font-weight: 900;
      letter-spacing:.2px;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke2);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.86);
      font-weight: 800;
      font-size: 13px;
    }
    .chev{
      width: 44px;
      height: 44px;
      display:grid;
      place-items:center;
      border-radius: 999px;
      border: 1px solid var(--stroke2);
      background: rgba(0,0,0,.18);
      font-weight: 900;
      color: rgba(255,255,255,.9);
    }
    .body{ display:none; padding: 0 18px 18px 18px; }
    .acc.open .body{ display:block; }

    /* small */
    @media (max-width:520px){
      :root{ --fsTitle: 34px; --inputH: 58px; }
      .pill{ min-width: 100%; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- ===== HEADER (complete section) ===== -->
    <section class="hero" id="hero">
      <h1 class="brand" id="ui_appTitle">Equity Analyzer</h1>
      <p class="sub" id="ui_subtitle">Multi-Model Fair Value • Watchlist • Guide</p>

      <div class="topControls">
        <div class="pill">
          <div class="k" id="ui_langLbl">Language</div>
          <select id="in_lang">
            <option value="en" selected>EN</option>
            <option value="cz">CZ</option>
          </select>
        </div>

        <div class="pill">
          <div class="k" id="ui_modeLbl">Mode</div>
          <select id="in_mode">
            <option value="quick" selected>Quick</option>
            <option value="advanced">Advanced</option>
          </select>
        </div>
      </div>
    </section>
    <!-- ===== /HEADER ===== -->

    <!-- ===== ACCORDION START ===== -->
    <div class="accordion" id="accordion">

      <!-- Drawer 1: Fair Value (will be filled in Part 2) -->
      <div class="acc open" id="acc_val">
        <div class="head" data-acc="val">
          <div class="title">
            <div class="titleRow">
              <div class="h" id="ui_valTitle">Fair value</div>
              <span class="tag" id="ui_valTag">Models + 3 scenarios</span>
            </div>
          </div>
          <div class="chev" aria-hidden="true">▲</div>
        </div>

        <div class="body" id="valBody">
          <!-- Part 2 will start here (content of drawer 1) -->
        </div>
      </div>

    </div>
    <!-- ===== /ACCORDION START ===== -->

  </div>
</body>
</html>

<!-- ===== PART 2/5 START ===== -->

<style>
  /* layout inside drawer */
  .grid{
    display:grid;
    grid-template-columns: 1.1fr .9fr;
    gap: 14px;
    margin-top: 14px;
  }
  @media (max-width: 860px){
    .grid{ grid-template-columns: 1fr; }
  }

  .card{
    border-radius: var(--r2);
    border: 1px solid var(--stroke);
    background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(0,0,0,.10));
    box-shadow: var(--shadow2);
    padding: 14px;
  }
  .muted{ color: var(--muted); font-weight: 650; }
  h3{
    margin: 0 0 8px 0;
    font-size: 20px;
    font-weight: 900;
    letter-spacing:.2px;
  }

  .tipbox{
    border-radius: 18px;
    border: 1px solid rgba(107,53,255,.45);
    background: rgba(107,53,255,.16);
    padding: 12px 12px;
    font-weight: 750;
    color: rgba(255,255,255,.92);
  }

  /* model buttons */
  .modelGrid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 10px;
  }
  @media (max-width: 520px){
    .modelGrid{ grid-template-columns: 1fr; }
  }
  .mBtn{
    text-align:left;
    border-radius: 18px;
    border: 1px solid var(--stroke2);
    background: rgba(0,0,0,.18);
    padding: 12px 12px;
    cursor:pointer;
  }
  .mBtn .t{ font-weight: 950; font-size: 16px; }
  .mBtn .d{ color: var(--muted); font-weight: 700; margin-top: 4px; }
  .mBtn.active{
    border-color: rgba(107,53,255,.95);
    box-shadow: 0 0 0 2px rgba(107,53,255,.35) inset;
    background: rgba(107,53,255,.18);
  }

  /* fields */
  .row{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  @media (max-width: 560px){ .row{ grid-template-columns: 1fr; } }

  .field{ display:flex; flex-direction:column; gap: 8px; }
  .lbl{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
    font-weight: 900;
  }
  .lbl span:first-child{ font-size: 16px; }
  .hint{
    width: 30px;
    height: 30px;
    border-radius: 999px;
    display:grid;
    place-items:center;
    border: 1px solid rgba(107,53,255,.65);
    background: rgba(107,53,255,.18);
    cursor:pointer;
    font-weight: 950;
    user-select:none;
  }

  input, select{
    height: var(--inputH);
    border-radius: 18px;
    border: 2px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    color: var(--text);
    padding: 0 14px;
    font-size: 18px;
    font-weight: 850;
    outline:none;
  }
  input:focus, select:focus{
    border-color: rgba(58,166,255,.75);
    box-shadow: 0 0 0 3px rgba(58,166,255,.18);
  }
  .mini{
    color: rgba(255,255,255,.70);
    font-weight: 700;
    font-size: 13px;
    line-height: 1.25;
  }

  .btns{ display:flex; flex-wrap:wrap; gap: 10px; margin-top: 12px; }
  button{
    height: 54px;
    border-radius: 18px;
    border: 1px solid rgba(107,53,255,.85);
    background: linear-gradient(180deg, rgba(107,53,255,1), rgba(75,25,230,1));
    color: white;
    font-weight: 950;
    font-size: 16px;
    padding: 0 16px;
    cursor:pointer;
  }
  button.secondary{
    background: rgba(0,0,0,.18);
    border-color: rgba(255,255,255,.18);
    color: rgba(255,255,255,.92);
  }

  /* results */
  .results{
    display:grid;
    grid-template-columns: 1fr;
    gap: 12px;
  }
  .res{
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    padding: 12px;
  }
  .k{ display:flex; align-items:center; justify-content:space-between; gap: 10px; }
  .badge{
    display:inline-flex;
    align-items:center;
    padding: 6px 10px;
    border-radius: 999px;
    font-weight: 950;
    font-size: 12px;
    border: 1px solid rgba(255,255,255,.18);
  }
  .badgeBear{ background: rgba(255,77,109,.18); border-color: rgba(255,77,109,.55); }
  .badgeBase{ background: rgba(107,53,255,.18); border-color: rgba(107,53,255,.55); }
  .badgeBull{ background: rgba(39,208,125,.18); border-color: rgba(39,208,125,.55); }
  .v{
    font-size: 34px;
    font-weight: 950;
    margin-top: 8px;
    letter-spacing:.2px;
  }
  .s{ color: rgba(255,255,255,.72); font-weight: 750; margin-top: 2px; }
</style>

<div class="grid">

  <!-- LEFT: MODEL + INPUTS -->
  <div class="card">

    <h3 id="ui_introTitle">What are we calculating?</h3>
    <div class="muted" id="ui_introText">
      Choose a company model and calculate fair value in 3 scenarios. This is educational — not investment advice.
    </div>

    <div class="tipbox" style="margin-top:10px;" id="ui_decimalTip">
      Tip: You can type decimals with dot or comma (e.g., 5.5 or 5,5). You can also use k / m / b (e.g., 10b).
    </div>

    <div class="row" style="margin-top:12px;">
      <div class="field">
        <div class="lbl">
          <span id="ui_currLbl">Currency</span>
          <span class="hint" data-help="currency">i</span>
        </div>
        <select id="in_curr">
          <option value="USD" selected>USD</option>
          <option value="EUR">EUR</option>
          <option value="CZK">CZK</option>
        </select>
      </div>

      <div class="field">
        <div class="lbl">
          <span id="ui_mosLbl">Margin of Safety</span>
          <span class="hint" data-help="mos">i</span>
        </div>
        <select id="in_mos">
          <option value="off" selected>Off</option>
          <option value="10">10%</option>
          <option value="20">20%</option>
          <option value="30">30%</option>
        </select>
      </div>
    </div>

    <h3 style="margin-top:14px;" id="ui_modelsTitle">Choose model</h3>

    <div class="modelGrid" id="modelGrid">
      <button class="mBtn active" type="button" data-model="standard">
        <div class="t" id="ui_m_standard_t">Standard (FCF DCF)</div>
        <div class="d" id="ui_m_standard_d">Classic companies with stable FCF (non-financial).</div>
      </button>

      <button class="mBtn" type="button" data-model="financial">
        <div class="t" id="ui_m_fin_t">Financial (RIM)</div>
        <div class="d" id="ui_m_fin_d">Banks/insurance/fintech via BVPS + ROE.</div>
      </button>

      <button class="mBtn" type="button" data-model="reit">
        <div class="t" id="ui_m_reit_t">REIT (AFFO)</div>
        <div class="d" id="ui_m_reit_d">REITs — use AFFO per share instead of FCF.</div>
      </button>

      <button class="mBtn" type="button" data-model="growth">
        <div class="t" id="ui_m_growth_t">Growth (Revenue)</div>
        <div class="d" id="ui_m_growth_d">Revenue + margin model (simple).</div>
      </button>

      <button class="mBtn" type="button" data-model="cyclical">
        <div class="t" id="ui_m_cyc_t">Cyclical</div>
        <div class="d" id="ui_m_cyc_d">Normalized cash flow across a cycle (simple).</div>
      </button>

      <button class="mBtn" type="button" data-model="utility">
        <div class="t" id="ui_m_util_t">Utility</div>
        <div class="d" id="ui_m_util_d">Stable cash/dividend style (simple).</div>
      </button>
    </div>

    <h3 style="margin-top:14px;" id="ui_inputsMain">Main inputs</h3>

    <div class="row">
      <div class="field">
        <div class="lbl">
          <span id="ui_tickerLbl">Ticker</span>
          <span class="hint" data-help="ticker">i</span>
        </div>
        <input id="in_ticker" placeholder="e.g., AAPL" />
      </div>

      <div class="field">
        <div class="lbl">
          <span id="ui_priceLbl">Current price</span>
          <span class="hint" data-help="price">i</span>
        </div>
        <input id="in_price" inputmode="decimal" placeholder="e.g., 180" />
      </div>
    </div>

    <!-- Model specific sections start (filled in Part 3) -->
    <div id="modelSections" style="margin-top:10px;">
      <!-- Part 3 will insert all model-specific input blocks here -->
    </div>

    <div class="btns">
      <button id="btn_calc" type="button">Calculate</button>
      <button class="secondary" id="btn_save" type="button">Save to Watchlist</button>
      <button class="secondary" id="btn_demo" type="button">Demo values</button>
    </div>

    <div class="mini" id="ui_saveNote">
      Saves the last computed result (Bear/Base/Bull) to your local watchlist.
    </div>

  </div>

  <!-- RIGHT: SCENARIOS + RESULTS -->
  <div class="card">

    <h3 id="ui_inputsScen">Scenarios (annual)</h3>
    <div class="muted" id="ui_inputsScenText">
      Quick mode uses Base only and auto-sets Bear/Bull (±2). Advanced lets you set all manually.
    </div>

    <div class="tipbox" style="margin-top:10px;" id="ui_scenTipText">
      For Standard/REIT: scenario = cash-flow growth. For Financial: scenario = ROE.
    </div>

    <div class="row" style="margin-top:12px;">
      <div class="field">
        <div class="lbl">
          <span id="ui_bearLbl">Bear</span>
          <span class="hint" data-help="bear">i</span>
        </div>
        <input id="in_bear" inputmode="decimal" placeholder="2" value="3" />
      </div>

      <div class="field">
        <div class="lbl">
          <span id="ui_baseLbl">Base</span>
          <span class="hint" data-help="base">i</span>
        </div>
        <input id="in_base" inputmode="decimal" placeholder="5" value="5" />
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <div class="field">
        <div class="lbl">
          <span id="ui_bullLbl">Bull</span>
          <span class="hint" data-help="bull">i</span>
        </div>
        <input id="in_bull" inputmode="decimal" placeholder="8" value="7" />
      </div>

      <div class="field">
        <div class="lbl">
          <span id="ui_yearsLbl">Projection years</span>
          <span class="hint" data-help="years">i</span>
        </div>
        <input id="in_years" inputmode="numeric" placeholder="10" value="10" />
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <div class="field">
        <div class="lbl">
          <span id="ui_discLbl">Discount rate (%)</span>
          <span class="hint" data-help="disc">i</span>
        </div>
        <input id="in_disc" inputmode="decimal" placeholder="9" value="9" />
      </div>

      <div class="field">
        <div class="lbl">
          <span id="ui_termLbl">Terminal growth (%)</span>
          <span class="hint" data-help="term">i</span>
        </div>
        <input id="in_term" inputmode="decimal" placeholder="2.5" value="2.5" />
      </div>
    </div>

    <div class="results" id="resultGrid" style="margin-top:12px;">
      <div class="res">
        <div class="k"><span class="badge badgeBear">BEAR</span><span id="r_bear_pct"></span></div>
        <div class="v" id="r_bear">—</div>
        <div class="s" id="r_bear_s">—</div>
      </div>

      <div class="res">
        <div class="k"><span class="badge badgeBase">BASE</span><span id="r_base_pct"></span></div>
        <div class="v" id="r_base">—</div>
        <div class="s" id="r_base_s">—</div>
      </div>

      <div class="res">
        <div class="k"><span class="badge badgeBull">BULL</span><span id="r_bull_pct"></span></div>
        <div class="v" id="r_bull">—</div>
        <div class="s" id="r_bull_s">—</div>
      </div>
    </div>

    <div class="card" style="margin-top:12px;">
      <h3 id="ui_targetsTitle">Target & Range</h3>
      <div class="muted" id="ui_targetsText">
        Target = Base with Margin of Safety. Range = Bear to Bull.
      </div>

      <div class="row" style="margin-top:10px;">
        <div class="field">
          <div class="lbl"><span id="ui_targetLbl">Target price</span></div>
          <input id="out_target" readonly placeholder="—" />
        </div>

        <div class="field">
          <div class="lbl"><span id="ui_rangeLbl">Fair value range</span></div>
          <input id="out_range" readonly placeholder="—" />
        </div>
      </div>
    </div>

  </div>

</div>

<!-- ===== PART 3/5 START ===== -->

<!-- STANDARD (FCF DCF): firm-level FCF + shares -->
<div id="sec_standard" style="margin-top:10px;">
  <div class="row">
    <div class="field">
      <div class="lbl">
        <span id="ui_fcfLbl">Free Cash Flow (FCF) — total</span>
        <span class="hint" data-help="fcf_total">i</span>
      </div>
      <input id="in_fcf" inputmode="decimal" placeholder="e.g., 10b" />
      <div class="mini" id="ui_fcfMini">Annual total company FCF (ideally 3–5y average). Use k/m/b shortcuts.</div>
    </div>

    <div class="field">
      <div class="lbl">
        <span id="ui_sharesLbl">Shares outstanding</span>
        <span class="hint" data-help="shares">i</span>
      </div>
      <input id="in_shares" inputmode="decimal" placeholder="e.g., 2.6b" />
      <div class="mini" id="ui_sharesMini">Total shares outstanding (used to convert firm value to per-share).</div>
    </div>
  </div>
</div>

<!-- FINANCIAL (RIM): BVPS + ROE + payout -->
<div id="sec_financial" style="display:none; margin-top:10px;">
  <div class="row">
    <div class="field">
      <div class="lbl">
        <span id="ui_bvpsLbl">Book value per share (BVPS)</span>
        <span class="hint" data-help="bvps">i</span>
      </div>
      <input id="in_bvps" inputmode="decimal" placeholder="e.g., 6.95" />
      <div class="mini" id="ui_bvpsMini">Used for banks/financials. Book value per share (equity per share).</div>
    </div>

    <div class="field">
      <div class="lbl">
        <span id="ui_roeLbl">ROE (%)</span>
        <span class="hint" data-help="roe">i</span>
      </div>
      <input id="in_roe" inputmode="decimal" placeholder="e.g., 12" />
      <div class="mini" id="ui_roeMini">Return on equity. Scenarios for Financial are typically ROE (Bear/Base/Bull).</div>
    </div>
  </div>

  <div class="row" style="margin-top:10px;">
    <div class="field">
      <div class="lbl">
        <span id="ui_payoutLbl">Payout ratio (%)</span>
        <span class="hint" data-help="payout">i</span>
      </div>
      <input id="in_payout" inputmode="decimal" placeholder="e.g., 20" value="20" />
      <div class="mini" id="ui_payoutMini">How much profit is paid out. The rest increases BVPS over time.</div>
    </div>

    <div class="field">
      <div class="lbl">
        <span id="ui_sharesFinLbl">Shares (optional)</span>
        <span class="hint" data-help="shares_fin">i</span>
      </div>
      <input id="in_shares_fin" inputmode="decimal" placeholder="leave blank" />
      <div class="mini" id="ui_sharesFinMini">Not needed for RIM. Kept for future dilution adjustments.</div>
    </div>
  </div>

  <div class="mini" id="ui_finNote" style="margin-top:8px;">
    Note: For Financial (RIM), terminal growth is treated conservatively (0 residual income beyond horizon).
  </div>
</div>

<!-- REIT (AFFO): AFFO per share -->
<div id="sec_reit" style="display:none; margin-top:10px;">
  <div class="row">
    <div class="field">
      <div class="lbl">
        <span id="ui_affoLbl">AFFO per share</span>
        <span class="hint" data-help="affo">i</span>
      </div>
      <input id="in_affo" inputmode="decimal" placeholder="e.g., 2.10" />
      <div class="mini" id="ui_affoMini">For REITs, AFFO/FFO is often more meaningful than FCF.</div>
    </div>

    <div class="field">
      <div class="lbl">
        <span id="ui_reitNoteLbl">Note</span>
        <span class="hint" data-help="reit_note">i</span>
      </div>
      <input id="in_reit_note" placeholder="(optional) e.g., AFFO TTM" />
      <div class="mini" id="ui_reitNoteMini">Just a label for you — does not affect calculations.</div>
    </div>
  </div>
</div>

<!-- GROWTH (Revenue + Margin + Shares): simple skeleton -->
<div id="sec_growth" style="display:none; margin-top:10px;">
  <div class="row">
    <div class="field">
      <div class="lbl">
        <span id="ui_revLbl">Annual revenue</span>
        <span class="hint" data-help="rev">i</span>
      </div>
      <input id="in_rev" inputmode="decimal" placeholder="e.g., 300b" />
      <div class="mini" id="ui_revMini">Annual revenue (TTM or last FY). Use k/m/b shortcuts.</div>
    </div>

    <div class="field">
      <div class="lbl">
        <span id="ui_marginLbl">FCF margin (%)</span>
        <span class="hint" data-help="margin">i</span>
      </div>
      <input id="in_margin" inputmode="decimal" placeholder="e.g., 20" />
      <div class="mini" id="ui_marginMini">Approximate FCF margin to convert revenue to FCF (simple model).</div>
    </div>
  </div>

  <div class="row" style="margin-top:10px;">
    <div class="field">
      <div class="lbl">
        <span id="ui_sharesGLbl">Shares outstanding</span>
        <span class="hint" data-help="shares_g">i</span>
      </div>
      <input id="in_shares_g" inputmode="decimal" placeholder="e.g., 2.6b" />
      <div class="mini" id="ui_sharesGMini">Used to convert from firm value to per-share value.</div>
    </div>

    <div class="field">
      <div class="lbl">
        <span id="ui_revGrowthLbl">Revenue growth base (%)</span>
        <span class="hint" data-help="rev_growth">i</span>
      </div>
      <input id="in_rev_growth" inputmode="decimal" placeholder="e.g., 10" />
      <div class="mini" id="ui_revGrowthMini">Base revenue growth. Bear/Bull will be derived around this.</div>
    </div>
  </div>
</div>

<!-- CYCLICAL: normalized FCF (total) + shares -->
<div id="sec_cyclical" style="display:none; margin-top:10px;">
  <div class="row">
    <div class="field">
      <div class="lbl">
        <span id="ui_nfcfLbl">Normalized FCF — total</span>
        <span class="hint" data-help="nfcf">i</span>
      </div>
      <input id="in_nfcf" inputmode="decimal" placeholder="e.g., 8b" />
      <div class="mini" id="ui_nfcfMini">Cycle-normalized annual FCF (use mid-cycle average, not peak).</div>
    </div>

    <div class="field">
      <div class="lbl">
        <span id="ui_sharesCLbl">Shares outstanding</span>
        <span class="hint" data-help="shares_c">i</span>
      </div>
      <input id="in_shares_c" inputmode="decimal" placeholder="e.g., 1.2b" />
      <div class="mini" id="ui_sharesCMini">Used to convert firm value to per-share.</div>
    </div>
  </div>
</div>

<!-- UTILITY: dividend / FCF per share approach -->
<div id="sec_utility" style="display:none; margin-top:10px;">
  <div class="row">
    <div class="field">
      <div class="lbl">
        <span id="ui_divLbl">Dividend per share (annual)</span>
        <span class="hint" data-help="div">i</span>
      </div>
      <input id="in_div" inputmode="decimal" placeholder="e.g., 2.50" />
      <div class="mini" id="ui_divMini">Simple utility approach: stable annual dividend per share.</div>
    </div>

    <div class="field">
      <div class="lbl">
        <span id="ui_divGrowthLbl">Dividend growth base (%)</span>
        <span class="hint" data-help="div_growth">i</span>
      </div>
      <input id="in_div_growth" inputmode="decimal" placeholder="e.g., 3" />
      <div class="mini" id="ui_divGrowthMini">Base dividend growth. Bear/Bull will be derived around this.</div>
    </div>
  </div>
</div>

<!-- ===== PART 4/5 START ===== -->

<!-- WATCHLIST DRAWER -->
<div class="acc" id="acc_watch">
  <div class="head" data-acc="watch">
    <div class="title">
      <div class="titleRow">
        <div class="h" id="ui_watchTitle">Watchlist</div>
        <span class="tag" id="ui_watchTag">Local storage</span>
      </div>
    </div>
    <div class="chev" aria-hidden="true">▼</div>
  </div>

  <div class="body" id="watchBody">
    <div class="card">
      <h3 id="ui_watchIntroTitle">Saved valuations</h3>
      <div class="muted" id="ui_watchIntroText">
        Saved tickers and their Bear/Base/Bull values. You can delete rows and export the table.
      </div>

      <div class="btns" style="margin-top:10px;">
        <button class="secondary" id="btn_export_csv" type="button">Export CSV</button>
        <button class="secondary" id="btn_print_pdf" type="button">Print / PDF</button>
      </div>
    </div>

    <div class="card" style="margin-top:12px;">
      <div style="overflow:auto;">
        <table id="watchTable" style="width:100%; border-collapse:collapse;">
          <thead>
            <tr>
              <th id="th_date" style="text-align:left; padding:10px;">Date</th>
              <th id="th_ticker" style="text-align:left; padding:10px;">Ticker</th>
              <th id="th_price" style="text-align:right; padding:10px;">Price</th>
              <th id="th_model" style="text-align:right; padding:10px;">Model</th>
              <th id="th_bear" style="text-align:right; padding:10px;">Bear</th>
              <th id="th_base" style="text-align:right; padding:10px;">Base</th>
              <th id="th_bull" style="text-align:right; padding:10px;">Bull</th>
              <th id="th_target" style="text-align:right; padding:10px;">Target</th>
              <th id="th_range" style="text-align:right; padding:10px;">Range</th>
              <th id="th_action" style="text-align:right; padding:10px;">Action</th>
            </tr>
          </thead>
          <tbody id="watchTbody">
            <tr>
              <td colspan="10" class="muted" id="watchEmpty" style="padding:12px;">
                No saved items yet.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="muted" id="ui_watchFooter" style="margin-top:10px;">
      Note: Watchlist is stored locally in your browser (localStorage).
    </div>
  </div>
</div>

<!-- GUIDE DRAWER -->
<div class="acc" id="acc_guide">
  <div class="head" data-acc="guide">
    <div class="title">
      <div class="titleRow">
        <div class="h" id="ui_guideTitle">Guide</div>
        <span class="tag" id="ui_guideTag">How to use</span>
      </div>
    </div>
    <div class="chev" aria-hidden="true">▼</div>
  </div>

  <div class="body" id="guideBody">
    <div class="card">
      <h3 id="ui_guideHead1">1) Choose a model</h3>
      <div class="muted" id="ui_guideText1">
        Use the model buttons (Standard / Financial / REIT / Growth / Cyclical / Utility).  
        After switching, the meaning of inputs and scenarios changes.
      </div>
    </div>

    <div class="card" style="margin-top:12px;">
      <h3 id="ui_guideHead2">2) Which model to use</h3>
      <div class="muted" id="ui_guideText2">
        <ul>
          <li><strong>Standard (FCF DCF):</strong> companies with positive, stable FCF. Enter total FCF and shares.</li>
          <li><strong>Financial (RIM):</strong> banks/insurance/fintech. Enter BVPS + ROE + payout. Scenarios = ROE.</li>
          <li><strong>REIT (AFFO):</strong> REITs. Use AFFO per share. Scenarios = AFFO growth.</li>
          <li><strong>Growth (Revenue):</strong> early/high-growth firms. Revenue + margin approximates FCF.</li>
          <li><strong>Cyclical:</strong> commodity/industrial cyclicals. Use normalized mid-cycle FCF, not peak.</li>
          <li><strong>Utility:</strong> stable dividend-like profile. Uses dividend discount style approximation.</li>
        </ul>
      </div>
    </div>

    <div class="card" style="margin-top:12px;">
      <h3 id="ui_guideHead3">3) Where to find inputs</h3>
      <div class="muted" id="ui_guideText3">
        Typical sources: annual reports (10-K/20-F), investor presentations, company filings, and financial sites.  
        Tip: use 3–5 year averages for FCF/ROE where possible.
      </div>
    </div>

    <div class="card" style="margin-top:12px;">
      <h3 id="ui_guideHead4">Important disclaimer</h3>
      <div class="muted" id="ui_guideText4">
        Equity Analyzer is an educational tool only. It does not provide financial advice, recommendations, or personalized investment guidance.
      </div>
    </div>
  </div>
</div>

<!-- FOOTER DISCLAIMER (always visible) -->
<div class="muted" id="ui_footer" style="margin-top:14px; text-align:center;">
  Educational tool • Not investment advice
</div>

<!-- TOAST + MODAL -->
<div id="toast" style="display:none; position:fixed; left:50%; transform:translateX(-50%); bottom:22px; z-index:9999;
  padding:12px 14px; border-radius:16px; border:1px solid rgba(255,255,255,.18); background:rgba(0,0,0,.55);
  color:white; font-weight:900; backdrop-filter: blur(10px); max-width:min(92vw,520px);"></div>

<div id="modalBackdrop" style="display:none; position:fixed; inset:0; z-index:9998; background:rgba(0,0,0,.55); backdrop-filter: blur(4px);
  align-items:center; justify-content:center; padding:18px;">
  <div style="width:min(720px, 92vw); border-radius:22px; border:1px solid rgba(255,255,255,.18); background:rgba(10,10,25,.92);
    box-shadow: 0 20px 70px rgba(0,0,0,.65); overflow:hidden;">
    <div style="display:flex; align-items:center; justify-content:space-between; padding:14px 14px; border-bottom:1px solid rgba(255,255,255,.10);">
      <div id="modalTitle" style="font-weight:950; font-size:18px;">Info</div>
      <button id="modalClose" type="button" class="secondary" style="height:42px; border-radius:14px;">Close</button>
    </div>
    <div id="modalBody" style="padding:14px; color:rgba(255,255,255,.90); font-weight:750;"></div>
  </div>
</div>

<script>
/* ========= CORE STATE ========= */
const EA_LS_KEY = "ea_watchlist_v3";
const state = {
  lang: "en",
  mode: "quick",
  currency: "USD",
  mos: "off",
  model: "standard",
  lastResult: null
};
const $ = (id) => document.getElementById(id);

/* ========= TEXTS (EN primary + CZ option) ========= */
const TEXTS = {
  en: {
    subtitle: "Multi-Model Fair Value • Watchlist • Guide",
    langLbl: "Language",
    modeLbl: "Mode",
    valTitle: "Fair value",
    valTag: "Models + 3 scenarios",

    watchTitle: "Watchlist",
    watchTag: "Local storage",
    watchIntroTitle: "Saved valuations",
    watchIntroText: "Saved tickers and their Bear/Base/Bull values. You can delete rows and export the table.",
    watchFooter: "Note: Watchlist is stored locally in your browser (localStorage).",
    empty: "No saved items yet.",
    exportCsv: "Export CSV",
    printPdf: "Print / PDF",
    del: "Delete",

    guideTitle: "Guide",
    guideTag: "How to use",
    guideHead1: "1) Choose a model",
    guideText1: "Use the model buttons (Standard / Financial / REIT / Growth / Cyclical / Utility). After switching, inputs and scenario meaning changes.",
    guideHead2: "2) Which model to use",
    guideHead3: "3) Where to find inputs",
    guideHead4: "Important disclaimer",
    guideText4: "Equity Analyzer is an educational tool only. It does not provide financial advice, recommendations, or personalized investment guidance.",

    footer: "Educational tool • Not investment advice",

    inputsMain: "Main inputs",
    modelsTitle: "Choose model",
    currLbl: "Currency",
    mosLbl: "Margin of Safety",
    tickerLbl: "Ticker",
    priceLbl: "Current price",

    inputsScen: "Scenarios (annual)",
    inputsScenText: "Quick mode uses Base only and auto-sets Bear/Bull (±2). Advanced lets you set all manually.",
    bearLbl: "Bear",
    baseLbl: "Base",
    bullLbl: "Bull",
    yearsLbl: "Projection years",
    discLbl: "Discount rate (%)",
    termLbl: "Terminal growth (%)",

    targetsTitle: "Target & Range",
    targetsText: "Target = Base with Margin of Safety. Range = Bear to Bull.",
    targetLbl: "Target price",
    rangeLbl: "Fair value range",

    calc: "Calculate",
    save: "Save to Watchlist",
    demo: "Demo values",
    saveNote: "Saves the last computed result (Bear/Base/Bull) to your local watchlist.",

    m_standard_t: "Standard (FCF DCF)",
    m_standard_d: "Classic companies with stable FCF (non-financial).",
    m_fin_t: "Financial (RIM)",
    m_fin_d: "Banks/insurance/fintech via BVPS + ROE.",
    m_reit_t: "REIT (AFFO)",
    m_reit_d: "REITs — use AFFO per share instead of FCF.",
    m_growth_t: "Growth (Revenue)",
    m_growth_d: "Revenue + margin model (simple).",
    m_cyc_t: "Cyclical",
    m_cyc_d: "Normalized mid-cycle FCF (simple).",
    m_util_t: "Utility",
    m_util_d: "Stable dividend style approximation.",

    /* help texts (modal “i”) */
    helps: {
      currency:{t:"Currency",b:"Currency used for display only. The math assumes your inputs are in this same currency."},
      mos:{t:"Margin of Safety",b:"Applies a discount to the Base scenario to create a more conservative Target price."},
      ticker:{t:"Ticker",b:"Stock symbol for labeling the watchlist."},
      price:{t:"Current price",b:"Market price used to calculate upside/downside vs fair value."},

      fcf_total:{t:"FCF (total)",b:"Enter annual total company FCF. You can write 10b, 500m, 1200000000 etc."},
      shares:{t:"Shares outstanding",b:"Total shares outstanding. You can use 2.6b / 2600m etc."},

      bvps:{t:"BVPS",b:"Book value per share. Core input for Financial (RIM)."},
      roe:{t:"ROE",b:"Return on equity. For Financial model, scenarios represent ROE levels (Bear/Base/Bull)."},
      payout:{t:"Payout ratio",b:"Percent of earnings paid out as dividends/buybacks; remainder increases book value."},
      shares_fin:{t:"Shares (optional)",b:"Not used in RIM. Reserved for future dilution adjustments."},

      affo:{t:"AFFO per share",b:"Adjusted Funds From Operations per share (or FFO/AFFO). Often better than FCF for REITs."},
      reit_note:{t:"Note",b:"Optional label for you (TTM/Forward). Does not affect the calculation."},

      rev:{t:"Revenue",b:"Annual revenue (TTM or last FY). Used in Growth model to approximate FCF via margin."},
      margin:{t:"FCF margin",b:"Approximation of FCF margin (% of revenue). Growth model uses Revenue × Margin to estimate FCF."},
      shares_g:{t:"Shares (Growth)",b:"Shares used to convert firm value to per share in Growth model."},
      rev_growth:{t:"Revenue growth base",b:"Optional base growth. If filled, it will override Base scenario for Growth model in Quick mode."},

      nfcf:{t:"Normalized FCF",b:"Mid-cycle annual FCF for cyclicals. Avoid peak-year numbers."},
      shares_c:{t:"Shares (Cyclical)",b:"Shares used to convert cycliclical firm value to per share."},

      div:{t:"Dividend per share",b:"Annual dividend per share (utility-style approximation)."},
      div_growth:{t:"Dividend growth base",b:"Optional base growth. If filled, it can act as Base scenario for Utility in Quick mode."},

      bear:{t:"Bear scenario",b:"Conservative scenario. Standard/REIT/Growth/Cyclical/Utility: growth %. Financial: ROE %."},
      base:{t:"Base scenario",b:"Realistic scenario. Standard/REIT/Growth/Cyclical/Utility: growth %. Financial: ROE %."},
      bull:{t:"Bull scenario",b:"Optimistic scenario. Standard/REIT/Growth/Cyclical/Utility: growth %. Financial: ROE %."},

      years:{t:"Projection years",b:"How many years to project cash flows or dividends."},
      disc:{t:"Discount rate",b:"Required return. Must be higher than terminal growth for DCF-style models."},
      term:{t:"Terminal growth",b:"Long-run growth after the projection period (DCF models). Keep conservative (e.g., 2–3%)."}
    }
  },

  cz: {
    subtitle: "Multi-Model Fair Value • Watchlist • Návod",
    langLbl: "Jazyk",
    modeLbl: "Mód",
    valTitle: "Férová cena",
    valTag: "Modely + 3 scénáře",

    watchTitle: "Watchlist",
    watchTag: "Lokální úložiště",
    watchIntroTitle: "Uložené výpočty",
    watchIntroText: "Uložené tickery a jejich Bear/Base/Bull. Můžeš mazat řádky a exportovat tabulku.",
    watchFooter: "Pozn.: Watchlist je uložen lokálně v prohlížeči (localStorage).",
    empty: "Zatím nic uloženého.",
    exportCsv: "Export CSV",
    printPdf: "Tisk / PDF",
    del: "Smazat",

    guideTitle: "Návod",
    guideTag: "Jak to používat",
    guideHead1: "1) Vyber model",
    guideText1: "Použij tlačítka modelů (Standard / Finanční / REIT / Growth / Cyklická / Utility). Po přepnutí se změní vstupy i význam scénářů.",
    guideHead2: "2) Kdy použít který model",
    guideHead3: "3) Kde brát vstupy",
    guideHead4: "Důležité upozornění",
    guideText4: "Equity Analyzer je pouze vzdělávací nástroj. Neposkytuje finanční doporučení ani personalizované investiční rady.",

    footer: "Vzdělávací nástroj • Nejedná se o investiční doporučení",

    inputsMain: "Hlavní vstupy",
    modelsTitle: "Vyber model",
    currLbl: "Měna",
    mosLbl: "Margin of Safety",
    tickerLbl: "Ticker",
    priceLbl: "Aktuální cena",

    inputsScen: "Scénáře (ročně)",
    inputsScenText: "Quick mód používá jen Base a Bear/Bull dopočítá automaticky (±2). Advanced dovolí zadat vše ručně.",
    bearLbl: "Bear",
    baseLbl: "Base",
    bullLbl: "Bull",
    yearsLbl: "Délka projekce",
    discLbl: "Diskontní sazba (%)",
    termLbl: "Terminální růst (%)",

    targetsTitle: "Target & Rozpětí",
    targetsText: "Target = Base se zapnutým Margin of Safety. Rozpětí = Bear až Bull.",
    targetLbl: "Target cena",
    rangeLbl: "Rozpětí férové ceny",

    calc: "Spočítat",
    save: "Uložit do Watchlistu",
    demo: "Demo hodnoty",
    saveNote: "Ukládá poslední výsledek (Bear/Base/Bull) do lokálního watchlistu.",

    m_standard_t: "Standard (FCF DCF)",
    m_standard_d: "Klasické firmy se stabilním FCF (mimo finance).",
    m_fin_t: "Finanční (RIM)",
    m_fin_d: "Banky/pojišťovny/fintech přes BVPS + ROE.",
    m_reit_t: "REIT (AFFO)",
    m_reit_d: "REIT – AFFO na akcii místo FCF.",
    m_growth_t: "Growth (Revenue)",
    m_growth_d: "Tržby + marže (jednoduše).",
    m_cyc_t: "Cyklická",
    m_cyc_d: "Normalizované mid-cycle FCF (jednoduše).",
    m_util_t: "Utility",
    m_util_d: "Stabilní dividendový přístup (zjednodušeně).",

    helps: {
      currency:{t:"Měna",b:"Měna je jen pro zobrazení. Počítá se s tím, že vstupy jsou ve stejné měně."},
      mos:{t:"Margin of Safety",b:"Aplikuje slevu na Base a vytvoří konzervativnější Target cenu."},
      ticker:{t:"Ticker",b:"Zkratka akcie pro přehled ve watchlistu."},
      price:{t:"Aktuální cena",b:"Tržní cena akcie pro výpočet % rozdílu vůči férové hodnotě."},

      fcf_total:{t:"FCF celkem",b:"Roční FCF celé firmy. Můžeš psát 10b, 500m, 1200000000 atd."},
      shares:{t:"Počet akcií",b:"Shares outstanding. Můžeš použít 2.6b / 2600m atd."},

      bvps:{t:"BVPS",b:"Účetní hodnota na akcii. Klíčový vstup pro Finanční (RIM)."},
      roe:{t:"ROE",b:"Návratnost vlastního kapitálu. U Finančního modelu scénáře představují ROE."},
      payout:{t:"Payout ratio",b:"Kolik % zisku se vyplatí. Zbytek zvyšuje účetní hodnotu."},
      shares_fin:{t:"Shares (volitelné)",b:"V RIM se nepoužívá. Rezerva pro budoucí rozšíření."},

      affo:{t:"AFFO na akcii",b:"AFFO/FFO na akcii. U REIT je často vhodnější než FCF."},
      reit_note:{t:"Poznámka",b:"Jen label pro tebe (TTM/Forward). Výpočet neovlivní."},

      rev:{t:"Tržby (Revenue)",b:"Roční tržby (TTM nebo FY). Growth model odhaduje FCF přes marži."},
      margin:{t:"FCF marže",b:"Odhad FCF marže (% z tržeb). Growth model počítá Revenue × Marže = FCF."},
      shares_g:{t:"Shares (Growth)",b:"Počet akcií pro Growth model (přepočet na 1 akcii)."},
      rev_growth:{t:"Základ růstu tržeb",b:"Volitelně přepíše Base scénář pro Growth v Quick módu."},

      nfcf:{t:"Normalizované FCF",b:"Mid-cycle roční FCF pro cyklické firmy. Nepoužívej peak rok."},
      shares_c:{t:"Shares (Cyclical)",b:"Počet akcií pro přepočet na 1 akcii."},

      div:{t:"Dividenda na akcii",b:"Roční dividenda na akcii (utility styl)."},
      div_growth:{t:"Základ růstu dividendy",b:"Volitelně přepíše Base scénář pro Utility v Quick módu."},

      bear:{t:"Bear",b:"Pesimistický scénář. U většiny modelů je to růst %, u Financial je to ROE %."},
      base:{t:"Base",b:"Realistický scénář. U většiny modelů je to růst %, u Financial je to ROE %."},
      bull:{t:"Bull",b:"Optimistický scénář. U většiny modelů je to růst %, u Financial je to ROE %."},

      years:{t:"Délka projekce",b:"Počet let projekce cash flow / dividend."},
      disc:{t:"Diskont",b:"Požadovaný výnos. Musí být větší než terminální růst u DCF."},
      term:{t:"Terminál",b:"Dlouhodobý růst po projekci (DCF). Drž konzervativně (např. 2–3%)."}
    }
  }
};

/* ========= TEXTS (replace from "helps:" to the end of TEXTS) ========= */
    helps: {
      ticker: { t: "Ticker", b: "Zkratka akcie (např. AAPL). Slouží pro přehled ve watchlistu." },
      price: { t: "Aktuální cena", b: "Tržní cena akcie. Podle ní počítáme % rozdíl vůči férové hodnotě." },

      fcf_total: { t: "FCF – celkem", b: "Zadej roční Free Cash Flow celé firmy (např. 10 000 000 000). Aplikace to až potom dělí počtem akcií." },
      shares: { t: "Shares Outstanding", b: "Počet akcií v oběhu. Používá se pro přepočet hodnoty firmy na 1 akcii." },

      bvps: { t: "BVPS", b: "Book Value per Share – účetní hodnota na akcii. U bank je to klíčový vstup pro RIM/PB-ROE přístup." },
      roe: { t: "ROE", b: "Return on Equity. U finančních firem scénáře často odpovídají ROE (např. 8 / 12 / 15 %)." },
      payout: { t: "Payout ratio", b: "Kolik % zisku se vyplatí. Zbytek zvyšuje účetní hodnotu (BVPS)." },
      shares_fin: { t: "Shares (volitelné)", b: "U RIM není potřeba. Nech prázdné." },

      affo: { t: "AFFO/akcii", b: "Adjusted Funds From Operations na akcii. U REIT je to vhodnější než FCF." },
      reit_note: { t: "Poznámka", b: "Jen pro tebe (např. AFFO TTM/Forward). Výpočty neovlivní." },

      rev: { t: "Tržby", b: "Roční tržby (TTM nebo poslední FY). Používá se u Growth modelu." },
      opm: { t: "Operating margin", b: "Provozní marže v % (Operating Income / Revenue). U Growth modelu." },
      shares_g: { t: "Shares Outstanding", b: "Počet akcií v oběhu pro Growth model (přepočet na 1 akcii)." },

      cyc_earn: { t: "Normalizovaný zisk", b: "Normalizovaný zisk nebo cash flow přes cyklus (zjednodušeně). U Cyclical modelu." },
      util_div: { t: "Dividenda/akcii", b: "Roční dividenda na akcii (nebo proxy cash flow) pro Utility model." },

      years: { t: "Délka projekce", b: "Počet let projekce. Standardně 10 let." },
      disc: { t: "Diskont", b: "Požadovaný výnos/riziko. Vyšší = konzervativnější. Typicky 8–12 %." },
      term: { t: "Terminální růst", b: "Dlouhodobý růst po projekci (u Standard/REIT). Typicky 2–3 %." },

      bear: { t: "Bear", b: "Pesimistický scénář. U Standard/REIT/Growth/Cyclical/Utility je to růst %, u Financial je to ROE %." },
      base: { t: "Base", b: "Realistický scénář. U Standard/REIT/Growth/Cyclical/Utility je to růst %, u Financial je to ROE %." },
      bull: { t: "Bull", b: "Optimistický scénář. U Standard/REIT/Growth/Cyclical/Utility je to růst %, u Financial je to ROE %." }
    },

    guideHead1: "1) Přepínání modelu",
    guideText1:
      "Model přepínáš nahoře v prvním šuplíku přes velká tlačítka. Po přepnutí se změní vstupní pole i význam scénářů.",

    guideHead2: "2) Kdy použít který model",
    guideText2:
      "<ul>" +
      "<li><strong>Standard (FCF DCF):</strong> klasické firmy se stabilním FCF. Zadej <em>FCF celkem</em> + <em>Shares</em>.</li>" +
      "<li><strong>Financial (RIM):</strong> banky/pojišťovny/fintech. Zadej <em>BVPS</em> + <em>ROE</em> (+ payout).</li>" +
      "<li><strong>REIT (AFFO):</strong> realitní trusty. Zadej <em>AFFO na akcii</em>.</li>" +
      "<li><strong>Growth:</strong> růstové firmy – zjednodušený revenue/margin přístup.</li>" +
      "<li><strong>Cyclical:</strong> cyklické firmy – normalizace přes cyklus (zjednodušeně).</li>" +
      "<li><strong>Utility:</strong> utility/dividendový typ – stabilní cash/dividenda (zjednodušeně).</li>" +
      "</ul>",

    guideHead3: "3) Rychlá kontrola výsledku (sanity check)",
    guideText3:
      "<ul>" +
      "<li>Zkontroluj, zda je zvolen správný model pro typ firmy.</li>" +
      "<li>Jednotky: u Standard je FCF <strong>celkem</strong>, ne „na akcii“.</li>" +
      "<li>Shares Outstanding nesmí být o řád mimo.</li>" +
      "<li>Diskontní sazba musí být vyšší než terminální růst.</li>" +
      "</ul>"
  },

  en: {
    sub: "Multi-Model Fair Value • Watchlist • Guide",
    langLbl: "Language",
    modeLbl: "Mode",

    valTitle: "Fair value",
    valTag: "Models + 3 scenarios",

    watchTitle: "Watchlist",
    watchTag: "Local storage",

    guideTitle: "How to choose a model",
    guideTag: "Guide",

    introTitle: "What does this calculate?",
    introText:
      "Pick a company type (model) and estimate fair value using 3 scenarios. This is an educational tool, not advice.",

    currLbl: "Currency",
    mosLbl: "Margin of Safety",
    decimalTip:
      "Tip: You can type decimals with dot or comma (e.g., 5.5 or 5,5). Spaces are ignored. You can also use k/m/b suffixes (e.g., 2.6b).",

    m_standard_t: "Standard (FCF DCF)",
    m_standard_d: "Classic companies with stable free cash flow.",
    m_fin_t: "Financial (RIM)",
    m_fin_d: "Banks/insurers/fintech via book value + ROE.",
    m_reit_t: "REIT (AFFO)",
    m_reit_d: "REITs via AFFO per share instead of FCF.",
    m_growth_t: "Growth (no FCF)",
    m_growth_d: "Simple revenue/margin model (educational).",
    m_cyc_t: "Cyclical",
    m_cyc_d: "Cycle-normalized approach (simplified).",
    m_util_t: "Utility",
    m_util_d: "Stable cash/dividend proxy model (simplified).",

    inputsMain: "Core inputs",
    tickerLbl: "Ticker",
    priceLbl: "Current price",

    fcfLbl: "Free Cash Flow (FCF) – total",
    fcfMini: "Annual company-level FCF (ideally 3–5y avg). Enter in the currency above.",
    sharesLbl: "Shares Outstanding",
    sharesMini: "Total shares outstanding (used to convert firm value to per-share value).",

    bvpsLbl: "Book Value per Share (BVPS)",
    bvpsMini: "Book value per share (used for banks and financial institutions).",
    roeLbl: "ROE (%)",
    roeMini: "Return on equity used to estimate residual income.",
    payoutLbl: "Payout ratio (%)",
    payoutMini: "Percent of earnings paid out. The rest increases BVPS.",
    sharesFinLbl: "Shares (optional)",
    sharesFinMini: "Not required for RIM. Keep empty.",

    affoLbl: "AFFO per share",
    affoMini: "For REITs, AFFO/FFO is typically more useful than FCF.",
    dummyLbl: "Note",
    dummyMini: "Optional label for your own reference.",

    revLbl: "Annual revenue",
    revMini: "Annual revenue (TTM or last FY). Used in Growth model.",
    opmLbl: "Operating margin (%)",
    opmMini: "Operating margin estimate (Operating Income / Revenue). Used in Growth model.",
    sharesGLabel: "Shares outstanding",
    sharesGMini: "Shares outstanding used to convert to per-share value (Growth model).",

    cycEarnLbl: "Normalized earnings / cash flow",
    cycEarnMini: "A normalized figure across a cycle (simplified).",
    utilDivLbl: "Dividend per share",
    utilDivMini: "Annual dividend per share (or proxy cash flow) used for Utility model.",

    yearsLbl: "Projection length (years)",
    discLbl: "Discount rate (%)",
    termLbl: "Terminal growth (%)",
    termMini: "Used for Standard/REIT. For Financial (RIM), terminal residual income is conservatively 0.",

    inputsScen: "Scenarios (annual)",
    inputsScenText:
      "Quick mode uses Base and auto-derives Bear/Bull (±2). Advanced mode lets you set all three.",
    scenTipText:
      "For Standard/REIT/Growth/Cyclical/Utility, scenarios represent growth %. For Financial, scenarios represent ROE %. ",

    bearLbl: "Bear",
    baseLbl: "Base",
    bullLbl: "Bull",

    targetsTitle: "Target & Range",
    targetsText: "Target price = Base with Margin of Safety applied. Range = Bear to Bull.",
    targetLbl: "Target price",
    rangeLbl: "Fair Value Range",

    calc: "Calculate",
    save: "Save to Watchlist",
    demo: "Demo values",
    saveNote: "Saves the latest result (Bear/Base/Bull).",

    watchIntroTitle: "Saved calculations",
    watchIntroText: "Your saved results are stored locally. You can delete items or export.",
    watchFooter: "Note: Watchlist is stored locally in your browser (localStorage).",
    empty: "Nothing saved yet.",
    exportCsv: "Export CSV",
    printPdf: "Print / PDF",
    del: "Delete",
    footer: "Educational tool • Not investment advice",

    th: {
      date: "Date",
      ticker: "Ticker",
      price: "Price",
      model: "Model",
      bear: "Bear",
      base: "Base",
      bull: "Bull",
      target: "Target",
      range: "Range",
      action: "Action"
    },

    sanityTitle: "Sanity check:",
    sanityLow:
      "Result looks extremely low. Check model choice, units (total vs per-share), and share count.",
    sanityHigh:
      "Result looks extremely high. Check growth, discount rate, and whether the company is cyclical.",

    helps: {
      ticker: { t: "Ticker", b: "Stock ticker symbol (e.g., AAPL). Used for organizing your watchlist." },
      price: { t: "Current price", b: "Market price per share used to compute % difference vs fair value." },

      fcf_total: { t: "FCF – total", b: "Annual firm-level free cash flow (e.g., 10,000,000,000). The app converts to per-share using shares outstanding." },
      shares: { t: "Shares outstanding", b: "Total shares outstanding used to convert firm value to per-share value." },

      bvps: { t: "BVPS", b: "Book value per share (common input for banks/financial institutions in RIM)." },
      roe: { t: "ROE", b: "Return on equity. In Financial model, scenarios typically represent ROE levels (e.g., 8/12/15%)." },
      payout: { t: "Payout ratio", b: "Percent of earnings paid out. The remainder increases book value (BVPS)." },
      shares_fin: { t: "Shares (optional)", b: "Not required for RIM. Leave empty." },

      affo: { t: "AFFO per share", b: "Adjusted Funds From Operations per share. Usually better than FCF for REITs." },
      reit_note: { t: "Note", b: "Optional label for your own reference (does not affect calculations)." },

      rev: { t: "Revenue", b: "Annual revenue (TTM or last FY). Used in Growth model." },
      opm: { t: "Operating margin", b: "Operating margin % estimate used in Growth model." },
      shares_g: { t: "Shares outstanding", b: "Shares outstanding for Growth model per-share conversion." },

      cyc_earn: { t: "Normalized earnings", b: "A simplified normalized earnings/cash flow figure across the cycle." },
      util_div: { t: "Dividend per share", b: "Annual dividend per share (or stable cash proxy) used in Utility model." },

      years: { t: "Projection length", b: "Number of years projected. Typical default: 10." },
      disc: { t: "Discount rate", b: "Required return. Higher = more conservative. Typical: 8–12%." },
      term: { t: "Terminal growth", b: "Long-term growth after projection (Standard/REIT). Typical: 2–3%." },

      bear: { t: "Bear", b: "Pessimistic scenario. Growth % for most models; ROE % for Financial." },
      base: { t: "Base", b: "Most likely scenario. Growth % for most models; ROE % for Financial." },
      bull: { t: "Bull", b: "Optimistic scenario. Growth % for most models; ROE % for Financial." }
    },

    guideHead1: "1) Switching models",
    guideText1:
      "Use the large buttons at the top of the first drawer to switch models. Inputs and scenario meaning change accordingly.",

    guideHead2: "2) When to use which model",
    guideText2:
      "<ul>" +
      "<li><strong>Standard (FCF DCF):</strong> stable cash-flow companies. Enter <em>Total FCF</em> + <em>Shares</em>.</li>" +
      "<li><strong>Financial (RIM):</strong> banks/insurers/fintech. Enter <em>BVPS</em> + <em>ROE</em> (+ payout). Scenarios = ROE.</li>" +
      "<li><strong>REIT (AFFO):</strong> REITs. Enter <em>AFFO per share</em>. Scenarios = AFFO growth.</li>" +
      "<li><strong>Growth:</strong> simple revenue + margin model for educational use.</li>" +
      "<li><strong>Cyclical:</strong> simplified cycle-normalized approach.</li>" +
      "<li><strong>Utility:</strong> stable dividend/cash proxy model.</li>" +
      "</ul>",

    guideHead3: "3) Quick sanity check",
    guideText3:
      "<ul>" +
      "<li>Confirm you selected the right model for the company type.</li>" +
      "<li>Units matter: Standard uses <strong>total</strong> FCF (not per-share).</li>" +
      "<li>Shares outstanding must be realistic (not off by an order of magnitude).</li>" +
      "<li>Discount rate should be greater than terminal growth.</li>" +
      "</ul>"
  }
};
/* ========= END TEXTS ========= */<script>
/* ========= APP STATE ========= */
const state = {
  lang: "en",
  model: "standard",
  currency: "USD"
};

/* ========= HELPERS ========= */
const $ = (id) => document.getElementById(id);

/* ========= LANGUAGE ========= */
function applyLang() {
  const L = TEXTS[state.lang];
  if (!L) return;

  document.querySelectorAll("[data-i]").forEach(el => {
    const k = el.getAttribute("data-i");
    if (L[k]) el.innerHTML = L[k];
  });

  document.querySelectorAll("[data-ph]").forEach(el => {
    const k = el.getAttribute("data-ph");
    if (L[k]) el.placeholder = L[k];
  });
}

/* ========= ACCORDION (fix šuplíků) ========= */
document.querySelectorAll(".acc .head").forEach(h => {
  h.addEventListener("click", () => {
    const acc = h.closest(".acc");
    acc.classList.toggle("open");
    const chev = acc.querySelector(".chev");
    if (chev) chev.textContent = acc.classList.contains("open") ? "▲" : "▼";
  });
});

/* ========= MODEL SWITCHING (6 modelů) ========= */
function setModel(m) {
  state.model = m;

  document.querySelectorAll(".mBtn").forEach(b => {
    b.classList.toggle("active", b.dataset.model === m);
  });

  const show = (id, on) => {
    const el = $(id);
    if (!el) return;
    el.style.display = on ? "" : "none";
  };

  show("sec_standard", m === "standard");
  show("sec_financial", m === "financial");
  show("sec_reit", m === "reit");
  show("sec_growth", m === "growth");
  show("sec_cyclical", m === "cyclical");
  show("sec_utility", m === "utility");

  const tip = $("ui_scenTipText");
  if (tip) {
    tip.textContent =
      m === "financial"
        ? (state.lang === "cz"
            ? "U Financial modelu scénáře = ROE (%)"
            : "In Financial model, scenarios represent ROE (%)")
        : (state.lang === "cz"
            ? "Scénáře = růst (%)"
            : "Scenarios represent growth (%)");
  }
}

document.querySelectorAll(".mBtn").forEach(btn => {
  btn.addEventListener("click", () => setModel(btn.dataset.model));
});

/* ========= NUMBER PARSING ========= */
function parseNum(v) {
  if (v === null || v === undefined) return NaN;
  let s = String(v).trim();
  if (!s) return NaN;

  s = s.replace(/\s+/g, "").replace(",", ".");
  const last = s.slice(-1).toLowerCase();
  let mult = 1;

  if (last === "k") { mult = 1e3; s = s.slice(0, -1); }
  if (last === "m") { mult = 1e6; s = s.slice(0, -1); }
  if (last === "b") { mult = 1e9; s = s.slice(0, -1); }

  const n = Number(s);
  if (!Number.isFinite(n)) return NaN;
  return n * mult;
}

/* ========= FORMAT ========= */
function fmtMoney(n) {
  if (!Number.isFinite(n)) return "–";
  try {
    return new Intl.NumberFormat(
      state.lang === "cz" ? "cs-CZ" : "en-US",
      { style: "currency", currency: state.currency, maximumFractionDigits: 0 }
    ).format(n);
  } catch {
    return n.toFixed(0) + " " + state.currency;
  }
}

function fmtPct(n) {
  if (!Number.isFinite(n)) return "";
  return (n > 0 ? "+" : "") + n.toFixed(1) + "%";
}

/* ========= CALCULATION (základní – aby to fungovalo) ========= */
function calculate() {
  const price = parseNum($("in_price")?.value);
  if (!Number.isFinite(price)) return alert("Invalid price");

  let base = NaN;

  if (state.model === "standard") {
    const fcf = parseNum($("in_fcf")?.value);
    const sh = parseNum($("in_shares")?.value);
    if (fcf > 0 && sh > 0) base = fcf / sh;
  }

  if (state.model === "financial") {
    const bvps = parseNum($("in_bvps")?.value);
    const roe = parseNum($("in_roe")?.value) / 100;
    if (bvps > 0 && roe > 0) base = bvps * roe * 10;
  }

  if (!Number.isFinite(base)) {
    alert(state.lang === "cz"
      ? "Chybné nebo neúplné vstupy"
      : "Invalid or incomplete inputs");
    return;
  }

  $("out_base").value = fmtMoney(base);
  $("out_diff").value = fmtPct((base / price - 1) * 100);
}

/* ========= BUTTONS ========= */
$("btn_calc")?.addEventListener("click", calculate);
$("btn_lang")?.addEventListener("click", () => {
  state.lang = state.lang === "en" ? "cz" : "en";
  applyLang();
});

/* ========= INIT ========= */
applyLang();
setModel("standard");
</script>









      




  




    

    


    


  














  
  

    
        




          

        

          





  

  

  


  


    


      

  

    

          
    

    

    
    


    





    

    

  
        

    
    

  

  





