<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8" />
    <title>Equity Analyz√©r ‚Äì DCF, Watchlist, Earnings</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        * {
            box-sizing: border-box;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: radial-gradient(circle at top, #1f2933 0, #0b1015 55%, #05070a 100%);
            color: #e5e7eb;
        }

        header {
            padding: 24px 16px 8px;
            text-align: center;
        }

        header h1 {
            margin: 0;
            font-size: 1.8rem;
            letter-spacing: 0.03em;
        }

        header p {
            margin: 6px 0 0;
            font-size: 0.9rem;
            color: #9ca3af;
        }

        main {
            max-width: 1200px;
            margin: 0 auto 40px;
            padding: 8px 12px 24px;
        }

        .top-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 16px;
        }

        .tab-btn {
            border: 1px solid #374151;
            background: #111827;
            color: #e5e7eb;
            padding: 8px 14px;
            font-size: 0.9rem;
            border-radius: 999px;
            cursor: pointer;
            transition: background 0.15s ease, color 0.15s ease, transform 0.1s ease;
        }

        .tab-btn:hover {
            background: #1f2937;
            transform: translateY(-1px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #2563eb, #4c1d95);
            border-color: transparent;
        }

        .modules {
            display: grid;
            grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
            gap: 16px;
        }

        @media (max-width: 900px) {
            .modules {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        section.module {
            display: none;
            padding: 16px 14px 18px;
            border-radius: 14px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid #243146;
            box-shadow: 0 18px 35px rgba(0, 0, 0, 0.45);
        }

        section.module.active {
            display: block;
        }

        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            gap: 10px;
            margin-bottom: 10px;
        }

        .module-header h2 {
            margin: 0;
            font-size: 1.1rem;
        }

        .module-header span {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
        }

        label {
            display: block;
            font-size: 0.78rem;
            color: #9ca3af;
            margin-bottom: 3px;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 7px 8px;
            border-radius: 8px;
            border: 1px solid #374151;
            background: #020617;
            color: #e5e7eb;
            font-size: 0.9rem;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        input::placeholder,
        textarea::placeholder {
            color: #6b7280;
        }

        button.primary,
        button.secondary,
        button.danger,
        button.ghost {
            border-radius: 999px;
            padding: 7px 14px;
            font-size: 0.85rem;
            border: 1px solid transparent;
            cursor: pointer;
            transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.15s ease, border-color 0.15s ease;
            white-space: nowrap;
        }

        button.primary {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            color: #f9fafb;
        }

        button.primary:hover {
            box-shadow: 0 0 0 1px #3b82f6, 0 14px 25px rgba(37, 99, 235, 0.35);
            transform: translateY(-1px);
        }

        button.secondary {
            background: #020617;
            border-color: #374151;
            color: #e5e7eb;
        }

        button.secondary:hover {
            background: #111827;
        }

        button.danger {
            background: #7f1d1d;
            color: #fee2e2;
        }

        button.danger:hover {
            background: #991b1b;
        }

        button.ghost {
            background: transparent;
            border-color: #374151;
            color: #9ca3af;
        }

        button.ghost:hover {
            background: #020617;
            color: #e5e7eb;
        }

        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.8rem;
        }

        th,
        td {
            padding: 6px 6px;
            border-bottom: 1px solid #1f2937;
            text-align: right;
        }

        th:first-child,
        td:first-child {
            text-align: left;
        }

        th {
            background: #020617;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        tbody tr:nth-child(even) {
            background: rgba(15, 23, 42, 0.8);
        }

        .pill {
            display: inline-flex;
            align-items: center;
            padding: 2px 7px;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .pill.green {
            background: rgba(16, 185, 129, 0.15);
            color: #6ee7b7;
        }

        .pill.red {
            background: rgba(248, 113, 113, 0.12);
            color: #fecaca;
        }

        .pill.neutral {
            background: rgba(107, 114, 128, 0.3);
            color: #e5e7eb;
        }

        .note {
            margin-top: 8px;
            font-size: 0.75rem;
            color: #9ca3af;
        }

        .split {
            display: grid;
            grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
            gap: 16px;
            margin-top: 10px;
        }

        @media (max-width: 900px) {
            .split {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .card {
            padding: 10px 10px 8px;
            border-radius: 12px;
            border: 1px solid #1f2937;
            background: rgba(15, 23, 42, 0.85);
        }

        .card h3 {
            margin: 0 0 6px;
            font-size: 0.95rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 4px;
        }

        .tag-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }

        footer {
            text-align: center;
            font-size: 0.75rem;
            color: #6b7280;
            padding-bottom: 12px;
        }

        a {
            color: #60a5fa;
        }
    </style>
</head>
<body>
<header>
    <h1>Equity Analyz√©r</h1>
    <p>DCF, spr√°va watchlistu, earnings kalend√°≈ô a pozn√°mky ‚Äì v≈°e lok√°lnƒõ v prohl√≠≈æeƒçi (localStorage).</p>
</header>

<main>
    <div class="top-bar">
        <button class="tab-btn active" data-target="mod-watchlist">Watchlist &amp; pozice</button>
        <button class="tab-btn" data-target="mod-dcf">DCF &amp; f√©rov√° hodnota</button>
        <button class="tab-btn" data-target="mod-earnings">Earnings kalend√°≈ô</button>
        <button class="tab-btn" data-target="mod-notes">Pozn√°mky</button>
        <button class="tab-btn" data-target="mod-settings">Nastaven√≠</button>
    </div>

    <div class="modules">
        <!-- LEFT COLUMN -->
        <div style="display:flex;flex-direction:column;gap:16px;">
            <!-- WATCHLIST -->
            <section id="mod-watchlist" class="module active">
                <div class="module-header">
                    <h2>Watchlist &amp; pozice</h2>
                    <span>Ukl√°d√° se automaticky do localStorage</span>
                </div>

                <div class="grid">
                    <div>
                        <label for="wl-ticker">Ticker*</label>
                        <input id="wl-ticker" type="text" placeholder="AAPL, PLTR‚Ä¶" />
                    </div>
                    <div>
                        <label for="wl-name">N√°zev</label>
                        <input id="wl-name" type="text" placeholder="Apple, Palantir‚Ä¶" />
                    </div>
                    <div>
                        <label for="wl-price">N√°kupn√≠ cena</label>
                        <input id="wl-price" type="number" step="0.01" placeholder="150" />
                    </div>
                    <div>
                        <label for="wl-shares">Kusy</label>
                        <input id="wl-shares" type="number" step="0.01" placeholder="10" />
                    </div>
                    <div>
                        <label for="wl-current">Aktu√°ln√≠ cena</label>
                        <input id="wl-current" type="number" step="0.01" placeholder="nap≈ô. posledn√≠ close" />
                    </div>
                    <div>
                        <label for="wl-tag">Tag</label>
                        <input id="wl-tag" type="text" placeholder="tech, zdravotnictv√≠‚Ä¶" />
                    </div>
                </div>

                <label for="wl-note">Pozn√°mka</label>
                <textarea id="wl-note" placeholder="D≈Øvod n√°kupu, teze, rizika‚Ä¶"></textarea>

                <div class="btn-row">
                    <button class="primary" id="wl-add">P≈ôidat / aktualizovat pozici</button>
                    <button class="secondary" id="wl-clear-form">Vyƒçistit formul√°≈ô</button>
                    <button class="ghost" id="wl-reset-prices">Vynulovat aktu√°ln√≠ ceny</button>
                </div>

                <table id="wl-table">
                    <thead>
                    <tr>
                        <th>Ticker</th>
                        <th>N√°zev</th>
                        <th>Kusy</th>
                        <th>N√°kup</th>
                        <th>Aktu√°ln√≠</th>
                        <th>Zisk</th>
                        <th>Zisk %</th>
                        <th>Hodnota</th>
                        <th>Tag</th>
                        <th>Akce</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <p class="note">
                    Zisk se poƒç√≠t√° z rozd√≠lu mezi n√°kupn√≠ a aktu√°ln√≠ cenou (bez dan√≠ a poplatk≈Ø).
                    Data z≈Øst√°vaj√≠ jen ve tv√©m prohl√≠≈æeƒçi.
                </p>
            </section>

            <!-- DCF -->
            <section id="mod-dcf" class="module">
                <div class="module-header">
                    <h2>DCF kalkulaƒçka</h2>
                    <span>Jednoduch√Ω model se t≈ôemi sc√©n√°≈ôi</span>
                </div>

                <div class="grid">
                    <div>
                        <label for="dcf-ticker">Ticker / firma</label>
                        <input id="dcf-ticker" type="text" placeholder="PLTR" />
                    </div>
                    <div>
                        <label for="dcf-eps">Aktu√°ln√≠ EPS (TTM)</label>
                        <input id="dcf-eps" type="number" step="0.01" placeholder="nap≈ô. 1.25" />
                    </div>
                    <div>
                        <label for="dcf-years">Poƒçet let p≈ôedpovƒõdi</label>
                        <input id="dcf-years" type="number" step="1" value="10" />
                    </div>
                    <div>
                        <label for="dcf-discount">Diskontn√≠ sazba (%)</label>
                        <input id="dcf-discount" type="number" step="0.1" value="9" />
                    </div>
                    <div>
                        <label for="dcf-price">Aktu√°ln√≠ cena</label>
                        <input id="dcf-price" type="number" step="0.01" placeholder="pro porovn√°n√≠" />
                    </div>
                </div>

                <div class="split">
                    <div class="card">
                        <h3>R≈Øst EPS (%) a c√≠lov√Ω P/E</h3>
                        <div class="grid">
                            <div>
                                <label for="dcf-g1">R≈Øst konzervativn√≠</label>
                                <input id="dcf-g1" type="number" step="0.1" value="5" />
                            </div>
                            <div>
                                <label for="dcf-g2">R≈Øst z√°kladn√≠</label>
                                <input id="dcf-g2" type="number" step="0.1" value="10" />
                            </div>
                            <div>
                                <label for="dcf-g3">R≈Øst optimistick√Ω</label>
                                <input id="dcf-g3" type="number" step="0.1" value="15" />
                            </div>
                            <div>
                                <label for="dcf-pe1">P/E konzervativn√≠</label>
                                <input id="dcf-pe1" type="number" step="0.1" value="12" />
                            </div>
                            <div>
                                <label for="dcf-pe2">P/E z√°kladn√≠</label>
                                <input id="dcf-pe2" type="number" step="0.1" value="18" />
                            </div>
                            <div>
                                <label for="dcf-pe3">P/E optimistick√Ω</label>
                                <input id="dcf-pe3" type="number" step="0.1" value="25" />
                            </div>
                        </div>

                        <div class="btn-row">
                            <button class="primary" id="dcf-run">Spoƒç√≠tat DCF</button>
                            <button class="secondary" id="dcf-clear">Vymazat vstupy</button>
                        </div>

                        <p class="note">
                            Jednoduch√Ω DCF: suma diskontovan√Ωch EPS + termin√°ln√≠ hodnota EPS<sub>n</sub> √ó P/E.
                            V≈°e na akcii, bez dluhu a hotovosti.
                        </p>
                    </div>

                    <div class="card">
                        <h3>V√Ωsledek</h3>
                        <table id="dcf-table">
                            <thead>
                            <tr>
                                <th>Sc√©n√°≈ô</th>
                                <th>R≈Øst</th>
                                <th>P/E</th>
                                <th>F√©rov√° cena</th>
                                <th>Rozd√≠l</th>
                                <th>Rozd√≠l %</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>

                        <div class="tag-row" id="dcf-summary-tags"></div>

                        <p class="note">
                            V√Ωpoƒçet je orientaƒçn√≠ ‚Äì v√Ωsledek silnƒõ z√°vis√≠ na zadan√©m r≈Østu a P/E.
                            Nep≈ôedstavuje investiƒçn√≠ doporuƒçen√≠.
                        </p>
                    </div>
                </div>
            </section>

            <!-- SETTINGS (left column, for layout) -->
            <section id="mod-settings" class="module">
                <div class="module-header">
                    <h2>Nastaven√≠ &amp; export</h2>
                    <span>Pr√°ce s localStorage</span>
                </div>

                <div class="card">
                    <h3>LocalStorage</h3>
                    <div class="btn-row">
                        <button class="secondary" id="set-export">Exportovat v≈°echna data (JSON)</button>
                        <button class="danger" id="set-wipe">Smazat v≈°echna data</button>
                    </div>
                    <p class="note">
                        Export si m≈Ø≈æe≈° ulo≈æit bokem (nap≈ô. do souboru). Import zat√≠m nen√≠,
                        ale m≈Ø≈æeme ho kdykoliv doprogramovat ‚Äì JSON si staƒç√≠ ruƒçnƒõ vlo≈æit do konzole.
                    </p>
                    <label for="set-export-area">Exportovan√Ω JSON</label>
                    <textarea id="set-export-area" placeholder="Po kliknut√≠ na Export se sem vlo≈æ√≠ JSON‚Ä¶"></textarea>
                </div>
            </section>
        </div>

        <!-- RIGHT COLUMN -->
        <div style="display:flex;flex-direction:column;gap:16px;">
            <!-- EARNINGS -->
            <section id="mod-earnings" class="module">
                <div class="module-header">
                    <h2>Earnings kalend√°≈ô</h2>
                    <span>Reporty, konference, dal≈°√≠ ud√°losti</span>
                </div>

                <div class="grid">
                    <div>
                        <label for="er-ticker">Ticker*</label>
                        <input id="er-ticker" type="text" placeholder="MSFT" />
                    </div>
                    <div>
                        <label for="er-date">Datum*</label>
                        <input id="er-date" type="date" />
                    </div>
                    <div>
                        <label for="er-type">Typ</label>
                        <select id="er-type">
                            <option value="Earnings">Earnings</option>
                            <option value="Guidance">Guidance</option>
                            <option value="Dividend">Dividend</option>
                            <option value="Jin√©">Jin√©</option>
                        </select>
                    </div>
                </div>

                <label for="er-note">Pozn√°mka</label>
                <textarea id="er-note" placeholder="Q4 2025, d≈Øle≈æit√© pro tezi, oƒçek√°van√Ω r≈Øst‚Ä¶"></textarea>

                <div class="btn-row">
                    <button class="primary" id="er-add">P≈ôidat ud√°lost</button>
                    <button class="secondary" id="er-clear-form">Vyƒçistit formul√°≈ô</button>
                </div>

                <table id="er-table">
                    <thead>
                    <tr>
                        <th>Datum</th>
                        <th>Ticker</th>
                        <th>Typ</th>
                        <th>Pozn√°mka</th>
                        <th>Akce</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <p class="note">
                    Ud√°losti se ukl√°daj√≠ lok√°lnƒõ. ≈ò√°dk≈Ø m≈Ø≈æe≈° m√≠t kolik chce≈° ‚Äì se≈ôazeno podle data.
                </p>
            </section>

            <!-- NOTES -->
        <section id="mod-notes" class="module">
            <div class="module-header">
                <h2>Pozn√°mky k akci√≠m</h2>
                <span>Rychl√Ω textov√Ω not√Ωsek</span>
            </div>

            <label for="note-title">Nadpis / ticker</label>
            <input id="note-title" type="text" placeholder="PLTR ‚Äì dlouhodob√° teze" />

            <label for="note-body">Text pozn√°mky</label>
            <textarea id="note-body" placeholder="Shrnut√≠, katalyz√°tory, rizika, co sledovat‚Ä¶"></textarea>

            <div class="btn-row">
                <button class="primary" id="note-save">Ulo≈æit pozn√°mku</button>
                <button class="secondary" id="note-clear">Vyƒçistit</button>
            </div>

            <table id="note-table">
                <thead>
                <tr>
                    <th>Nadpis</th>
                    <th>Datum</th>
                    <th>Akce</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>

            <p class="note">
                Pozn√°mky slou≈æ√≠ jako jednoduch√Ω p≈ôehled ‚Äì m≈Ø≈æe≈° je libovolnƒõ mazat nebo p≈ôepisovat.
            </p>
        </section>
    </div>
</div>
</main>

<footer>
    Vytvo≈ôeno pro osobn√≠ anal√Ωzu akci√≠ ‚Äì ≈æ√°dn√° data neopou≈°t√≠ tv≈Øj prohl√≠≈æeƒç.
</footer>

<script>
    // --- Pomocn√© funkce ---
    function toNum(val) {
        if (val === null || val === undefined || val === "") return NaN;
        return parseFloat(String(val).replace(",", "."));
    }

    function formatMoney(num) {
        if (isNaN(num)) return "-";
        return num.toFixed(2);
    }

    function formatPct(num) {
        if (isNaN(num)) return "-";
        return (num * 100).toFixed(1) + " %";
    }

    function todayISO() {
        return new Date().toISOString().slice(0, 10);
    }

    // --- P≈ôep√≠n√°n√≠ modul≈Ø (taby) ---
    (function initTabs() {
        var buttons = document.querySelectorAll(".tab-btn");
        buttons.forEach(function (btn) {
            btn.addEventListener("click", function () {
                buttons.forEach(function (b) { b.classList.remove("active"); });
                btn.classList.add("active");

                var target = btn.getAttribute("data-target");
                document.querySelectorAll("section.module").forEach(function (mod) {
                    if (mod.id === target) mod.classList.add("active");
                    else mod.classList.remove("active");
                });
            });
        });
    })();

    // --- WATCHLIST ---
    var wlData = [];
    var wlEditIndex = null;

    function wlSave() {
        try {
            localStorage.setItem("ea_watchlist", JSON.stringify(wlData));
        } catch (e) {
            console.warn("Nelze ulo≈æit watchlist:", e);
        }
    }

    function wlLoad() {
        try {
            var raw = localStorage.getItem("ea_watchlist");
            wlData = raw ? JSON.parse(raw) : [];
        } catch (e) {
            wlData = [];
        }
        wlRender();
    }

    function wlRender() {
        var tbody = document.querySelector("#wl-table tbody");
        tbody.innerHTML = "";

        var totalValue = 0;

        wlData.forEach(function (row, idx) {
            var tr = document.createElement("tr");

            var qty = toNum(row.shares);
            var buy = toNum(row.price);
            var cur = toNum(row.current);

            var value = (!isNaN(qty) && !isNaN(cur)) ? qty * cur : NaN;
            var profit = (!isNaN(qty) && !isNaN(buy) && !isNaN(cur)) ? qty * (cur - buy) : NaN;
            var profitPct = (!isNaN(buy) && buy !== 0 && !isNaN(cur)) ? (cur - buy) / buy : NaN;

            if (!isNaN(value)) totalValue += value;

            var pillClass = "neutral";
            if (!isNaN(profit)) {
                if (profit > 0) pillClass = "green";
                else if (profit < 0) pillClass = "red";
            }

            tr.innerHTML =
                "<td>" + (row.ticker || "") + "</td>" +
                "<td>" + (row.name || "") + "</td>" +
                "<td>" + (qty ? qty.toFixed(2) : "") + "</td>" +
                "<td>" + (isNaN(buy) ? "" : formatMoney(buy)) + "</td>" +
                "<td>" + (isNaN(cur) ? "" : formatMoney(cur)) + "</td>" +
                "<td>" + (isNaN(profit) ? "" :
                    "<span class='pill " + pillClass + "'>" + formatMoney(profit) + "</span>") + "</td>" +
                "<td>" + (isNaN(profitPct) ? "" : formatPct(profitPct)) + "</td>" +
                "<td>" + (isNaN(value) ? "" : formatMoney(value)) + "</td>" +
                "<td>" + (row.tag || "") + "</td>" +
                "<td>" +
                    "<button class='secondary' data-edit='" + idx + "'>‚úèÔ∏è</button> " +
                    "<button class='danger' data-del='" + idx + "'>üóëÔ∏è</button>" +
                "</td>";

            tbody.appendChild(tr);
        });

        if (wlData.length) {
            var trTotal = document.createElement("tr");
            trTotal.innerHTML =
                "<td colspan='7'><strong>Celkov√° hodnota portfolia</strong></td>" +
                "<td><strong>" + formatMoney(totalValue) + "</strong></td>" +
                "<td></td><td></td>";
            tbody.appendChild(trTotal);
        }

        tbody.querySelectorAll("button[data-del]").forEach(function (btn) {
            btn.addEventListener("click", function () {
                var i = parseInt(btn.getAttribute("data-del"), 10);
                if (!isNaN(i)) {
                    wlData.splice(i, 1);
                    wlSave();
                    wlRender();
                }
            });
        });

        tbody.querySelectorAll("button[data-edit]").forEach(function (btn) {
            btn.addEventListener("click", function () {
                var i = parseInt(btn.getAttribute("data-edit"), 10);
                if (!isNaN(i)) {
                    wlEditIndex = i;
                    var row = wlData[i];
                    document.getElementById("wl-ticker").value = row.ticker || "";
                    document.getElementById("wl-name").value = row.name || "";
                    document.getElementById("wl-price").value = row.price || "";
                    document.getElementById("wl-shares").value = row.shares || "";
                    document.getElementById("wl-current").value = row.current || "";
                    document.getElementById("wl-tag").value = row.tag || "";
                    document.getElementById("wl-note").value = row.note || "";
                }
            });
        });
    }

    function wlClearForm() {
        wlEditIndex = null;
        document.getElementById("wl-ticker").value = "";
        document.getElementById("wl-name").value = "";
        document.getElementById("wl-price").value = "";
        document.getElementById("wl-shares").value = "";
        document.getElementById("wl-current").value = "";
        document.getElementById("wl-tag").value = "";
        document.getElementById("wl-note").value = "";
    }

    document.getElementById("wl-add").addEventListener("click", function () {
        var ticker = document.getElementById("wl-ticker").value.trim().toUpperCase();
        var name = document.getElementById("wl-name").value.trim();
        var price = document.getElementById("wl-price").value.trim();
        var shares = document.getElementById("wl-shares").value.trim();
        var current = document.getElementById("wl-current").value.trim();
        var tag = document.getElementById("wl-tag").value.trim();
        var note = document.getElementById("wl-note").value.trim();

        if (!ticker) {
            alert("Vypl≈à pros√≠m alespo≈à ticker.");
            return;
        }

        var row = { ticker, name, price, shares, current, tag, note };

        if (wlEditIndex !== null && wlEditIndex >= 0 && wlEditIndex < wlData.length) {
            wlData[wlEditIndex] = row;
        } else {
            wlData.push(row);
        }

        wlSave();
        wlRender();
        wlClearForm();
    });

    document.getElementById("wl-clear-form").addEventListener("click", wlClearForm);

    document.getElementById("wl-reset-prices").addEventListener("click", function () {
        wlData.forEach(function (row) { row.current = ""; });
        wlSave();
        wlRender();
    });

    // --- DCF ---
    function dcfRun() {
        var eps = toNum(document.getElementById("dcf-eps").value);
        var years = parseInt(document.getElementById("dcf-years").value, 10);
        var discPct = toNum(document.getElementById("dcf-discount").value);
        var price = toNum(document.getElementById("dcf-price").value);

        if (!eps || isNaN(eps)) {
            alert("Zadej pros√≠m EPS.");
            return;
        }
        if (!years || years <= 0 || isNaN(years)) {
            alert("Poƒçet let mus√≠ b√Ωt kladn√© ƒç√≠slo.");
            return;
        }
        if (isNaN(discPct) || discPct <= 0) {
            alert("Diskontn√≠ sazba mus√≠ b√Ωt kladn√°.");
            return;
        }

        var discount = discPct / 100;

        var scenarios = [
            {
                label: "Konzervativn√≠",
                growth: toNum(document.getElementById("dcf-g1").value) / 100,
                pe: toNum(document.getElementById("dcf-pe1").value)
            },
            {
                label: "Z√°kladn√≠",
                growth: toNum(document.getElementById("dcf-g2").value) / 100,
                pe: toNum(document.getElementById("dcf-pe2").value)
            },
            {
                label: "Optimistick√Ω",
                growth: toNum(document.getElementById("dcf-g3").value) / 100,
                pe: toNum(document.getElementById("dcf-pe3").value)
            }
        ];

        var tbody = document.querySelector("#dcf-table tbody");
        tbody.innerHTML = "";
        var summaryTags = document.getElementById("dcf-summary-tags");
        summaryTags.innerHTML = "";

        scenarios.forEach(function (sc) {
            if (isNaN(sc.growth) || isNaN(sc.pe) || sc.pe <= 0) return;

            var epsT = eps;
            var sum = 0;
            for (var i = 1; i <= years; i++) {
                epsT = epsT * (1 + sc.growth);
                var discFactor = Math.pow(1 + discount, i);
                sum += epsT / discFactor;
            }
            var terminal = (epsT * sc.pe) / Math.pow(1 + discount, years);
            var fair = sum + terminal;

            var diff = NaN;
            var diffPct = NaN;
            if (!isNaN(price) && price > 0) {
                diff = fair - price;
                diffPct = (fair - price) / price;
            }

            var pillClass = "neutral";
            if (!isNaN(diffPct)) {
                if (diffPct > 0.15) pillClass = "green";
                else if (diffPct < -0.15) pillClass = "red";
            }

            var tr = document.createElement("tr");
            tr.innerHTML =
                "<td>" + sc.label + "</td>" +
                "<td>" + (sc.growth * 100).toFixed(1) + " %</td>" +
                "<td>" + sc.pe.toFixed(1) + "</td>" +
                "<td>" + formatMoney(fair) + "</td>" +
                "<td>" + (isNaN(diff) ? "-" : formatMoney(diff)) + "</td>" +
                "<td>" + (isNaN(diffPct) ? "-" : formatPct(diffPct)) + "</td>";
            tbody.appendChild(tr);

            if (!isNaN(diffPct)) {
                var div = document.createElement("div");
                div.className = "pill " + pillClass;
                div.textContent = sc.label + ": " + formatPct(diffPct);
                summaryTags.appendChild(div);
            }
        });
    }

    document.getElementById("dcf-run").addEventListener("click", dcfRun);

    document.getElementById("dcf-clear").addEventListener("click", function () {
        [
            "dcf-ticker", "dcf-eps", "dcf-years", "dcf-discount", "dcf-price",
            "dcf-g1", "dcf-g2", "dcf-g3", "dcf-pe1", "dcf-pe2", "dcf-pe3"
        ].forEach(function (id) {
            document.getElementById(id).value = "";
        });
        document.querySelector("#dcf-table tbody").innerHTML = "";
        document.getElementById("dcf-summary-tags").innerHTML = "";
    });

    // --- EARNINGS ---
    var earnings = [];

    function erSave() {
        try {
            localStorage.setItem("ea_earnings", JSON.stringify(earnings));
        } catch (e) {
            console.warn("Nelze ulo≈æit earnings:", e);
        }
    }

    function erLoad() {
        try {
            var raw = localStorage.getItem("ea_earnings");
            earnings = raw ? JSON.parse(raw) : [];
        } catch (e) {
            earnings = [];
        }
        erRender();
    }

    function erRender() {
        var tbody = document.querySelector("#er-table tbody");
        tbody.innerHTML = "";

        earnings.sort(function (a, b) {
            return (a.date || "").localeCompare(b.date || "");
        });

        earnings.forEach(function (row, idx) {
            var tr = document.createElement("tr");
            tr.innerHTML =
                "<td>" + (row.date || "") + "</td>" +
                "<td>" + (row.ticker || "") + "</td>" +
                "<td>" + (row.type || "") + "</td>" +
                "<td>" + (row.note || "") + "</td>" +
                "<td><button class='danger' data-del='" + idx + "'>üóëÔ∏è</button></td>";
            tbody.appendChild(tr);
        });

        tbody.querySelectorAll("button[data-del]").forEach(function (btn) {
            btn.addEventListener("click", function () {
                var i = parseInt(btn.getAttribute("data-del"), 10);
                if (!isNaN(i)) {
                    earnings.splice(i, 1);
                    erSave();
                    erRender();
                }
            });
        });
    }

    function erClearForm() {
        document.getElementById("er-ticker").value = "";
        document.getElementById("er-date").value = "";
        document.getElementById("er-type").value = "Earnings";
        document.getElementById("er-note").value = "";
    }

    document.getElementById("er-add").addEventListener("click", function () {
        var t = document.getElementById("er-ticker").value.trim().toUpperCase();
        var d = document.getElementById("er-date").value;
        var type = document.getElementById("er-type").value;
        var n = document.getElementById("er-note").value.trim();

        if (!t || !d) {
            alert("Vypl≈à pros√≠m alespo≈à ticker a datum.");
            return;
        }

        earnings.push({ ticker: t, date: d, type: type, note: n });
        erSave();
        erRender();
        erClearForm();
    });

    document.getElementById("er-clear-form").addEventListener("click", erClearForm);

    // --- POZN√ÅMKY ---
    var notes = [];

    function noteSaveStore() {
        try {
            localStorage.setItem("ea_notes", JSON.stringify(notes));
        } catch (e) {
            console.warn("Nelze ulo≈æit notes:", e);
        }
    }

    function noteLoad() {
        try {
            var raw = localStorage.getItem("ea_notes");
            notes = raw ? JSON.parse(raw) : [];
        } catch (e) {
            notes = [];
        }
        noteRender();
    }

    function noteRender() {
        var tbody = document.querySelector("#note-table tbody");
        tbody.innerHTML = "";

        notes.forEach(function (n, idx) {
            var tr = document.createElement("tr");
            tr.innerHTML =
                "<td>" + (n.title || "") + "</td>" +
                "<td>" + (n.date || "") + "</td>" +
                "<td>" +
                    "<button class='secondary' data-load='" + idx + "'>Naƒç√≠st</button> " +
                    "<button class='danger' data-del='" + idx + "'>üóëÔ∏è</button>" +
                "</td>";
            tbody.appendChild(tr);
        });

        tbody.querySelectorAll("button[data-del]").forEach(function (btn) {
            btn.addEventListener("click", function () {
                var i = parseInt(btn.getAttribute("data-del"), 10);
                if (!isNaN(i)) {
                    notes.splice(i, 1);
                    noteSaveStore();
                    noteRender();
                }
            });
        });

        tbody.querySelectorAll("button[data-load]").forEach(function (btn) {
            btn.addEventListener("click", function () {
                var i = parseInt(btn.getAttribute("data-load"), 10);
                if (!isNaN(i)) {
                    var n = notes[i];
                    document.getElementById("note-title").value = n.title || "";
                    document.getElementById("note-body").value = n.body || "";
                }
            });
        });
    }

    document.getElementById("note-save").addEventListener("click", function () {
        var title = document.getElementById("note-title").value.trim();
        var body = document.getElementById("note-body").value.trim();
        if (!title && !body) {
            alert("Pr√°zdnou pozn√°mku nem√° cenu ukl√°dat.");
            return;
        }
        notes.push({ title: title || "(bez n√°zvu)", body: body, date: todayISO() });
        noteSaveStore();
        noteRender();
        document.getElementById("note-title").value = "";
        document.getElementById("note-body").value = "";
    });

    document.getElementById("note-clear").addEventListener("click", function () {
        document.getElementById("note-title").value = "";
        document.getElementById("note-body").value = "";
    });

    // --- SETTINGS / EXPORT ---
    document.getElementById("set-export").addEventListener("click", function () {
        var payload = {
            watchlist: wlData,
            earnings: earnings,
            notes: notes
        };
        var text = JSON.stringify(payload, null, 2);
        document.getElementById("set-export-area").value = text;
    });

    document.getElementById("set-wipe").addEventListener("click", function () {
        if (!confirm("Opravdu smazat v≈°echna data z tohoto n√°stroje (watchlist, earnings, pozn√°mky)?")) return;
        wlData = [];
        earnings = [];
        notes = [];
        wlSave();
        erSave();
        noteSaveStore();
        wlRender();
        erRender();
        noteRender();
        document.getElementById("set-export-area").value = "";
    });

    // --- INIT ---
    wlLoad();
    erLoad();
    noteLoad();
</script>
</body>
</html>
