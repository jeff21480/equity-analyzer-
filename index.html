<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Equity Analyzer – DCF Fair Value</title>

  <style>
    :root{
      --bg0:#0b0a16;
      --bg1:#110f24;
      --panel:#201a3d;
      --panel2:#171233;
      --card:#251f4a;

      --accent:#7c5cff;
      --accent2:#4aa3ff;

      --text:#ffffff;
      --muted:#bdb9e6;

      --ok:#39d98a;
      --bad:#ff5c7a;
      --warn:#ffd166;

      --border:rgba(255,255,255,.10);
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --r:18px;
    }

    *{box-sizing:border-box; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;}
    body{
      margin:0;
      color:var(--text);
      background: radial-gradient(900px 500px at 20% 0%, rgba(124,92,255,.25), transparent 55%),
                  radial-gradient(900px 500px at 80% 10%, rgba(74,163,255,.20), transparent 55%),
                  linear-gradient(180deg, var(--bg1), var(--bg0));
      min-height:100vh;
    }

    .wrap{max-width:1100px; margin:0 auto; padding:22px 18px 64px;}
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:14px;
      padding:18px 18px;
      background: linear-gradient(90deg, rgba(124,92,255,.18), rgba(74,163,255,.12));
      border:1px solid var(--border);
      border-radius: var(--r);
      box-shadow: var(--shadow);
    }

    .brand{
      display:flex; flex-direction:column; gap:4px;
    }
    .brand h1{
      margin:0;
      font-size:34px;
      letter-spacing:.2px;
      line-height:1.1;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      font-weight:900;
    }
    .brand .sub{
      color:var(--muted);
      font-size:13px;
    }

    .switches{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid var(--border);
      box-shadow: 0 6px 16px rgba(0,0,0,.25);
    }
    .pill label{font-size:12px; color:var(--muted);}

    select{
      appearance:none;
      background: rgba(0,0,0,.18);
      color:var(--text);
      border:1px solid rgba(255,255,255,.14);
      border-radius: 12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:700;
      outline:none;
    }

    .accordion{
      margin-top:18px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .acc{
      border-radius: var(--r);
      overflow:hidden;
      border:1px solid rgba(124,92,255,.35);
      box-shadow: var(--shadow);
      background: linear-gradient(180deg, rgba(124,92,255,.18), rgba(255,255,255,.04));
    }

    .acc .head{
      display:flex; justify-content:space-between; align-items:center;
      padding:18px 18px;
      cursor:pointer;
      user-select:none;
      background: linear-gradient(90deg, rgba(124,92,255,.35), rgba(74,163,255,.20));
    }
    .acc .head .title{
      display:flex; align-items:center; gap:10px;
      font-size:18px;
      font-weight:900;
    }

    .tag{
      font-size:11px;
      color:rgba(255,255,255,.95);
      padding:4px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.12);
      font-weight:800;
    }

    .chev{
      font-weight:900;
      color:rgba(255,255,255,.85);
      transform: translateY(-1px);
      transition: transform .18s ease;
    }
    .acc.open .chev{ transform: rotate(180deg); }

    .acc .body{
      display:none;
      padding:18px 18px 20px;
      background: rgba(0,0,0,.18);
      border-top:1px solid rgba(255,255,255,.10);
    }
    .acc.open .body{ display:block; }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns: 1fr;}
      .brand h1{font-size:28px;}
      .topbar{flex-direction:column; align-items:flex-start;}
      .switches{justify-content:flex-start;}
    }

    .card{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding:14px;
    }
    .card h3{margin:0 0 10px; font-size:14px; color:rgba(255,255,255,.92); letter-spacing:.2px;}
    .muted{color:var(--muted); font-size:13px; line-height:1.35;}

    .row{
      display:flex; gap:10px; align-items:flex-end; flex-wrap:wrap;
    }

    .field{
      flex:1;
      min-width: 210px;
    }
    .field .lbl{
      display:flex; align-items:center; gap:8px;
      font-size:12px; color:var(--muted);
      margin:0 0 6px;
      font-weight:800;
    }
    .hint{
      width:18px; height:18px;
      display:inline-flex; align-items:center; justify-content:center;
      border-radius: 999px;
      background: rgba(124,92,255,.25);
      border:1px solid rgba(124,92,255,.45);
      color:#fff;
      font-size:12px;
      cursor:pointer;
      user-select:none;
    }

    input{
      width:100%;
      padding:11px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      color:var(--text);
      outline:none;
      font-weight:800;
    }
    input::placeholder{color:rgba(255,255,255,.35); font-weight:700;}

    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;}
    button{
      border:none;
      padding:11px 14px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:900;
      color:#fff;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      box-shadow: 0 10px 20px rgba(0,0,0,.28);
    }
    button.secondary{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.14);
      color:rgba(255,255,255,.92);
      box-shadow:none;
    }
    button.danger{
      background: rgba(255,92,122,.18);
      border:1px solid rgba(255,92,122,.35);
      color:#fff;
    }

    .results{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    @media (max-width:900px){ .results{grid-template-columns:1fr;} }

    .res{
      padding:14px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
    }
    .res .k{font-size:12px; color:var(--muted); font-weight:900; display:flex; justify-content:space-between; align-items:center;}
    .res .v{margin-top:6px; font-size:26px; font-weight:1000; letter-spacing:.2px;}
    .res .s{margin-top:6px; font-size:13px; color:var(--muted);}

    .badgeBear{color:#fff; background: rgba(255,92,122,.22); border:1px solid rgba(255,92,122,.35); padding:3px 10px; border-radius:999px; font-weight:900; font-size:11px;}
    .badgeBase{color:#fff; background: rgba(124,92,255,.28); border:1px solid rgba(124,92,255,.45); padding:3px 10px; border-radius:999px; font-weight:900; font-size:11px;}
    .badgeBull{color:#fff; background: rgba(57,217,138,.18); border:1px solid rgba(57,217,138,.35); padding:3px 10px; border-radius:999px; font-weight:900; font-size:11px;}

    .toast{
      position: fixed;
      left:50%;
      bottom:18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.75);
      border:1px solid rgba(255,255,255,.16);
      color:#fff;
      padding:10px 12px;
      border-radius: 999px;
      font-size:13px;
      box-shadow: var(--shadow);
      display:none;
      z-index:9999;
    }

    .tipbox{
      margin-top:10px;
      padding:12px 12px;
      border-radius: 14px;
      background: rgba(124,92,255,.14);
      border:1px solid rgba(124,92,255,.26);
      color: rgba(255,255,255,.92);
      font-size:13px;
      line-height:1.35;
    }

    /* modal (klikací vysvětlivky v Advanced) */
    .modalBackdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center; justify-content:center;
      z-index:9998;
      padding:18px;
    }
    .modal{
      max-width:720px;
      width:100%;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(124,92,255,.22), rgba(0,0,0,.45));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modalHead{
      padding:14px 14px;
      display:flex; justify-content:space-between; align-items:center;
      background: rgba(0,0,0,.25);
      border-bottom:1px solid rgba(255,255,255,.10);
      gap:10px;
    }
    .modalHead .t{font-weight:1000;}
    .modalBody{padding:14px 14px 16px; color:rgba(255,255,255,.92); line-height:1.45; font-size:14px;}
    .xbtn{
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      border-radius: 12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:1000;
      color:#fff;
      box-shadow:none;
    }

    table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
    }
    th,td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      text-align:left;
      font-size:13px;
      color:rgba(255,255,255,.92);
      vertical-align:top;
    }
    th{color:var(--muted); font-size:12px; font-weight:1000; background: rgba(0,0,0,.18);}
    tr:last-child td{border-bottom:none;}
    .mini{
      font-size:12px; color:var(--muted);
      margin-top:4px;
    }
    .right{ text-align:right; }
    .nowrap{ white-space:nowrap; }
    .footer{
      margin-top:18px;
      text-align:center;
      color: rgba(255,255,255,.45);
      font-size:12px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <h1 id="ui_brand">Equity Analyzer</h1>
        <div class="sub" id="ui_sub">DCF Fair Value Calculator • Watchlist • Education</div>
      </div>

      <div class="switches">
        <div class="pill">
          <label id="ui_langLbl">Jazyk</label>
          <select id="langSel">
            <option value="cz">CZ</option>
            <option value="en">EN</option>
          </select>
        </div>

        <div class="pill">
          <label id="ui_modeLbl">Mód</label>
          <select id="modeSel">
            <option value="quick">Quick</option>
            <option value="advanced">Advanced</option>
          </select>
        </div>
      </div>
    </div>

    <div class="accordion">

      <!-- DCF -->
      <div class="acc open" id="acc_dcf">
        <div class="head" data-acc="dcf">
          <div class="title">
            <span id="ui_dcfTitle">DCF / Výpočet férové ceny</span>
            <span class="tag" id="ui_dcfTag">3 scénáře</span>
          </div>
          <div class="chev">▼</div>
        </div>
        <div class="body" id="dcfBody"><div class="card">
            <h3 id="ui_introTitle">Co tady počítáme?</h3>
            <div class="muted" id="ui_introText">
              Pomocí DCF odhadneme férovou (vnitřní) hodnotu akcie. Výsledek je scénář, ne doporučení.
            </div>

            <div class="row" style="margin-top:12px;">
              <div class="pill">
                <label id="ui_currLbl">Měna</label>
                <select id="curSel">
                  <option value="USD">USD</option>
                  <option value="EUR">EUR</option>
                </select>
              </div>

              <div class="pill">
                <label id="ui_mosLbl">Margin of Safety</label>
                <select id="mosSel">
                  <option value="off">Off</option>
                  <option value="20">20%</option>
                </select>
              </div>
            </div>

            <div class="tipbox" id="ui_decimalTip">
              Tip: Můžeš psát čísla s desetinnou tečkou nebo čárkou (např. 5.5 nebo 5,5). Mezery ignorujeme.
            </div>
          </div>

          <div class="grid" style="margin-top:12px;">
            <div class="card">
              <h3 id="ui_inputsMain">Základní vstupy</h3>

              <div class="row">
                <div class="field">
                  <div class="lbl">
                    <span id="ui_tickerLbl">Ticker</span>
                    <span class="hint" data-help="ticker">i</span>
                  </div>
                  <input id="in_ticker" placeholder="AAPL" />
                </div>

                <div class="field">
                  <div class="lbl">
                    <span id="ui_priceLbl">Aktuální cena</span>
                    <span class="hint" data-help="price">i</span>
                  </div>
                  <input id="in_price" placeholder="např. 180" />
                </div>
              </div>

              <div class="row" style="margin-top:10px;">
                <div class="field">
                  <div class="lbl">
                    <span id="ui_fcfLbl">Free Cash Flow (FCF)</span>
                    <span class="hint" data-help="fcf">i</span>
                  </div>
                  <input id="in_fcf" placeholder="např. 10000000000" />
                  <div class="mini" id="ui_fcfMini">Zadej roční FCF (ideálně průměr 3–5 let). Číslo v měně výše.</div>
                </div>

                <div class="field">
                  <div class="lbl">
                    <span id="ui_sharesLbl">Shares Outstanding</span>
                    <span class="hint" data-help="shares">i</span>
                  </div>
                  <input id="in_shares" placeholder="např. 16000000000" />
                  <div class="mini" id="ui_sharesMini">Počet akcií v oběhu.</div>
                </div>
              </div>

              <div class="row" style="margin-top:10px;">
                <div class="field">
                  <div class="lbl">
                    <span id="ui_yearsLbl">Délka projekce (roky)</span>
                    <span class="hint" data-help="years">i</span>
                  </div>
                  <input id="in_years" placeholder="10" value="10"/>
                </div>

                <div class="field">
                  <div class="lbl">
                    <span id="ui_discLbl">Diskontní sazba (%)</span>
                    <span class="hint" data-help="disc">i</span>
                  </div>
                  <input id="in_disc" placeholder="9" value="9"/>
                </div>
              </div>

              <div class="row" style="margin-top:10px;">
                <div class="field">
                  <div class="lbl">
                    <span id="ui_termLbl">Terminální růst (%)</span>
                    <span class="hint" data-help="term">i</span>
                  </div>
                  <input id="in_term" placeholder="2.5" value="2.5"/>
                </div>
              </div>

              <div class="btns">
                <button id="btn_calc">Calculate</button>
                <button class="secondary" id="btn_save">Save to Watchlist</button>
                <button class="secondary" id="btn_fillDemo">Demo values</button>
              </div>
              <div class="mini" id="ui_saveNote">Uloží se poslední vypočtený výsledek (Bear/Base/Bull).</div>
            </div>

            <div class="card">
              <h3 id="ui_inputsScen">Scénáře růstu (ročně)</h3>
              <div class="muted" id="ui_inputsScenText">
                Quick mód používá jen Base a Bear/Bull dopočítá automaticky (±2 %). Advanced mód umožní zadat vše ručně.
              </div>

              <div class="row" style="margin-top:12px;">
                <div class="field">
                  <div class="lbl">
                    <span id="ui_bearLbl">Bear growth (%)</span>
                    <span class="hint" data-help="bear">i</span>
                  </div>
                  <input id="in_bear" placeholder="2" value="2"/>
                </div>

                <div class="field">
                  <div class="lbl">
                    <span id="ui_baseLbl">Base growth (%)</span>
                    <span class="hint" data-help="base">i</span>
                  </div>
                  <input id="in_base" placeholder="5" value="5"/>
                </div>

                <div class="field">
                  <div class="lbl">
                    <span id="ui_bullLbl">Bull growth (%)</span>
                    <span class="hint" data-help="bull">i</span>
                  </div>
                  <input id="in_bull" placeholder="8" value="8"/>
                </div>
              </div>

              <div class="results" id="resultGrid" style="margin-top:12px;">
                <div class="res">
                  <div class="k"><span class="badgeBear">BEAR</span><span id="r_bear_pct"></span></div>
                  <div class="v" id="r_bear">—</div>
                  <div class="s" id="r_bear_s">—</div>
                </div>
                <div class="res">
                  <div class="k"><span class="badgeBase">BASE</span><span id="r_base_pct"></span></div>
                  <div class="v" id="r_base">—</div>
                  <div class="s" id="r_base_s">—</div>
                </div>
                <div class="res">
                  <div class="k"><span class="badgeBull">BULL</span><span id="r_bull_pct"></span></div>
                  <div class="v" id="r_bull">—</div>
                  <div class="s" id="r_bull_s">—</div>
                </div>
              </div>

              <div class="card" style="margin-top:12px;">
                <h3 id="ui_targetsTitle">Target & Range</h3>
                <div class="muted" id="ui_targetsText">
                  Target cena = Base se zapnutým Margin of Safety. Range = Bear až Bull.
                </div>
                <div class="row" style="margin-top:10px;">
                  <div class="field">
                    <div class="lbl"><span id="ui_targetLbl">Target price</span></div>
                    <input id="out_target" readonly placeholder="—"/>
                  </div>
                  <div class="field">
                    <div class="lbl"><span id="ui_rangeLbl">Fair Value Range</span></div>
                    <input id="out_range" readonly placeholder="—"/>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div><!-- /dcfBody -->
      </div><!-- /acc dcf --><!-- WATCHLIST -->
      <div class="acc" id="acc_watch">
        <div class="head" data-acc="watch">
          <div class="title">
            <span id="ui_watchTitle">Watchlist</span>
            <span class="tag" id="ui_watchTag">Local storage</span>
          </div>
          <div class="chev">▼</div>
        </div>
        <div class="body" id="watchBody">
          <div class="card">
            <h3 id="ui_watchIntroTitle">Uložené výpočty</h3>
            <div class="muted" id="ui_watchIntroText">
              Zde se ukládají vypočítané akcie. Můžeš mazat jednotlivé položky a exportovat tabulku.
            </div>

            <div class="btns" style="margin-top:10px;">
              <button class="secondary" id="btn_export_csv">Export CSV</button>
              <button class="secondary" id="btn_print_pdf">Print / PDF</button>
            </div>
          </div>

          <div class="card" style="margin-top:12px;">
            <div style="overflow:auto;">
              <table id="watchTable">
                <thead>
                  <tr>
                    <th id="th_date">Date</th>
                    <th id="th_ticker">Ticker</th>
                    <th class="right" id="th_price">Price</th>
                    <th class="right" id="th_bear">Bear</th>
                    <th class="right" id="th_base">Base</th>
                    <th class="right" id="th_bull">Bull</th>
                    <th class="right nowrap" id="th_target">Target</th>
                    <th class="right nowrap" id="th_range">Range</th>
                    <th class="right" id="th_action">Action</th>
                  </tr>
                </thead>
                <tbody id="watchTbody">
                  <tr><td colspan="9" class="muted" id="watchEmpty">Zatím nic uloženého.</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="footer" id="ui_watchFooter">
            Pozn.: Watchlist je uložen lokálně v prohlížeči (localStorage).
          </div>
        </div>
      </div>

      <!-- ABOUT -->
      <div class="acc" id="acc_about">
        <div class="head" data-acc="about">
          <div class="title">
            <span id="ui_aboutTitle">O aplikaci</span>
            <span class="tag" id="ui_aboutTag">CZ / EN</span>
          </div>
          <div class="chev">▼</div>
        </div>
        <div class="body" id="aboutBody">
          <div class="card">
            <h3 id="ui_aboutHead">Pro koho je Equity Analyzer</h3>
            <div class="muted" id="ui_aboutText">
              <!-- doplní JS -->
            </div>
          </div>

          <div class="card" style="margin-top:12px;">
            <h3 id="ui_aboutHead2">Jak to používat</h3>
            <div class="muted" id="ui_aboutText2">
              <!-- doplní JS -->
            </div>
          </div>

          <div class="card" style="margin-top:12px;">
            <h3 id="ui_aboutHead3">Upozornění</h3>
            <div class="muted" id="ui_aboutText3">
              <!-- doplní JS -->
            </div>
          </div>
        </div>
      </div>

    </div><!-- /accordion -->

    <div class="footer" id="ui_footer">
      Educational tool • Not investment advice
    </div>
  </div><!-- /wrap -->

  <div class="toast" id="toast"></div>

  <div class="modalBackdrop" id="modalBackdrop">
    <div class="modal">
      <div class="modalHead">
        <div class="t" id="modalTitle">Info</div>
        <button class="xbtn" id="modalClose">Close</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <script>// ---------- i18n ----------
    const TEXTS = {
      cz: {
        sub: "DCF kalkulačka férové hodnoty • Watchlist • Vzdělávání",
        langLbl: "Jazyk",
        modeLbl: "Mód",
        dcfTitle: "DCF / Výpočet férové ceny",
        dcfTag: "3 scénáře",
        watchTitle: "Watchlist",
        watchTag: "Local storage",
        aboutTitle: "O aplikaci",
        aboutTag: "CZ / EN",

        introTitle: "Co tady počítáme?",
        introText: "Pomocí DCF odhadneme férovou (vnitřní) hodnotu akcie. Výsledek je scénář, ne doporučení.",
        currLbl: "Měna",
        mosLbl: "Margin of Safety",
        decimalTip: "Tip: Můžeš psát čísla s desetinnou tečkou nebo čárkou (např. 5.5 nebo 5,5). Mezery ignorujeme.",

        inputsMain: "Základní vstupy",
        tickerLbl: "Ticker",
        priceLbl: "Aktuální cena",
        fcfLbl: "Free Cash Flow (FCF)",
        fcfMini: "Zadej roční FCF (ideálně průměr 3–5 let). Číslo v měně výše.",
        sharesLbl: "Shares Outstanding",
        sharesMini: "Počet akcií v oběhu.",
        yearsLbl: "Délka projekce (roky)",
        discLbl: "Diskontní sazba (%)",
        termLbl: "Terminální růst (%)",
        saveNote: "Uloží se poslední vypočtený výsledek (Bear/Base/Bull).",

        inputsScen: "Scénáře růstu (ročně)",
        inputsScenText: "Quick mód používá jen Base a Bear/Bull dopočítá automaticky (±2 %). Advanced mód umožní zadat vše ručně.",
        bearLbl: "Bear growth (%)",
        baseLbl: "Base growth (%)",
        bullLbl: "Bull growth (%)",

        targetsTitle: "Target & Range",
        targetsText: "Target cena = Base se zapnutým Margin of Safety. Range = Bear až Bull.",
        targetLbl: "Target price",
        rangeLbl: "Fair Value Range",

        calc: "Calculate",
        save: "Save to Watchlist",
        demo: "Demo values",

        watchIntroTitle: "Uložené výpočty",
        watchIntroText: "Zde se ukládají vypočítané akcie. Můžeš mazat jednotlivé položky a exportovat tabulku.",
        watchFooter: "Pozn.: Watchlist je uložen lokálně v prohlížeči (localStorage).",
        empty: "Zatím nic uloženého.",
        th: {
          date:"Datum", ticker:"Ticker", price:"Cena", bear:"Bear", base:"Base", bull:"Bull", target:"Target", range:"Range", action:"Akce"
        },
        exportCsv: "Export CSV",
        printPdf: "Print / PDF",
        del: "Smazat",

        about1h:"Pro koho je Equity Analyzer",
        about1:"Equity Analyzer je pro investory, kteří si chtějí sami odhadnout férovou cenu akcie pomocí metody DCF (Discounted Cash Flow). Aplikace je navržena tak, aby byla srozumitelná i pro retail investory – výpočet je transparentní a krokově pochopitelný.",
        about2h:"Jak to používat",
        about2:"Vyplň základní vstupy (FCF, počet akcií, diskontní sazbu) a nastav scénáře růstu (Bear/Base/Bull). Výsledek ti ukáže férovou hodnotu ve třech scénářích, procentuální rozdíl vůči aktuální ceně a volitelně i Target cenu s Margin of Safety.",
        about3h:"Upozornění",
        about3:"Aplikace slouží k analytickým a vzdělávacím účelům. Nejedná se o investiční doporučení. Výsledek závisí na tebou zvolených předpokladech.",

        helps: {
          ticker: {t:"Ticker", b:"Zkratka akcie (např. AAPL, MSFT). Slouží jen pro přehled ve watchlistu."},
          price: {t:"Aktuální cena", b:"Aktuální tržní cena akcie. Podle ní pak počítáme, o kolik % je akcie pod/nadhodnocená."},
          fcf: {t:"Free Cash Flow (FCF)", b:"FCF je hotovost, která firmě reálně zůstane po investicích. Najdeš ho např. na Yahoo Finance → Cash Flow → Free Cash Flow. Doporučení: použij průměr posledních 3–5 let."},
          shares: {t:"Shares Outstanding", b:"Počet akcií v oběhu. Najdeš v sekci Statistics / Key Metrics. Používá se pro výpočet férové ceny na 1 akcii."},
          years: {t:"Délka projekce", b:"Počet let, po které projekčně modelujeme růst FCF. Standardně 10 let."},
          disc: {t:"Diskontní sazba", b:"Vyjadřuje riziko a požadovaný výnos. Vyšší sazba = konzervativnější výsledek. Pokud si nejsi jistý, použij 9 %."},
          term: {t:"Terminální růst", b:"Dlouhodobý růst po období projekce (nekonečno). Typicky 2–3 %."},
          bear: {t:"Bear growth", b:"Pesimistický scénář růstu FCF. Slabší ekonomika / vyšší konkurence."},
          base: {t:"Base growth", b:"Realistický scénář růstu FCF. Pro většinu firem 3–8 % (dle kvality a sektoru)."},
          bull: {t:"Bull growth", b:"Optimistický scénář růstu FCF. Firma překvapí pozitivně."},
        },

        footer:"Vzdělávací nástroj • Nejedná se o investiční doporučení"
      },

      en: {
        sub: "DCF Fair Value Calculator • Watchlist • Education",
        langLbl: "Language",
        modeLbl: "Mode",
        dcfTitle: "DCF / Fair Value Calculator",
        dcfTag: "3 scenarios",
        watchTitle: "Watchlist",
        watchTag: "Local storage",
        aboutTitle: "About",
        aboutTag: "CZ / EN",

        introTitle: "What are we calculating?",
        introText: "We estimate intrinsic (fair) value using a simple DCF model. The output is a scenario, not a recommendation.",
        currLbl: "Currency",
        mosLbl: "Margin of Safety",
        decimalTip: "Tip: You can type decimals with dot or comma (e.g., 5.5 or 5,5). Spaces are ignored.",

        inputsMain: "Core inputs",
        tickerLbl: "Ticker",
        priceLbl: "Current price",
        fcfLbl: "Free Cash Flow (FCF)",
        fcfMini: "Enter annual FCF (ideally 3–5y average). Value in selected currency.",
        sharesLbl: "Shares Outstanding",
        sharesMini: "Total shares outstanding.",
        yearsLbl: "Projection years",
        discLbl: "Discount rate (%)",
        termLbl: "Terminal growth (%)",
        saveNote: "Saves the latest calculated result (Bear/Base/Bull).",

        inputsScen: "Growth scenarios (annual)",
        inputsScenText: "Quick uses Base only and auto-derives Bear/Bull (±2%). Advanced lets you set all three.",
        bearLbl: "Bear growth (%)",
        baseLbl: "Base growth (%)",
        bullLbl: "Bull growth (%)",

        targetsTitle: "Target & Range",
        targetsText: "Target price = Base with Margin of Safety. Range = Bear to Bull.",
        targetLbl: "Target price",
        rangeLbl: "Fair Value Range",

        calc: "Calculate",
        save: "Save to Watchlist",
        demo: "Demo values",

        watchIntroTitle: "Saved valuations",
        watchIntroText: "Your saved tickers. You can delete individual rows and export the table.",
        watchFooter: "Note: Watchlist is stored locally in your browser (localStorage).",
        empty: "No saved items yet.",
        th: {
          date:"Date", ticker:"Ticker", price:"Price", bear:"Bear", base:"Base", bull:"Bull", target:"Target", range:"Range", action:"Action"
        },
        exportCsv: "Export CSV",
        printPdf: "Print / PDF",
        del: "Delete",

        about1h:"Who is Equity Analyzer for?",
        about1:"Equity Analyzer is built for investors who want to estimate fair value using a transparent DCF framework. It aims to be understandable for retail investors while keeping the math visible and controllable.",
        about2h:"How to use it",
        about2:"Fill in core inputs (FCF, shares, discount rate) and set Bear/Base/Bull growth assumptions. The result shows three fair values, % over/undervaluation vs current price, and an optional Target price with a Margin of Safety.",
        about3h:"Disclaimer",
        about3:"This tool is for educational and analytical purposes only. It is not investment advice. Results depend on your assumptions.",

        helps: {
          ticker: {t:"Ticker", b:"Stock symbol (e.g., AAPL). Used for labeling saved items."},
          price: {t:"Current price", b:"Market price used to compute upside/downside (%) vs fair value."},
          fcf: {t:"Free Cash Flow", b:"Cash the business generates after investments. You can find it on Yahoo Finance → Cash Flow → Free Cash Flow. Suggestion: use a 3–5y average."},
          shares: {t:"Shares outstanding", b:"Total shares. Used to convert equity value into per-share fair value."},
          years: {t:"Projection years", b:"How many years you project FCF growth. Commonly 10 years."},
          disc: {t:"Discount rate", b:"Risk/required return. Higher rate = more conservative. If unsure, use 9%."},
          term: {t:"Terminal growth", b:"Long-run growth after projection period. Typical 2–3%."},
          bear: {t:"Bear growth", b:"Conservative growth scenario for FCF."},
          base: {t:"Base growth", b:"Realistic growth scenario."},
          bull: {t:"Bull growth", b:"Optimistic growth scenario."},
        },

        footer:"Educational tool • Not investment advice"
      }
    };

    const LS_KEY = "ea_watchlist_v1";

    const state = {
      lang: "cz",
      mode: "quick",
      currency: "USD",
      mos: "off",
      lastResult: null
    };

    // ---------- helpers ----------
    const $ = (id) => document.getElementById(id);

    function toast(msg){
      const t = $("toast");
      t.textContent = msg;
      t.style.display = "block";
      clearTimeout(toast._tm);
      toast._tm = setTimeout(()=> t.style.display="none", 2200);
    }

    function parseNum(v){
      if (v === null || v === undefined) return NaN;
      const s = String(v).trim().replace(/\s+/g,"").replace(",",".");
      const n = Number(s);
      return Number.isFinite(n) ? n : NaN;
    }

    function fmtMoney(n, cur){
      if (!Number.isFinite(n)) return "—";
      try{
        return new Intl.NumberFormat(state.lang === "cz" ? "cs-CZ" : "en-US", {
          style:"currency", currency: cur, maximumFractionDigits: 2
        }).format(n);
      }catch{
        return `${n.toFixed(2)} ${cur}`;
      }
    }

    function fmtPct(n){
      if (!Number.isFinite(n)) return "—";
      const sign = n > 0 ? "+" : "";
      return `${sign}${n.toFixed(1)}%`;
    }

    function openModal(title, body){
      $("modalTitle").textContent = title;
      $("modalBody").innerHTML = body;
      $("modalBackdrop").style.display = "flex";
    }
    function closeModal(){
      $("modalBackdrop").style.display = "none";
    }

    $("modalBackdrop").addEventListener("click", (e)=>{
      if (e.target === $("modalBackdrop")) closeModal();
    });
    $("modalClose").addEventListener("click", closeModal);

    // ---------- accordion ----------
    document.querySelectorAll(".acc .head").forEach(h=>{
      h.addEventListener("click", ()=>{
        const acc = h.closest(".acc");
        acc.classList.toggle("open");
      });
    });

    // ---------- UI apply ----------
    function applyLang(){
      const t = TEXTS[state.lang];

      $("ui_sub").textContent = t.sub;
      $("ui_langLbl").textContent = t.langLbl;
      $("ui_modeLbl").textContent = t.modeLbl;

      $("ui_dcfTitle").textContent = t.dcfTitle;
      $("ui_dcfTag").textContent = t.dcfTag;

      $("ui_watchTitle").textContent = t.watchTitle;
      $("ui_watchTag").textContent = t.watchTag;

      $("ui_aboutTitle").textContent = t.aboutTitle;
      $("ui_aboutTag").textContent = t.aboutTag;

      $("ui_introTitle").textContent = t.introTitle;
      $("ui_introText").textContent = t.introText;
      $("ui_currLbl").textContent = t.currLbl;
      $("ui_mosLbl").textContent = t.mosLbl;
      $("ui_decimalTip").textContent = t.decimalTip;

      $("ui_inputsMain").textContent = t.inputsMain;
      $("ui_tickerLbl").textContent = t.tickerLbl;
      $("ui_priceLbl").textContent = t.priceLbl;
      $("ui_fcfLbl").textContent = t.fcfLbl;
      $("ui_fcfMini").textContent = t.fcfMini;
      $("ui_sharesLbl").textContent = t.sharesLbl;
      $("ui_sharesMini").textContent = t.sharesMini;
      $("ui_yearsLbl").textContent = t.yearsLbl;
      $("ui_discLbl").textContent = t.discLbl;
      $("ui_termLbl").textContent = t.termLbl;
      $("ui_saveNote").textContent = t.saveNote;

      $("ui_inputsScen").textContent = t.inputsScen;
      $("ui_inputsScenText").textContent = t.inputsScenText;
      $("ui_bearLbl").textContent = t.bearLbl;
      $("ui_baseLbl").textContent = t.baseLbl;
      $("ui_bullLbl").textContent = t.bullLbl;

      $("ui_targetsTitle").textContent = t.targetsTitle;
      $("ui_targetsText").textContent = t.targetsText;
      $("ui_targetLbl").textContent = t.targetLbl;
      $("ui_rangeLbl").textContent = t.rangeLbl;

      $("btn_calc").textContent = t.calc;
      $("btn_save").textContent = t.save;
      $("btn_fillDemo").textContent = t.demo;

      $("ui_watchIntroTitle").textContent = t.watchIntroTitle;
      $("ui_watchIntroText").textContent = t.watchIntroText;
      $("btn_export_csv").textContent = t.exportCsv;
      $("btn_print_pdf").textContent = t.printPdf;
      $("ui_watchFooter").textContent = t.watchFooter;

      $("th_date").textContent = t.th.date;
      $("th_ticker").textContent = t.th.ticker;
      $("th_price").textContent = t.th.price;
      $("th_bear").textContent = t.th.bear;
      $("th_base").textContent = t.th.base;
      $("th_bull").textContent = t.th.bull;
      $("th_target").textContent = t.th.target;
      $("th_range").textContent = t.th.range;
      $("th_action").textContent = t.th.action;

      $("ui_aboutHead").textContent = t.about1h;
      $("ui_aboutText").textContent = t.about1;
      $("ui_aboutHead2").textContent = t.about2h;
      $("ui_aboutText2").textContent = t.about2;
      $("ui_aboutHead3").textContent = t.about3h;
      $("ui_aboutText3").textContent = t.about3;

      $("ui_footer").textContent = t.footer;

      // rerender watchlist (to update buttons/empty text language)
      renderWatchlist();
    }

    function applyMode(){
      // Quick: lock bear/bull, auto derive from base
      const isQuick = state.mode === "quick";
      $("in_bear").disabled = isQuick;
      $("in_bull").disabled = isQuick;

      $("in_bear").style.opacity = isQuick ? 0.65 : 1;
      $("in_bull").style.opacity = isQuick ? 0.65 : 1;
    }

    $("langSel").addEventListener("change", ()=>{
      state.lang = $("langSel").value;
      applyLang();
    });

    $("modeSel").addEventListener("change", ()=>{
      state.mode = $("modeSel").value;
      applyMode();
      // when switching to quick, recompute derived scen values
      if (state.mode === "quick"){
        const base = parseNum($("in_base").value);
        if (Number.isFinite(base)){
          $("in_bear").value = String(Math.max(base - 2, -50));
          $("in_bull").value = String(base + 2);
        }
      }
    });

    $("curSel").addEventListener("change", ()=>{
      state.currency = $("curSel").value;
      // refresh display values
      if (state.lastResult) paintResults(state.lastResult);
      renderWatchlist();
    });

    $("mosSel").addEventListener("change", ()=>{
      state.mos = $("mosSel").value;
      if (state.lastResult) paintResults(state.lastResult);
    });

    // tooltip/click help
    document.querySelectorAll(".hint").forEach(h=>{
      h.addEventListener("click", ()=>{
        const key = h.getAttribute("data-help");
        const help = TEXTS[state.lang].helps[key];
        const body = `<div style="color:rgba(255,255,255,.92)">${help.b}</div>`;
        openModal(help.t, body);
      });

      // tooltip on hover in quick mode
      h.addEventListener("mouseenter", ()=>{
        if (state.mode !== "quick") return;
        const key = h.getAttribute("data-help");
        const help = TEXTS[state.lang].helps[key];
        h.setAttribute("title", help.b);
      });
    });// ---------- DCF core ----------
    function dcfFairValuePerShare({ fcf, shares, years, discPct, termPct, growthPct }){
      // growthPct is annual growth for projection
      const r = discPct / 100;
      const gT = termPct / 100;
      const g = growthPct / 100;

      // Basic guards
      if (!(fcf > 0) || !(shares > 0) || !(years >= 1) || !(r > 0) || !(gT >= -0.05) ) return NaN;
      if (r <= gT) return NaN; // terminal formula requires r > gT

      let pv = 0;
      let f = fcf;

      for (let y=1; y<=years; y++){
        f = f * (1 + g);
        pv += f / Math.pow(1 + r, y);
      }

      const terminal = (f * (1 + gT)) / (r - gT);
      const pvTerminal = terminal / Math.pow(1 + r, years);

      const equityValue = pv + pvTerminal;
      return equityValue / shares;
    }

    function computeAll(){
      const ticker = String($("in_ticker").value || "").trim().toUpperCase();
      const price = parseNum($("in_price").value);
      const fcf = parseNum($("in_fcf").value);
      const shares = parseNum($("in_shares").value);
      const years = Math.round(parseNum($("in_years").value));
      const disc = parseNum($("in_disc").value);
      const term = parseNum($("in_term").value);

      let base = parseNum($("in_base").value);
      let bear = parseNum($("in_bear").value);
      let bull = parseNum($("in_bull").value);

      if (!Number.isFinite(base)) base = 5;

      if (state.mode === "quick"){
        bear = Number.isFinite(base) ? (base - 2) : 2;
        bull = Number.isFinite(base) ? (base + 2) : 8;
        $("in_bear").value = String(Math.max(bear, -50));
        $("in_bull").value = String(bull);
      }

      const errors = [];
      if (!ticker) errors.push("Ticker");
      if (!Number.isFinite(price) || price <= 0) errors.push("Price");
      if (!Number.isFinite(fcf) || fcf <= 0) errors.push("FCF");
      if (!Number.isFinite(shares) || shares <= 0) errors.push("Shares");
      if (!Number.isFinite(years) || years < 1 || years > 30) errors.push("Years");
      if (!Number.isFinite(disc) || disc <= 0 || disc > 40) errors.push("Discount");
      if (!Number.isFinite(term) || term < -5 || term > 10) errors.push("Terminal");

      if (errors.length){
        toast((state.lang === "cz")
          ? ("Chybí/neplatné: " + errors.join(", "))
          : ("Missing/invalid: " + errors.join(", "))
        );
        return null;
      }

      const perBear = dcfFairValuePerShare({fcf, shares, years, discPct:disc, termPct:term, growthPct:bear});
      const perBase = dcfFairValuePerShare({fcf, shares, years, discPct:disc, termPct:term, growthPct:base});
      const perBull = dcfFairValuePerShare({fcf, shares, years, discPct:disc, termPct:term, growthPct:bull});

      if (![perBear, perBase, perBull].every(Number.isFinite)){
        toast((state.lang === "cz")
          ? "Výpočet selhal: zkontroluj, že diskontní sazba > terminální růst."
          : "Calculation failed: ensure discount rate > terminal growth."
        );
        return null;
      }

      const res = {
        id: crypto?.randomUUID ? crypto.randomUUID() : String(Date.now()) + "_" + Math.random().toString(16).slice(2),
        dt: new Date().toISOString(),
        ticker,
        currency: state.currency,
        inputs: { price, fcf, shares, years, disc, term, bear, base, bull },
        values: { bear: perBear, base: perBase, bull: perBull }
      };

      return res;
    }

    function paintResults(res){
      const cur = res.currency;

      const price = res.inputs.price;
      const bear = res.values.bear;
      const base = res.values.base;
      const bull = res.values.bull;

      $("r_bear").textContent = fmtMoney(bear, cur);
      $("r_base").textContent = fmtMoney(base, cur);
      $("r_bull").textContent = fmtMoney(bull, cur);

      const pctBear = ((bear / price) - 1) * 100;
      const pctBase = ((base / price) - 1) * 100;
      const pctBull = ((bull / price) - 1) * 100;

      $("r_bear_pct").textContent = fmtPct(pctBear);
      $("r_base_pct").textContent = fmtPct(pctBase);
      $("r_bull_pct").textContent = fmtPct(pctBull);

      $("r_bear_s").textContent = (state.lang === "cz") ? "vs aktuální cena" : "vs current price";
      $("r_base_s").textContent = (state.lang === "cz") ? "vs aktuální cena" : "vs current price";
      $("r_bull_s").textContent = (state.lang === "cz") ? "vs aktuální cena" : "vs current price";

      // MOS target based on Base
      const mos = state.mos === "off" ? 0 : (parseInt(state.mos,10)/100);
      const target = base * (1 - mos);
      $("out_target").value = fmtMoney(target, cur);

      // Range Bear-Bull
      $("out_range").value = `${fmtMoney(bear, cur)} – ${fmtMoney(bull, cur)}`;

      state.lastResult = res;
    }

    $("btn_calc").addEventListener("click", ()=>{
      const res = computeAll();
      if (!res) return;
      paintResults(res);
      toast((state.lang === "cz") ? "Hotovo ✅" : "Done ✅");
    });

    $("btn_fillDemo").addEventListener("click", ()=>{
      // safe demo values (big numbers as typical)
      $("in_ticker").value = "DEMO";
      $("in_price").value = "100";
      $("in_fcf").value = "10000000000";
      $("in_shares").value = "2000000000";
      $("in_years").value = "10";
      $("in_disc").value = "9";
      $("in_term").value = "2.5";
      $("in_base").value = "5";
      if (state.mode === "quick"){
        $("in_bear").value = "3";
        $("in_bull").value = "7";
      } else {
        $("in_bear").value = "2";
        $("in_bull").value = "8";
      }
      toast((state.lang === "cz") ? "Demo vyplněno" : "Demo filled");
    });

    function loadWatchlist(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr : [];
      }catch{
        return [];
      }
    }

    function saveWatchlist(arr){
      localStorage.setItem(LS_KEY, JSON.stringify(arr));
    }

    $("btn_save").addEventListener("click", ()=>{
      if (!state.lastResult){
        toast((state.lang === "cz") ? "Nejdřív spočítej výsledek." : "Calculate first.");
        return;
      }
      const arr = loadWatchlist();
      arr.unshift(state.lastResult);
      saveWatchlist(arr);
      renderWatchlist();
      toast((state.lang === "cz") ? "Uloženo do watchlistu ✅" : "Saved ✅");
    });// ---------- Watchlist UI ----------
    function renderWatchlist(){
      const t = TEXTS[state.lang];
      const arr = loadWatchlist();

      const tb = $("watchTbody");
      tb.innerHTML = "";

      if (!arr.length){
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 9;
        td.className = "muted";
        td.id = "watchEmpty";
        td.textContent = t.empty;
        tr.appendChild(td);
        tb.appendChild(tr);
        return;
      }

      for (const item of arr){
        const tr = document.createElement("tr");

        const d = new Date(item.dt);
        const dateStr = (state.lang === "cz")
          ? d.toLocaleString("cs-CZ", {year:"numeric", month:"2-digit", day:"2-digit"})
          : d.toLocaleString("en-US", {year:"numeric", month:"2-digit", day:"2-digit"});

        const price = item.inputs.price;
        const bear = item.values.bear;
        const base = item.values.base;
        const bull = item.values.bull;

        const mos = state.mos === "off" ? 0 : (parseInt(state.mos,10)/100);
        const target = base * (1 - mos);
        const range = `${fmtMoney(bear, item.currency)} – ${fmtMoney(bull, item.currency)}`;

        tr.innerHTML = `
          <td class="nowrap">${dateStr}</td>
          <td class="nowrap"><strong>${item.ticker}</strong><div class="mini">${item.currency}</div></td>
          <td class="right nowrap">${fmtMoney(price, item.currency)}</td>
          <td class="right nowrap">${fmtMoney(bear, item.currency)}<div class="mini">${fmtPct(((bear/price)-1)*100)}</div></td>
          <td class="right nowrap">${fmtMoney(base, item.currency)}<div class="mini">${fmtPct(((base/price)-1)*100)}</div></td>
          <td class="right nowrap">${fmtMoney(bull, item.currency)}<div class="mini">${fmtPct(((bull/price)-1)*100)}</div></td>
          <td class="right nowrap">${fmtMoney(target, item.currency)}</td>
          <td class="right nowrap">${range}</td>
          <td class="right nowrap">
            <button class="danger" data-del="${item.id}">${t.del}</button>
          </td>
        `;
        tb.appendChild(tr);
      }

      // bind delete buttons
      tb.querySelectorAll("button[data-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-del");
          const arr2 = loadWatchlist().filter(x => x.id !== id);
          saveWatchlist(arr2);
          renderWatchlist();
          toast((state.lang === "cz") ? "Smazáno" : "Deleted");
        });
      });
    }

    // CSV export
    $("btn_export_csv").addEventListener("click", ()=>{
      const arr = loadWatchlist();
      if (!arr.length){
        toast((state.lang==="cz") ? "Watchlist je prázdný." : "Watchlist is empty.");
        return;
      }

      const rows = [];
      rows.push(["date","ticker","currency","price","bear","base","bull","target(mos)","range"].join(","));

      const mos = state.mos === "off" ? 0 : (parseInt(state.mos,10)/100);

      for (const it of arr){
        const target = it.values.base * (1 - mos);
        const range = `${it.values.bear} - ${it.values.bull}`;
        rows.push([
          new Date(it.dt).toISOString(),
          it.ticker,
          it.currency,
          it.inputs.price,
          it.values.bear,
          it.values.base,
          it.values.bull,
          target,
          `"${range}"`
        ].join(","));
      }

      const blob = new Blob([rows.join("\n")], {type:"text/csv;charset=utf-8;"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "equity-analyzer-watchlist.csv";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);

      toast((state.lang==="cz") ? "CSV staženo ✅" : "CSV downloaded ✅");
    });

    // Print / PDF (browser print dialog)
    $("btn_print_pdf").addEventListener("click", ()=>{
      const arr = loadWatchlist();
      if (!arr.length){
        toast((state.lang==="cz") ? "Watchlist je prázdný." : "Watchlist is empty.");
        return;
      }

      const mos = state.mos === "off" ? 0 : (parseInt(state.mos,10)/100);

      const html = `
        <html>
        <head>
          <meta charset="utf-8"/>
          <title>Equity Analyzer – Watchlist</title>
          <style>
            body{font-family: Arial, sans-serif; padding:18px;}
            h1{margin:0 0 10px;}
            table{width:100%; border-collapse:collapse;}
            th,td{border:1px solid #ddd; padding:8px; font-size:12px;}
            th{background:#f3f3f3;}
          </style>
        </head>
        <body>
          <h1>Equity Analyzer – Watchlist</h1>
          <p>Generated: ${new Date().toLocaleString()}</p>
          <table>
            <thead>
              <tr>
                <th>Date</th><th>Ticker</th><th>Cur</th><th>Price</th>
                <th>Bear</th><th>Base</th><th>Bull</th>
                <th>Target (MoS)</th><th>Range</th>
              </tr>
            </thead>
            <tbody>
              ${arr.map(it=>{
                const d = new Date(it.dt).toISOString().slice(0,10);
                const target = (it.values.base * (1 - mos)).toFixed(2);
                const range = `${it.values.bear.toFixed(2)} - ${it.values.bull.toFixed(2)}`;
                return `<tr>
                  <td>${d}</td><td>${it.ticker}</td><td>${it.currency}</td><td>${it.inputs.price}</td>
                  <td>${it.values.bear.toFixed(2)}</td><td>${it.values.base.toFixed(2)}</td><td>${it.values.bull.toFixed(2)}</td>
                  <td>${target}</td><td>${range}</td>
                </tr>`;
              }).join("")}
            </tbody>
          </table>
        </body>
        </html>
      `;

      const w = window.open("", "_blank");
      w.document.write(html);
      w.document.close();
      w.focus();
      w.print();
    });

    // ---------- init ----------
    function init(){
      // set defaults
      state.lang = $("langSel").value;
      state.mode = $("modeSel").value;
      state.currency = $("curSel").value;
      state.mos = $("mosSel").value;

      applyMode();
      applyLang();
      renderWatchlist();

      // Quick mode derive
      if (state.mode === "quick"){
        const base = parseNum($("in_base").value);
        if (Number.isFinite(base)){
          $("in_bear").value = String(Math.max(base - 2, -50));
          $("in_bull").value = String(base + 2);
        }
      }
    }

    init();
  </script>
</body>
</html>
    
      
    
    


            


          
          
  

    



    





  
  


  





        


        



  


 

            

        




          

        

          





  

  

  


  


    


      

  

    

          
    

    

    
    


    





    

    

  
        

    
    

  

  





