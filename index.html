<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#5b2cff" />
  <meta name="description" content="Equity Analyzer — educational fair value calculator (DCF-style) with watchlist." />
  <title>Equity Analyzer</title>

  <style>
    :root{
      --bg0:#070716;
      --bg1:#0b0b22;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.14);
      --text:#f6f7ff;
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.60);

      --p1:#5b2cff;   /* purple */
      --p2:#00b3ff;   /* blue */
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;

      --shadow: 0 18px 60px rgba(0,0,0,.50);
      --radius: 18px;
      --radius2: 14px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      font-family: var(--font);
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(91,44,255,.35), transparent 60%),
        radial-gradient(900px 600px at 85% 10%, rgba(0,179,255,.25), transparent 55%),
        radial-gradient(900px 600px at 40% 100%, rgba(91,44,255,.15), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }

    .wrap{
      width:min(1100px, calc(100% - 28px));
      margin: 20px auto 40px;
      padding: 0;
    }

    /* header */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 30;
      padding: 14px 0 10px;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(7,7,22,.70), rgba(7,7,22,.20));
    }

    .brand{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding: 14px 16px;
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.12);
      background:
        linear-gradient(135deg, rgba(91,44,255,.25), rgba(0,179,255,.12)),
        rgba(255,255,255,.05);
      box-shadow: var(--shadow);
    }

    .brandLeft{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 0;
    }

    .title{
      font-size: 28px;
      line-height: 1.1;
      font-weight: 900;
      letter-spacing: .2px;
      text-shadow: 0 10px 30px rgba(0,0,0,.45);
      margin:0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .subtitle{
      font-size: 13px;
      color: var(--muted);
      margin:0;
      letter-spacing: .2px;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:flex;
      gap:8px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
    }
    .pill label{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
    }
    select, input{
      width:100%;
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.16);
      color: var(--text);
      border-radius: 12px;
      padding: 12px 12px;
      outline:none;
      font-size: 15px;
    }
    select{ padding-right: 34px; }
    input::placeholder{ color: rgba(255,255,255,.45); }

    /* accordion */
    .accordion{
      margin-top: 14px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .acc{
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      box-shadow: 0 16px 50px rgba(0,0,0,.35);
      overflow: hidden;
    }

    .acc .head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 16px 16px;
      cursor:pointer;
      user-select:none;
      background:
        linear-gradient(90deg, rgba(91,44,255,.18), rgba(0,179,255,.10));
      border-bottom: 1px solid rgba(255,255,255,.10);
    }

    .acc .head .left{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }
    .acc .head .hTitle{
      font-size: 16px;
      font-weight: 900;
      margin:0;
    }
    .acc .head .hDesc{
      font-size: 12px;
      margin:0;
      color: var(--muted);
    }
    .acc .head .chev{
      font-size: 16px;
      opacity: .9;
      padding-left: 10px;
      transform: rotate(0deg);
      transition: transform .2s ease;
    }
    .acc.open .head .chev{ transform: rotate(180deg); }

    .acc .body{
      max-height: 0;
      overflow:hidden;
      transition: max-height .25s ease;
    }
    .acc.open .body{
      overflow: visible;
    }

    .inner{
      padding: 16px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 12px;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
      .title{ font-size: 24px; }
    }

    .card{
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      padding: 14px;
    }

    .card h3{
      margin: 0 0 8px;
      font-size: 14px;
      font-weight: 900;
      letter-spacing: .2px;
    }

    .muted{ color: var(--muted); font-size: 13px; }
    .mini{ color: var(--muted2); font-size: 12px; margin-top: 6px; line-height: 1.35; }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 520px){
      .row{ grid-template-columns: 1fr; }
    }

    .field{ display:flex; flex-direction:column; gap:8px; }

    .lbl{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .lbl span:first-child{
      font-weight: 800;
      font-size: 13px;
    }

    .hint{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width: 24px;
      height: 24px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.20);
      background: linear-gradient(135deg, rgba(91,44,255,.45), rgba(0,179,255,.25));
      color: #fff;
      font-weight: 900;
      cursor:pointer;
      flex: 0 0 auto;
      user-select:none;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .hint:active{ transform: scale(.98); }

    .seg{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    @media (max-width: 520px){
      .seg{ grid-template-columns: 1fr; }
    }

    .seg button{
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.20);
      color: var(--text);
      padding: 12px 12px;
      font-size: 14px;
      font-weight: 900;
      cursor:pointer;
      transition: transform .06s ease, border-color .2s ease, background .2s ease;
    }
    .seg button.active{
      border-color: rgba(255,255,255,.32);
      background:
        linear-gradient(135deg, rgba(91,44,255,.55), rgba(0,179,255,.35));
    }
    .seg button:active{ transform: scale(.99); }

    .btns{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    button{
      border: 0;
      border-radius: 14px;
      padding: 12px 14px;
      font-size: 14px;
      font-weight: 900;
      cursor:pointer;
    }
    .primary{
      color:#fff;
      background: linear-gradient(135deg, var(--p1), var(--p2));
      box-shadow: 0 18px 55px rgba(91,44,255,.22);
    }
    .secondary{
      color: var(--text);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
    }

    .results{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    @media (max-width: 520px){
      .results{ grid-template-columns: 1fr; }
    }

    .res{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      padding: 12px;
    }

    .res .k{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      font-weight: 900;
      font-size: 12px;
      letter-spacing:.4px;
      opacity:.95;
    }
    .badge{
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.15);
      background: rgba(255,255,255,.08);
      font-weight: 1000;
    }
    .badge.bear{ background: rgba(251,113,133,.16); border-color: rgba(251,113,133,.25); }
    .badge.base{ background: rgba(52,211,153,.16); border-color: rgba(52,211,153,.25); }
    .badge.bull{ background: rgba(251,191,36,.16); border-color: rgba(251,191,36,.25); }

    .res .v{
      font-size: 20px;
      font-weight: 1000;
      margin-top: 8px;
    }
    .res .s{
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    .tableWrap{ overflow:auto; }
    table{
      width:100%;
      border-collapse: collapse;
      min-width: 720px;
    }
    th, td{
      padding: 10px 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      font-size: 13px;
      color: rgba(255,255,255,.88);
    }
    th{
      text-align:left;
      color: rgba(255,255,255,.78);
      font-size: 12px;
      letter-spacing: .3px;
    }
    .right{ text-align:right; }
    .nowrap{ white-space:nowrap; }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.65);
      color: #fff;
      box-shadow: 0 20px 70px rgba(0,0,0,.55);
      display:none;
      z-index: 50;
      max-width: min(560px, calc(100% - 22px));
    }

    .modalBackdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.60);
      backdrop-filter: blur(10px);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 60;
      padding: 18px;
    }
    .modal{
      width: min(640px, 100%);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      background:
        linear-gradient(180deg, rgba(91,44,255,.18), rgba(0,179,255,.08)),
        rgba(10,10,30,.90);
      box-shadow: 0 22px 90px rgba(0,0,0,.65);
      overflow:hidden;
    }
    .modalHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .modalHead .t{
      font-weight: 1000;
      letter-spacing: .2px;
    }
    .xbtn{
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      color: #fff;
      font-weight: 900;
      cursor:pointer;
    }
    .modalBody{
      padding: 14px;
      color: rgba(255,255,255,.90);
      font-size: 13px;
      line-height: 1.45;
    }

    .footer{
      margin-top: 14px;
      font-size: 12px;
      color: rgba(255,255,255,.65);
      text-align:center;
      padding-bottom: 8px;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topbar">
      <div class="brand">
        <div class="brandLeft">
          <h1 class="title" id="ui_appTitle">Equity Analyzer</h1>
          <p class="subtitle" id="ui_appSub">Educational fair value tool • 3 scenarios • Watchlist</p>
        </div>

        <div class="controls">
          <div class="pill">
            <label id="ui_langLbl" for="sel_lang">Language</label>
            <select id="sel_lang">
              <option value="en">EN</option>
              <option value="cz">CZ</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="accordion" id="accordion">

      <!-- 1) CALCULATOR -->
      <div class="acc open" id="acc_calc">
        <div class="head" data-acc="calc">
          <div class="left">
            <p class="hTitle" id="ui_calcTitle">Valuation</p>
            <p class="hDesc" id="ui_calcDesc">Enter inputs → calculate Bear/Base/Bull → save to watchlist</p>
          </div>
          <div class="chev">▼</div>
        </div>

        <div class="body" id="calcBody">
          <div class="inner">
            <div class="grid">

              <!-- LEFT: INPUTS -->
              <div class="card">
                <h3 id="ui_inputsTitle">Inputs</h3>
                <div class="muted" id="ui_inputsText">
                  Universal “DCF-style” calculator. You choose the metric and we discount future per-share cash/earnings/dividends.
                </div>

                <div class="row">
                  <div class="field">
                    <div class="lbl">
                      <span id="ui_tickerLbl">Ticker</span>
                      <span class="hint" data-help="ticker">i</span>
                    </div>
                    <input id="in_ticker" placeholder="e.g. AAPL" />
                    <div class="mini" id="ui_tickerMini">Used only for your watchlist label.</div>
                  </div>

                  <div class="field">
                    <div class="lbl">
                      <span id="ui_currencyLbl">Currency</span>
                      <span class="hint" data-help="currency">i</span>
                    </div>
                    <select id="sel_cur">
                      <option value="USD">USD</option>
                      <option value="EUR">EUR</option>
                      <option value="CZK">CZK</option>
                      <option value="GBP">GBP</option>
                    </select>
                    <div class="mini" id="ui_currencyMini">Formatting only (does not fetch FX).</div>
                  </div>
                </div>

                <div class="row">
                  <div class="field">
                    <div class="lbl">
                      <span id="ui_priceLbl">Current price</span>
                      <span class="hint" data-help="price">i</span>
                    </div>
                    <input id="in_price" inputmode="decimal" placeholder="e.g. 180" />
                    <div class="mini" id="ui_priceMini">Market price to compute upside/downside.</div>
                  </div>

                  <div class="field">
                    <div class="lbl">
                      <span id="ui_mosLbl">Margin of safety (%)</span>
                      <span class="hint" data-help="mos">i</span>
                    </div>
                    <input id="in_mos" inputmode="decimal" placeholder="e.g. 20" value="20" />
                    <div class="mini" id="ui_mosMini">Target price = Base × (1 − MOS).</div>
                  </div>
                </div>

                <div class="card" style="margin-top:12px;">
                  <h3 id="ui_modelTitle">Pick calculation type</h3>
                  <div class="muted" id="ui_modelText">
                    Choose what per-share metric you want to discount.
                  </div>

                  <div class="seg" role="tablist" aria-label="calc types">
                    <button class="typeBtn active" data-type="cash" id="btn_type_cash">
                      <span id="ui_typeCash">Cash-Flow (per share)</span>
                    </button>
                    <button class="typeBtn" data-type="earn" id="btn_type_earn">
                      <span id="ui_typeEarn">Earnings (EPS)</span>
                    </button>
                    <button class="typeBtn" data-type="div" id="btn_type_div">
                      <span id="ui_typeDiv">Dividend (per share)</span>
                    </button>
                  </div>

                  <div class="row" style="margin-top:12px;">
                    <div class="field">
                      <div class="lbl">
                        <span id="ui_metricLbl">Base metric (per share)</span>
                        <span class="hint" data-help="metric">i</span>
                      </div>
                      <input id="in_metric_ps" inputmode="decimal" placeholder="e.g. 6.50" />
                      <div class="mini" id="ui_metricMini">
                        Use TTM or last FY. Example: FCF/share, EPS, or Dividend/share.
                      </div>
                    </div>

                    <div class="field">
                      <div class="lbl">
                        <span id="ui_yearsLbl">Projection years</span>
                        <span class="hint" data-help="years">i</span>
                      </div>
                      <input id="in_years" inputmode="numeric" placeholder="10" value="10" />
                      <div class="mini" id="ui_yearsMini">Typical: 5–10 years.</div>
                    </div>
                  </div>

                  <div class="row" style="margin-top:10px;">
                    <div class="field">
                      <div class="lbl">
                        <span id="ui_discLbl">Discount rate (%)</span>
                        <span class="hint" data-help="disc">i</span>
                      </div>
                      <input id="in_disc" inputmode="decimal" placeholder="9" value="9" />
                      <div class="mini" id="ui_discMini">Higher = more conservative.</div>
                    </div>

                    <div class="field">
                      <div class="lbl">
                        <span id="ui_termLbl">Terminal growth (%)</span>
                        <span class="hint" data-help="term">i</span>
                      </div>
                      <input id="in_term" inputmode="decimal" placeholder="2.5" value="2.5" />
                      <div class="mini" id="ui_termMini">Must be lower than discount rate.</div>
                    </div>
                  </div>

                  <div class="card" style="margin-top:12px;">
                    <h3 id="ui_scenTitle">Scenarios (annual growth)</h3>
                    <div class="muted" id="ui_scenText">
                      Bear/Base/Bull are growth assumptions for the selected metric.
                    </div>

                    <div class="row" style="margin-top:10px;">
                      <div class="field">
                        <div class="lbl">
                          <span id="ui_bearLbl">Bear (%)</span>
                          <span class="hint" data-help="bear">i</span>
                        </div>
                        <input id="in_bear" inputmode="decimal" placeholder="2" value="2" />
                        <div class="mini" id="ui_bearMini">Conservative growth.</div>
                      </div>

                      <div class="field">
                        <div class="lbl">
                          <span id="ui_baseLbl">Base (%)</span>
                          <span class="hint" data-help="base">i</span>
                        </div>
                        <input id="in_base" inputmode="decimal" placeholder="5" value="5" />
                        <div class="mini" id="ui_baseMini">Realistic growth.</div>
                      </div>
                    </div>

                    <div class="row" style="margin-top:10px;">
                      <div class="field">
                        <div class="lbl">
                          <span id="ui_bullLbl">Bull (%)</span>
                          <span class="hint" data-help="bull">i</span>
                        </div>
                        <input id="in_bull" inputmode="decimal" placeholder="8" value="8" />
                        <div class="mini" id="ui_bullMini">Optimistic growth.</div>
                      </div>

                      <div class="field">
                        <div class="lbl">
                          <span id="ui_noteLbl">Number tip</span>
                          <span class="hint" data-help="numbertip">i</span>
                        </div>
                        <input id="in_numbertip" readonly value="Use 2.5 / 2,5 / 10k / 3.2m / 1b" />
<div class="mini" id="ui_noteMini">App accepts comma decimals and k/m/b suffixes.</div>
</div>
</div>

<div class="btns">
  <button class="primary" id="btn_calc" type="button">Calculate</button>
  <button class="secondary" id="btn_save" type="button">Save to Watchlist</button>
  <button class="secondary" id="btn_reset" type="button">Reset</button>
</div>
<div class="mini" id="ui_saveNote">Saves last calculated Bear/Base/Bull.</div>
</div>
</div>
</div>
</div>

<!-- RIGHT: RESULTS -->
<div class="card">
  <h3 id="ui_resultsTitle">Results</h3>
  <div class="muted" id="ui_resultsText">
    Fair value is per share (in selected currency). Upside/downside uses current price.
  </div>

  <div class="results" id="resultGrid">
    <div class="res">
      <div class="k">
        <span class="badge bear" id="ui_badgeBear">BEAR</span>
        <span id="r_bear_pct"></span>
      </div>
      <div class="v" id="r_bear">—</div>
      <div class="s" id="r_bear_s">—</div>
    </div>

    <div class="res">
      <div class="k">
        <span class="badge base" id="ui_badgeBase">BASE</span>
        <span id="r_base_pct"></span>
      </div>
      <div class="v" id="r_base">—</div>
      <div class="s" id="r_base_s">—</div>
    </div>

    <div class="res">
      <div class="k">
        <span class="badge bull" id="ui_badgeBull">BULL</span>
        <span id="r_bull_pct"></span>
      </div>
      <div class="v" id="r_bull">—</div>
      <div class="s" id="r_bull_s">—</div>
    </div>
  </div>

  <div class="card" style="margin-top:12px;">
    <h3 id="ui_targetsTitle">Target & Range</h3>
    <div class="muted" id="ui_targetsText">
      Target = Base with margin of safety. Range = Bear → Bull.
    </div>

    <div class="row" style="margin-top:10px;">
      <div class="field">
        <div class="lbl">
          <span id="ui_targetLbl">Target price</span>
          <span class="hint" data-help="target">i</span>
        </div>
        <input id="out_target" readonly placeholder="—" />
        <div class="mini" id="ui_targetMini">Base × (1 − MOS).</div>
      </div>

      <div class="field">
        <div class="lbl">
          <span id="ui_rangeLbl">Fair value range</span>
          <span class="hint" data-help="range">i</span>
        </div>
        <input id="out_range" readonly placeholder="—" />
        <div class="mini" id="ui_rangeMini">From Bear to Bull.</div>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:12px;">
    <h3 id="ui_sanityTitle">Quick sanity check</h3>
    <div class="muted" id="ui_sanityText">
      If the result looks extreme, re-check discount rate, terminal growth, and metric choice.
    </div>
  </div>

</div>

</div><!-- /grid -->
</div><!-- /inner -->
</div><!-- /body -->
</div><!-- /acc calc -->

<!-- 2) WATCHLIST -->
<div class="acc" id="acc_watch">
  <div class="head" data-acc="watch">
    <div class="left">
      <p class="hTitle" id="ui_watchTitle">Watchlist</p>
      <p class="hDesc" id="ui_watchDesc">Saved calculations in your browser (local storage)</p>
    </div>
    <div class="chev">▼</div>
  </div>

  <div class="body" id="watchBody">
    <div class="inner">
      <div class="card">
        <h3 id="ui_watchIntroTitle">Saved valuations</h3>
        <div class="muted" id="ui_watchIntroText">
          Save a result from the calculator. You can export to CSV or delete rows.
        </div>

        <div class="btns" style="margin-top:10px;">
          <button class="secondary" id="btn_export_csv" type="button">Export CSV</button>
          <button class="secondary" id="btn_clear_all" type="button">Clear all</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px;">
        <div class="tableWrap">
          <table id="watchTable">
            <thead>
              <tr>
                <th id="th_date">Date</th>
                <th id="th_ticker">Ticker</th>
                <th id="th_type">Type</th>
                <th class="right" id="th_price">Price</th>
                <th class="right" id="th_bear">Bear</th>
                <th class="right" id="th_base">Base</th>
                <th class="right" id="th_bull">Bull</th>
                <th class="right nowrap" id="th_target">Target</th>
                <th class="right nowrap" id="th_range">Range</th>
                <th class="right" id="th_action">Action</th>
              </tr>
            </thead>
            <tbody id="watchTbody">
              <tr>
                <td colspan="10" class="muted" id="watchEmpty">Nothing saved yet.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="mini" id="ui_watchFooter" style="margin-top:10px;">
          Note: Watchlist is stored locally in your browser (localStorage).
        </div>
      </div>
    </div>
  </div>
</div><!-- /acc watch -->

<!-- 3) GUIDE -->
<div class="acc" id="acc_guide">
  <div class="head" data-acc="guide">
    <div class="left">
      <p class="hTitle" id="ui_guideTitle">Guide</p>
      <p class="hDesc" id="ui_guideDesc">What the app does, for whom, and important disclaimer</p>
    </div>
    <div class="chev">▼</div>
  </div>

  <div class="body" id="guideBody">
    <div class="inner">
      <div class="card">
        <h3 id="ui_guideH1">What is this?</h3>
        <div class="muted" id="ui_guideP1">
          Equity Analyzer is an educational tool that estimates fair value per share using a simple discounted model with 3 scenarios.
        </div>
      </div>

      <div class="card" style="margin-top:12px;">
        <h3 id="ui_guideH2">Which type to use?</h3>
        <div class="muted" id="ui_guideP2"></div>
      </div>

      <div class="card" style="margin-top:12px;">
        <h3 id="ui_guideH3">Disclaimer</h3>
        <div class="muted" id="ui_guideP3">
          This is NOT financial advice. It is for learning and training only. Always do your own research.
        </div>
      </div>
    </div>
  </div>
</div><!-- /acc guide -->

</div><!-- /accordion -->

<div class="footer" id="ui_footer">
  Educational tool • Not investment advice
</div>

</div><!-- /wrap -->

<div class="toast" id="toast"></div>

<div class="modalBackdrop" id="modalBackdrop">
  <div class="modal">
    <div class="modalHead">
      <div class="t" id="modalTitle">Info</div>
      <button class="xbtn" id="modalClose" type="button">Close</button>
    </div>
    <div class="modalBody" id="modalBody"></div>
  </div>
</div>

<!-- =========================
     PART 2 GOES BELOW
     ========================= --><script>
    /* =========================
       STATE
       ========================= */
    const state = {
      lang: "en",
      type: "cash", // cash | earn | div
      last: null
    };

    const $ = (id) => document.getElementById(id);

    /* =========================
       I18N TEXTS (EN + CZ)
       ========================= */
    const TEXTS = {
      en: {
        appTitle: "Equity Analyzer",
        appSub: "Educational fair value tool • 3 scenarios • Watchlist",
        langLbl: "Language",

        calcTitle: "Valuation",
        calcDesc: "Enter inputs → calculate Bear/Base/Bull → save to watchlist",

        inputsTitle: "Inputs",
        inputsText: "Universal “DCF-style” calculator. You choose the metric and we discount future per-share cash/earnings/dividends.",

        tickerLbl: "Ticker",
        tickerMini: "Used only for your watchlist label.",
        currencyLbl: "Currency",
        currencyMini: "Formatting only (does not fetch FX).",
        priceLbl: "Current price",
        priceMini: "Market price to compute upside/downside.",
        mosLbl: "Margin of safety (%)",
        mosMini: "Target price = Base × (1 − MOS).",

        modelTitle: "Pick calculation type",
        modelText: "Choose what per-share metric you want to discount.",
        typeCash: "Cash-Flow (per share)",
        typeEarn: "Earnings (EPS)",
        typeDiv: "Dividend (per share)",

        metricLbl: "Base metric (per share)",
        metricMini: "Use TTM or last FY. Example: FCF/share, EPS, or Dividend/share.",
        yearsLbl: "Projection years",
        yearsMini: "Typical: 5–10 years.",
        discLbl: "Discount rate (%)",
        discMini: "Higher = more conservative.",
        termLbl: "Terminal growth (%)",
        termMini: "Must be lower than discount rate.",

        scenTitle: "Scenarios (annual growth)",
        scenText: "Bear/Base/Bull are growth assumptions for the selected metric.",
        bearLbl: "Bear (%)",
        bearMini: "Conservative growth.",
        baseLbl: "Base (%)",
        baseMini: "Realistic growth.",
        bullLbl: "Bull (%)",
        bullMini: "Optimistic growth.",
        noteLbl: "Number tip",
        noteMini: "App accepts comma decimals and k/m/b suffixes.",
        saveNote: "Saves last calculated Bear/Base/Bull.",

        btnCalc: "Calculate",
        btnSave: "Save to Watchlist",
        btnReset: "Reset",

        resultsTitle: "Results",
        resultsText: "Fair value is per share (in selected currency). Upside/downside uses current price.",
        targetsTitle: "Target & Range",
        targetsText: "Target = Base with margin of safety. Range = Bear → Bull.",
        targetLbl: "Target price",
        targetMini: "Base × (1 − MOS).",
        rangeLbl: "Fair value range",
        rangeMini: "From Bear to Bull.",
        sanityTitle: "Quick sanity check",
        sanityText: "If the result looks extreme, re-check discount rate, terminal growth, and metric choice.",

        watchTitle: "Watchlist",
        watchDesc: "Saved calculations in your browser (local storage)",
        watchIntroTitle: "Saved valuations",
        watchIntroText: "Save a result from the calculator. You can export to CSV or delete rows.",
        watchFooter: "Note: Watchlist is stored locally in your browser (localStorage).",
        watchEmpty: "Nothing saved yet.",
        exportCsv: "Export CSV",
        clearAll: "Clear all",

        th: { date:"Date", ticker:"Ticker", type:"Type", price:"Price", bear:"Bear", base:"Base", bull:"Bull", target:"Target", range:"Range", action:"Action" },
        del: "Delete",

        guideTitle: "Guide",
        guideDesc: "What the app does, for whom, and important disclaimer",
        guideH1: "What is this?",
        guideP1: "Equity Analyzer is an educational tool that estimates fair value per share using a simple discounted model with 3 scenarios.",
        guideH2: "Which type to use?",
        guideP2:
          "<ul>" +
          "<li><strong>Cash-Flow (per share):</strong> best for companies with stable free cash flow (many non-financial businesses).</li>" +
          "<li><strong>Earnings (EPS):</strong> can work when EPS is meaningful and cash flow is harder to estimate (but be careful with one-off items).</li>" +
          "<li><strong>Dividend (per share):</strong> useful for dividend-focused stocks (utilities, mature companies). If dividend is unstable, choose a different metric.</li>" +
          "</ul>",
        guideH3: "Disclaimer",
        guideP3: "This is NOT financial advice. It is for learning and training only. Always do your own research.",

        footer: "Educational tool • Not investment advice",

        helps: {
          ticker: { t:"Ticker", b:"Stock symbol (e.g. AAPL). Only used to label your watchlist row." },
          currency: { t:"Currency", b:"Used for formatting results only. The app does not fetch FX rates." },
          price: { t:"Current price", b:"Market price per share. Used to compute upside/downside vs fair value." },
          mos: { t:"Margin of safety", b:"Extra discount for your target. Example: 20% MOS → Target = Base × 0.80." },
          metric: { t:"Base metric (per share)", b:"Your starting value per share (TTM or last FY). Examples: FCF/share, EPS, Dividend/share." },
          years: { t:"Projection years", b:"How many years you project growth before terminal value. Typical: 5–10." },
          disc: { t:"Discount rate", b:"Required return. Higher rate → lower fair value. Typical: 8–12%." },
          term: { t:"Terminal growth", b:"Long-term growth after projection. Must be lower than discount rate." },
          bear: { t:"Bear growth", b:"Conservative annual growth for your metric." },
          base: { t:"Base growth", b:"Realistic annual growth for your metric." },
          bull: { t:"Bull growth", b:"Optimistic annual growth for your metric." },
          numbertip: { t:"Number input", b:"You can type 2.5 or 2,5. Also supports suffix: 10k, 3.2m, 1b." },
          target: { t:"Target price", b:"Your “buy target” based on Base scenario with margin of safety applied." },
          range: { t:"Fair value range", b:"Displays Bear → Bull as a quick range of outcomes." }
        }
      },

      cz: {
        appTitle: "Equity Analyzer",
        appSub: "Vzdělávací výpočet férové ceny • 3 scénáře • Watchlist",
        langLbl: "Jazyk",

        calcTitle: "Výpočet",
        calcDesc: "Zadej vstupy → spočítej Bear/Base/Bull → ulož do watchlistu",

        inputsTitle: "Vstupy",
        inputsText: "Univerzální „DCF-style“ kalkulačka. Vybereš metriku a diskontujeme budoucí hodnoty na akcii (cash flow / zisk / dividenda).",

        tickerLbl: "Ticker",
        tickerMini: "Použije se jen jako popisek ve watchlistu.",
        currencyLbl: "Měna",
        currencyMini: "Jen formátování (apka nestahuje kurzy).",
        priceLbl: "Aktuální cena",
        priceMini: "Tržní cena pro výpočet % rozdílu vůči férové hodnotě.",
        mosLbl: "Margin of Safety (%)",
        mosMini: "Target price = Base × (1 − MOS).",

        modelTitle: "Vyber typ výpočtu",
        modelText: "Vyber, jakou metriku na akcii chceš diskontovat.",
        typeCash: "Cash-Flow (na akcii)",
        typeEarn: "Zisk (EPS)",
        typeDiv: "Dividenda (na akcii)",

        metricLbl: "Základní metrika (na akcii)",
        metricMini: "Použij TTM nebo poslední FY. Příklad: FCF/akcii, EPS, dividenda/akcii.",
        yearsLbl: "Délka projekce (roky)",
        yearsMini: "Typicky 5–10 let.",
        discLbl: "Diskontní sazba (%)",
        discMini: "Vyšší = konzervativnější.",
        termLbl: "Terminální růst (%)",
        termMini: "Musí být nižší než diskont.",

        scenTitle: "Scénáře (roční růst)",
        scenText: "Bear/Base/Bull jsou růstové předpoklady pro zvolenou metriku.",
        bearLbl: "Bear (%)",
        bearMini: "Konzervativní růst.",
        baseLbl: "Base (%)",
        baseMini: "Realistický růst.",
        bullLbl: "Bull (%)",
        bullMini: "Optimistický růst.",
        noteLbl: "Tip na čísla",
        noteMini: "Aplikace umí desetinnou čárku i tečku a zkratky k/m/b.",
        saveNote: "Uloží se poslední vypočtený Bear/Base/Bull.",

        btnCalc: "Spočítat",
        btnSave: "Uložit do Watchlistu",
        btnReset: "Reset",

        resultsTitle: "Výsledky",
        resultsText: "Férová cena je na akcii (v měně výše). % rozdíl se počítá proti aktuální ceně.",
        targetsTitle: "Target & Rozpětí",
        targetsText: "Target = Base se zapnutým MOS. Rozpětí = Bear → Bull.",
        targetLbl: "Target price",
        targetMini: "Base × (1 − MOS).",
        rangeLbl: "Rozpětí férové ceny",
        rangeMini: "Od Bear po Bull.",
        sanityTitle: "Rychlá kontrola",
        sanityText: "Když výsledek vypadá divně, zkontroluj diskont, terminál a správnou metriku.",

        watchTitle: "Watchlist",
        watchDesc: "Uložené výpočty v prohlížeči (local storage)",
        watchIntroTitle: "Uložené výpočty",
        watchIntroText: "Ulož si výsledek z kalkulačky. Můžeš exportovat CSV nebo mazat řádky.",
        watchFooter: "Pozn.: Watchlist je uložen lokálně v prohlížeči (localStorage).",
        watchEmpty: "Zatím nic uloženého.",
        exportCsv: "Export CSV",
        clearAll: "Smazat vše",

        th: { date:"Datum", ticker:"Ticker", type:"Typ", price:"Cena", bear:"Bear", base:"Base", bull:"Bull", target:"Target", range:"Rozpětí", action:"Akce" },
        del: "Smazat",

        guideTitle: "Návod",
        guideDesc: "Jak appka funguje, pro koho je a důležité upozornění",
        guideH1: "Co to je?",
        guideP1: "Equity Analyzer je vzdělávací nástroj pro odhad férové ceny na akcii pomocí jednoduchého diskontovaného modelu ve 3 scénářích.",
        guideH2: "Kdy použít který typ?",
        guideP2:
          "<ul>" +
          "<li><strong>Cash-Flow (na akcii):</strong> vhodné pro firmy se stabilním cash flow (většina nefinančních firem).</li>" +
          "<li><strong>Zisk (EPS):</strong> použitelné, když EPS dává smysl a cash flow se těžko odhaduje (pozor na jednorázové položky).</li>" +
          "<li><strong>Dividenda (na akcii):</strong> vhodné pro dividendové akcie (utility, zralé firmy). Pokud je dividenda nestabilní, zvaž jinou metriku.</li>" +
          "</ul>",
        guideH3: "Upozornění (disclaimer)",
        guideP3: "Toto NENÍ finanční doporučení. Je to nástroj pro učení a trénink. Vždy si dělej vlastní analýzu.",

        footer: "Vzdělávací nástroj • Nejedná se o investiční doporučení",

        helps: {
          ticker: { t:"Ticker", b:"Zkratka akcie (např. AAPL). Slouží jen jako název ve watchlistu." },
          currency: { t:"Měna", b:"Použije se pouze pro formátování. Apka nestahuje kurzy." },
          price: { t:"Aktuální cena", b:"Tržní cena na akcii. Podle ní počítáme % rozdíl." },
          mos: { t:"Margin of Safety", b:"Bezpečnostní rezerva. Např. MOS 20% → Target = Base × 0,80." },
          metric: { t:"Základní metrika (na akcii)", b:"Startovní hodnota na akcii (TTM nebo poslední FY). Např. FCF/akcii, EPS, dividenda/akcii." },
          years: { t:"Délka projekce", b:"Počet let růstu před terminální hodnotou. Typicky 5–10." },
          disc: { t:"Diskont", b:"Požadovaný výnos. Vyšší diskont → nižší férová cena. Typicky 8–12%." },
          term: { t:"Terminální růst", b:"Dlouhodobý růst po projekci. Musí být nižší než diskont." },
          bear: { t:"Bear růst", b:"Konzervativní roční růst metriky." },
          base: { t:"Base růst", b:"Realistický roční růst metriky." },
          bull: { t:"Bull růst", b:"Optimistický roční růst metriky." },
          numbertip: { t:"Zadávání čísel", b:"Můžeš psát 2,5 nebo 2.5. Umí i 10k, 3.2m, 1b." },
          target: { t:"Target price", b:"Cílová cena z Base scénáře se zapnutým MOS." },
          range: { t:"Rozpětí férové ceny", b:"Rozmezí Bear → Bull jako rychlý přehled." }
        }
      }
    };

    /* =========================
       HELP MODAL + TOAST
       ========================= */
    function toast(msg){
      const t = $("toast");
      t.textContent = msg;
      t.style.display = "block";
      clearTimeout(toast._tm);
      toast._tm = setTimeout(()=> t.style.display="none", 2400);
    }

    function openModal(title, body){
      $("modalTitle").textContent = title;
      $("modalBody").innerHTML = body;
      $("modalBackdrop").style.display = "flex";
    }
    function closeModal(){
      $("modalBackdrop").style.display = "none";
    }

    $("modalClose").addEventListener("click", closeModal);
    $("modalBackdrop").addEventListener("click", (e)=>{
      if(e.target === $("modalBackdrop")) closeModal();
    });

    /* =========================
       NUMBER PARSING
       - supports spaces, comma decimals, k/m/b suffix
       ========================= */
    function parseNum(v){
      if(v === null || v === undefined) return NaN;
      let s = String(v).trim();
      if(!s) return NaN;

      // remove spaces
      s = s.replace(/\s+/g, "");

      // comma decimal -> dot
      s = s.replace(",", ".");

      // suffix
      const last = s.slice(-1).toLowerCase();
      let mult = 1;
      if(last === "k"){ mult = 1e3; s = s.slice(0,-1); }
      if(last === "m"){ mult = 1e6; s = s.slice(0,-1); }
      if(last === "b"){ mult = 1e9; s = s.slice(0,-1); }

      const n = Number(s);
      if(!Number.isFinite(n)) return NaN;
      return n * mult;
    }

    function fmtMoney(n, cur){
      if(!Number.isFinite(n)) return "—";
      try{
        return new Intl.NumberFormat(state.lang === "cz" ? "cs-CZ" : "en-US", {
          style: "currency",
          currency: cur,
          maximumFractionDigits: 2
        }).format(n);
      }catch{
        return `${n.toFixed(2)} ${cur}`;
      }
    }

    function fmtPct(n){
      if(!Number.isFinite(n)) return "";
      const sign = n > 0 ? "+" : "";
      return `${sign}${n.toFixed(1)}%`;
    }

    function todayStr(){
      const d = new Date();
      const pad = (x)=> String(x).padStart(2,"0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    }

    /* =========================
       ACCORDION (fixes “won’t open”)
       ========================= */
    function bindAccordion(){
      document.querySelectorAll(".acc .head").forEach(head=>{
        head.addEventListener("click", ()=>{
          const acc = head.closest(".acc");
          acc.classList.toggle("open");
          const body = acc.querySelector(".body");
          const inner = body.querySelector(".inner");
          if(acc.classList.contains("open")){
            body.style.maxHeight = (inner.scrollHeight + 24) + "px";
          }else{
            body.style.maxHeight = "0px";
          }
        });
      });

      // ensure open ones have height
      document.querySelectorAll(".acc.open").forEach(acc=>{
        const body = acc.querySelector(".body");
        const inner = body.querySelector(".inner");
        body.style.maxHeight = (inner.scrollHeight + 24) + "px";
      });
    }

    /* =========================
       TYPE SWITCH (3 calculation types)
       ========================= */
    function setType(t){
      state.type = t;
      document.querySelectorAll(".typeBtn").forEach(b=>{
        b.classList.toggle("active", b.getAttribute("data-type") === t);
      });

      // adjust label text lightly based on type
      const T = TEXTS[state.lang];
      if(t === "cash"){
        $("ui_metricLbl").textContent = state.lang === "cz" ? "Základní metrika (FCF na akcii)" : "Base metric (FCF per share)";
      } else if(t === "earn"){
        $("ui_metricLbl").textContent = state.lang === "cz" ? "Základní metrika (EPS)" : "Base metric (EPS)";
      } else {
        $("ui_metricLbl").textContent = state.lang === "cz" ? "Základní metrika (dividenda na akcii)" : "Base metric (Dividend per share)";
      }
      // keep metric mini as-is (still correct)
    }

    function bindTypeButtons(){
      document.querySelectorAll(".typeBtn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          setType(btn.getAttribute("data-type"));
        });
      });
    }

    /* =========================
       LANGUAGE APPLY (fixes “doesn’t translate”)
       ========================= */
    function applyLang(){
      const T = TEXTS[state.lang];

      $("ui_appTitle").textContent = T.appTitle;
      $("ui_appSub").textContent   = T.appSub;
      $("ui_langLbl").textContent  = T.langLbl;

      $("ui_calcTitle").textContent = T.calcTitle;
      $("ui_calcDesc").textContent  = T.calcDesc;

      $("ui_inputsTitle").textContent = T.inputsTitle;
      $("ui_inputsText").textContent  = T.inputsText;

      $("ui_tickerLbl").textContent = T.tickerLbl;
      $("ui_tickerMini").textContent = T.tickerMini;
      $("ui_currencyLbl").textContent = T.currencyLbl;
      $("ui_currencyMini").textContent = T.currencyMini;
      $("ui_priceLbl").textContent = T.priceLbl;
      $("ui_priceMini").textContent = T.priceMini;
      $("ui_mosLbl").textContent = T.mosLbl;
      $("ui_mosMini").textContent = T.mosMini;

      $("ui_modelTitle").textContent = T.modelTitle;
      $("ui_modelText").textContent  = T.modelText;
      $("ui_typeCash").textContent = T.typeCash;
      $("ui_typeEarn").textContent = T.typeEarn;
      $("ui_typeDiv").textContent  = T.typeDiv;

      // metric label depends on type
      setType(state.type);
      $("ui_metricMini").textContent = T.metricMini;

      $("ui_yearsLbl").textContent = T.yearsLbl;
      $("ui_yearsMini").textContent = T.yearsMini;
      $("ui_discLbl").textContent = T.discLbl;
      $("ui_discMini").textContent = T.discMini;
      $("ui_termLbl").textContent = T.termLbl;
      $("ui_termMini").textContent = T.termMini;

      $("ui_scenTitle").textContent = T.scenTitle;
      $("ui_scenText").textContent  = T.scenText;
      $("ui_bearLbl").textContent = T.bearLbl;
      $("ui_bearMini").textContent = T.bearMini;
      $("ui_baseLbl").textContent = T.baseLbl;
      $("ui_baseMini").textContent = T.baseMini;
      $("ui_bullLbl").textContent = T.bullLbl;
      $("ui_bullMini").textContent = T.bullMini;
      $("ui_noteLbl").textContent = T.noteLbl;
      $("ui_noteMini").textContent = T.noteMini;

      $("btn_calc").textContent = T.btnCalc;
      $("btn_save").textContent = T.btnSave;
      $("btn_reset").textContent = T.btnReset;
      $("ui_saveNote").textContent = T.saveNote;

      $("ui_resultsTitle").textContent = T.resultsTitle;
      $("ui_resultsText").textContent = T.resultsText;

      $("ui_targetsTitle").textContent = T.targetsTitle;
      $("ui_targetsText").textContent  = T.targetsText;
      $("ui_targetLbl").textContent = T.targetLbl;
      $("ui_targetMini").textContent = T.targetMini;
      $("ui_rangeLbl").textContent = T.rangeLbl;
      $("ui_rangeMini").textContent = T.rangeMini;

      $("ui_sanityTitle").textContent = T.sanityTitle;
      $("ui_sanityText").textContent  = T.sanityText;

      $("ui_watchTitle").textContent = T.watchTitle;
      $("ui_watchDesc").textContent  = T.watchDesc;
      $("ui_watchIntroTitle").textContent = T.watchIntroTitle;
      $("ui_watchIntroText").textContent  = T.watchIntroText;
      $("ui_watchFooter").textContent     = T.watchFooter;
      $("watchEmpty").textContent         = T.watchEmpty;
      $("btn_export_csv").textContent     = T.exportCsv;
      $("btn_clear_all").textContent      = T.clearAll;

      $("th_date").textContent = T.th.date;
      $("th_ticker").textContent = T.th.ticker;
      $("th_type").textContent = T.th.type;
      $("th_price").textContent = T.th.price;
      $("th_bear").textContent = T.th.bear;
      $("th_base").textContent = T.th.base;
      $("th_bull").textContent = T.th.bull;
      $("th_target").textContent = T.th.target;
      $("th_range").textContent = T.th.range;
      $("th_action").textContent = T.th.action;

      $("ui_guideTitle").textContent = T.guideTitle;
      $("ui_guideDesc").textContent = T.guideDesc;

$("ui_guideH1").textContent = T.guideH1;
$("ui_guideP1").textContent = T.guideP1;

$("ui_guideH2").textContent = T.guideH2;
$("ui_guideP2").innerHTML  = T.guideP2;

$("ui_guideH3").textContent = T.guideH3;
$("ui_guideP3").textContent = T.guideP3;

$("ui_footer").textContent = T.footer;
}

/* =========================
   LANGUAGE SWITCH WIRING
   ========================= */
(function bindLang(){
  const sel = $("sel_lang");
  const btn = $("btn_lang");

  if (sel){
    sel.addEventListener("change", ()=>{
      state.lang = sel.value;
      applyLang();
    });
  }

  if (btn){
    btn.addEventListener("click", ()=>{
      state.lang = (state.lang === "en") ? "cz" : "en";
      if (sel) sel.value = state.lang;
      applyLang();
    });
  }
})();

/* =========================
   INIT (texts only here)
   ========================= */
applyLang();


  




    

    


    


  














  
  

    
        




          

        

          





  

  

  


  


    


      

  

    

          
    

    

    
    


    





    

    

  
        

    
    

  

  





