<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Equity Analyzer</title>

  <style>
    :root{
      --bg:#0b0e1f;
      --bg2:#0f1330;
      --card:#121845;
      --card2:#161f55;
      --stroke:rgba(255,255,255,.10);

      --text:#eef0ff;
      --muted:rgba(238,240,255,.72);

      --purple:#8b5cf6;
      --purple2:#a78bfa;
      --blue:#3b82f6;
      --cyan:#22d3ee;

      --bear:#60a5fa;   /* modrá */
      --base:#a78bfa;   /* fialová */
      --bull:#34d399;   /* zelená */

      --danger:#fb7185;
      --ok:#34d399;

      --radius:18px;
      --radius2:14px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 600px at 20% 10%, rgba(139,92,246,.25), transparent 60%),
                  radial-gradient(900px 500px at 80% 20%, rgba(59,130,246,.20), transparent 55%),
                  linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--text);
    }

    .app{
      max-width: 1120px;
      margin: 0 auto;
      padding: 18px 14px 40px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
      padding:14px 14px;
      border:1px solid var(--stroke);
      background: rgba(18,24,69,.55);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width: 180px;
    }
    .brand .title{
      font-weight:800;
      letter-spacing:.2px;
      font-size:18px;
      line-height:1.1;
      background: linear-gradient(90deg, var(--purple2), var(--blue), var(--cyan));
      -webkit-background-clip:text;
      -webkit-text-fill-color: transparent;
    }
    .brand .sub{
      font-size:12px;
      color:var(--muted);
    }

    .top-controls{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
      flex-wrap:wrap;
    }

    .seg{
      display:flex;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      border-radius: 999px;
      padding:4px;
      gap:4px;
    }
    .seg button{
      appearance:none;
      border:0;
      cursor:pointer;
      padding:8px 10px;
      border-radius: 999px;
      font-weight:700;
      font-size:12px;
      color:var(--muted);
      background: transparent;
    }
    .seg button.active{
      color: var(--text);
      background: linear-gradient(90deg, rgba(167,139,250,.35), rgba(59,130,246,.25));
    }

    .drawers{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:12px;
      margin-top:12px;
    }
    @media (max-width: 900px){
      .drawers{grid-template-columns: 1fr;}
      .brand{min-width:auto}
    }

    .drawer{
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:14px;
      background: linear-gradient(180deg, rgba(18,24,69,.75), rgba(15,19,48,.65));
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      cursor:pointer;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      min-height: 92px;
    }
    .drawer:hover{
      transform: translateY(-2px);
      border-color: rgba(167,139,250,.35);
      background: linear-gradient(180deg, rgba(22,31,85,.75), rgba(15,19,48,.65));
    }

    .drawer .left{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .drawer .name{
      font-weight:800;
      font-size:16px;
    }
    .drawer .desc{
      font-size:12px;
      color:var(--muted);
    }
    .pill{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      font-size:12px;
      font-weight:800;
      color:var(--text);
      white-space:nowrap;
    }

    .screen{
      display:none;
      margin-top:14px;
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(18,24,69,.75), rgba(15,19,48,.70));
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .screen.active{display:block}

    .screen-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px 14px;
      border-bottom:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
    }
    .screen-head h2{
      margin:0;
      font-size:16px;
      font-weight:900;
    }
    .backBtn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color: var(--text);
      padding:8px 10px;
      border-radius: 12px;
      font-weight:800;
      cursor:pointer;
    }
    .backBtn:hover{border-color: rgba(167,139,250,.35)}

    .screen-body{
      padding: 14px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns: 1fr;}
    }

    .card{
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: rgba(255,255,255,.03);
      padding:14px;
    }

    .card h3{
      margin:0 0 10px 0;
      font-size:14px;
      font-weight:900;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 160px;
      gap:10px;
      align-items:center;
      margin-bottom:10px;
    }
    @media (max-width: 520px){
      .row{grid-template-columns: 1fr;}
    }

    label{
      font-size:12px;
      font-weight:800;
      color: var(--text);
      display:flex;
      align-items:center;
      gap:8px;
    }

    .hintBtn{
      width:18px;height:18px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color:var(--text);
      font-weight:900;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      flex: 0 0 auto;
    }

    input, select{
      width:100%;
      padding:10px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      color: var(--text);
      font-weight:800;
      outline:none;
    }
    input:focus, select:focus{
      border-color: rgba(167,139,250,.45);
      box-shadow: 0 0 0 3px rgba(167,139,250,.12);
    }

    .btn{
      border:0;
      cursor:pointer;
      padding:10px 12px;
      border-radius: 14px;
      font-weight:900;
      color:#061022;
      background: linear-gradient(90deg, var(--purple2), var(--blue));
    }
    .btn:hover{filter: brightness(1.05)}
    .btn.secondary{
      background: rgba(255,255,255,.07);
      color: var(--text);
      border:1px solid var(--stroke);
    }
    .btn.danger{
      background: rgba(251,113,133,.18);
      color: #ffdbe3;
      border:1px solid rgba(251,113,133,.35);
    }

    .note{
      font-size:12px;
      color: var(--muted);
      margin-top:8px;
      line-height:1.45;
    }

    .results{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 900px){
      .results{grid-template-columns: 1fr;}
    }

    .rbox{
      border:1px solid var(--stroke);
      border-radius: var(--radius2);
      background: rgba(255,255,255,.03);
      padding:12px;
    }
    .rbox .tag{
      font-size:12px;
      font-weight:1000;
      letter-spacing:.2px;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .tag .chip{
      padding:5px 9px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      font-weight:900;
      font-size:11px;
      color: var(--text);
    }
    .rbox .price{
      font-size:26px;
      font-weight:1000;
      letter-spacing:-.3px;
    }
    .rbox .subline{
      margin-top:6px;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }

    .bear{border-color: rgba(96,165,250,.35)}
    .base{border-color: rgba(167,139,250,.40)}
    .bull{border-color: rgba(52,211,153,.35)}

    .bear .tag{color: var(--bear)}
    .base .tag{color: var(--base)}
    .bull .tag{color: var(--bull)}

    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:flex-end;
      justify-content:center;
      background: rgba(0,0,0,.55);
      padding: 18px 12px;
      z-index: 99;
    }
    .modal.open{display:flex}
    .modalCard{
      width:min(820px, 100%);
      border-radius: var(--radius);
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(18,24,69,.95), rgba(15,19,48,.95));
      box-shadow: 0 18px 70px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modalHead{
      padding:12px 14px;
      border-bottom:1px solid var(--stroke);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .modalHead b{font-size:13px}
    .closeX{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--text);
      border-radius: 12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:900;
    }
    .modalBody{
      padding:14px;
      color: var(--muted);
      font-size:13px;
      line-height:1.55;
    }

    table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: var(--radius);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.02);
    }
    th,td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.06);
      font-size:12px;
      text-align:left;
      color: var(--text);
      vertical-align: top;
    }
    th{color: var(--muted); font-weight:900}
    tr:last-child td{border-bottom:0}

    .rowBtns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
  </style>
</head>

<body>
  <div class="app">

    <header>
      <div class="brand">
        <div class="title">Equity Analyzer</div>
        <div class="sub" id="topSubtitle">DCF výpočet • Watchlist • Popis aplikace</div>
      </div>

      <div class="top-controls">
        <div class="seg" aria-label="language">
          <button id="langCS" class="active" type="button">CZ</button>
          <button id="langEN" type="button">EN</button>
        </div>
      </div>
    </header>

    <div class="drawers" id="drawers">
      <div class="drawer" data-screen="dcf">
        <div class="left">
          <div class="name" id="d1Title">DCF Model</div>
          <div class="desc" id="d1Desc">Výpočet férové hodnoty a 3 scénáře</div>
        </div>
        <div class="pill" id="d1Pill">Open</div>
      </div>

      <div class="drawer" data-screen="watch">
        <div class="left">
          <div class="name" id="d2Title">Watchlist</div>
          <div class="desc" id="d2Desc">Uložené výpočty + mazání položek</div>
        </div>
        <div class="pill" id="d2Pill">Open</div>
      </div>

      <div class="drawer" data-screen="about">
        <div class="left">
          <div class="name" id="d3Title">O aplikaci</div>
          <div class="desc" id="d3Desc">Pro koho je a jak funguje</div>
        </div>
        <div class="pill" id="d3Pill">Open</div>
      </div>
    </div>

    <!-- SCREENS -->
    <section class="screen" id="screen-dcf" aria-hidden="true">
      <div class="screen-head">
        <h2 id="s1Title">DCF Model</h2>
        <button class="backBtn" type="button" data-back="1" id="back1">Zpět</button>
      </div>
      <div class="screen-body"><div class="grid">
          <div class="card">
            <h3 id="dcfInputTitle">Vstupy</h3>

            <div class="row">
              <label>
                <span id="lblTicker">Ticker</span>
                <button class="hintBtn" type="button" data-hint="ticker">i</button>
              </label>
              <input id="inpTicker" placeholder="např. AAPL" inputmode="text" />
            </div>

            <div class="row">
              <label>
                <span id="lblPrice">Aktuální cena</span>
                <button class="hintBtn" type="button" data-hint="price">i</button>
              </label>
              <input id="inpPrice" placeholder="např. 190.5" inputmode="decimal" />
            </div>

            <div class="row">
              <label>
                <span id="lblCurrency">Měna</span>
                <button class="hintBtn" type="button" data-hint="currency">i</button>
              </label>
              <select id="inpCurrency">
                <option value="USD">USD ($)</option>
                <option value="EUR">EUR (€)</option>
              </select>
            </div>

            <div class="row">
              <label>
                <span id="lblFCF">Free Cash Flow (TTM)</span>
                <button class="hintBtn" type="button" data-hint="fcf">i</button>
              </label>
              <input id="inpFCF" placeholder="např. 110000000000" inputmode="decimal" />
            </div>

            <div class="row">
              <label>
                <span id="lblShares">Počet akcií (diluted)</span>
                <button class="hintBtn" type="button" data-hint="shares">i</button>
              </label>
              <input id="inpShares" placeholder="např. 15500000000" inputmode="decimal" />
            </div>

            <div class="row">
              <label>
                <span id="lblDisc">Diskontní sazba</span>
                <button class="hintBtn" type="button" data-hint="disc">i</button>
              </label>
              <input id="inpDisc" placeholder="např. 9" inputmode="decimal" />
            </div>

            <div class="card" style="margin-top:12px;">
              <h3 id="dcfScenTitle">Scénáře růstu (FCF)</h3>

              <div class="row">
                <label><span id="lblBear">Bear growth (%)</span> <button class="hintBtn" type="button" data-hint="bear">i</button></label>
                <input id="inpGBear" placeholder="např. 2" inputmode="decimal" />
              </div>

              <div class="row">
                <label><span id="lblBase">Base growth (%)</span> <button class="hintBtn" type="button" data-hint="base">i</button></label>
                <input id="inpGBase" placeholder="např. 5" inputmode="decimal" />
              </div>

              <div class="row">
                <label><span id="lblBull">Bull growth (%)</span> <button class="hintBtn" type="button" data-hint="bull">i</button></label>
                <input id="inpGBull" placeholder="např. 8" inputmode="decimal" />
              </div>

              <div class="row">
                <label><span id="lblMoS">Margin of Safety</span> <button class="hintBtn" type="button" data-hint="mos">i</button></label>
                <select id="inpMoS">
                  <option value="0">OFF</option>
                  <option value="0.2">20% pod BASE</option>
                </select>
              </div>

              <div class="rowBtns">
                <button class="btn" type="button" id="btnCalc">Spočítat</button>
                <button class="btn secondary" type="button" id="btnReset">Reset</button>
              </div>

              <div class="note" id="dcfNote">
                Tip: Můžeš psát čísla i s mezerami, čárkou nebo tečkou (např. 1 234,56).
              </div>
            </div>
          </div>

          <div class="card">
            <h3 id="dcfOutTitle">Výstupy</h3>

            <div class="results" id="results" style="display:none;">
              <div class="rbox bear">
                <div class="tag"><span>BEAR</span><span class="chip" id="chipBear">-</span></div>
                <div class="price" id="outBear">—</div>
                <div class="subline" id="subBear">—</div>
              </div>

              <div class="rbox base">
                <div class="tag"><span>BASE</span><span class="chip" id="chipBase">-</span></div>
                <div class="price" id="outBase">—</div>
                <div class="subline" id="subBase">—</div>
              </div>

              <div class="rbox bull">
                <div class="tag"><span>BULL</span><span class="chip" id="chipBull">-</span></div>
                <div class="price" id="outBull">—</div>
                <div class="subline" id="subBull">—</div>
              </div>
            </div>

            <div class="card" id="targetCard" style="margin-top:12px; display:none;">
              <h3 id="targetTitle">Cílová cena</h3>
              <div class="price" id="outTarget">—</div>
              <div class="note" id="targetNote">Margin of Safety je odvozený z BASE.</div>
            </div>

            <div class="rowBtns" style="margin-top:12px;">
              <button class="btn" type="button" id="btnSave" disabled>Uložit do Watchlistu</button>
            </div>

            <div class="note" id="saveNote">
              Watchlist ukládá: ticker, datum, měnu + Bear/Base/Bull a případně Target.
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="screen" id="screen-watch" aria-hidden="true">
      <div class="screen-head">
        <h2 id="s2Title">Watchlist</h2>
        <button class="backBtn" type="button" data-back="2" id="back2">Zpět</button>
      </div>
      <div class="screen-body">
        <div class="card">
          <h3 id="wlTitle">Uložené výpočty</h3>

          <div class="rowBtns" style="margin-bottom:10px;">
            <button class="btn secondary" type="button" id="btnExportCSV">Export CSV</button>
            <button class="btn secondary" type="button" id="btnPrint">Tisk / PDF</button>
          </div>

          <div id="wlEmpty" class="note">Zatím nic uloženého.</div>

          <div style="overflow:auto;">
            <table id="wlTable" style="display:none;">
              <thead>
                <tr>
                  <th id="thDate">Datum</th>
                  <th id="thTicker">Ticker</th>
                  <th id="thCur">Měna</th>
                  <th id="thPrice">Cena</th>
                  <th id="thBear">Bear</th>
                  <th id="thBase">Base</th>
                  <th id="thBull">Bull</th>
                  <th id="thTarget">Target</th>
                  <th id="thAct">Akce</th>
                </tr>
              </thead>
              <tbody id="wlBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <section class="screen" id="screen-about" aria-hidden="true">
      <div class="screen-head">
        <h2 id="s3Title">O aplikaci</h2>
        <button class="backBtn" type="button" data-back="3" id="back3">Zpět</button>
      </div>
      <div class="screen-body">
        <div class="card" id="aboutCard">
          <!-- Text doplníme v dílu 6 -->
          <div class="note" id="aboutPlaceholder">Text se načte…</div>
        </div>
      </div>
    </section>

    <!-- HINT MODAL -->
    <div class="modal" id="hintModal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modalCard">
        <div class="modalHead">
          <b id="hintTitle">Vysvětlivka</b>
          <button class="closeX" type="button" id="hintClose">Zavřít</button>
        </div>
        <div class="modalBody" id="hintBody"></div>
      </div>
    </div><script>
      // ====== STATE ======
      const LS_KEY = "ea_watchlist_v1";
      let LANG = "cs";

      // ====== UI NAV ======
      const drawers = document.querySelectorAll(".drawer");
      const screens = {
        dcf: document.getElementById("screen-dcf"),
        watch: document.getElementById("screen-watch"),
        about: document.getElementById("screen-about"),
      };

      function showHome(){
        Object.values(screens).forEach(s => { s.classList.remove("active"); s.setAttribute("aria-hidden","true"); });
        document.getElementById("drawers").style.display = "grid";
        window.scrollTo({top:0, behavior:"smooth"});
      }

      function openScreen(key){
        document.getElementById("drawers").style.display = "none";
        Object.values(screens).forEach(s => { s.classList.remove("active"); s.setAttribute("aria-hidden","true"); });
        screens[key].classList.add("active");
        screens[key].setAttribute("aria-hidden","false");
        window.scrollTo({top:0, behavior:"smooth"});
      }

      drawers.forEach(d => d.addEventListener("click", () => openScreen(d.dataset.screen)));
      document.querySelectorAll(".backBtn").forEach(b => b.addEventListener("click", showHome));

      // ====== PARSE NUMBERS ======
      function parseNumber(v){
        if (v === null || v === undefined) return NaN;
        let s = String(v).trim();
        if (!s) return NaN;
        // allow spaces, commas, dots
        s = s.replace(/\s+/g,"");
        // if both comma and dot exist -> assume comma thousands, dot decimal
        // else if only comma -> treat as decimal
        if (s.includes(",") && !s.includes(".")) s = s.replace(",", ".");
        // remove any non-number (except . and -)
        s = s.replace(/[^0-9.\-]/g,"");
        return Number(s);
      }

      function fmtMoney(x, cur){
        if (!isFinite(x)) return "—";
        const sym = cur === "EUR" ? "€" : "$";
        return sym + " " + x.toFixed(2);
      }

      function fmtPct(x){
        if (!isFinite(x)) return "—";
        const sign = x > 0 ? "+" : "";
        return sign + x.toFixed(1) + "%";
      }

      function nowISO(){
        const d = new Date();
        const pad = n => String(n).padStart(2,"0");
        return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
      }
    </script><script>
      // ====== DCF LOGIC ======
      const el = id => document.getElementById(id);

      const btnCalc = el("btnCalc");
      const btnReset = el("btnReset");
      const btnSave = el("btnSave");

      function dcfPerShare(fcf, g, r, shares){
        // super jednoduchý model (perpetuity) – stabilní, rychlý, nezávislý
        // fair value = FCF*(1+g) / r  / shares
        const pv = (fcf * (1 + g/100)) / (r/100);
        return pv / shares;
      }

      function valuationLine(fair, price){
        if (!isFinite(fair) || !isFinite(price) || price <= 0) return "—";
        const diff = (fair/price - 1) * 100;
        if (diff >= 0) return `${fmtPct(diff)} (podhodnocené)`;
        return `${fmtPct(diff)} (nadhodnocené)`;
      }

      function setResultUI(cur, price, bear, base, bull, target){
        el("results").style.display = "grid";
        el("outBear").textContent = fmtMoney(bear, cur);
        el("outBase").textContent = fmtMoney(base, cur);
        el("outBull").textContent = fmtMoney(bull, cur);

        el("subBear").textContent = valuationLine(bear, price);
        el("subBase").textContent = valuationLine(base, price);
        el("subBull").textContent = valuationLine(bull, price);

        el("chipBear").textContent = "Fair";
        el("chipBase").textContent = "Fair";
        el("chipBull").textContent = "Fair";

        if (isFinite(target)){
          el("targetCard").style.display = "block";
          el("outTarget").textContent = fmtMoney(target, cur);
        } else {
          el("targetCard").style.display = "none";
        }

        btnSave.disabled = false;
      }

      function clearDCF(){
        ["inpTicker","inpPrice","inpFCF","inpShares","inpDisc","inpGBear","inpGBase","inpGBull"].forEach(id => el(id).value = "");
        el("inpCurrency").value = "USD";
        el("inpMoS").value = "0";
        el("results").style.display = "none";
        el("targetCard").style.display = "none";
        btnSave.disabled = true;
      }

      btnReset.addEventListener("click", clearDCF);

      btnCalc.addEventListener("click", () => {
        const ticker = (el("inpTicker").value || "").trim().toUpperCase();
        const cur = el("inpCurrency").value;

        const price = parseNumber(el("inpPrice").value);
        const fcf = parseNumber(el("inpFCF").value);
        const shares = parseNumber(el("inpShares").value);
        const r = parseNumber(el("inpDisc").value);

        const gBear = parseNumber(el("inpGBear").value);
        const gBase = parseNumber(el("inpGBase").value);
        const gBull = parseNumber(el("inpGBull").value);

        const mos = Number(el("inpMoS").value || "0");

        // guards
        if (!ticker) { alert(LANG==="cs" ? "Vyplň ticker." : "Fill the ticker."); return; }
        if (!isFinite(price) || price <= 0) { alert(LANG==="cs" ? "Zadej aktuální cenu." : "Enter current price."); return; }
        if (!isFinite(fcf) || fcf <= 0) { alert(LANG==="cs" ? "Zadej FCF (TTM)." : "Enter FCF (TTM)."); return; }
        if (!isFinite(shares) || shares <= 0) { alert(LANG==="cs" ? "Zadej počet akcií." : "Enter shares count."); return; }
        if (!isFinite(r) || r <= 0) { alert(LANG==="cs" ? "Zadej diskontní sazbu." : "Enter discount rate."); return; }
        if (!isFinite(gBear) || !isFinite(gBase) || !isFinite(gBull)) { alert(LANG==="cs" ? "Zadej růsty Bear/Base/Bull." : "Enter Bear/Base/Bull growth."); return; }
        if (r <= gBull) { alert(LANG==="cs" ? "Diskontní sazba by měla být vyšší než růst (zejména Bull)." : "Discount rate should be above growth (especially Bull)."); return; }

        const bear = dcfPerShare(fcf, gBear, r, shares);
        const base = dcfPerShare(fcf, gBase, r, shares);
        const bull = dcfPerShare(fcf, gBull, r, shares);

        const target = mos > 0 ? base * (1 - mos) : NaN;

        // store latest calc in memory for save
        window.__LAST_CALC__ = { ticker, cur, price, fcf, shares, r, gBear, gBase, gBull, bear, base, bull, target, mos, at: nowISO() };

        setResultUI(cur, price, bear, base, bull, target);
      });

      // ====== WATCHLIST STORAGE ======
      function loadWL(){
        try{
          const raw = localStorage.getItem(LS_KEY);
          const arr = raw ? JSON.parse(raw) : [];
          return Array.isArray(arr) ? arr : [];
        }catch(e){ return []; }
      }

      function saveWL(arr){
        localStorage.setItem(LS_KEY, JSON.stringify(arr));
      }

      btnSave.addEventListener("click", () => {
        const x = window.__LAST_CALC__;
        if (!x) return;

        const wl = loadWL();
        wl.unshift({
          id: crypto?.randomUUID ? crypto.randomUUID() : String(Date.now()) + "_" + Math.random().toString(16).slice(2),
          ...x
        });
        saveWL(wl);
        renderWatchlist();          // defined in Díl 5
        openScreen("watch");
      });
                               </script><script>
      // ====== WATCHLIST UI ======
      const wlBody = document.getElementById("wlBody");
      const wlTable = document.getElementById("wlTable");
      const wlEmpty = document.getElementById("wlEmpty");

      function renderWatchlist(){
        const wl = loadWL();
        wlBody.innerHTML = "";

        if (!wl.length){
          wlEmpty.style.display = "block";
          wlTable.style.display = "none";
          return;
        }

        wlEmpty.style.display = "none";
        wlTable.style.display = "table";

        wl.forEach(item => {
          const tr = document.createElement("tr");

          const tdDate = document.createElement("td"); tdDate.textContent = item.at || "";
          const tdTicker = document.createElement("td"); tdTicker.textContent = item.ticker || "";
          const tdCur = document.createElement("td"); tdCur.textContent = item.cur || "";
          const tdPrice = document.createElement("td"); tdPrice.textContent = fmtMoney(Number(item.price), item.cur);

          const tdBear = document.createElement("td"); tdBear.textContent = fmtMoney(Number(item.bear), item.cur);
          const tdBase = document.createElement("td"); tdBase.textContent = fmtMoney(Number(item.base), item.cur);
          const tdBull = document.createElement("td"); tdBull.textContent = fmtMoney(Number(item.bull), item.cur);
          const tdTarget = document.createElement("td"); tdTarget.textContent = isFinite(Number(item.target)) ? fmtMoney(Number(item.target), item.cur) : "—";

          const tdAct = document.createElement("td");
          const del = document.createElement("button");
          del.className = "btn danger";
          del.type = "button";
          del.textContent = (LANG==="cs") ? "Smazat" : "Delete";
          del.addEventListener("click", () => {
            const wl2 = loadWL().filter(x => x.id !== item.id);
            saveWL(wl2);
            renderWatchlist();
          });
          tdAct.appendChild(del);

          [tdDate, tdTicker, tdCur, tdPrice, tdBear, tdBase, tdBull, tdTarget, tdAct].forEach(td => tr.appendChild(td));
          wlBody.appendChild(tr);
        });
      }

      document.getElementById("btnExportCSV").addEventListener("click", () => {
        const wl = loadWL();
        if (!wl.length){ alert(LANG==="cs" ? "Watchlist je prázdný." : "Watchlist is empty."); return; }

        const header = ["date","ticker","currency","price","bear","base","bull","target"];
        const rows = wl.map(x => [
          x.at || "",
          x.ticker || "",
          x.cur || "",
          Number(x.price ?? "").toString(),
          Number(x.bear ?? "").toString(),
          Number(x.base ?? "").toString(),
          Number(x.bull ?? "").toString(),
          isFinite(Number(x.target)) ? Number(x.target).toString() : ""
        ]);

        const csv = [header, ...rows]
          .map(r => r.map(v => `"${String(v).replace(/"/g,'""')}"`).join(","))
          .join("\n");

        const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "watchlist.csv";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      });

      document.getElementById("btnPrint").addEventListener("click", () => {
        // browser print dialog -> user can Save as PDF
        window.print();
      });

      // init render on load
      renderWatchlist();
                               </script><script>
      // ====== HINTS + ABOUT + I18N ======
      const modal = document.getElementById("hintModal");
      const hintTitle = document.getElementById("hintTitle");
      const hintBody = document.getElementById("hintBody");
      const hintClose = document.getElementById("hintClose");

      const TEXT = {
        cs: {
          topSubtitle: "DCF výpočet • Watchlist • Popis aplikace",
          d1Desc: "Výpočet férové hodnoty a 3 scénáře",
          d2Desc: "Uložené výpočty + mazání položek",
          d3Title: "O aplikaci",
          d3Desc: "Pro koho je a jak funguje",
          open: "Open",
          back: "Zpět",
          about: `
            <h3>Pro koho je tato aplikace</h3>
            <p>
              Tato aplikace je pro investory, kteří si chtějí <b>sami</b> spočítat férovou hodnotu akcie
              a rozumět tomu, <b>z čeho výsledek vychází</b>.
            </p>

            <h3>Co aplikace dělá</h3>
            <ul>
              <li>Vypočítá orientační férovou cenu akcie (DCF – zjednodušený perpetuity model).</li>
              <li>Zobrazí <b>3 scénáře</b>: Bear / Base / Bull.</li>
              <li>Volitelně spočítá <b>Target</b> jako 20% Margin of Safety pod BASE.</li>
              <li>Umožní uložit výpočet do Watchlistu a jednotlivé položky mazat.</li>
            </ul>

            <h3>Proč to není „AI tip“</h3>
            <p>
              Cílem není dostat „radu“, ale mít <b>transparentní výpočet</b>, který si umíš zkontrolovat.
              Je to i <b>vzdělávací nástroj</b> – učíš se pracovat s klíčovými vstupy (FCF, diskont, růst, počet akcií).
            </p>

            <p class="note">
              Pozn.: Výpočet je zjednodušený a slouží jako rychlá orientace. Pro detailní valuaci je vhodné doplnit víceleté projekce,
              terminal value, netto dluh a další úpravy.
            </p>
          `,
          hints: {
            ticker: "Ticker je burzovní zkratka firmy (např. AAPL, MSFT).",
            price: "Aktuální tržní cena akcie. Slouží pro výpočet % nadhodnocení/podhodnocení.",
            currency: "Měna, ve které počítáš. Jen formátování výsledků (USD/EUR).",
            fcf: "Free Cash Flow (TTM) – volný cash flow za posledních 12 měsíců. Základ výpočtu.",
            shares: "Počet akcií (diluted). Dělíme jím celkovou hodnotu na 1 akcii.",
            disc: "Diskontní sazba (např. 9 %) – požadovaná výnosnost / rizikovost.",
            bear: "Pesimistický růst FCF (%).",
            base: "Realistický růst FCF (%).",
            bull: "Optimistický růst FCF (%).",
            mos: "Margin of Safety: pokud je ON, Target = BASE * (1 - 0.20)."
          }
        },

        en: {
          topSubtitle: "DCF calculator • Watchlist • About",
          d1Desc: "Fair value estimate with 3 scenarios",
          d2Desc: "Saved calculations + delete items",
          d3Title: "About",
          d3Desc: "Who it’s for and how it works",
          open: "Open",
          back: "Back",
          about: `
            <h3>Who this app is for</h3>
            <p>
              This app is for investors who want to calculate a stock’s <b>fair value on their own</b>
              and understand <b>what drives the result</b>.
            </p>

            <h3>What it does</h3>
            <ul>
              <li>Estimates fair value per share using a simplified DCF (perpetuity model).</li>
              <li>Shows <b>3 scenarios</b>: Bear / Base / Bull.</li>
              <li>Optionally calculates a <b>Target</b> as a 20% margin of safety below BASE.</li>
              <li>Saves results to a Watchlist, where items can be deleted one by one.</li>
            </ul>

            <h3>Why this isn’t an “AI pick”</h3>
            <p>
              The goal is not a “tip”, but a <b>transparent calculation</b> you can verify.
              It also works as a <b>learning tool</b>—you practice key inputs (FCF, discount rate, growth, shares).
            </p>

            <p class="note">
              Note: This is a simplified model for quick orientation. A full valuation typically includes multi-year projections,
              terminal value details, net debt adjustments, and more.
            </p>
          `,
          hints: {
            ticker: "Ticker is the stock symbol (e.g., AAPL, MSFT).",
            price: "Current market price. Used to compute % under/overvaluation.",
            currency: "Currency for displaying results (USD/EUR).",
            fcf: "Free Cash Flow (TTM) – trailing 12 months. Core input.",
            shares: "Diluted shares outstanding. Used to convert total value to per-share value.",
            disc: "Discount rate (e.g., 9%) – required return / risk.",
            bear: "Pessimistic FCF growth (%).",
            base: "Base-case FCF growth (%).",
            bull: "Optimistic FCF growth (%).",
            mos: "Margin of Safety: when ON, Target = BASE * (1 - 0.20)."
          }
        }
      };

      function applyLang(){
        const t = TEXT[LANG];

        document.documentElement.lang = LANG === "cs" ? "cs" : "en";
        document.getElementById("topSubtitle").textContent = t.topSubtitle;

        document.getElementById("d1Desc").textContent = t.d1Desc;
        document.getElementById("d2Desc").textContent = t.d2Desc;

        document.getElementById("d3Title").textContent = t.d3Title;
        document.getElementById("d3Desc").textContent = t.d3Desc;

        document.getElementById("back1").textContent = t.back;
        document.getElementById("back2").textContent = t.back;
        document.getElementById("back3").textContent = t.back;

        document.getElementById("aboutCard").innerHTML = t.about;

        // buttons in watchlist rows need re-render to update label
        renderWatchlist();
      }

      // language buttons
      const bCS = document.getElementById("langCS");
      const bEN = document.getElementById("langEN");
      bCS.addEventListener("click", () => {
        LANG = "cs";
        bCS.classList.add("active"); bEN.classList.remove("active");
        applyLang();
      });
      bEN.addEventListener("click", () => {
        LANG = "en";
        bEN.classList.add("active"); bCS.classList.remove("active");
        applyLang();
      });

      // hints
      document.querySelectorAll(".hintBtn").forEach(btn => {
        btn.addEventListener("click", () => {
          const key = btn.dataset.hint;
          const t = TEXT[LANG];
          hintTitle.textContent = (LANG==="cs") ? "Vysvětlivka" : "Explanation";
          hintBody.textContent = t.hints[key] || "—";
          modal.classList.add("open");
          modal.setAttribute("aria-hidden","false");
        });
      });

      function closeModal(){
        modal.classList.remove("open");
        modal.setAttribute("aria-hidden","true");
      }
      hintClose.addEventListener("click", closeModal);
      modal.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });
      document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModal(); });

      // initial
      applyLang();
    </script>

  </div>
</body>
</html>

    


                
    
    


    

    



        



      
    

    
      
  

    



    





  
  


  





        


        



  


 

            

        




          

        

          





  

  

  


  


    


      

  

    

          
    

    

    
    


    





    

    

  
        

    
    

  

  





