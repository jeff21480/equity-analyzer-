<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Equity Analyzer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --bg:#0b1020;
      --panel:#141a33;
      --panel-2:#1b2350;
      --accent:#6c7cff;
      --accent-2:#9b6cff;
      --text:#e9ecff;
      --muted:#a9b0ff;
      --border:rgba(255,255,255,.08);
      --ok:#4cd964;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto;
      background:radial-gradient(1200px 600px at 20% -10%, #1a1f4a, var(--bg));
      color:var(--text);
    }

    .wrap{
      max-width:900px;
      margin:0 auto;
      padding:20px;
    }

    /* HEADER */
    .header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:24px;
    }
    .title{
      font-size:34px;
      font-weight:800;
      letter-spacing:.5px;
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }

    .lang{
      background:var(--panel);
      border:1px solid var(--border);
      color:var(--text);
      padding:8px 12px;
      border-radius:10px;
      font-weight:600;
    }

    /* ACCORDION */
    .acc{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:18px;
      margin-bottom:18px;
      overflow:hidden;
    }

    .acc-head{
      padding:18px 20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      cursor:pointer;
      background:linear-gradient(180deg,var(--panel-2),var(--panel));
    }

    .acc-head h2{
      margin:0;
      font-size:18px;
    }

    .chev{
      font-size:20px;
      opacity:.7;
      transition:.3s;
    }

    .acc.open .chev{transform:rotate(180deg)}

    .acc-body{
      display:none;
      padding:20px;
      border-top:1px solid var(--border);
    }

    .acc.open .acc-body{display:block}

    /* FIELDS */
    .field{
      margin-bottom:16px;
    }

    .lbl{
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:600;
      margin-bottom:6px;
    }

    .hint{
      width:18px;
      height:18px;
      border-radius:50%;
      background:var(--accent);
      color:#fff;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      cursor:pointer;
    }

    input{
      width:100%;
      padding:14px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#0e1430;
      color:var(--text);
      font-size:16px;
    }

    .mini{
      font-size:13px;
      color:var(--muted);
      margin-top:4px;
    }

    /* BUTTONS */
    .btns{
      display:flex;
      gap:12px;
      margin-top:18px;
      flex-wrap:wrap;
    }

    button{
      padding:14px 20px;
      border-radius:14px;
      border:none;
      font-weight:700;
      cursor:pointer;
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      color:#fff;
      font-size:15px;
    }

    button.secondary{
      background:#222a55;
      color:var(--text);
    }

    /* FOOTER */
    .footer{
      margin-top:30px;
      font-size:13px;
      color:var(--muted);
      text-align:center;
    }
  </style>
</head>

<body>
<div class="wrap">

  <!-- HEADER -->
  <div class="header">
    <div class="title" id="ui_title">Equity Analyzer</div>
    <select class="lang" id="sel_lang">
      <option value="en">EN</option>
      <option value="cz">CZ</option>
    </select>
  </div>

  <!-- ACCORDION 1: INPUTS -->
  <div class="acc open" id="acc_inputs">
    <div class="acc-head">
      <h2 id="ui_inputs_title">1) Valuation Inputs</h2>
      <div class="chev">⌄</div>
    </div>
    <div class="acc-body">

      <div class="field">
        <div class="lbl">
          <span id="ui_ticker_lbl">Ticker / Company</span>
          <span class="hint">i</span>
        </div>
        <input id="in_ticker" placeholder="e.g. AAPL" />
        <div class="mini" id="ui_ticker_help">
          Company name or stock ticker.
        </div>
      </div>

      <div class="field">
        <div class="lbl">
          <span id="ui_price_lbl">Current Share Price</span>
          <span class="hint">i</span>
        </div>
        <input id="in_price" placeholder="e.g. 180" inputmode="decimal"/>
        <div class="mini" id="ui_price_help">
          Market price of one share.
        </div>
      </div>

      <div class="field">
        <div class="lbl">
          <span id="ui_fcf_lbl">Free Cash Flow (total)</span>
          <span class="hint">i</span>
        </div>
        <input id="in_fcf" placeholder="e.g. 70000000000" />
        <div class="mini" id="ui_fcf_help">
          Annual FCF for the whole company.
        </div>
      </div>

      <div class="field">
        <div class="lbl">
          <span id="ui_shares_lbl">Shares Outstanding</span>
          <span class="hint">i</span>
        </div>
        <input id="in_shares" placeholder="e.g. 16000000000" />
        <div class="mini" id="ui_shares_help">
          Total number of shares.
        </div>
      </div>

    </div>
  </div>

  <!-- ACCORDION 2: RESULTS / WATCHLIST -->
  <div class="acc" id="acc_results">
    <div class="acc-head">
      <h2 id="ui_results_title">2) Result & Watchlist</h2>
      <div class="chev">⌄</div>
    </div>
    <div class="acc-body">

      <div class="field">
        <div class="lbl" id="ui_value_lbl">Estimated Fair Value</div>
        <input readonly placeholder="—" />
      </div>

      <div class="btns">
        <button id="btn_calc">Calculate</button>
        <button class="secondary" id="btn_save">Save to Watchlist</button>
      </div>

    </div>
  </div>

  <!-- ACCORDION 3: ABOUT -->
  <div class="acc" id="acc_about">
    <div class="acc-head">
      <h2 id="ui_about_title">3) About This Tool</h2>
      <div class="chev">⌄</div>
    </div>
    <div class="acc-body" id="ui_about_text">

      This educational tool helps estimate intrinsic value of stocks using simplified valuation logic.
      It is designed for learning and comparison purposes only.
      <br><br>
      <strong>This is NOT financial advice.</strong>

    </div>
  </div>

  <div class="footer" id="ui_footer">
    Educational valuation tool · No financial advice
  </div>

</div>

<script>
  /* ACCORDION TOGGLE (UI only) */
  document.querySelectorAll(".acc-head").forEach(h=>{
    h.addEventListener("click",()=>{
      h.parentElement.classList.toggle("open");
    });
  });

  /* PART 2 WILL CONTINUE HERE */
</script>

<!-- =======================
     PART 1 END
     PART 2 STARTS BELOW
======================= -->

</body>
</html>
      
    <script>
/* =========================================================
   EQUITY ANALYZER — PART 2
   - i18n EN/CZ (all UI text)
   - Universal valuation model (FCF-per-share DCF simplified)
   - Watchlist (localStorage)
   - Info modal (ℹ) for every input
   - Safe accordion + stable wiring (no broken drawers)
   ========================================================= */

/* ---------- tiny helpers ---------- */
const $ = (id)=>document.getElementById(id);

const state = {
  lang: "en",
  currency: "USD",
  mos: 25,      // margin of safety %
  years: 10,
  disc: 9,      // discount rate %
  term: 2.5,    // terminal growth %
  scen: { bear: 2, base: 5, bull: 8 }, // growth (FCF growth)
};

/* ---------- modal UI (created here so Part 1 can stay simple) ---------- */
(function ensureModal(){
  if ($("modalBack")) return;

  const back = document.createElement("div");
  back.id = "modalBack";
  back.style.cssText = `
    position:fixed; inset:0; display:none; align-items:center; justify-content:center;
    background:rgba(0,0,0,.55); z-index:9999; padding:18px;
  `;
  back.innerHTML = `
    <div style="
      width:min(560px, 100%); background:#141a33; border:1px solid rgba(255,255,255,.10);
      border-radius:16px; overflow:hidden; box-shadow:0 20px 60px rgba(0,0,0,.5);
    ">
      <div style="
        display:flex; justify-content:space-between; align-items:center;
        padding:14px 16px; background:linear-gradient(180deg,#1b2350,#141a33);
        border-bottom:1px solid rgba(255,255,255,.08);
      ">
        <div id="modalTitle" style="font-weight:800">Info</div>
        <button id="modalClose" style="
          border:none; cursor:pointer; font-weight:800; color:#fff;
          padding:10px 12px; border-radius:12px; background:#222a55;
        ">Close</button>
      </div>
      <div id="modalBody" style="padding:16px; color:#e9ecff; line-height:1.45"></div>
    </div>
  `;
  document.body.appendChild(back);

  back.addEventListener("click",(e)=>{
    if(e.target === back) closeModal();
  });
  $("modalClose").addEventListener("click", closeModal);
})();

function openModal(title, bodyHtml){
  $("modalTitle").textContent = title;
  $("modalBody").innerHTML = bodyHtml;
  $("modalBack").style.display = "flex";
}
function closeModal(){
  $("modalBack").style.display = "none";
}

/* ---------- number parsing (supports spaces, comma, k/m/b) ---------- */
function parseNum(v){
  if (v === null || v === undefined) return NaN;
  let s = String(v).trim();
  if(!s) return NaN;

  // remove spaces
  s = s.replace(/\s+/g,"");

  // accept comma decimal
  s = s.replace(",", ".");

  // suffix multipliers
  const last = s.slice(-1).toLowerCase();
  let mult = 1;
  if (last === "k"){ mult = 1e3; s = s.slice(0,-1); }
  if (last === "m"){ mult = 1e6; s = s.slice(0,-1); }
  if (last === "b"){ mult = 1e9; s = s.slice(0,-1); }

  const n = Number(s);
  if(!Number.isFinite(n)) return NaN;
  return n * mult;
}

/* ---------- formatting ---------- */
function fmtMoney(n, cur){
  if(!Number.isFinite(n)) return "—";
  const c = cur || state.currency || "USD";
  try{
    return new Intl.NumberFormat(state.lang==="cz"?"cs-CZ":"en-US",{
      style:"currency",
      currency:c,
      maximumFractionDigits:2
    }).format(n);
  }catch{
    return `${n.toFixed(2)} ${c}`;
  }
}

function fmtPct(n){
  if(!Number.isFinite(n)) return "";
  const sign = n>0?"+":"";
  return `${sign}${n.toFixed(1)}%`;
}

/* ---------- i18n texts ---------- */
const TEXTS = {
  en:{
    inputsTitle:"1) Valuation Inputs",
    resultsTitle:"2) Result & Watchlist",
    aboutTitle:"3) About This Tool",
    footer:"Educational valuation tool · No financial advice",

    tickerLbl:"Ticker / Company",
    tickerHelp:"Company name or stock ticker (used in your watchlist).",

    priceLbl:"Current Share Price",
    priceHelp:"Market price of one share. Used to show upside/downside vs fair value.",

    fcfLbl:"Free Cash Flow (total)",
    fcfHelp:"Annual Free Cash Flow for the whole company. Tip: you can type 70b, 70B, 70000000000 or 70 000 000 000.",

    sharesLbl:"Shares Outstanding",
    sharesHelp:"Total number of shares. Used to convert company value into value per share. Tip: you can type 16b / 16B.",

    yearsLbl:"Projection length (years)",
    yearsHelp:"How many years you project cash flow growth. Typical: 10.",

    discLbl:"Discount rate (%)",
    discHelp:"Required return. Higher = more conservative. Typical: 8–12%. Must be > terminal growth.",

    termLbl:"Terminal growth (%)",
    termHelp:"Long-term growth after projection. Typical: 2–3%.",

    mosLbl:"Margin of Safety (%)",
    mosHelp:"Extra discount applied to Base case to get a more conservative target price.",

    scenTitle:"Scenario growth rates (annual %)",
    scenText:"We estimate 3 cases: Bear / Base / Bull. These are annual growth assumptions for the chosen metric (here: FCF).",
    bearLbl:"Bear growth (%)",
    baseLbl:"Base growth (%)",
    bullLbl:"Bull growth (%)",

    btnCalc:"Calculate",
    btnSave:"Save to Watchlist",
    btnReset:"Reset",
    valueLbl:"Estimated Fair Value (Base)",
    targetLbl:"Target price (Base with MoS)",
    rangeLbl:"Fair Value Range (Bear → Bull)",
    upsideLbl:"Upside vs current price",

    aboutHtml:`
      <div style="color:#a9b0ff; font-size:14px; line-height:1.5">
        <b>What this app does:</b> it estimates an intrinsic value using a simplified cash-flow model (DCF-style).
        <br><br>
        <b>Who it is for:</b> education, training, and quick comparisons between stocks.
        <br><br>
        <b>How to use:</b> enter current price, total annual FCF, shares outstanding, and scenario growth rates.
        Adjust discount rate / terminal growth for conservatism.
        <br><br>
        <b>Important:</b> This tool is <b>not financial advice</b>. Values are approximate and depend on assumptions.
      </div>
    `,

    watchEmpty:"No saved items yet.",
    watchTitle:"Saved items",
    del:"Delete"
  },

  cz:{
    inputsTitle:"1) Vstupy pro výpočet",
    resultsTitle:"2) Výsledek & Watchlist",
    aboutTitle:"3) O aplikaci",
    footer:"Vzdělávací nástroj · Nejde o finanční doporučení",

    tickerLbl:"Ticker / Firma",
    tickerHelp:"Název firmy nebo ticker (uloží se do watchlistu).",

    priceLbl:"Aktuální cena akcie",
    priceHelp:"Tržní cena 1 akcie. Podle ní ukážeme % rozdíl oproti férové hodnotě.",

    fcfLbl:"Free Cash Flow (celkem)",
    fcfHelp:"Roční Free Cash Flow celé firmy. Tip: můžeš psát 70b / 70B / 70 000 000 000.",

    sharesLbl:"Počet akcií (Shares Outstanding)",
    sharesHelp:"Počet akcií v oběhu. Použije se pro přepočet na hodnotu 1 akcie. Tip: můžeš psát 16b / 16B.",

    yearsLbl:"Délka projekce (roky)",
    yearsHelp:"Počet let projekce růstu cash flow. Typicky 10.",

    discLbl:"Diskontní sazba (%)",
    discHelp:"Požadovaný výnos/riziko. Vyšší = konzervativnější. Typicky 8–12 %. Musí být > terminál.",

    termLbl:"Terminální růst (%)",
    termHelp:"Dlouhodobý růst po projekci. Typicky 2–3 %.",

    mosLbl:"Margin of Safety (%)",
    mosHelp:"Dodatečná rezerva – sníží Base scénář pro konzervativní target cenu.",

    scenTitle:"Scénáře růstu (ročně v %)",
    scenText:"Počítáme 3 scénáře: Bear / Base / Bull. Zde jsou to předpoklady ročního růstu FCF.",
    bearLbl:"Bear růst (%)",
    baseLbl:"Base růst (%)",
    bullLbl:"Bull růst (%)",

    btnCalc:"Spočítat",
    btnSave:"Uložit do Watchlistu",
    btnReset:"Reset",
    valueLbl:"Odhad férové hodnoty (Base)",
    targetLbl:"Target cena (Base s MoS)",
    rangeLbl:"Rozmezí férové hodnoty (Bear → Bull)",
    upsideLbl:"Potenciál vs aktuální cena",

    aboutHtml:`
      <div style="color:#a9b0ff; font-size:14px; line-height:1.5">
        <b>Co aplikace dělá:</b> odhaduje vnitřní hodnotu pomocí zjednodušeného cash-flow modelu (DCF-styl).
        <br><br>
        <b>Pro koho je:</b> vzdělávání, školení a rychlé srovnání akcií.
        <br><br>
        <b>Jak použít:</b> zadej aktuální cenu, celkové roční FCF, počet akcií a růstové scénáře.
        Diskont a terminál uprav podle konzervativnosti.
        <br><br>
        <b>Důležité:</b> Toto <b>není finanční doporučení</b>. Výsledek závisí na předpokladech.
      </div>
    `,

    watchEmpty:"Zatím nic uloženého.",
    watchTitle:"Uložené položky",
    del:"Smazat"
  }
};

/* ---------- upgrade Part 1 UI: add missing inputs + results blocks ---------- */
(function enhanceUI(){
  // Insert advanced inputs + results table into accordion 1 and 2, if not already inserted
  const inputsBody = $("acc_inputs")?.querySelector(".acc-body");
  const resultsBody = $("acc_results")?.querySelector(".acc-body");

  if(inputsBody && !inputsBody.querySelector("#block_adv")){
    const adv = document.createElement("div");
    adv.id = "block_adv";
    adv.innerHTML = `
      <div class="field" style="margin-top:10px;">
        <div class="lbl">
          <span id="ui_years_lbl">Projection length (years)</span>
          <span class="hint" data-help="years">i</span>
        </div>
        <input id="in_years" placeholder="10" value="10" inputmode="numeric" />
        <div class="mini" id="ui_years_help"></div>
      </div>

      <div class="field">
        <div class="lbl">
          <span id="ui_disc_lbl">Discount rate (%)</span>
          <span class="hint" data-help="disc">i</span>
        </div>
        <input id="in_disc" placeholder="9" value="9" inputmode="decimal" />
        <div class="mini" id="ui_disc_help"></div>
      </div>

      <div class="field">
        <div class="lbl">
          <span id="ui_term_lbl">Terminal growth (%)</span>
          <span class="hint" data-help="term">i</span>
        </div>
        <input id="in_term" placeholder="2.5" value="2.5" inputmode="decimal" />
        <div class="mini" id="ui_term_help"></div>
      </div>

      <div class="field">
        <div class="lbl">
          <span id="ui_mos_lbl">Margin of Safety (%)</span>
          <span class="hint" data-help="mos">i</span>
        </div>
        <input id="in_mos" placeholder="25" value="25" inputmode="decimal" />
        <div class="mini" id="ui_mos_help"></div>
      </div>

      <div class="field" style="padding:14px; border:1px solid rgba(255,255,255,.08); border-radius:14px; background:#0e1430;">
        <div style="font-weight:800; margin-bottom:8px;" id="ui_scen_title">Scenario growth rates (annual %)</div>
        <div class="mini" id="ui_scen_text" style="margin-bottom:10px;"></div>

        <div class="field">
          <div class="lbl">
            <span id="ui_bear_lbl">Bear growth (%)</span>
            <span class="hint" data-help="bear">i</span>
          </div>
          <input id="in_bear" placeholder="2" value="2" inputmode="decimal" />
        </div>

        <div class="field">
          <div class="lbl">
            <span id="ui_base_lbl">Base growth (%)</span>
            <span class="hint" data-help="base">i</span>
          </div>
          <input id="in_base" placeholder="5" value="5" inputmode="decimal" />
        </div>

        <div class="field" style="margin-bottom:0;">
          <div class="lbl">
            <span id="ui_bull_lbl">Bull growth (%)</span>
            <span class="hint" data-help="bull">i</span>
          </div>
          <input id="in_bull" placeholder="8" value="8" inputmode="decimal" />
        </div>
      </div>

      <div class="btns">
        <button class="secondary" id="btn_reset">Reset</button>
      </div>
    `;
    inputsBody.appendChild(adv);
  }

  if(resultsBody && !resultsBody.querySelector("#block_results")){
    const r = document.createElement("div");
    r.id = "block_results";
    r.innerHTML = `
      <div class="field">
        <div class="lbl" id="ui_value_lbl">Estimated Fair Value (Base)</div>
        <input id="out_value" readonly placeholder="—" />
      </div>

      <div class="field">
        <div class="lbl" id="ui_target_lbl">Target price (Base with MoS)</div>
        <input id="out_target" readonly placeholder="—" />
      </div>

      <div class="field">
        <div class="lbl" id="ui_range_lbl">Fair Value Range (Bear → Bull)</div>
        <input id="out_range" readonly placeholder="—" />
      </div>

      <div class="field">
        <div class="lbl" id="ui_upside_lbl">Upside vs current price</div>
        <input id="out_upside" readonly placeholder="—" />
      </div>

      <div style="margin-top:16px; padding:14px; border:1px solid rgba(255,255,255,.08); border-radius:14px; background:#0e1430;">
        <div style="font-weight:900; margin-bottom:10px;" id="ui_watch_title">Saved items</div>
        <div id="watchBox"></div>
      </div>
    `;
    // put results ABOVE buttons
    const btns = resultsBody.querySelector(".btns");
    resultsBody.insertBefore(r, btns || null);
  }
})();

/* ---------- help texts for ℹ (every input) ---------- */
const HELPS = {
  en:{
    ticker:["Ticker / Company","Enter the stock ticker (e.g. AAPL) or company name."],
    price:["Current Share Price","Current market price per share."],
    fcf:["Free Cash Flow (total)","Annual company-level free cash flow. You can type 70b or 70 000 000 000."],
    shares:["Shares Outstanding","Total shares. Used to convert company value into per-share value."],
    years:["Projection length","Years of growth projection. Typical: 10."],
    disc:["Discount rate","Required return (risk). Typical 8–12%. Must be higher than terminal growth."],
    term:["Terminal growth","Long-term growth after projection. Typical 2–3%."],
    mos:["Margin of Safety","Extra discount applied to Base to compute a conservative target price."],
    bear:["Bear growth","Pessimistic annual growth assumption for FCF."],
    base:["Base growth","Realistic annual growth assumption for FCF."],
    bull:["Bull growth","Optimistic annual growth assumption for FCF."]
  },
  cz:{
    ticker:["Ticker / Firma","Zadej ticker (např. AAPL) nebo název firmy."],
    price:["Aktuální cena","Tržní cena za 1 akcii."],
    fcf:["FCF celkem","Roční FCF celé firmy. Můžeš psát 70b nebo 70 000 000 000."],
    shares:["Počet akcií","Počet akcií v oběhu. Použije se pro přepočet na 1 akcii."],
    years:["Délka projekce","Počet let projekce růstu. Typicky 10."],
    disc:["Diskont","Požadovaný výnos/riziko. Typicky 8–12 %. Musí být vyšší než terminál."],
    term:["Terminál","Dlouhodobý růst po projekci. Typicky 2–3 %."],
    mos:["Margin of Safety","Dodatečná rezerva – sníží Base scénář pro konzervativní target cenu."],
    bear:["Bear růst","Pesimistický předpoklad ročního růstu FCF."],
    base:["Base růst","Realistický předpoklad ročního růstu FCF."],
    bull:["Bull růst","Optimistický předpoklad ročního růstu FCF."]
  }
};

/* ---------- apply language to all UI nodes ---------- */
function applyLang(){
  const T = TEXTS[state.lang] || TEXTS.en;

  // accordion titles + footer + about
  if($("ui_inputs_title")) $("ui_inputs_title").textContent = T.inputsTitle;
  if($("ui_results_title")) $("ui_results_title").textContent = T.resultsTitle;
  if($("ui_about_title")) $("ui_about_title").textContent = T.aboutTitle;
  if($("ui_footer")) $("ui_footer").textContent = T.footer;
  if($("ui_about_text")) $("ui_about_text").innerHTML = T.aboutHtml;

  // field labels
  if($("ui_ticker_lbl")) $("ui_ticker_lbl").textContent = T.tickerLbl;
  if($("ui_ticker_help")) $("ui_ticker_help").textContent = T.tickerHelp;

  if($("ui_price_lbl")) $("ui_price_lbl").textContent = T.priceLbl;
  if($("ui_price_help")) $("ui_price_help").textContent = T.priceHelp;

  if($("ui_fcf_lbl")) $("ui_fcf_lbl").textContent = T.fcfLbl;
  if($("ui_fcf_help")) $("ui_fcf_help").textContent = T.fcfHelp;

  if($("ui_shares_lbl")) $("ui_shares_lbl").textContent = T.sharesLbl;
  if($("ui_shares_help")) $("ui_shares_help").textContent = T.sharesHelp;

  // advanced labels + helps (inserted)
  if($("ui_years_lbl")) $("ui_years_lbl").textContent = T.yearsLbl;
  if($("ui_years_help")) $("ui_years_help").textContent = T.yearsHelp;

  if($("ui_disc_lbl")) $("ui_disc_lbl").textContent = T.discLbl;
  if($("ui_disc_help")) $("ui_disc_help").textContent = T.discHelp;

  if($("ui_term_lbl")) $("ui_term_lbl").textContent = T.termLbl;
  if($("ui_term_help")) $("ui_term_help").textContent = T.termHelp;

  if($("ui_mos_lbl")) $("ui_mos_lbl").textContent = T.mosLbl;
  if($("ui_mos_help")) $("ui_mos_help").textContent = T.mosHelp;

  if($("ui_scen_title")) $("ui_scen_title").textContent = T.scenTitle;
  if($("ui_scen_text")) $("ui_scen_text").textContent = T.scenText;

  if($("ui_bear_lbl")) $("ui_bear_lbl").textContent = T.bearLbl;
  if($("ui_base_lbl")) $("ui_base_lbl").textContent = T.baseLbl;
  if($("ui_bull_lbl")) $("ui_bull_lbl").textContent = T.bullLbl;

  // buttons
  if($("btn_calc")) $("btn_calc").textContent = T.btnCalc;
  if($("btn_save")) $("btn_save").textContent = T.btnSave;
  if($("btn_reset")) $("btn_reset").textContent = T.btnReset;

  // results labels
  if($("ui_value_lbl")) $("ui_value_lbl").textContent = T.valueLbl;
  if($("ui_target_lbl")) $("ui_target_lbl").textContent = T.targetLbl;
  if($("ui_range_lbl")) $("ui_range_lbl").textContent = T.rangeLbl;
  if($("ui_upside_lbl")) $("ui_upside_lbl").textContent = T.upsideLbl;
  if($("ui_watch_title")) $("ui_watch_title").textContent = T.watchTitle;

  renderWatchlist();
}

/* ---------- bind language selector ---------- */
function bindLang(){
  const sel = $("sel_lang");
  if(!sel) return;

  sel.value = state.lang;
  sel.addEventListener("change", ()=>{
    state.lang = sel.value;
    applyLang();
  });
}

/* ---------- bind info hints ℹ ---------- */
function bindHints(){
  document.querySelectorAll(".hint").forEach(h=>{
    // attach only once
    if(h.dataset.bound === "1") return;
    h.dataset.bound = "1";

    // if no data-help, infer by nearest input id
    h.addEventListener("click",(e)=>{
      e.stopPropagation();
      let key = h.dataset.help;

      if(!key){
        // infer from closest field input
        const field = h.closest(".field");
        const inp = field?.querySelector("input");
        if(inp){
          const id = inp.id;
          if(id==="in_ticker") key="ticker";
          if(id==="in_price") key="price";
          if(id==="in_fcf") key="fcf";
          if(id==="in_shares") key="shares";
          if(id==="in_years") key="years";
          if(id==="in_disc") key="disc";
          if(id==="in_term") key="term";
          if(id==="in_mos") key="mos";
          if(id==="in_bear") key="bear";
          if(id==="in_base") key="base";
          if(id==="in_bull") key="bull";
        }
      }

      const H = (HELPS[state.lang]||HELPS.en)[key];
      if(!H){
        openModal("Info", state.lang==="cz"
          ? "K této položce chybí popis (doplníme)."
          : "Help text missing for this item (we'll add it)."
        );
        return;
      }
      openModal(H[0], `<div style="color:#a9b0ff">${H[1]}</div>`);
    });
  });
}

/* ---------- universal valuation model (simplified DCF) ----------
   Steps:
   - Convert total FCF to FCF per share (FCF_total / shares)
   - Project FCF per share for N years with growth g (scenario)
   - Discount each year at discount rate r
   - Terminal value using Gordon growth on year N FCF: TV = FCF_N*(1+tg)/(r-tg)
   - PV sum => fair value per share
*/
function dcfPerShare({ fcfTotal, shares, years, g, r, tg }){
  const fcfPS0 = fcfTotal / shares;
  if(!Number.isFinite(fcfPS0) || fcfPS0<=0) return NaN;

  const rr = r/100;
  const gg = g/100;
  const tt = tg/100;

  if(rr <= tt) return NaN;

  let pv = 0;
  let f = fcfPS0;

  for(let t=1; t<=years; t++){
    f = f * (1+gg);
    pv += f / Math.pow(1+rr, t);
  }

  // terminal value at year N (after growth)
  const tv = (f * (1+tt)) / (rr - tt);
  pv += tv / Math.pow(1+rr, years);

  return pv;
}
<script>
/* -------- calculate & render -------- */

function calculate() {
  const fcf0   = parseFloat(document.getElementById("in_fcf").value);
  const growth = parseFloat(document.getElementById("in_growth").value) / 100;
  const disc   = parseFloat(document.getElementById("in_disc").value) / 100;
  const term   = parseFloat(document.getElementById("in_term").value) / 100;
  const years  = parseInt(document.getElementById("in_years").value, 10);
  const shares = parseFloat(document.getElementById("in_shares").value);

  if (
    !isFinite(fcf0) || !isFinite(growth) || !isFinite(disc) ||
    !isFinite(term) || !isFinite(years) || !isFinite(shares) ||
    disc <= term
  ) {
    alert(state.lang === "cz"
      ? "Zkontroluj vstupy (diskont musí být vyšší než terminální růst)."
      : "Check inputs (discount rate must be higher than terminal growth)."
    );
    return;
  }

  let pv = 0;
  let f = fcf0;

  for (let t = 1; t <= years; t++) {
    f = f * (1 + growth);
    pv += f / Math.pow(1 + disc, t);
  }

  const terminalValue = (f * (1 + term)) / (disc - term);
  pv += terminalValue / Math.pow(1 + disc, years);

  const fairValue = pv / shares;

  document.getElementById("out_value").textContent =
    fairValue.toFixed(2) + " $";
}

/* -------- buttons -------- */

document.getElementById("btn_calc").addEventListener("click", calculate);

document.getElementById("btn_lang").addEventListener("click", () => {
  state.lang = state.lang === "en" ? "cz" : "en";
  applyLang();
});

/* -------- init -------- */

applyLang();
</script>


      

    











    
    

  



      




  




    

    


    


  














  
  

    
        




          

        

          





  

  

  


  


    


      

  

    

          
    

    

    
    


    





    

    

  
        

    
    

  

  





