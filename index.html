<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Equity Analyzer ‚Äî Multi-Model Fair Value</title>

  <meta name="theme-color" content="#0b1020" />
  <style>
    :root{
      --bg0:#070A14;
      --bg1:#0b1020;
      --card:#0f1832;
      --card2:#0d1430;
      --border:rgba(255,255,255,.10);
      --border2:rgba(255,255,255,.14);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.55);

      --p1:#6D5BFF;   /* purple */
      --p2:#28C7FF;   /* cyan */
      --p3:#00E1A4;   /* mint */
      --warn:#FFB020;
      --bad:#FF5A7A;

      --shadow: 0 12px 30px rgba(0,0,0,.45);
      --radius: 18px;
      --radius2: 24px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(109,91,255,.20), transparent 60%),
        radial-gradient(1200px 700px at 85% 20%, rgba(40,199,255,.18), transparent 58%),
        radial-gradient(900px 600px at 60% 90%, rgba(0,225,164,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    a{color:inherit}
    .wrap{
      width:min(1100px, 92vw);
      margin: 28px auto 60px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding: 18px 18px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      position:sticky;
      top:12px;
      z-index: 50;
      backdrop-filter: blur(10px);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 240px;
    }
    .logo{
      width:42px;height:42px;border-radius:14px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.35), transparent 60%),
        linear-gradient(135deg, var(--p1), var(--p2));
      box-shadow: 0 10px 25px rgba(109,91,255,.25);
      border:1px solid rgba(255,255,255,.18);
    }
    .brand h1{
      margin:0;
      font-size: 20px;
      letter-spacing: .4px;
      line-height:1.05;
    }
    .brand .sub{
      margin:2px 0 0;
      font-size: 12px;
      color: var(--muted);
    }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size: 13px;
      user-select:none;
    }

    .btn{
      border:1px solid var(--border2);
      background: rgba(255,255,255,.05);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      font-weight: 650;
      letter-spacing:.2px;
    }
    .btn:hover{
      background: rgba(255,255,255,.08);
      border-color: rgba(255,255,255,.22);
    }
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      border: none;
      background: linear-gradient(135deg, var(--p1), var(--p2));
      box-shadow: 0 12px 28px rgba(109,91,255,.22);
    }
    .btn.primary:hover{filter:brightness(1.06)}
    .btn.ghost{
      background: rgba(0,0,0,.0);
    }
    .btn.danger{
      border:1px solid rgba(255,90,122,.35);
      background: rgba(255,90,122,.09);
    }

    .seg{
      display:flex;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      border-radius: 14px;
      overflow:hidden;
    }
    .seg button{
      border:0;
      background:transparent;
      color: var(--muted);
      padding: 10px 12px;
      cursor:pointer;
      font-weight: 700;
      min-width: 56px;
    }
    .seg button.active{
      color: var(--text);
      background: rgba(255,255,255,.08);
    }

    .tabs{
      margin-top: 18px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .tab{
      flex:1;
      min-width: 190px;
      padding: 14px 14px;
      border-radius: var(--radius);
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      cursor:pointer;
      transition: background .15s ease, border-color .15s ease, transform .08s ease;
      position:relative;
      overflow:hidden;
    }
    .tab:hover{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.18); }
    .tab:active{transform: translateY(1px)}
    .tab.active{
      background:
        radial-gradient(900px 220px at 20% 10%, rgba(109,91,255,.22), transparent 60%),
        radial-gradient(700px 200px at 90% 40%, rgba(40,199,255,.18), transparent 60%),
        rgba(255,255,255,.05);
      border-color: rgba(255,255,255,.22);
      box-shadow: 0 14px 32px rgba(0,0,0,.35);
    }
    .tab h3{margin:0; font-size:15px}
    .tab p{margin:6px 0 0; font-size:12px; color: var(--muted); line-height:1.35}

    .panel{
      margin-top: 14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .panelHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 16px 18px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    .panelHead .title{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .panelHead .title b{font-size:15px}
    .panelHead .title span{font-size:12px;color:var(--muted)}
    .panelBody{ padding: 16px 18px 18px; }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 920px){
      .grid{grid-template-columns:1fr}
      .brand{min-width:auto}
    }

    .card{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(15,24,50,.55);
      border-radius: var(--radius);
      padding: 14px;
    }
    .card.soft{
      background: rgba(13,20,48,.45);
    }
    .card h4{
      margin:0 0 10px;
      font-size: 13px;
      letter-spacing:.25px;
      color: rgba(255,255,255,.88);
      display:flex; align-items:center; gap:8px;
    }
    .hint{
      width:18px;height:18px;border-radius:999px;
      display:inline-flex;align-items:center;justify-content:center;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-size: 12px;
      cursor:pointer;
      user-select:none;
    }
    .muted{color:var(--muted)}
    .muted2{color:var(--muted2)}

    .row{
      display:grid;
      grid-template-columns: 1fr 160px;
      gap: 10px;
      margin-bottom: 10px;
    }
    @media (max-width: 480px){
      .row{grid-template-columns:1fr}
    }

    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .field{
      width:100%;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--text);
      padding: 11px 12px;
      border-radius: 14px;
      outline:none;
      transition: border-color .15s ease, background .15s ease;
    }
    .field:focus{
      border-color: rgba(40,199,255,.40);
      background: rgba(0,0,0,.24);
    }
    .suffix{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .unit{
      font-family: var(--mono);
      font-size: 11px;
      color: var(--muted2);
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      white-space:nowrap;
    }

    .split{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top: 10px;
    }
    .split .left, .split .right{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

    .badge{
      font-family: var(--mono);
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.88);
    }
    .badge.good{border-color: rgba(0,225,164,.35); background: rgba(0,225,164,.10);}
    .badge.warn{border-color: rgba(255,176,32,.35); background: rgba(255,176,32,.10);}
    .badge.bad{border-color: rgba(255,90,122,.35); background: rgba(255,90,122,.10);}

    .results{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 720px){ .results{grid-template-columns:1fr} }

    .big{
      font-size: 26px;
      font-weight: 900;
      letter-spacing: .2px;
    }
    .small{
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
      line-height:1.35;
    }

    .table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
    }
    .table th,.table td{
      padding: 10px 10px;
      font-size: 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      text-align:left;
      vertical-align:top;
    }
    .table th{color: var(--muted); font-weight: 800;}
    .table tr:last-child td{border-bottom:0}
    .table .mono{font-family: var(--mono)}
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--muted);
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      padding: 12px 14px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(10,14,30,.85);
      box-shadow: var(--shadow);
      color: var(--text);
      font-size: 13px;
      display:none;
      z-index: 999;
      max-width: 92vw;
      backdrop-filter: blur(10px);
    }

    .modalOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 1000;
    }
    .modal{
      width:min(780px, 96vw);
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(900px 260px at 20% 10%, rgba(109,91,255,.22), transparent 60%),
        radial-gradient(700px 260px at 90% 40%, rgba(40,199,255,.18), transparent 60%),
        rgba(13,20,48,.92);
      box-shadow: 0 28px 60px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modalHead{
      display:flex;align-items:center;justify-content:space-between;
      padding: 14px 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .modalHead b{font-size:14px}
    .modalBody{padding: 14px 16px 16px; color: var(--muted); font-size: 13px; line-height:1.55}
    .modalBody ul{margin: 8px 0 0 18px}
    .modalBody li{margin: 6px 0}
    .x{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      width:36px;height:36px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 900;
    }
    .footerNote{
      margin-top: 14px;
      color: var(--muted2);
      font-size: 12px;
      line-height:1.45;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1 id="t_appTitle">Equity Analyzer</h1>
          <div class="sub" id="t_appSubtitle">Fair value & portfolio helper (education-first)</div>
        </div>
      </div>

      <div class="actions">
        <div class="pill">
          <span id="t_lang">Language</span>
          <div class="seg" role="tablist" aria-label="Language">
            <button id="langEN" class="active" type="button">EN</button>
            <button id="langCS" type="button">CZ</button>
          </div>
        </div>

        <button class="btn ghost" type="button" id="btnHelp">
          <span id="t_help">How it works</span>
        </button>

        <button class="btn primary" type="button" id="btnQuickSave">
          <span id="t_quickSave">Save to Watchlist</span>
        </button>
      </div>
    </div>

    <div class="tabs" role="tablist">
      <div class="tab active" role="tab" tabindex="0" id="tabValuation">
        <h3 id="t_tab1">Valuation Models</h3>
        <p id="t_tab1sub">DCF + Dividend + Multiples. Pick the model that fits the company.</p>
      </div>
      <div class="tab" role="tab" tabindex="0" id="tabWatch">
        <h3 id="t_tab2">Watchlist</h3>
        <p id="t_tab2sub">Saved calculations. Stored locally in your browser.</p>
      </div>
      <div class="tab" role="tab" tabindex="0" id="tabAbout">
        <h3 id="t_tab3">About & Disclaimer</h3>
        <p id="t_tab3sub">Educational app. Not financial advice.</p>
      </div>
    </div>

    <!-- PANEL 1: VALUATION -->
    <section class="panel" id="panelValuation">
      <div class="panelHead">
        <div class="title">
          <b id="t_panel1title">Valuation Models</b>
          <span id="t_panel1subtitle">Choose a model and enter assumptions. The app explains what each input means.</span>
        </div>
        <div class="right">
          <span class="badge" id="badgeModel">MODEL: DCF</span>
        </div>
      </div>

      <div class="panelBody">
        <div class="grid">
          <!-- LEFT: INPUTS -->
          <div class="card">
            <h4>
              <span id="t_company">Company</span>
              <span class="hint" data-hint="company">i</span>
            </h4>

            <div class="row">
              <div>
                <label id="t_tickerLbl" for="ticker">Ticker / Name</label>
                <input class="field" id="ticker" placeholder="e.g., SOFI / Palantir / Apple" />
              </div>
              <div class="suffix">
                <div style="width:100%">
                  <label id="t_currencyLbl" for="currency">Currency</label>
                  <select class="field" id="currency">
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="CZK">CZK</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="split" style="margin-top:8px">
              <div class="left">
                <span class="tag">üíæ <span id="t_storage">Saved locally</span></span>
                <span class="tag">üß† <span id="t_edu">Education-first</span></span>
              </div>
              <div class="right">
                <label class="muted" style="margin:0;font-size:12px" id="t_modelLbl">Model</label>
                <select class="field" id="model" style="min-width:220px">
                  <option value="DCF">DCF (Free Cash Flow)</option>
                  <option value="DDM">Dividend Discount (DDM)</option>
                  <option value="MULT">Multiples (P/E, EV/EBITDA)</option>
                </select>
              </div>
            </div>

            <div style="height:12px"></div>

            <div class="card soft" id="blockDCF">
              <h4>
                <span id="t_dcfTitle">DCF Inputs</span>
                <span class="hint" data-hint="dcf">i</span>
              </h4>

              <div class="row">
                <div>
                  <label id="t_fcfLbl">Current Free Cash Flow (FCF)</label>
                  <input class="field num" id="fcf" placeholder="e.g., 500000000" />
                  <div class="small" id="t_fcfHelp">Cash the business generates after investments. Core for DCF.</div>
                </div>
                <div class="suffix">
                  <div class="unit" id="u_fcf">currency / year</div>
                </div>
              </div>

              <div class="row">
                <div>
                  <label id="t_growthLbl">FCF Growth (Years 1-5)</label>
                  <input class="field num" id="g1" placeholder="e.g., 15" />
                  <div class="small" id="t_growthHelp">Your expected annual growth rate for the next 5 years.</div>
                </div>
                <div class="suffix"><div class="unit">%</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_growth2Lbl">FCF Growth (Years 6-10)</label>
                  <input class="field num" id="g2" placeholder="e.g., 8" />
                  <div class="small" id="t_growth2Help">Slower growth phase (maturing business).</div>
                </div>
                <div class="suffix"><div class="unit">%</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_discountLbl">Discount Rate</label>
                  <input class="field num" id="dr" placeholder="e.g., 9" value="9" />
                  <div class="small" id="t_discountHelp">Your required return (risk). Higher = lower valuation.</div>
                </div>
                <div class="suffix"><div class="unit">%</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_terminalLbl">Terminal Growth</label>
                  <input class="field num" id="tg" placeholder="e.g., 2.5" value="2.5" />
                  <div class="small" id="t_terminalHelp">Long-term growth after year 10 (usually low).</div>
                </div>
                <div class="suffix"><div class="unit">%</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_cashLbl">Cash & Equivalents</label>
                  <input class="field num" id="cash" placeholder="e.g., 2000000000" />
                  <div class="small" id="t_cashHelp">Added to enterprise value to reach equity value.</div>
                </div>
                <div class="suffix"><div class="unit" id="u_cash">currency</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_debtLbl">Total Debt</label>
                  <input class="field num" id="debt" placeholder="e.g., 1500000000" />
                  <div class="small" id="t_debtHelp">Subtracted to get equity value.</div>
                </div>
                <div class="suffix"><div class="unit" id="u_debt">currency</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_sharesLbl">Shares Outstanding</label>
                  <input class="field num" id="shares" placeholder="e.g., 1000000000" />
                  <div class="small" id="t_sharesHelp">Used to convert total equity value into per-share fair value.</div>
                </div>
                <div class="suffix"><div class="unit" id="u_shares">shares</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_priceLbl">Current Price (optional)</label>
                  <input class="field num" id="price" placeholder="e.g., 12.30" />
                  <div class="small" id="t_priceHelp">If provided, we show upside/downside vs fair value.</div>
                </div>
                <div class="suffix"><div class="unit" id="u_price">/ share</div></div>
              </div>
            </div>

            <div class="card soft" id="blockDDM" style="display:none">
              <h4>
                <span id="t_ddmTitle">Dividend Discount Inputs</span>
                <span class="hint" data-hint="ddm">i</span>
              </h4>

              <div class="row">
                <div>
                  <label id="t_divLbl">Next Year Dividend (D1) per Share</label>
                  <input class="field num" id="d1" placeholder="e.g., 1.20" />
                  <div class="small" id="t_divHelp">Expected dividend paid over the next 12 months.</div>
                </div>
                <div class="suffix"><div class="unit" id="u_d1">/ share</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_divGrowLbl">Dividend Growth</label>
                  <input class="field num" id="dg" placeholder="e.g., 4" />
                  <div class="small" id="t_divGrowHelp">Long-term dividend growth rate.</div>
                </div>
                <div class="suffix"><div class="unit">%</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_reqLbl">Required Return</label>
                  <input class="field num" id="rr" placeholder="e.g., 9" value="9" />
                  <div class="small" id="t_reqHelp">Investor required return (must be > dividend growth).</div>
                </div>
                <div class="suffix"><div class="unit">%</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_price2Lbl">Current Price (optional)</label>
                  <input class="field num" id="price2" placeholder="e.g., 55.10" />
                  <div class="small" id="t_price2Help">Used to compute upside/downside.</div>
                </div>
                <div class="suffix"><div class="unit" id="u_price2">/ share</div></div>
              </div>
            </div>

            <div class="card soft" id="blockMULT" style="display:none">
              <h4>
                <span id="t_multTitle">Multiples Inputs</span>
                <span class="hint" data-hint="mult">i</span>
              </h4>

              <div class="row">
                <div>
                  <label id="t_epsLbl">Forward EPS (per share)</label>
                  <input class="field num" id="eps" placeholder="e.g., 2.10" />
                  <div class="small" id="t_epsHelp">Expected earnings per share (next 12 months).</div>
                </div>
                <div class="suffix"><div class="unit" id="u_eps">/ share</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_peLbl">Target P/E Multiple</label>
                  <input class="field num" id="pe" placeholder="e.g., 18" />
                  <div class="small" id="t_peHelp">A reasonable multiple for this business/sector.</div>
                </div>
                <div class="suffix"><div class="unit">x</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_eBitdaLbl">Forward EBITDA (optional)</label>
                  <input class="field num" id="ebitda" placeholder="e.g., 3000000000" />
                  <div class="small" id="t_eBitdaHelp">If you prefer EV/EBITDA, enter EBITDA and EV/EBITDA multiple.</div>
                </div>
                <div class="suffix"><div class="unit" id="u_ebitda">currency</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_evEbitdaLbl">Target EV/EBITDA (optional)</label>
                  <input class="field num" id="evebitda" placeholder="e.g., 12" />
                  <div class="small" id="t_evEbitdaHelp">If filled with EBITDA, we estimate enterprise value.</div>
                </div>
                <div class="suffix"><div class="unit">x</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_cash2Lbl">Cash (optional, for EV‚ÜíEquity)</label>
                  <input class="field num" id="cash2" placeholder="e.g., 2000000000" />
                  <div class="small" id="t_cash2Help">Used only with EV/EBITDA path.</div>
                </div>
                <div class="suffix"><div class="unit" id="u_cash2">currency</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_debt2Lbl">Debt (optional, for EV‚ÜíEquity)</label>
                  <input class="field num" id="debt2" placeholder="e.g., 1500000000" />
                  <div class="small" id="t_debt2Help">Used only with EV/EBITDA path.</div>
                </div>
                <div class="suffix"><div class="unit" id="u_debt2">currency</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_shares2Lbl">Shares Outstanding</label>
                  <input class="field num" id="shares2" placeholder="e.g., 1000000000" />
                  <div class="small" id="t_shares2Help">Needed to compute fair value per share.</div>
                </div>
                <div class="suffix"><div class="unit">shares</div></div>
              </div>

              <div class="row">
                <div>
                  <label id="t_price3Lbl">Current Price (optional)</label>
                  <input class="field num" id="price3" placeholder="e.g., 12.30" />
                  <div class="small" id="t_price3Help">Used to compute upside/downside.</div>
                </div>
                <div class="suffix"><div class="unit" id="u_price3">/ share</div></div>
              </div>
            </div>

            <div class="split">
              <div class="left">
                <button class="btn" type="button" id="btnCalculate"><span id="t_calc">Calculate</span></button>
                <button class="btn ghost" type="button" id="btnReset"><span id="t_reset">Reset</span></button>
              </div>
              <div class="right">
                <button class="btn" type="button" id="btnSave"><span id="t_save">Save result</span></button>
              </div>
            </div>

            <div class="footerNote" id="t_noteSmall">
              Tip: For growth companies use DCF. For mature dividend payers use DDM. For quick sanity checks use Multiples.
            </div>
          </div>

          <!-- RIGHT: OUTPUTS -->
          <div class="card">
            <h4>
              <span id="t_resultsTitle">Results</span>
              <span class="hint" data-hint="results">i</span>
            </h4>

            <div class="results">
              <div class="card soft">
                <div class="muted" id="t_fairValue">Fair Value</div>
                <div class="big" id="outFair">‚Äî</div>
                <div class="small" id="outFairSub">‚Äî</div>
              </div>
              <div class="card soft">
                <div class="muted" id="t_margin">Margin of Safety</div>
                <div class="big" id="outMOS">‚Äî</div>
                <div class="small" id="outMOSSub">‚Äî</div>
              </div>
            </div>

            <div style="height:10px"></div>

            <div class="card soft">
              <div class="muted" id="t_detail">Details</div>
              <div class="small" id="outDetail">
                Enter inputs and press Calculate.
              </div>
            </div>

            <div style="height:10px"></div>

            <div class="card soft">
              <div class="muted" id="t_sanity">Sanity Checks</div>
              <div class="small" id="outSanity">‚Äî</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- PANEL 2: WATCHLIST -->
    <section class="panel" id="panelWatch" style="display:none">
      <div class="panelHead">
        <div class="title">
          <b id="t_watchTitle">Watchlist</b>
          <span id="t_watchSub">Your saved calculations. Stored in localStorage (this device + this browser).</span>
        </div>
        <div class="right">
          <button class="btn danger" type="button" id="btnClearWatch"><span id="t_clearAll">Clear all</span></button>
        </div>
      </div>
      <div class="panelBody">
        <div class="card soft">
          <h4>
            <span id="t_watchTable">Saved items</span>
            <span class="hint" data-hint="watch">i</span>
          </h4>

          <div style="overflow:auto">
            <table class="table" id="watchTable">
              <thead>
                <tr>
                  <th id="t_w_company">Company</th>
                  <th id="t_w_model">Model</th>
                  <th id="t_w_fv">Fair Value</th>
                  <th id="t_w_price">Price</th>
                  <th id="t_w_upside">Upside</th>
                  <th id="t_w_date">Saved</th>
                  <th id="t_w_actions">Actions</th>
                </tr>
              </thead>
              <tbody id="watchBody">
                <tr>
                  <td colspan="7" class="muted" id="t_emptyWatch">No saved items yet.</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="footerNote" id="t_watchNote">
            Watchlist is stored locally. If you clear browser data or switch devices, items disappear.
          </div>
        </div>
      </div>
    </section>

    <!-- PANEL 3: ABOUT -->
    <section class="panel" id="panelAbout" style="display:none">
      <div class="panelHead">
        <div class="title">
          <b id="t_aboutTitle">About & Disclaimer</b>
          <span id="t_aboutSub">This tool is for learning. Always do your own research.</span>
        </div>
      </div>
      <div class="panelBody">
        <div class="card">
          <h4><span id="t_aboutH">What this app is</span></h4>
          <div class="muted" id="t_aboutP">
            Equity Analyzer helps you estimate a rough intrinsic value using common models (DCF, DDM, Multiples).
            Inputs are intentionally explained so you understand what you are doing.
          </div>

          <div style="height:12px"></div>

          <h4><span id="t_disclaimerH">Disclaimer (Important)</span></h4>
          <div class="muted" id="t_disclaimerP">
            This is NOT financial advice. Outputs depend heavily on assumptions. Markets can be irrational. Use this as a learning aid only.
          </div>

          <div style="height:12px"></div>

          <h4><span id="t_forWhoH">For whom it is useful</span></h4>
          <div class="muted" id="t_forWhoP">
            Investors who want to practice valuation thinking, compare scenarios, and save their notes. Best with real company fundamentals.
          </div>

          <div style="height:12px"></div>

          <h4><span id="t_howToH">How to use</span></h4>
          <div class="muted" id="t_howToP">
            Choose a model, fill inputs, calculate, then save to Watchlist. Try conservative assumptions and compare outcomes.
          </div>
        </div>
      </div>
    </section>

  </div>

  <div class="toast" id="toast"></div>

  <div class="modalOverlay" id="modalOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHead">
        <b id="modalTitle">Info</b>
        <button class="x" type="button" id="modalClose">√ó</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <script>
    // ========= i18n (EN/CZ) =========
    const I18N = {
      en: {
        appTitle: "Equity Analyzer",
        appSubtitle: "Fair value & portfolio helper (education-first)",
        lang: "Language",
        help: "How it works",
        quickSave: "Save to Watchlist",

        tab1:"Valuation Models",
        tab1sub:"DCF + Dividend + Multiples. Pick the model that fits the company.",
        tab2:"Watchlist",
        tab2sub:"Saved calculations. Stored locally in your browser.",
        tab3:"About & Disclaimer",
        tab3sub:"Educational app. Not financial advice.",

        panel1title:"Valuation Models",
        panel1subtitle:"Choose a model and enter assumptions. The app explains what each input means.",

        company:"Company",
        tickerLbl:"Ticker / Name",
        currencyLbl:"Currency",
        storage:"Saved locally",
        edu:"Education-first",
        modelLbl:"Model",

        dcfTitle:"DCF Inputs",
        fcfLbl:"Current Free Cash Flow (FCF)",
        fcfHelp:"Cash the business generates after investments. Core for DCF.",
        growthLbl:"FCF Growth (Years 1-5)",
        growthHelp:"Your expected annual growth rate for the next 5 years.",
        growth2Lbl:"FCF Growth (Years 6-10)",
        growth2Help:"Slower growth phase (maturing business).",
        discountLbl:"Discount Rate",
        discountHelp:"Your required return (risk). Higher = lower valuation.",
        terminalLbl:"Terminal Growth",
        terminalHelp:"Long-term growth after year 10 (usually low).",
        cashLbl:"Cash & Equivalents",
        cashHelp:"Added to enterprise value to reach equity value.",
        debtLbl:"Total Debt",
        debtHelp:"Subtracted to get equity value.",
        sharesLbl:"Shares Outstanding",
        sharesHelp:"Used to convert total equity value into per-share fair value.",
        priceLbl:"Current Price (optional)",
        priceHelp:"If provided, we show upside/downside vs fair value.",

        ddmTitle:"Dividend Discount Inputs",
        divLbl:"Next Year Dividend (D1) per Share",
        divHelp:"Expected dividend paid over the next 12 months.",
        divGrowLbl:"Dividend Growth",
        divGrowHelp:"Long-term dividend growth rate.",
        reqLbl:"Required Return",
        reqHelp:"Investor required return (must be > dividend growth).",
        price2Lbl:"Current Price (optional)",
        price2Help:"Used to compute upside/downside.",

        multTitle:"Multiples Inputs",
        epsLbl:"Forward EPS (per share)",
        epsHelp:"Expected earnings per share (next 12 months).",
        peLbl:"Target P/E Multiple",
        peHelp:"A reasonable multiple for this business/sector.",
        eBitdaLbl:"Forward EBITDA (optional)",
        eBitdaHelp:"If you prefer EV/EBITDA, enter EBITDA and EV/EBITDA multiple.",
        evEbitdaLbl:"Target EV/EBITDA (optional)",
        evEbitdaHelp:"If filled with EBITDA, we estimate enterprise value.",
        cash2Lbl:"Cash (optional, for EV‚ÜíEquity)",
        cash2Help:"Used only with EV/EBITDA path.",
        debt2Lbl:"Debt (optional, for EV‚ÜíEquity)",
        debt2Help:"Used only with EV/EBITDA path.",
        shares2Lbl:"Shares Outstanding",
        shares2Help:"Needed to compute fair value per share.",
        price3Lbl:"Current Price (optional)",
        price3Help:"Used to compute upside/downside.",

        calc:"Calculate",
        reset:"Reset",
        save:"Save result",
        noteSmall:"Tip: For growth companies use DCF. For mature dividend payers use DDM. For quick sanity checks use Multiples.",

        resultsTitle:"Results",
        fairValue:"Fair Value",
        margin:"Margin of Safety",
        detail:"Details",
        sanity:"Sanity Checks",

        watchTitle:"Watchlist",
        watchSub:"Your saved calculations. Stored in localStorage (this device + this browser).",
        clearAll:"Clear all",
        watchTable:"Saved items",
        w_company:"Company",
        w_model:"Model",
        w_fv:"Fair Value",
        w_price:"Price",
        w_upside:"Upside",
        w_date:"Saved",
        w_actions:"Actions",
        emptyWatch:"No saved items yet.",
        watchNote:"Watchlist is stored locally. If you clear browser data or switch devices, items disappear.",

        aboutTitle:"About & Disclaimer",
        aboutSub:"This tool is for learning. Always do your own research.",
        aboutH:"What this app is",
        aboutP:"Equity Analyzer helps you estimate a rough intrinsic value using common models (DCF, DDM, Multiples). Inputs are intentionally explained so you understand what you are doing.",
        disclaimerH:"Disclaimer (Important)",
        disclaimerP:"This is NOT financial advice. Outputs depend heavily on assumptions. Markets can be irrational. Use this as a learning aid only.",
        forWhoH:"For whom it is useful",
        forWhoP:"Investors who want to practice valuation thinking, compare scenarios, and save their notes. Best with real company fundamentals.",
        howToH:"How to use",
        howToP:"Choose a model, fill inputs, calculate, then save to Watchlist. Try conservative assumptions and compare outcomes.",

        toastSaved:"Saved to Watchlist.",
        toastDeleted:"Deleted.",
        toastCleared:"Watchlist cleared.",
        toastNeedCalc:"First calculate a result to save.",
        toastInvalid:"Some inputs are invalid. Check rates and required fields.",

        modelBadge:"MODEL",
      },

      cs: {
        appTitle: "Equity Analyzer",
        appSubtitle: "F√©rov√° hodnota & portfolio pomocn√≠k (v√Ωukovƒõ)",
        lang: "Jazyk",
        help: "Jak to funguje",
        quickSave: "Ulo≈æit do Watchlistu",

        tab1:"Modely ocenƒõn√≠",
        tab1sub:"DCF + Dividendy + N√°sobky. Vyber model podle typu firmy.",
        tab2:"Watchlist",
        tab2sub:"Ulo≈æen√© v√Ωpoƒçty. Ukl√°d√° se lok√°lnƒõ v prohl√≠≈æeƒçi.",
        tab3:"O aplikaci & upozornƒõn√≠",
        tab3sub:"V√Ωukov√° aplikace. Nejde o finanƒçn√≠ doporuƒçen√≠.",

        panel1title:"Modely ocenƒõn√≠",
        panel1subtitle:"Vyber model a zadej p≈ôedpoklady. Aplikace vysvƒõtluje, co kter√Ω vstup znamen√°.",

        company:"Firma",
        tickerLbl:"Ticker / N√°zev",
        currencyLbl:"Mƒõna",
        storage:"Ulo≈æeno lok√°lnƒõ",
        edu:"V√Ωukovƒõ",
        modelLbl:"Model",

        dcfTitle:"DCF vstupy",
        fcfLbl:"Aktu√°ln√≠ Free Cash Flow (FCF)",
        fcfHelp:"Hotovost, kterou firma generuje po investic√≠ch. Z√°klad pro DCF.",
        growthLbl:"R≈Øst FCF (roky 1‚Äì5)",
        growthHelp:"Odhad roƒçn√≠ho r≈Østu pro n√°sleduj√≠c√≠ch 5 let.",
        growth2Lbl:"R≈Øst FCF (roky 6‚Äì10)",
        growth2Help:"Pomalej≈°√≠ f√°ze r≈Østu (zral√° firma).",
        discountLbl:"Diskontn√≠ sazba",
        discountHelp:"Po≈æadovan√Ω v√Ωnos (riziko). Vy≈°≈°√≠ = ni≈æ≈°√≠ f√©rov√° hodnota.",
        terminalLbl:"Termin√°ln√≠ r≈Øst",
        terminalHelp:"Dlouhodob√Ω r≈Øst po 10. roce (obvykle n√≠zk√Ω).",
        cashLbl:"Hotovost (Cash)",
        cashHelp:"P≈ôiƒç√≠t√° se k enterprise value pro v√Ωpoƒçet equity value.",
        debtLbl:"Dluh (Debt)",
        debtHelp:"Odeƒç√≠t√° se pro v√Ωpoƒçet equity value.",
        sharesLbl:"Poƒçet akci√≠ (Shares)",
        sharesHelp:"P≈ôepoƒçet celkov√© hodnoty na hodnotu na 1 akcii.",
        priceLbl:"Aktu√°ln√≠ cena (voliteln√©)",
        priceHelp:"Pokud vypln√≠≈°, uk√°≈æeme potenci√°l vs f√©rov√° hodnota.",

        ddmTitle:"Model dividend (DDM) vstupy",
        divLbl:"Dividenda p≈ô√≠≈°t√≠ rok (D1) na akcii",
        divHelp:"Oƒçek√°van√° dividenda v p≈ô√≠≈°t√≠ch 12 mƒõs√≠c√≠ch.",
        divGrowLbl:"R≈Øst dividend",
        divGrowHelp:"Dlouhodob√© tempo r≈Østu dividend.",
        reqLbl:"Po≈æadovan√Ω v√Ωnos",
        reqHelp:"Po≈æadovan√Ω v√Ωnos investora (mus√≠ b√Ωt > r≈Øst dividend).",
        price2Lbl:"Aktu√°ln√≠ cena (voliteln√©)",
        price2Help:"Pro v√Ωpoƒçet potenci√°lu.",

        multTitle:"N√°sobky (Multiples) vstupy",
        epsLbl:"Forward EPS (na akcii)",
        epsHelp:"Oƒçek√°van√Ω zisk na akcii (p≈ô√≠≈°t√≠ch 12 mƒõs√≠c≈Ø).",
        peLbl:"C√≠lov√© P/E",
        peHelp:"Rozumn√Ω n√°sobek pro firmu/odvƒõtv√≠.",
        eBitdaLbl:"Forward EBITDA (voliteln√©)",
        eBitdaHelp:"Pokud chce≈° EV/EBITDA, zadej EBITDA a n√°sobek.",
        evEbitdaLbl:"C√≠lov√© EV/EBITDA (voliteln√©)",
        evEbitdaHelp:"Pokud vypln√≠≈° s EBITDA, dopoƒç√≠t√°me enterprise value.",
        cash2Lbl:"Hotovost (volitelnƒõ, pro EV‚ÜíEquity)",
        cash2Help:"Pouze pro EV/EBITDA vƒõtev.",
        debt2Lbl:"Dluh (volitelnƒõ, pro EV‚ÜíEquity)",
        debt2Help:"Pouze pro EV/EBITDA vƒõtev.",
        shares2Lbl:"Poƒçet akci√≠",
        shares2Help:"Nutn√© pro v√Ωpoƒçet na 1 akcii.",
        price3Lbl:"Aktu√°ln√≠ cena (voliteln√©)",
        price3Help:"Pro v√Ωpoƒçet potenci√°lu.",

        calc:"Spoƒç√≠tat",
        reset:"Reset",
        save:"Ulo≈æit v√Ωsledek",
        noteSmall:"Tip: R≈Østov√© firmy ‚Üí DCF. Dividendov√© firmy ‚Üí DDM. Rychl√° kontrola ‚Üí N√°sobky.",

        resultsTitle:"V√Ωsledky",
        fairValue:"F√©rov√° hodnota",
        margin:"Margin of Safety",
        detail:"Detaily",
        sanity:"Kontroly",

        watchTitle:"Watchlist",
        watchSub:"Ulo≈æen√© v√Ωpoƒçty. Ukl√°d√° se do localStorage (tento prohl√≠≈æeƒç).",
        clearAll:"Smazat v≈°e",
        watchTable:"Ulo≈æen√© polo≈æky",
        w_company:"Firma",
        w_model:"Model",
        w_fv:"F√©rov√° hodnota",
        w_price:"Cena",
        w_upside:"Potenci√°l",
        w_date:"Ulo≈æeno",
        w_actions:"Akce",
        emptyWatch:"Zat√≠m nem√°≈° nic ulo≈æen√©.",
        watchNote:"Watchlist je lok√°ln√≠. Kdy≈æ vyma≈æe≈° data prohl√≠≈æeƒçe nebo zmƒõn√≠≈° za≈ô√≠zen√≠, polo≈æky zmiz√≠.",

        aboutTitle:"O aplikaci & upozornƒõn√≠",
        aboutSub:"N√°stroj je v√Ωukov√Ω. V≈ædy dƒõlej vlastn√≠ research.",
        aboutH:"Co tahle appka je",
        aboutP:"Equity Analyzer pom√°h√° odhadnout f√©rovou hodnotu pomoc√≠ bƒõ≈æn√Ωch model≈Ø (DCF, DDM, N√°sobky). Vstupy jsou schv√°lnƒõ vysvƒõtlen√©, aby ses uƒçil, co zad√°v√°≈°.",
        disclaimerH:"Upozornƒõn√≠ (d≈Øle≈æit√©)",
        disclaimerP:"Tohle NEN√ç finanƒçn√≠ doporuƒçen√≠. V√Ωsledky z√°vis√≠ na p≈ôedpokladech. Trh m≈Ø≈æe b√Ωt iracion√°ln√≠. Ber to jako pom≈Øcku na uƒçen√≠.",
        forWhoH:"Pro koho je to vhodn√©",
        forWhoP:"Pro investory, kte≈ô√≠ chtƒõj√≠ tr√©novat uva≈æov√°n√≠ o hodnotƒõ, porovn√°vat sc√©n√°≈ôe a ukl√°dat si pozn√°mky. Nejl√©pe s re√°ln√Ωmi fundamenty.",
        howToH:"Jak to pou≈æ√≠vat",
        howToP:"Vyber model, vypl≈à vstupy, spoƒç√≠tej a ulo≈æ do Watchlistu. Zkou≈°ej konzervativn√≠ p≈ôedpoklady a porovn√°vej v√Ωsledky.",

        toastSaved:"Ulo≈æeno do Watchlistu.",
        toastDeleted:"Smaz√°no.",
        toastCleared:"Watchlist vymaz√°n.",
        toastNeedCalc:"Nejd≈ô√≠v nƒõco spoƒç√≠tej, pak ukl√°dej.",
        toastInvalid:"Nƒõkter√© vstupy jsou ≈°patnƒõ. Zkontroluj sazby a povinn√° pole.",

        modelBadge:"MODEL",
      }
    };

    let LANG = "en";
    const LS_KEY = "equity_analyzer_watchlist_v1";

    // ========= Helpers =========
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    function fmtNumber(n){
      if(!isFinite(n)) return "‚Äî";
      return n.toLocaleString(undefined, { maximumFractionDigits: 2 });
    }
    function fmtMoney(n, cur){
      if(!isFinite(n)) return "‚Äî";
      try{
        return new Intl.NumberFormat(undefined,{style:"currency", currency:cur, maximumFractionDigits: 2}).format(n);
      }catch{
        return `${fmtNumber(n)} ${cur}`;
      }
    }
    function toNum(v){
      if(v === null || v === undefined) return NaN;
      const s = String(v).trim().replace(/\s+/g,"").replace(",",".");
      if(s === "") return NaN;
      const x = Number(s);
      return isFinite(x) ? x : NaN;
    }

    function toast(msg){
      const el = $("#toast");
      el.textContent = msg;
      el.style.display = "block";
      clearTimeout(toast._t);
      toast._t = setTimeout(()=>{ el.style.display="none"; }, 2400);
    }

    function setText(id, txt){ const el = document.getElementById(id); if(el) el.textContent = txt; }

    function applyI18n(){
      const t = I18N[LANG];

      setText("t_appTitle", t.appTitle);
      setText("t_appSubtitle", t.appSubtitle);
      setText("t_lang", t.lang);
      setText("t_help", t.help);
      setText("t_quickSave", t.quickSave);

      setText("t_tab1", t.tab1);
      setText("t_tab1sub", t.tab1sub);
      setText("t_tab2", t.tab2);
      setText("t_tab2sub", t.tab2sub);
      setText("t_tab3", t.tab3);
      setText("t_tab3sub", t.tab3sub);

      setText("t_panel1title", t.panel1title);
      setText("t_panel1subtitle", t.panel1subtitle);

      setText("t_company", t.company);
      setText("t_tickerLbl", t.tickerLbl);
      setText("t_currencyLbl", t.currencyLbl);
      setText("t_storage", t.storage);
      setText("t_edu", t.edu);
      setText("t_modelLbl", t.modelLbl);

      setText("t_dcfTitle", t.dcfTitle);
      setText("t_fcfLbl", t.fcfLbl);
      setText("t_fcfHelp", t.fcfHelp);
      setText("t_growthLbl", t.growthLbl);
      setText("t_growthHelp", t.growthHelp);
      setText("t_growth2Lbl", t.growth2Lbl);
      setText("t_growth2Help", t.growth2Help);
      setText("t_discountLbl", t.discountLbl);
      setText("t_discountHelp", t.discountHelp);
      setText("t_terminalLbl", t.terminalLbl);
      setText("t_terminalHelp", t.terminalHelp);
      setText("t_cashLbl", t.cashLbl);
      setText("t_cashHelp", t.cashHelp);
      setText("t_debtLbl", t.debtLbl);
      setText("t_debtHelp", t.debtHelp);
      setText("t_sharesLbl", t.sharesLbl);
      setText("t_sharesHelp", t.sharesHelp);
      setText("t_priceLbl", t.priceLbl);
      setText("t_priceHelp", t.priceHelp);

      setText("t_ddmTitle", t.ddmTitle);
      setText("t_divLbl", t.divLbl);
      setText("t_divHelp", t.divHelp);
      setText("t_divGrowLbl", t.divGrowLbl);
      setText("t_divGrowHelp", t.divGrowHelp);
      setText("t_reqLbl", t.reqLbl);
      setText("t_reqHelp", t.reqHelp);
      setText("t_price2Lbl", t.price2Lbl);
      setText("t_price2Help", t.price2Help);

      setText("t_multTitle", t.multTitle);
      setText("t_epsLbl", t.epsLbl);
      setText("t_epsHelp", t.epsHelp);
      setText("t_peLbl", t.peLbl);
      setText("t_peHelp", t.peHelp);
      setText("t_eBitdaLbl", t.eBitdaLbl);
      setText("t_eBitdaHelp", t.eBitdaHelp);
      setText("t_evEbitdaLbl", t.evEbitdaLbl);
      setText("t_evEbitdaHelp", t.evEbitdaHelp);
      setText("t_cash2Lbl", t.cash2Lbl);
      setText("t_cash2Help", t.cash2Help);
      setText("t_debt2Lbl", t.debt2Lbl);
      setText("t_debt2Help", t.debt2Help);
      setText("t_shares2Lbl", t.shares2Lbl);
      setText("t_shares2Help", t.shares2Help);
      setText("t_price3Lbl", t.price3Lbl);
      setText("t_price3Help", t.price3Help);

      setText("t_calc", t.calc);
      setText("t_reset", t.reset);
      setText("t_save", t.save);
      setText("t_noteSmall", t.noteSmall);

      setText("t_resultsTitle", t.resultsTitle);
      setText("t_fairValue", t.fairValue);
      setText("t_margin", t.margin);
      setText("t_detail", t.detail);
      setText("t_sanity", t.sanity);

      setText("t_watchTitle", t.watchTitle);
      setText("t_watchSub", t.watchSub);
      setText("t_clearAll", t.clearAll);
      setText("t_watchTable", t.watchTable);
      setText("t_w_company", t.w_company);
      setText("t_w_model", t.w_model);
      setText("t_w_fv", t.w_fv);
      setText("t_w_price", t.w_price);
      setText("t_w_upside", t.w_upside);
      setText("t_w_date", t.w_date);
      setText("t_w_actions", t.w_actions);
      setText("t_emptyWatch", t.emptyWatch);
      setText("t_watchNote", t.watchNote);

      setText("t_aboutTitle", t.aboutTitle);
      setText("t_aboutSub", t.aboutSub);
      setText("t_aboutH", t.aboutH);
      setText("t_aboutP", t.aboutP);
      setText("t_disclaimerH", t.disclaimerH);
      setText("t_disclaimerP", t.disclaimerP);
      setText("t_forWhoH", t.forWhoH);
      setText("t_forWhoP", t.forWhoP);
      setText("t_howToH", t.howToH);
      setText("t_howToP", t.howToP);

      // Update badge label
      updateModelBadge();
    }

    function updateCurrencyUnits(){
      const cur = $("#currency").value;
      $("#u_fcf").textContent = `${cur} / year`;
      $("#u_cash").textContent = cur;
      $("#u_debt").textContent = cur;
      $("#u_price").textContent = `${cur} / share`;

      $("#u_d1").textContent = `${cur} / share`;
      $("#u_price2").textContent = `${cur} / share`;

      $("#u_eps").textContent = `${cur} / share`;
      $("#u_ebitda").textContent = cur;
      $("#u_cash2").textContent = cur;
      $("#u_debt2").textContent = cur;
      $("#u_price3").textContent = `${cur} / share`;
    }

    function updateModelBadge(){
      const t = I18N[LANG];
      const m = $("#model").value;
      $("#badgeModel").textContent = `${t.modelBadge}: ${m}`;
    }

    // We'll keep last calculation here to enable "Quick Save"
    let LAST = null;

    // ========= Modal / Help text =========
    const HINTS = {
      company: {
        en: {
          title:"Company fields",
          body:`<ul>
            <li><b>Ticker/Name</b> is just for your records.</li>
            <li><b>Currency</b> is used only for formatting numbers.</li>
            <li>All saved items live <b>only in your browser</b> (localStorage).</li>
          </ul>`
        },
        cs: {
          title:"Pole pro firmu",
          body:`<ul>
            <li><b>Ticker/N√°zev</b> je jen pro tvoje pozn√°mky.</li>
            <li><b>Mƒõna</b> je pouze pro form√°tov√°n√≠.</li>
            <li>Ukl√°d√°n√≠ je <b>jen v prohl√≠≈æeƒçi</b> (localStorage).</li>
          </ul>`
        }
      },
      dcf: {
        en: {
          title:"DCF (Free Cash Flow) explained",
          body:`<ul>
            <li>DCF discounts future cash flows back to today.</li>
            <li><b>Discount rate</b> reflects risk (your required return).</li>
            <li><b>Terminal growth</b> should be conservative (often ~2‚Äì3%).</li>
            <li><b>Cash</b> adds value; <b>Debt</b> reduces value.</li>
          </ul>`
        },
        cs: {
          title:"DCF (Free Cash Flow) vysvƒõtlen√≠",
          body:`<ul>
            <li>DCF diskontuje budouc√≠ cash flow na dne≈°n√≠ hodnotu.</li>
            <li><b>Diskontn√≠ sazba</b> = riziko / po≈æadovan√Ω v√Ωnos.</li>
            <li><b>Termin√°ln√≠ r≈Øst</b> m√° b√Ωt konzervativn√≠ (ƒçasto ~2‚Äì3%).</li>
            <li><b>Cash</b> p≈ôiƒç√≠t√° hodnotu; <b>Debt</b> ji sni≈æuje.</li>
          </ul>`
        }
      },
      ddm: {
        en: {
          title:"DDM explained",
          body:`<ul>
            <li>Works best for stable dividend payers.</li>
            <li>Requires <b>required return</b> to be greater than <b>dividend growth</b>.</li>
            <li>Very sensitive to small changes in rates.</li>
          </ul>`
        },
        cs: {
          title:"DDM vysvƒõtlen√≠",
          body:`<ul>
            <li>Nejl√©pe pro stabiln√≠ dividendov√© firmy.</li>
            <li><b>Po≈æadovan√Ω v√Ωnos</b> mus√≠ b√Ωt vy≈°≈°√≠ ne≈æ <b>r≈Øst dividend</b>.</li>
            <li>Hodnƒõ citliv√© na mal√© zmƒõny sazeb.</li>
          </ul>`
        }
      },
      mult: {
        en: {
          title:"Multiples explained",
          body:`<ul>
            <li>Fast ‚Äúsanity check‚Äù valuation approach.</li>
            <li><b>P/E</b> uses EPS √ó target multiple.</li>
            <li><b>EV/EBITDA</b> estimates enterprise value; then adjusts to equity using cash & debt.</li>
          </ul>`
        },
        cs: {
          title:"N√°sobky vysvƒõtlen√≠",
          body:`<ul>
            <li>Rychl√° kontrola ocenƒõn√≠ (‚Äúsanity check‚Äù).</li>
            <li><b>P/E</b> = EPS √ó c√≠lov√Ω n√°sobek.</li>
            <li><b>EV/EBITDA</b> d√° enterprise value; pak p≈ôepoƒçet na equity p≈ôes cash & debt.</li>
          </ul>`
        }
      },
      results: {
        en: {
          title:"How to read results",
          body:`<ul>
            <li><b>Fair Value</b> is the model's estimate per share.</li>
            <li><b>Margin of Safety</b> compares fair value vs current price (if provided).</li>
            <li>Try multiple scenarios: conservative, base, optimistic.</li>
          </ul>`
        },
        cs: {
          title:"Jak ƒç√≠st v√Ωsledky",
          body:`<ul>
            <li><b>F√©rov√° hodnota</b> je odhad na akcii podle modelu.</li>
            <li><b>Margin of Safety</b> porovn√°v√° f√©rovku s aktu√°ln√≠ cenou (pokud je zadan√°).</li>
            <li>Zkou≈°ej sc√©n√°≈ôe: konzervativn√≠, z√°kladn√≠, optimistick√Ω.</li>
          </ul>`
        }
      },
      watch: {
        en: {
          title:"Watchlist storage",
          body:`<ul>
            <li>Stored using <b>localStorage</b>.</li>
            <li>Clearing browser data wipes it.</li>
            <li>Use it as a notebook of your assumptions.</li>
          </ul>`
        },
        cs: {
          title:"Ukl√°d√°n√≠ Watchlistu",
          body:`<ul>
            <li>Ukl√°d√° se do <b>localStorage</b>.</li>
            <li>Vymaz√°n√≠ dat prohl√≠≈æeƒçe to sma≈æe.</li>
            <li>Ber to jako pozn√°mkov√Ω blok pro p≈ôedpoklady.</li>
          </ul>`
        }
      }
    };

    function openModal(title, html){
      $("#modalTitle").textContent = title;
      $("#modalBody").innerHTML = html;
      $("#modalOverlay").style.display = "flex";
      $("#modalOverlay").setAttribute("aria-hidden","false");
    }
    function closeModal(){
      $("#modalOverlay").style.display = "none";
      $("#modalOverlay").setAttribute("aria-hidden","true");
    }

    // ========= Tabs =========
    function showTab(name){
      // tabs
      $("#tabValuation").classList.toggle("active", name==="val");
      $("#tabWatch").classList.toggle("active", name==="watch");
      $("#tabAbout").classList.toggle("active", name==="about");

      // panels
      $("#panelValuation").style.display = (name==="val") ? "" : "none";
      $("#panelWatch").style.display = (name==="watch") ? "" : "none";
      $("#panelAbout").style.display = (name==="about") ? "" : "none";

      if(name==="watch") renderWatch();
    }// ========= Calculations =========
    function calcDCF(){
      const cur = $("#currency").value;

      const fcf = toNum($("#fcf").value);
      const g1 = toNum($("#g1").value) / 100;
      const g2 = toNum($("#g2").value) / 100;
      const dr = toNum($("#dr").value) / 100;
      const tg = toNum($("#tg").value) / 100;
      const cash = toNum($("#cash").value) || 0;
      const debt = toNum($("#debt").value) || 0;
      const shares = toNum($("#shares").value);
      const price = toNum($("#price").value);

      // Validation
      if(!(isFinite(fcf) && fcf>0 && isFinite(g1) && isFinite(g2) && isFinite(dr) && dr>0 && isFinite(tg) && isFinite(shares) && shares>0)) return { ok:false };
      if(tg >= dr) return { ok:false, reason:"tg>=dr" };

      // Project years 1-10
      const years = [];
      let f = fcf;
      for(let y=1;y<=10;y++){
        const gr = (y<=5) ? g1 : g2;
        f = f * (1 + gr);
        const pv = f / Math.pow(1+dr, y);
        years.push({ y, fcf:f, pv });
      }

      const fcf10 = years[9].fcf;
      const terminalValue = (fcf10 * (1 + tg)) / (dr - tg);
      const pvTerminal = terminalValue / Math.pow(1+dr, 10);

      const pvSum = years.reduce((a,b)=>a+b.pv,0);
      const enterprise = pvSum + pvTerminal;
      const equity = enterprise + cash - debt;
      const fv = equity / shares;

      let upside = NaN;
      if(isFinite(price) && price>0) upside = (fv/price - 1);

      // sanity notes
      const sanity = [];
      sanity.push(`PV(Years 1‚Äì10): ${fmtMoney(pvSum, cur)}`);
      sanity.push(`PV(Terminal): ${fmtMoney(pvTerminal, cur)}`);
      sanity.push(`Terminal share of EV: ${isFinite(enterprise) && enterprise>0 ? fmtNumber(pvTerminal/enterprise*100) : "‚Äî"}%`);
      sanity.push(`Equity = EV + Cash ‚àí Debt`);

      return {
        ok:true,
        model:"DCF",
        currency:cur,
        fairValue:fv,
        price: isFinite(price) ? price : null,
        upside,
        detail:{
          pv10: pvSum,
          pvTerminal,
          enterprise,
          equity,
          terminalValue
        },
        sanity
      };
    }

    function calcDDM(){
      const cur = $("#currency").value;

      const d1 = toNum($("#d1").value);
      const dg = toNum($("#dg").value) / 100;
      const rr = toNum($("#rr").value) / 100;
      const price = toNum($("#price2").value);

      if(!(isFinite(d1) && d1>0 && isFinite(dg) && isFinite(rr) && rr>0)) return { ok:false };
      if(dg >= rr) return { ok:false, reason:"dg>=rr" };

      const fv = d1 / (rr - dg);

      let upside = NaN;
      if(isFinite(price) && price>0) upside = (fv/price - 1);

      const sanity = [];
      sanity.push(`Fair Value = D1 / (r ‚àí g)`);
      sanity.push(`Small changes in r or g can shift the result a lot.`);
      sanity.push(`Rule: r must be > g.`);

      return {
        ok:true,
        model:"DDM",
        currency:cur,
        fairValue:fv,
        price: isFinite(price) ? price : null,
        upside,
        detail:{ d1, dg, rr },
        sanity
      };
    }

    function calcMULT(){
      const cur = $("#currency").value;

      const eps = toNum($("#eps").value);
      const pe = toNum($("#pe").value);
      const ebitda = toNum($("#ebitda").value);
      const evebitda = toNum($("#evebitda").value);
      const cash = toNum($("#cash2").value) || 0;
      const debt = toNum($("#debt2").value) || 0;
      const shares = toNum($("#shares2").value);
      const price = toNum($("#price3").value);

      if(!(isFinite(shares) && shares>0)) return { ok:false };

      // Path A: EPS * PE
      let fvPE = NaN;
      if(isFinite(eps) && eps>0 && isFinite(pe) && pe>0){
        fvPE = eps * pe;
      }

      // Path B: EV/EBITDA -> equity -> per share
      let fvEV = NaN;
      if(isFinite(ebitda) && ebitda>0 && isFinite(evebitda) && evebitda>0){
        const ev = ebitda * evebitda;
        const equity = ev + cash - debt;
        fvEV = equity / shares;
      }

      if(!isFinite(fvPE) && !isFinite(fvEV)) return { ok:false };

      // Combine if both exist (simple average)
      let fv = isFinite(fvPE) && isFinite(fvEV) ? (fvPE + fvEV)/2 : (isFinite(fvPE) ? fvPE : fvEV);

      let upside = NaN;
      if(isFinite(price) && price>0) upside = (fv/price - 1);

      const sanity = [];
      if(isFinite(fvPE)) sanity.push(`P/E path: FV = EPS √ó P/E = ${fmtMoney(fvPE, cur)}`);
      if(isFinite(fvEV)) sanity.push(`EV/EBITDA path: EV = EBITDA √ó multiple ‚Üí Equity ‚Üí / Shares = ${fmtMoney(fvEV, cur)}`);
      if(isFinite(fvPE) && isFinite(fvEV)) sanity.push(`Combined FV = average of both paths.`);

      return {
        ok:true,
        model:"MULT",
        currency:cur,
        fairValue:fv,
        price: isFinite(price) ? price : null,
        upside,
        detail:{ fvPE, fvEV },
        sanity
      };
    }

    function calcAll(){
      const m = $("#model").value;
      if(m==="DCF") return calcDCF();
      if(m==="DDM") return calcDDM();
      return calcMULT();
    }

    function renderResult(res){
      const t = I18N[LANG];
      if(!res.ok){
        $("#outFair").textContent = "‚Äî";
        $("#outFairSub").textContent = "‚Äî";
        $("#outMOS").textContent = "‚Äî";
        $("#outMOSSub").textContent = "‚Äî";
        $("#outDetail").textContent = t.toastInvalid;
        $("#outSanity").textContent = "‚Äî";
        return;
      }

      const cur = res.currency;
      $("#outFair").textContent = fmtMoney(res.fairValue, cur);

      const modelName = res.model === "MULT" ? "Multiples" : res.model;
      $("#outFairSub").textContent = `Model: ${modelName}`;

      if(res.price && isFinite(res.upside)){
        const pct = res.upside * 100;
        const mos = (res.price / res.fairValue - 1) * 100; // negative if undervalued
        const upsideText = `${pct>=0?"+":""}${fmtNumber(pct)}%`;
        const mosText = `${mos<=0?"+":""}${fmtNumber(-mos)}%`;

        $("#outMOS").textContent = mosText;
        $("#outMOSSub").textContent = (LANG==="en")
          ? `vs price ${fmtMoney(res.price, cur)} (higher is better)`
          : `vs cena ${fmtMoney(res.price, cur)} (vy≈°≈°√≠ = lep≈°√≠)`;

        // Details
        $("#outDetail").innerHTML =
          (LANG==="en")
          ? `Fair value ${fmtMoney(res.fairValue, cur)} vs price ${fmtMoney(res.price, cur)} ‚Üí upside: <b>${upsideText}</b>`
          : `F√©rovka ${fmtMoney(res.fairValue, cur)} vs cena ${fmtMoney(res.price, cur)} ‚Üí potenci√°l: <b>${upsideText}</b>`;

        // Badge style MOS
        const mosBadge = $("#outMOS").closest(".card");
        // do nothing, but we can style by changing MOS badge class via outMOS content:
      }else{
        $("#outMOS").textContent = "‚Äî";
        $("#outMOSSub").textContent = (LANG==="en")
          ? "Enter current price to compute margin of safety."
          : "Zadej aktu√°ln√≠ cenu pro v√Ωpoƒçet margin of safety.";
        $("#outDetail").textContent = (LANG==="en")
          ? "Fair value computed. Add current price to show upside / margin of safety."
          : "F√©rov√° hodnota spoƒç√≠tan√°. P≈ôidej aktu√°ln√≠ cenu pro potenci√°l / MOS.";
      }

      $("#outSanity").innerHTML = res.sanity.map(x=>`‚Ä¢ ${x}`).join("<br/>");
    }

    // ========= Watchlist =========
    function loadWatch(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr : [];
      }catch{
        return [];
      }
    }
    function saveWatch(arr){
      localStorage.setItem(LS_KEY, JSON.stringify(arr));
    }

    function makeItemFromLast(){
      if(!LAST || !LAST.ok) return null;
      const cur = $("#currency").value;
      const name = ($("#ticker").value || "").trim() || "‚Äî";
      const now = new Date();
      const price = LAST.price ?? null;

      return {
        id: crypto?.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random().toString(16).slice(2),
        name,
        model: LAST.model,
        currency: LAST.currency || cur,
        fairValue: LAST.fairValue,
        price,
        upside: (price && isFinite(price) && isFinite(LAST.fairValue) && LAST.fairValue>0) ? (LAST.fairValue/price - 1) : null,
        createdAt: now.toISOString(),
        inputs: snapshotInputs()
      };
    }

    function snapshotInputs(){
      // Save relevant fields by model to help "load back"
      const m = $("#model").value;
      const common = {
        ticker: $("#ticker").value,
        currency: $("#currency").value,
        model: m
      };
      if(m==="DCF"){
        return {
          ...common,
          fcf: $("#fcf").value, g1: $("#g1").value, g2: $("#g2").value, dr: $("#dr").value, tg: $("#tg").value,
          cash: $("#cash").value, debt: $("#debt").value, shares: $("#shares").value, price: $("#price").value
        };
      }
      if(m==="DDM"){
        return {
          ...common,
          d1: $("#d1").value, dg: $("#dg").value, rr: $("#rr").value, price2: $("#price2").value
        };
      }
      return {
        ...common,
        eps: $("#eps").value, pe: $("#pe").value, ebitda: $("#ebitda").value, evebitda: $("#evebitda").value,
        cash2: $("#cash2").value, debt2: $("#debt2").value, shares2: $("#shares2").value, price3: $("#price3").value
      };
    }

    function loadInputs(inputs){
      if(!inputs) return;
      $("#ticker").value = inputs.ticker ?? "";
      $("#currency").value = inputs.currency ?? "USD";
      $("#model").value = inputs.model ?? "DCF";
      updateCurrencyUnits();
      updateModelBadge();
      toggleModelBlocks();

      if(inputs.model==="DCF"){
        $("#fcf").value = inputs.fcf ?? "";
        $("#g1").value = inputs.g1 ?? "";
        $("#g2").value = inputs.g2 ?? "";
        $("#dr").value = inputs.dr ?? "9";
        $("#tg").value = inputs.tg ?? "2.5";
        $("#cash").value = inputs.cash ?? "";
        $("#debt").value = inputs.debt ?? "";
        $("#shares").value = inputs.shares ?? "";
        $("#price").value = inputs.price ?? "";
      }else if(inputs.model==="DDM"){
        $("#d1").value = inputs.d1 ?? "";
        $("#dg").value = inputs.dg ?? "";
        $("#rr").value = inputs.rr ?? "9";
        $("#price2").value = inputs.price2 ?? "";
      }else{
        $("#eps").value = inputs.eps ?? "";
        $("#pe").value = inputs.pe ?? "";
        $("#ebitda").value = inputs.ebitda ?? "";
        $("#evebitda").value = inputs.evebitda ?? "";
        $("#cash2").value = inputs.cash2 ?? "";
        $("#debt2").value = inputs.debt2 ?? "";
        $("#shares2").value = inputs.shares2 ?? "";
        $("#price3").value = inputs.price3 ?? "";
      }
      // Recalculate after load
      const res = calcAll();
      LAST = res.ok ? res : null;
      renderResult(res);
      showTab("val");
      toast("Loaded inputs.");
    }

    function renderWatch(){
      const t = I18N[LANG];
      const arr = loadWatch();
      const body = $("#watchBody");
      body.innerHTML = "";

      if(arr.length === 0){
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 7;
        td.className = "muted";
        td.id = "t_emptyWatch";
        td.textContent = t.emptyWatch;
        tr.appendChild(td);
        body.appendChild(tr);
        return;
      }

      // newest first
      const sorted = [...arr].sort((a,b)=> (b.createdAt||"").localeCompare(a.createdAt||""));
      for(const it of sorted){
        const tr = document.createElement("tr");

        const tdName = document.createElement("td");
        tdName.innerHTML = `<b>${escapeHtml(it.name || "‚Äî")}</b><div class="muted2 mono" style="margin-top:3px">${escapeHtml(it.id.slice(0,8))}</div>`;
        tr.appendChild(tdName);

        const tdModel = document.createElement("td");
        tdModel.innerHTML = `<span class="tag">${escapeHtml(it.model)}</span>`;
        tr.appendChild(tdModel);

        const tdFV = document.createElement("td");
        tdFV.className = "mono";
        tdFV.textContent = fmtMoney(it.fairValue, it.currency || "USD");
        tr.appendChild(tdFV);

        const tdPrice = document.createElement("td");
        tdPrice.className = "mono";
        tdPrice.textContent = (it.price && isFinite(it.price)) ? fmtMoney(it.price, it.currency || "USD") : "‚Äî";
        tr.appendChild(tdPrice);

        const tdUp = document.createElement("td");
        tdUp.className = "mono";
        if(it.price && isFinite(it.price) && isFinite(it.fairValue) && it.fairValue>0){
          const up = (it.fairValue/it.price - 1) * 100;
          tdUp.textContent = `${up>=0?"+":""}${fmtNumber(up)}%`;
        }else tdUp.textContent = "‚Äî";
        tr.appendChild(tdUp);

        const tdDate = document.createElement("td");
        tdDate.textContent = formatDate(it.createdAt);
        tr.appendChild(tdDate);

        const tdAct = document.createElement("td");
        tdAct.innerHTML = `
          <button class="btn" type="button" data-act="load" data-id="${escapeAttr(it.id)}" style="padding:8px 10px;border-radius:12px">Load</button>
          <button class="btn danger" type="button" data-act="del" data-id="${escapeAttr(it.id)}" style="padding:8px 10px;border-radius:12px;margin-left:6px">Delete</button>
        `;
        tr.appendChild(tdAct);

        body.appendChild(tr);
      }

      // bind actions
      $$("#watchBody button").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-id");
          const act = btn.getAttribute("data-act");
          if(act==="del") deleteWatch(id);
          if(act==="load") loadWatchItem(id);
        });
      });
    }

    function deleteWatch(id){
      const t = I18N[LANG];
      const arr = loadWatch().filter(x=>x.id!==id);
      saveWatch(arr);
      renderWatch();
      toast(t.toastDeleted);
    }

    function loadWatchItem(id){
      const arr = loadWatch();
      const it = arr.find(x=>x.id===id);
      if(!it) return;
      loadInputs(it.inputs);
    }

    function clearWatch(){
      const t = I18N[LANG];
      saveWatch([]);
      renderWatch();
      toast(t.toastCleared);
    }

    function addToWatch(){
      const t = I18N[LANG];
      if(!LAST || !LAST.ok){
        toast(t.toastNeedCalc);
        return;
      }
      const item = makeItemFromLast();
      if(!item){
        toast(t.toastNeedCalc);
        return;
      }
      const arr = loadWatch();
      arr.push(item);
      saveWatch(arr);
      renderWatch();
      toast(t.toastSaved);
    }

    // ========= UI: Model blocks =========
    function toggleModelBlocks(){
      const m = $("#model").value;
      $("#blockDCF").style.display = (m==="DCF") ? "" : "none";
      $("#blockDDM").style.display = (m==="DDM") ? "" : "none";
      $("#blockMULT").style.display = (m==="MULT") ? "" : "none";
      updateModelBadge();
    }

    // ========= Reset =========
    function resetAll(){
      // common
      $("#ticker").value = "";
      $("#currency").value = "USD";
      $("#model").value = "DCF";

      // DCF
      $("#fcf").value = "";
      $("#g1").value = "";
      $("#g2").value = "";
      $("#dr").value = "9";
      $("#tg").value = "2.5";
      $("#cash").value = "";
      $("#debt").value = "";
      $("#shares").value = "";
      $("#price").value = "";

      // DDM
      $("#d1").value = "";
      $("#dg").value = "";
      $("#rr").value = "9";
      $("#price2").value = "";

      // MULT
      $("#eps").value = "";
      $("#pe").value = "";
      $("#ebitda").value = "";
      $("#evebitda").value = "";
      $("#cash2").value = "";
      $("#debt2").value = "";
      $("#shares2").value = "";
      $("#price3").value = "";

      LAST = null;
      toggleModelBlocks();
      updateCurrencyUnits();
      renderResult({ok:false});
    }

    // ========= Formatting / safety helpers =========
    function formatDate(iso){
      if(!iso) return "‚Äî";
      const d = new Date(iso);
      if(isNaN(d.getTime())) return "‚Äî";
      return d.toLocaleString(undefined, { year:"numeric", month:"2-digit", day:"2-digit", hour:"2-digit", minute:"2-digit" });
    }
    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, (c)=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[c]));
    }
    function escapeAttr(s){
      return escapeHtml(s).replace(/"/g,"&quot;");
    }

    // ========= Bind events =========
    function bind(){
      // language
      $("#langEN").addEventListener("click", ()=>{
        LANG="en";
        $("#langEN").classList.add("active");
        $("#langCS").classList.remove("active");
        applyI18n();
        renderWatch();
      });
      $("#langCS").addEventListener("click", ()=>{
        LANG="cs";
        $("#langCS").classList.add("active");
        $("#langEN").classList.remove("active");
        applyI18n();
        renderWatch();
      });

      // tabs
      $("#tabValuation").addEventListener("click", ()=>showTab("val"));
      $("#tabWatch").addEventListener("click", ()=>showTab("watch"));
      $("#tabAbout").addEventListener("click", ()=>showTab("about"));

      // model / currency
      $("#model").addEventListener("change", ()=>{
        toggleModelBlocks();
      });
      $("#currency").addEventListener("change", updateCurrencyUnits);

      // calculate
      $("#btnCalculate").addEventListener("click", ()=>{
        const res = calcAll();
        if(!res.ok){
          toast(I18N[LANG].toastInvalid);
          renderResult(res);
          LAST = null;
          return;
        }
        LAST = res;
        renderResult(res);
      });

      // reset
      $("#btnReset").addEventListener("click", resetAll);

      // save
      $("#btnSave").addEventListener("click", addToWatch);
      $("#btnQuickSave").addEventListener("click", addToWatch);

      // clear watchlist
      $("#btnClearWatch").addEventListener("click", clearWatch);

      // modal
      $("#modalClose").addEventListener("click", closeModal);
      $("#modalOverlay").addEventListener("click", (e)=>{
        if(e.target === $("#modalOverlay")) closeModal();
      });

      // hint icons
      $$(".hint").forEach(h=>{
        h.addEventListener("click", ()=>{
          const key = h.getAttribute("data-hint");
          const pack = HINTS[key]?.[LANG];
          if(!pack) return;
          openModal(pack.title, pack.body);
        });
      });

      // help button
      $("#btnHelp").addEventListener("click", ()=>{
        const t = I18N[LANG];
        const title = (LANG==="en") ? "How Equity Analyzer works" : "Jak funguje Equity Analyzer";
        const body = (LANG==="en")
          ? `<ul>
              <li><b>Choose a model</b> that fits the business type.</li>
              <li><b>Enter assumptions</b> (growth, discount rate, etc.). The tool explains each input.</li>
              <li><b>Calculate</b> ‚Üí you get an estimated fair value per share.</li>
              <li><b>Save</b> results to Watchlist to track your thesis.</li>
              <li><b>Disclaimer:</b> Education only, not financial advice.</li>
            </ul>`
          : `<ul>
              <li><b>Vyber model</b> podle typu firmy.</li>
              <li><b>Zadej p≈ôedpoklady</b> (r≈Øst, diskont, atd.). N√°stroj vysvƒõtluje, co zad√°v√°≈°.</li>
              <li><b>Spoƒç√≠tej</b> ‚Üí dostane≈° odhad f√©rov√© ceny na akcii.</li>
              <li><b>Ulo≈æ</b> do Watchlistu a sleduj svoje sc√©n√°≈ôe.</li>
              <li><b>Upozornƒõn√≠:</b> V√Ωukov√Ω n√°stroj, ne finanƒçn√≠ doporuƒçen√≠.</li>
            </ul>`;
        openModal(title, body);
      });

      // nice: compute on Enter in any numeric field
      $$(".num").forEach(inp=>{
        inp.addEventListener("keydown", (e)=>{
          if(e.key === "Enter"){
            $("#btnCalculate").click();
          }
        });
      });
    }

    // ========= Init =========
    function init(){
      applyI18n();
      updateCurrencyUnits();
      toggleModelBlocks();
      renderResult({ok:false});
      renderWatch();
      bind();
    }

    init();
  </script>
</body>
</html>
  

  


  


    


      

   

  

    

          
    

    

    
    


    





    

    

  
        

    
    

  

  





