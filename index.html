<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Equity Analyzer ‚Äì DCF</title>
  <style>
    :root{
      --bg1:#070819;
      --bg2:#0a0c2a;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.14);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.55);
      --accent1:#7c5cff;
      --accent2:#3aa0ff;
      --danger:#ff4d6d;
      --ok:#2dd4bf;
      --warn:#fbbf24;
      --shadow: 0 16px 50px rgba(0,0,0,.45);
      --r: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(1100px 700px at 20% 10%, rgba(124,92,255,.22), transparent 55%),
        radial-gradient(900px 600px at 80% 15%, rgba(58,160,255,.18), transparent 55%),
        radial-gradient(900px 900px at 50% 110%, rgba(124,92,255,.18), transparent 55%),
        linear-gradient(180deg, var(--bg2), var(--bg1));
      min-height:100dvh;
      overflow-x:hidden;
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 14px 30px;
    }

    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      border-radius: calc(var(--r) + 8px);
      overflow:hidden;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    .topCard{
      padding: 18px 16px;
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
    }

    .brand{
      display:flex; gap:12px; align-items:flex-start;
      min-width: 240px;
    }

    .logo{
      width:46px; height:46px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(124,92,255,.85), rgba(58,160,255,.85));
      box-shadow: 0 10px 30px rgba(124,92,255,.18);
      display:grid; place-items:center;
      flex:0 0 auto;
    }
    .logoDot{
      width:18px;height:18px;border-radius:8px;
      background: rgba(255,255,255,.85);
      box-shadow: inset 0 0 0 3px rgba(0,0,0,.10);
    }

    h1{margin:0; font-size: 26px; letter-spacing: .2px}
    .sub{margin:6px 0 0; color:var(--muted); line-height:1.35}

    .pills{
      display:flex; flex-direction:column; gap:10px; align-items:flex-end;
    }
    .pillRow{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end}

    .seg{
      display:flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--stroke);
    }
    .segLabel{font-size:12px; color:var(--muted)}
    .segBtns{
      display:flex; gap:6px;
      background: rgba(0,0,0,.12);
      border:1px solid rgba(255,255,255,.08);
      padding:4px;
      border-radius: 999px;
    }
    .segBtns button{
      border:0;
      padding:7px 10px;
      border-radius: 999px;
      background: transparent;
      color: rgba(255,255,255,.78);
      font-weight: 700;
      letter-spacing:.2px;
      cursor:pointer;
    }
    .segBtns button.active{
      background: linear-gradient(135deg, rgba(124,92,255,.90), rgba(58,160,255,.75));
      color: #fff;
      box-shadow: 0 8px 22px rgba(124,92,255,.15);
    }

    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.88);
      font-weight: 700;
    }

    /* Home (3 drawers) */
    .home{
      margin-top: 14px;
      padding: 14px;
    }
    .drawerList{display:flex; flex-direction:column; gap:12px}

    .drawerBtn{
      width:100%;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding: 14px 14px;
      border-radius: var(--r);
      border:1px solid var(--stroke2);
      background:
        radial-gradient(600px 160px at 15% 50%, rgba(124,92,255,.18), transparent 55%),
        radial-gradient(600px 160px at 85% 50%, rgba(58,160,255,.12), transparent 55%),
        rgba(255,255,255,.04);
      box-shadow: 0 10px 30px rgba(0,0,0,.20);
      cursor:pointer;
      text-align:left;
    }
    .drawerLeft{display:flex; gap:12px; align-items:center}
    .ico{
      width:46px; height:46px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      display:grid; place-items:center;
      font-size: 22px;
    }
    .drawerTitle{font-size:18px; font-weight:900}
    .drawerSub{font-size:13px; color:var(--muted); margin-top:2px}
    .chev{opacity:.7; font-size:18px}

    /* Screens */
    .screen{
      display:none;
      margin-top: 14px;
      overflow:hidden;
    }
    .screen.active{display:block}

    .screenTop{
      padding: 14px 14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      border-bottom: 1px solid var(--stroke);
      background: rgba(255,255,255,.02);
    }
    .backBtn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color:#fff;
      font-weight:900;
      border-radius:999px;
      padding:10px 14px;
      cursor:pointer;
    }
    .screenTitle{
      font-weight: 950;
      letter-spacing:.2px;
      opacity:.95;
    }

    .content{
      padding: 14px;
    }
    .card{
      border-radius: var(--r);
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      box-shadow: 0 10px 30px rgba(0,0,0,.20);
      overflow:hidden;
    }
    .card + .card{margin-top:12px}

    .sectionTitle{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .sectionTitle h2{margin:0; font-size:16px}
    .hint{font-size:12px; color:var(--muted)}

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      padding: 12px 14px 14px;
    }

    .field{
      position:relative;
      padding: 12px 12px 10px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.10);
    }
    .fieldRow{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .label{font-size:12px; color:var(--muted); font-weight: 800}
    .helpBtn{
      width:28px;height:28px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.88);
      cursor:pointer;
      font-weight: 900;
    }
    input{
      margin-top: 8px;
      width:100%;
      border:0;
      outline:none;
      background: transparent;
      color:#fff;
      font-size:18px;
      font-weight:900;
      letter-spacing:.2px;
    }
    input::placeholder{color:rgba(255,255,255,.35); font-weight:700}
    .small{margin-top:6px; font-size:12px; color:var(--muted2)}

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      padding: 12px 14px 14px;
      border-top: 1px dashed rgba(255,255,255,.10);
    }
    .btn{
      border:0;
      padding: 12px 14px;
      border-radius: 999px;
      cursor:pointer;
      font-weight: 950;
      letter-spacing:.2px;
    }
    .btnPrimary{
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(58,160,255,.70));
      color:#fff;
      box-shadow: 0 14px 32px rgba(124,92,255,.18);
    }
    .btnGhost{
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.90);
    }
    .btnDanger{
      background: rgba(255,77,109,.12);
      border:1px solid rgba(255,77,109,.35);
      color: #ffdbe2;
    }
    .btnMini{
      padding: 9px 10px;
      font-weight: 950;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color:#fff;
      cursor:pointer;
    }

    .results{
      padding: 12px 14px 14px;
    }
    .resultsGrid{
      display:grid;
      gap:12px;
    }
    .resCard{
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    .resTop{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      margin-bottom: 8px;
    }
    .chip{
      display:inline-flex; align-items:center;
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 12px;
      font-weight: 950;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.90);
    }
    .chip.ok{border-color: rgba(45,212,191,.35); background: rgba(45,212,191,.12); color: #d7fffa}
    .chip.warn{border-color: rgba(251,191,36,.38); background: rgba(251,191,36,.12); color: #fff4d2}
    .chip.bad{border-color: rgba(255,77,109,.40); background: rgba(255,77,109,.12); color: #ffdbe2}
    .big{
      font-size: 34px;
      font-weight: 1000;
      letter-spacing:.2px;
      margin-top: 4px;
    }
    .mutedLine{color:var(--muted); font-size: 13px; margin-top: 6px}
    .kv{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .kv span{color: var(--muted2); font-size: 12px}
    .kv b{color: rgba(255,255,255,.92)}

    /* Watchlist */
    .watchItem{
      padding: 14px;
      border-top: 1px solid rgba(255,255,255,.08);
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .watchLeft{min-width: 0}
    .watchTitle{font-weight: 1000; font-size: 16px}
    .watchSub{color: var(--muted); font-size: 12px; margin-top: 4px}
    .watchVals{
      display:flex; gap:10px; flex-wrap:wrap; margin-top: 8px;
      color: rgba(255,255,255,.92);
      font-weight: 900;
      font-size: 13px;
    }
    .watchBtns{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}

    /* Modal */
    .modalBack{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 50;
    }
    .modalBack.show{display:flex}
    .modal{
      width: min(720px, 100%);
      border-radius: calc(var(--r) + 8px);
      border:1px solid rgba(255,255,255,.14);
      background: rgba(20,22,55,.92);
      box-shadow: 0 22px 70px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modalTop{
      padding: 14px 14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .modalTop h3{margin:0; font-size: 15px}
    .xBtn{
      width:34px;height:34px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color:#fff;
      cursor:pointer;
      font-weight: 1000;
    }
    .modalBody{
      padding: 14px;
      color: rgba(255,255,255,.90);
      line-height: 1.55;
    }
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(20,22,55,.92);
      border:1px solid rgba(255,255,255,.14);
      padding: 12px 14px;
      border-radius: 999px;
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
      display:none;
      z-index: 60;
      font-weight: 900;
    }
    .toast.show{display:block}

    @media (min-width: 860px){
      .topCard{padding: 20px 20px}
      h1{font-size: 30px}
      .grid.two{grid-template-columns: 1fr 1fr}
      .resultsGrid{grid-template-columns: 1fr 1fr 1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Header / Controls -->
    <div class="glass topCard">
      <div class="brand">
        <div class="logo"><div class="logoDot"></div></div>
        <div>
          <div class="badge"><span data-i18n="beta">Anal√Ωza akci√≠ ‚Ä¢ Beta</span> <span style="opacity:.7">MVP</span></div>
          <h1 data-i18n="h1">Anal√Ωza akci√≠</h1>
          <div class="sub" data-i18n="sub">
            Appka pro investory: DCF odhad vnit≈ôn√≠ hodnoty (Bear/Base/Bull) + Watchlist ulo≈æen√Ωch v√Ωsledk≈Ø.
          </div>
        </div>
      </div>

      <div class="pills">
        <div class="pillRow">
          <div class="seg">
            <div class="segLabel" data-i18n="lang">Jazyk</div>
            <div class="segBtns" role="tablist" aria-label="Language">
              <button id="btnCZ" class="active" type="button">CZ</button>
              <button id="btnEN" type="button">EN</button>
            </div>
          </div>
          <div class="seg">
            <div class="segLabel" data-i18n="ccy">Mƒõna</div>
            <div class="segBtns" role="tablist" aria-label="Currency">
              <button id="btnUSD" class="active" type="button">USD</button>
              <button id="btnEUR" type="button">EUR</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- HOME: 3 drawers -->
    <div class="glass home" id="screenHome">
      <div class="drawerList">
        <button class="drawerBtn" type="button" id="goDCF">
          <div class="drawerLeft">
            <div class="ico">üìà</div>
            <div>
              <div class="drawerTitle" data-i18n="drawerDCF">DCF Anal√Ωza</div>
              <div class="drawerSub" data-i18n="drawerDCFSub">Vnit≈ôn√≠ hodnota ‚Ä¢ Bear / Base / Bull</div>
            </div>
          </div>
          <div class="chev">‚Ä∫</div>
        </button>

        <button class="drawerBtn" type="button" id="goWatch">
          <div class="drawerLeft">
            <div class="ico">üëÄ</div>
            <div>
              <div class="drawerTitle" data-i18n="drawerWatch">Watchlist</div>
              <div class="drawerSub" data-i18n="drawerWatchSub">Ulo≈æen√© anal√Ωzy ‚Ä¢ maz√°n√≠ po jedn√©</div>
            </div>
          </div>
          <div class="chev">‚Ä∫</div>
        </button>

        <button class="drawerBtn" type="button" id="goAbout">
          <div class="drawerLeft">
            <div class="ico">‚ÑπÔ∏è</div>
            <div>
              <div class="drawerTitle" data-i18n="drawerAbout">O aplikaci</div>
              <div class="drawerSub" data-i18n="drawerAboutSub">Pro koho je ‚Ä¢ jak funguje DCF ‚Ä¢ tipy</div>
            </div>
          </div>
          <div class="chev">‚Ä∫</div>
        </button>
      </div>
    </div>

    <!-- SCREEN: DCF -->
<section class="glass screen" id="screenDCF" aria-hidden="true">
  <div class="screenTop">
    <button class="backBtn" type="button" id="backFromDCF">‚Äπ <span data-i18n="back">Zpƒõt</span></button>
    <div class="screenTitle">DCF</div>
    <div style="width:88px"></div>
  </div>

  <div class="content">
    <div class="card">
      <div class="sectionTitle">
        <h2 data-i18n="inputs">Vstupy</h2>
        <div class="hint" data-i18n="hintHelp">Klikni na ‚Äû?‚Äú pro vysvƒõtlivku.</div>
      </div>

      <div class="grid two">
        <!-- Ticker -->
        <div class="field">
          <div class="fieldRow">
            <div class="label" data-i18n="f_ticker">Ticker / N√°zev</div>
            <button class="helpBtn" type="button" data-help="ticker">?</button>
          </div>
          <input id="inTicker" inputmode="text" data-ph="ph_ticker" placeholder="AAPL / Apple" />
          <div class="small" data-i18n="f_ticker_s">Voliteln√© ‚Äì jen pro p≈ôehled ve Watchlistu.</div>
        </div>

        <!-- FCF -->
        <div class="field">
          <div class="fieldRow">
            <div class="label" data-i18n="f_fcf">Posledn√≠ roƒçn√≠ FCF</div>
            <button class="helpBtn" type="button" data-help="fcf">?</button>
          </div>
          <input id="inFCF" inputmode="decimal" data-ph="ph_fcf" placeholder="9500000" />
          <div class="small" data-i18n="f_fcf_s">Zadej roƒçn√≠ Free Cash Flow (za posledn√≠ rok).</div>
        </div>

        <!-- Years -->
        <div class="field">
          <div class="fieldRow">
            <div class="label" data-i18n="f_years">Poƒçet let projekce</div>
            <button class="helpBtn" type="button" data-help="years">?</button>
          </div>
          <input id="inYears" inputmode="numeric" data-ph="ph_years" placeholder="10" />
          <div class="small" data-i18n="f_years_s">Typicky 5‚Äì10 let.</div>
        </div>

        <!-- WACC -->
        <div class="field">
          <div class="fieldRow">
            <div class="label" data-i18n="f_wacc">Diskontn√≠ sazba (WACC / r) %</div>
            <button class="helpBtn" type="button" data-help="wacc">?</button>
          </div>
          <input id="inWacc" inputmode="decimal" data-ph="ph_wacc" placeholder="9" />
          <div class="small" data-i18n="f_wacc_s">Oƒçek√°van√Ω v√Ωnos (nap≈ô. 9 %).</div>
        </div>

        <!-- Terminal growth -->
        <div class="field">
          <div class="fieldRow">
            <div class="label" data-i18n="f_tg">Terminal growth %</div>
            <button class="helpBtn" type="button" data-help="tg">?</button>
          </div>
          <input id="inTG" inputmode="decimal" data-ph="ph_tg" placeholder="2.5" />
          <div class="small" data-i18n="f_tg_s">Dlouhodob√Ω r≈Øst po projekci (obvykle 1‚Äì3 %).</div>
        </div>

        <!-- Net debt -->
        <div class="field">
          <div class="fieldRow">
            <div class="label" data-i18n="f_netd">Net debt / Cash (volitelnƒõ)</div>
            <button class="helpBtn" type="button" data-help="netd">?</button>
          </div>
          <input id="inNetD" inputmode="decimal" data-ph="ph_netd" placeholder="0" />
          <div class="small" data-i18n="f_netd_s">
            Net debt = dluhy ‚àí cash. Pokud m√° firma ƒçist√Ω cash, dej z√°porn√© ƒç√≠slo.
          </div>
        </div>

        <!-- Shares -->
        <div class="field">
          <div class="fieldRow">
            <div class="label" data-i18n="f_shares">Poƒçet akci√≠ (Shares)</div>
            <button class="helpBtn" type="button" data-help="shares">?</button>
          </div>
          <input id="inShares" inputmode="decimal" data-ph="ph_shares" placeholder="16000000" />
          <div class="small" data-i18n="f_shares_s">Kdy≈æ vypln√≠≈°, dostane≈° f√©rovou cenu na 1 akcii.</div>
        </div>

        <!-- Price -->
        <div class="field">
          <div class="fieldRow">
            <div class="label" data-i18n="f_price">Aktu√°ln√≠ cena (volitelnƒõ)</div>
            <button class="helpBtn" type="button" data-help="price">?</button>
          </div>
          <input id="inPrice" inputmode="decimal" data-ph="ph_price" placeholder="190" />
          <div class="small" data-i18n="f_price_s">Kdy≈æ vypln√≠≈°, uk√°≈æe se podhodnocen√≠/nadhodnocen√≠.</div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid two">
        <!-- Growth Bear -->
        <div class="field">
          <div class="fieldRow">
            <div class="label" data-i18n="f_bear">R≈Øst FCF Bear %</div>
            <button class="helpBtn" type="button" data-help="g">?</button>
          </div>
          <input id="inGBear" inputmode="decimal" data-ph="ph_bear" placeholder="4" />
          <div class="small" data-i18n="f_bear_s">Konzervativn√≠ r≈Øst.</div>
        </div>

        <!-- Growth Base -->
        <div class="field">
          <div class="fieldRow">
            <div class="label" data-i18n="f_base">R≈Øst FCF Base %</div>
            <button class="helpBtn" type="button" data-help="g">?</button>
          </div>
          <input id="inGBase" inputmode="decimal" data-ph="ph_base" placeholder="8" />
          <div class="small" data-i18n="f_base_s">Realistick√Ω r≈Øst.</div>
        </div>

        <!-- Growth Bull -->
        <div class="field">
          <div class="fieldRow">
            <div class="label" data-i18n="f_bull">R≈Øst FCF Bull %</div>
            <button class="helpBtn" type="button" data-help="g">?</button>
          </div>
          <input id="inGBull" inputmode="decimal" data-ph="ph_bull" placeholder="12" />
          <div class="small" data-i18n="f_bull_s">Optimistick√Ω r≈Øst.</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="btnCalc" type="button" data-i18n="btnCalc">Spoƒç√≠tat</button>
        <button class="btn" id="btnSave" type="button" data-i18n="btnSave">Ulo≈æit do Watchlistu</button>
        <button class="btn" id="btnPdfOne" type="button" data-i18n="btnPdfOne">PDF (tisk)</button>
      </div>
    </div>

    <div class="card">
      <div class="sectionTitle">
        <h2 data-i18n="results">V√Ωsledky</h2>
        <div class="hint" data-i18n="bbb">Bear / Base / Bull</div>
      </div>
      <div id="resultsBox" class="resultsEmpty" data-i18n="resultsEmpty">
        Zat√≠m nic. Vypl≈à vstupy a klikni na ‚ÄûSpoƒç√≠tat‚Äú.
      </div>
    </div>
  </div>
</section>

<!-- SCREEN: WATCHLIST -->
<section class="glass screen" id="screenWatch" aria-hidden="true">
  <div class="screenTop">
    <button class="backBtn" type="button" id="backFromWatch">‚Äπ <span data-i18n="back">Zpƒõt</span></button>
    <div class="screenTitle" data-i18n="watchTitle">Watchlist</div>
    <button class="miniBtn" type="button" id="btnPdfAll" data-i18n="btnPdfAll">PDF</button>
  </div>

  <div class="content">
    <div class="card">
      <div class="sectionTitle">
        <h2 data-i18n="saved">Ulo≈æen√©</h2>
        <div class="hint" data-i18n="watchHint">Klikni na polo≈æku pro naƒçten√≠ zpƒõt.</div>
      </div>
      <div id="watchBox"></div>
    </div>
  </div>
</section>

<!-- SCREEN: ABOUT -->
<section class="glass screen" id="screenAbout" aria-hidden="true">
  <div class="screenTop">
    <button class="backBtn" type="button" id="backFromAbout">‚Äπ <span data-i18n="back">Zpƒõt</span></button>
    <div class="screenTitle" data-i18n="aboutTitle">O aplikaci</div>
    <div style="width:88px"></div>
  </div>

  <div class="content">
    <div class="card prose">
      <h2 data-i18n="aboutH">Pro koho to je</h2>
      <p data-i18n="aboutP1">
        Aplikace je pro investory, kte≈ô√≠ chtƒõj√≠ rychle odhadnout f√©rovou cenu akcie pomoc√≠ jednoduch√©ho DCF modelu
        a ukl√°dat si v√Ωsledky do Watchlistu.
      </p>

      <h3 data-i18n="aboutH2">Jak to poƒç√≠t√°</h3>
      <p data-i18n="aboutP2">
        Zad√°≈° posledn√≠ roƒçn√≠ FCF, roƒçn√≠ r≈Øst (Bear/Base/Bull), poƒçet let projekce, diskontn√≠ sazbu a terminal growth.
        Vypoƒç√≠t√° se souƒçasn√° hodnota budouc√≠ch cash flow + terminal value. Pot√© se uprav√≠ o Net Debt (dluhy ‚àí cash).
        Kdy≈æ vypln√≠≈° poƒçet akci√≠, dostane≈° f√©rovou cenu na 1 akcii.
      </p>

      <div class="note" data-i18n="aboutNote">
        Pozn√°mka: P≈ôep√≠naƒç mƒõny (USD/EUR) je prim√°rnƒõ pro oznaƒçen√≠ jednotek. Pokud chce≈° p≈ôevod mezi mƒõnami,
        mus√≠≈° zadat vstupy u≈æ v c√≠lov√© mƒõnƒõ.
      </div>

      <h3 data-i18n="aboutH3">Tipy</h3>
      <ul>
        <li data-i18n="aboutLi1">Zkus v√≠ce sc√©n√°≈ô≈Ø r≈Østu a porovnej Bear/Base/Bull.</li>
        <li data-i18n="aboutLi2">D√°vej pozor, aby terminal growth nebyl vy≈°≈°√≠ ne≈æ diskontn√≠ sazba.</li>
        <li data-i18n="aboutLi3">Net Debt m≈Ø≈æe b√Ωt i z√°porn√Ω (firma m√° ƒçist√Ω cash).</li>
      </ul>

      <div class="divider"></div>
      <div class="small muted" data-i18n="aboutDisclaimer">
        Toto nen√≠ investiƒçn√≠ doporuƒçen√≠. V√Ωsledky jsou jen orientaƒçn√≠.
      </div>
    </div>
  </div>
</section>

<!-- MODAL (help) -->
<div class="modalBack" id="modalBack" aria-hidden="true">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modalTop">
      <h3 class="modalTitle" id="modalTitle">Help</h3>
      <button class="x" type="button" id="modalClose">√ó</button>
    </div>
    <div class="modalBody" id="modalBody"></div>
  </div>
</div>

<script>
/* =======================
   State
======================= */
const STORE_KEY = "equity_analyzer_watchlist_v3";
let LANG = "cs"; // cs | en
let CCY  = "USD"; // USD | EUR
let LAST = null;  // posledn√≠ v√Ωpoƒçet (pro PDF/Save)

/* =======================
   i18n UI
======================= */
const UI = {
  cs: {
    pill: "DCF ‚Ä¢ Watchlist ‚Ä¢ O aplikaci",
    h1: "Anal√Ωza akci√≠",
    sub: "Appka pro investory: DCF odhad vnit≈ôn√≠ hodnoty (Bear/Base/Bull) + Watchlist ulo≈æen√Ωch v√Ωsledk≈Ø.",
    navDCF: "DCF Anal√Ωza",
    navWatch: "Watchlist",
    navAbout: "O aplikaci",
    navDCFsub: "Vnit≈ôn√≠ hodnota ‚Ä¢ Bear / Base / Bull",
    navWatchsub: "Ulo≈æen√© anal√Ωzy ‚Ä¢ maz√°n√≠ po jedn√©",
    navAboutsub: "Metodika ‚Ä¢ jak funguje DCF ‚Ä¢ tipy",

    lang: "Jazyk", ccy: "Mƒõna",
    back: "Zpƒõt",

    inputs: "Vstupy",
    hintHelp: "Klikni na ‚Äû?‚Äú pro vysvƒõtlivku.",
    results: "V√Ωsledky",
    bbb: "Bear / Base / Bull",
    resultsEmpty: "Zat√≠m nic. Vypl≈à vstupy a klikni na ‚ÄûSpoƒç√≠tat‚Äú.",

    btnCalc: "Spoƒç√≠tat",
    btnSave: "Ulo≈æit do Watchlistu",
    btnPdfOne: "PDF (tisk)",
    btnPdfAll: "PDF",

    watchTitle: "Watchlist",
    saved: "Ulo≈æen√©",
    watchHint: "Klikni na polo≈æku pro naƒçten√≠ zpƒõt.",
    emptyWatch: "Zat√≠m nic ulo≈æen√©ho.",

    aboutTitle: "O aplikaci",
    aboutH: "Pro koho to je",
    aboutP1: "Aplikace je pro investory, kte≈ô√≠ chtƒõj√≠ rychle odhadnout f√©rovou cenu akcie pomoc√≠ jednoduch√©ho DCF modelu a ukl√°dat si v√Ωsledky do Watchlistu.",
    aboutH2: "Jak to poƒç√≠t√°",
    aboutP2: "Zad√°≈° posledn√≠ roƒçn√≠ FCF, roƒçn√≠ r≈Øst (Bear/Base/Bull), poƒçet let projekce, diskontn√≠ sazbu a terminal growth. Vypoƒç√≠t√° se souƒçasn√° hodnota budouc√≠ch cash flow + terminal value. Pot√© se uprav√≠ o Net Debt (dluhy ‚àí cash). Kdy≈æ vypln√≠≈° poƒçet akci√≠, dostane≈° f√©rovou cenu na 1 akcii.",
    aboutNote: "Pozn√°mka: P≈ôep√≠naƒç mƒõny (USD/EUR) je prim√°rnƒõ pro oznaƒçen√≠ jednotek. Pokud chce≈° p≈ôevod mezi mƒõnami, mus√≠≈° zadat vstupy u≈æ v c√≠lov√© mƒõnƒõ.",
    aboutH3: "Tipy",
    aboutLi1: "Zkus v√≠ce sc√©n√°≈ô≈Ø r≈Østu a porovnej Bear/Base/Bull.",
    aboutLi2: "D√°vej pozor, aby terminal growth nebyl vy≈°≈°√≠ ne≈æ diskontn√≠ sazba.",
    aboutLi3: "Net Debt m≈Ø≈æe b√Ωt i z√°porn√Ω (firma m√° ƒçist√Ω cash).",
    aboutDisclaimer: "Toto nen√≠ investiƒçn√≠ doporuƒçen√≠. V√Ωsledky jsou jen orientaƒçn√≠.",

    // labels
    f_ticker: "Ticker / N√°zev",
    f_ticker_s: "Voliteln√© ‚Äì jen pro p≈ôehled ve Watchlistu.",
    f_fcf: "Posledn√≠ roƒçn√≠ FCF",
    f_fcf_s: "Zadej roƒçn√≠ Free Cash Flow (za posledn√≠ rok).",
    f_years: "Poƒçet let projekce",
    f_years_s: "Typicky 5‚Äì10 let.",
    f_wacc: "Diskontn√≠ sazba (WACC / r) %",
    f_wacc_s: "Oƒçek√°van√Ω v√Ωnos (nap≈ô. 9 %).",
    f_tg: "Terminal growth %",
    f_tg_s: "Dlouhodob√Ω r≈Øst po projekci (obvykle 1‚Äì3 %).",
    f_netd: "Net debt / Cash (volitelnƒõ)",
    f_netd_s: "Net debt = dluhy ‚àí cash. Pokud m√° firma ƒçist√Ω cash, dej z√°porn√© ƒç√≠slo.",
    f_shares: "Poƒçet akci√≠ (Shares)",
    f_shares_s: "Kdy≈æ vypln√≠≈°, dostane≈° f√©rovou cenu na 1 akcii.",
    f_price: "Aktu√°ln√≠ cena (volitelnƒõ)",
    f_price_s: "Kdy≈æ vypln√≠≈°, uk√°≈æe se podhodnocen√≠/nadhodnocen√≠.",
    f_bear: "R≈Øst FCF Bear %",
    f_bear_s: "Konzervativn√≠ r≈Øst.",
    f_base: "R≈Øst FCF Base %",
    f_base_s: "Realistick√Ω r≈Øst.",
    f_bull: "R≈Øst FCF Bull %",
    f_bull_s: "Optimistick√Ω r≈Øst.",

    // placeholders
    ph_ticker: "AAPL / Apple",
    ph_fcf: "9500000",
    ph_years: "10",
    ph_wacc: "9",
    ph_tg: "2.5",
    ph_netd: "0",
    ph_shares: "16000000",
    ph_price: "190",
    ph_bear: "4",
    ph_base: "8",
    ph_bull: "12",

    // watchlist labels
    lblBear: "Bear",
    lblBase: "Base",
    lblBull: "Bull",
    del: "Smazat",
    pdf: "PDF",
    toastSaved: "V√Ωpoƒçet byl ulo≈æen do Watchlistu.",
    toastDeleted: "Polo≈æka smaz√°na.",
    toastLoaded: "Naƒçteno do DCF vstup≈Ø.",
    errInputs: "Zkontroluj vstupy ‚Äì FCF, roky, diskont a r≈Østy mus√≠ d√°vat smysl.",
    errRate: "Diskontn√≠ sazba mus√≠ b√Ωt vƒõt≈°√≠ ne≈æ terminal growth.",
  },

  en: {
    pill: "DCF ‚Ä¢ Watchlist ‚Ä¢ About",
    h1: "Equity Analyzer",
    sub: "Quick intrinsic value estimate using a simple DCF (Bear/Base/Bull) + saved Watchlist.",
    navDCF: "DCF Analysis",
    navWatch: "Watchlist",
    navAbout: "About",
    navDCFsub: "Intrinsic value ‚Ä¢ Bear / Base / Bull",
    navWatchsub: "Saved analyses ‚Ä¢ delete one by one",
    navAboutsub: "Method ‚Ä¢ how DCF works ‚Ä¢ tips",

    lang: "Language", ccy: "Currency",
    back: "Back",

    inputs: "Inputs",
    hintHelp: "Tap ‚Äú?‚Äù for explanations.",
    results: "Results",
    bbb: "Bear / Base / Bull",
    resultsEmpty: "Nothing yet. Fill inputs and tap ‚ÄúCalculate‚Äù.",

    btnCalc: "Calculate",
    btnSave: "Save to Watchlist",
    btnPdfOne: "PDF (print)",
    btnPdfAll: "PDF",

    watchTitle: "Watchlist",
    saved: "Saved",
    watchHint: "Tap an item to load it back.",
    emptyWatch: "No saved items yet.",

    aboutTitle: "About",
    aboutH: "Who it‚Äôs for",
    aboutP1: "This app is for investors who want a quick intrinsic value estimate using a simple DCF model and save results into a Watchlist.",
    aboutH2: "How it calculates",
    aboutP2: "Enter last annual FCF, growth (Bear/Base/Bull), projection years, discount rate and terminal growth. It discounts projected cash flows and terminal value to present value. Then it adjusts by Net Debt (debt ‚àí cash). If you provide shares outstanding, you get fair value per share.",
    aboutNote: "Note: The USD/EUR switch mainly labels units. For FX conversion, enter inputs already in the target currency.",
    aboutH3: "Tips",
    aboutLi1: "Try multiple growth scenarios and compare Bear/Base/Bull.",
    aboutLi2: "Make sure terminal growth is lower than the discount rate.",
    aboutLi3: "Net Debt can be negative (net cash).",
    aboutDisclaimer: "Not financial advice. Outputs are indicative only.",

    f_ticker: "Ticker / Name",
    f_ticker_s: "Optional ‚Äì just for Watchlist clarity.",
    f_fcf: "Last annual FCF",
    f_fcf_s: "Enter annual Free Cash Flow (last year).",
    f_years: "Projection years",
    f_years_s: "Typically 5‚Äì10 years.",
    f_wacc: "Discount rate (WACC / r) %",
    f_wacc_s: "Required return (e.g., 9%).",
    f_tg: "Terminal growth %",
    f_tg_s: "Long-term growth after projection (usually 1‚Äì3%).",
    f_netd: "Net debt / Cash (optional)",
    f_netd_s: "Net debt = debt ‚àí cash. If net cash, use a negative value.",
    f_shares: "Shares outstanding",
    f_shares_s: "If provided, you get fair value per share.",
    f_price: "Current price (optional)",
    f_price_s: "If provided, shows upside/downside vs market.",
    f_bear: "FCF growth Bear %",
    f_bear_s: "Conservative growth.",
    f_base: "FCF growth Base %",
    f_base_s: "Realistic growth.",
    f_bull: "FCF growth Bull %",
    f_bull_s: "Optimistic growth.",

    ph_ticker: "AAPL / Apple",
    ph_fcf: "9500000",
    ph_years: "10",
    ph_wacc: "9",
    ph_tg: "2.5",
    ph_netd: "0",
    ph_shares: "16000000",
    ph_price: "190",
    ph_bear: "4",
    ph_base: "8",
    ph_bull: "12",

    lblBear: "Bear",
    lblBase: "Base",
    lblBull: "Bull",
    del: "Delete",
    pdf: "PDF",
    toastSaved: "Saved to Watchlist.",
    toastDeleted: "Item deleted.",
    toastLoaded: "Loaded into DCF inputs.",
    errInputs: "Check inputs ‚Äì FCF, years, discount and growth must be reasonable.",
    errRate: "Discount rate must be higher than terminal growth.",
  }
};

const HELP = {
  ticker: {
    cs: { title: "Ticker / N√°zev", body: "<p><b>Ticker</b> je zkratka akcie (nap≈ô. AAPL). M≈Ø≈æe≈° napsat i n√°zev firmy.</p>" },
    en: { title: "Ticker / Name", body: "<p><b>Ticker</b> is the stock symbol (e.g., AAPL). You can also type the company name.</p>" }
  },
  fcf: {
    cs: { title: "FCF (Free Cash Flow)", body: "<p><b>FCF</b> je voln√Ω cash flow za posledn√≠ rok. DCF diskontuje budouc√≠ FCF do souƒçasnosti.</p><p><i>Tip:</i> Ber posledn√≠ roƒçn√≠ FCF z v√Ωkaz≈Ø (Cash Flow).</p>" },
    en: { title: "FCF (Free Cash Flow)", body: "<p><b>FCF</b> is last year's free cash flow. DCF discounts future FCF to present value.</p><p><i>Tip:</i> Use the last annual FCF from the cash flow statement.</p>" }
  },
  years: {
    cs: { title: "Poƒçet let projekce", body: "<p>Kolik let dop≈ôedu projekujeme FCF. Typicky 5‚Äì10 let.</p>" },
    en: { title: "Projection years", body: "<p>How many years you project FCF. Typically 5‚Äì10 years.</p>" }
  },
  wacc: {
    cs: { title: "Diskontn√≠ sazba (r)", body: "<p>Diskontn√≠ sazba = po≈æadovan√Ω v√Ωnos. ƒå√≠m vy≈°≈°√≠ r, t√≠m ni≈æ≈°√≠ souƒçasn√° hodnota.</p>" },
    en: { title: "Discount rate (r)", body: "<p>Discount rate = required return. Higher r lowers present value.</p>" }
  },
  tg: {
    cs: { title: "Terminal growth", body: "<p>Dlouhodob√Ω r≈Øst po obdob√≠ projekce. Obvykle 1‚Äì3 %.</p><p><b>Mus√≠ platit:</b> r &gt; tg.</p>" },
    en: { title: "Terminal growth", body: "<p>Long-term growth after projection. Usually 1‚Äì3%.</p><p><b>Must hold:</b> r &gt; tg.</p>" }
  },
  netd: {
    cs: { title: "Net debt / Cash", body: "<p>Net debt = dluhy ‚àí cash. Pokud m√° firma v√≠ce cash ne≈æ dluh≈Ø, zadej z√°porn√© ƒç√≠slo.</p>" },
    en: { title: "Net debt / Cash", body: "<p>Net debt = debt ‚àí cash. If the company has net cash, use a negative number.</p>" }
  },
  shares: {
    cs: { title: "Poƒçet akci√≠", body: "<p>Poƒçet akci√≠ v obƒõhu. Kdy≈æ je vypln√≠≈°, spoƒç√≠t√° se f√©rov√° cena na 1 akcii.</p>" },
    en: { title: "Shares outstanding", body: "<p>Shares outstanding. If provided, the model computes fair value per share.</p>" }
  },
  price: {
    cs: { title: "Aktu√°ln√≠ cena", body: "<p>Voliteln√©. Pokud vypln√≠≈°, uk√°≈æe se % rozd√≠l mezi trhem a f√©rovou cenou.</p>" },
    en: { title: "Current price", body: "<p>Optional. If provided, shows % upside/downside vs fair value.</p>" }
  },
  g: {
    cs: { title: "R≈Øst FCF (CAGR)", body: "<p>Oƒçek√°van√Ω roƒçn√≠ r≈Øst FCF pro dan√Ω sc√©n√°≈ô (Bear/Base/Bull).</p>" },
    en: { title: "FCF growth (CAGR)", body: "<p>Expected annual FCF growth for each scenario (Bear/Base/Bull).</p>" }
  }
};

/* =======================
   Helpers / protections
======================= */
function t(key){
  const dict = UI[LANG] || UI.cs;
  return dict[key] ?? (UI.cs[key] ?? key);
}

function clamp(n, a, b){
  if(!isFinite(n)) return a;
  return Math.min(b, Math.max(a, n));
}

function parseNum(v){
  if(v === null || v === undefined) return null;
  const s = String(v).trim();
  if(!s) return null;
  // support: "1 234 567,89" and "1234567.89"
  const cleaned = s.replace(/\s+/g, "").replace(",", ".");
  const num = Number(cleaned);
  return isFinite(num) ? num : null;
}

function fmtMoney(n, dec=2){
  if(n === null || n === undefined || !isFinite(Number(n))) return "‚Äî";
  const x = Number(n);
  const locale = (LANG === "cs") ? "cs-CZ" : "en-US";
  const val = x.toLocaleString(locale, { maximumFractionDigits: dec, minimumFractionDigits: dec });
  const sym = (CCY === "EUR") ? "‚Ç¨" : "$";
  return `${val} ${sym}`;
}

function fmtInt(n){
  if(n === null || n === undefined || !isFinite(Number(n))) return "‚Äî";
  const locale = (LANG === "cs") ? "cs-CZ" : "en-US";
  return Number(n).toLocaleString(locale, { maximumFractionDigits: 0 });
}

function escapeHtml(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;");
}

function toast(msg){
  const el = document.getElementById("toast");
  if(!el){ alert(msg); return; }
  el.textContent = msg;
  el.classList.add("show");
  clearTimeout(toast._t);
  toast._t = setTimeout(()=> el.classList.remove("show"), 2200);
}

/* =======================
   Navigation (3 screens)
======================= */
function showScreen(name){
  const home  = document.getElementById("homeWrap");
  const dcf   = document.getElementById("screenDCF");
  const w     = document.getElementById("screenWatch");
  const about = document.getElementById("screenAbout");

  if(!home || !dcf || !w || !about) return;

  const set = (el, on) => {
    if(on){
      el.classList.add("active");
      el.setAttribute("aria-hidden","false");
    } else {
      el.classList.remove("active");
      el.setAttribute("aria-hidden","true");
    }
  };

  if(name === "dcf"){
    home.style.display = "none";
    set(dcf,true); set(w,false); set(about,false);
  } else if(name === "watch"){
    home.style.display = "none";
    set(dcf,false); set(w,true); set(about,false);
    renderWatchlist();
  } else if(name === "about"){
    home.style.display = "none";
    set(dcf,false); set(w,false); set(about,true);
  } else {
    home.style.display = "";
    set(dcf,false); set(w,false); set(about,false);
  }

  window.scrollTo({ top: 0, behavior: "instant" });
}

/* =======================
   Modal help
======================= */
function openModal(title, html){
  const back = document.getElementById("modalBack");
  const tEl  = document.getElementById("modalTitle");
  const bEl  = document.getElementById("modalBody");
  if(!back || !tEl || !bEl) return;
  tEl.textContent = title;
  bEl.innerHTML = html;
  back.classList.add("show");
  back.setAttribute("aria-hidden","false");
}
function closeModal(){
  const back = document.getElementById("modalBack");
  if(!back) return;
  back.classList.remove("show");
  back.setAttribute("aria-hidden","true");
}

/* =======================
   DCF math
======================= */
function calcScenario(fcf0, years, r, g, tg){
  let pvSum = 0;
  let fcf = fcf0;

  for(let i=1;i<=years;i++){
    fcf = fcf * (1 + g);
    pvSum += fcf / Math.pow(1 + r, i);
  }

  const fcfN = fcf;
  const denom = (r - tg);
  const tv = denom > 0 ? (fcfN * (1 + tg) / denom) : null;
  const pvTv = (tv === null) ? null : (tv / Math.pow(1 + r, years));
  const ev = (pvTv === null) ? null : (pvSum + pvTv);

  return { ev, pvSum, tv, pvTv };
}

function computeDCF(){
  const ticker = (document.getElementById("inTicker")?.value || "").trim();

  const fcf    = parseNum(document.getElementById("inFCF")?.value);
  let years    = parseNum(document.getElementById("inYears")?.value);
  const waccP  = parseNum(document.getElementById("inWacc")?.value);
  const tgP    = parseNum(document.getElementById("inTG")?.value);
  const netd   = parseNum(document.getElementById("inNetD")?.value) ?? 0;
  const shares = parseNum(document.getElementById("inShares")?.value);
  const price  = parseNum(document.getElementById("inPrice")?.value);

  const gBearP = parseNum(document.getElementById("inGBear")?.value);
  const gBaseP = parseNum(document.getElementById("inGBase")?.value);
  const gBullP = parseNum(document.getElementById("inGBull")?.value);

  years = clamp(Math.round(years ?? 0), 1, 30);

  const r     = (waccP ?? NaN) / 100;
  const tg    = (tgP ?? NaN) / 100;
  const gBear = (gBearP ?? NaN) / 100;
  const gBase = (gBaseP ?? NaN) / 100;
  const gBull = (gBullP ?? NaN) / 100;

  // protections
  if(!(fcf>0) || !(years>=1) || !(r>0) || !(isFinite(tg)) || !(isFinite(gBear)) || !(isFinite(gBase)) || !(isFinite(gBull))){
    toast(t("errInputs"));
    return null;
  }
  if(!(r > tg)){
    toast(t("errRate"));
    return null;
  }

  const sBear = calcScenario(fcf, years, r, gBear, tg);
  const sBase = calcScenario(fcf, years, r, gBase, tg);
  const sBull = calcScenario(fcf, years, r, gBull, tg);

  function enrich(s){
    if(s.ev === null) return null;
    const equity = s.ev - netd;     // net debt reduces equity; net cash increases
    const fairPS = (shares && shares>0) ? (equity / shares) : null;
    return { ...s, equity, fairPS };
  }

  const bear = enrich(sBear);
  const base = enrich(sBase);
  const bull = enrich(sBull);

  const res = {
    ticker,
    ccy: CCY,
    lang: LANG,
    ts: Date.now(),
    inputs: { ticker, fcf, years, waccP, tgP, netd, shares, price, gBearP, gBaseP, gBullP, ccy: CCY },
    bear, base, bull
  };

  LAST = res;
  renderResults(res);
  return res;
}

function renderResults(res){
  const box = document.getElementById("resultsBox");
  if(!box) return;

  const price = res.inputs.price ?? null;

  const badge = (fair) => {
    if(price === null || price === undefined) return "";
    const p = Number(price);
    const f = Number(fair);
    if(!isFinite(p) || !isFinite(f) || p<=0) return "";
    const diff = (f - p) / p * 100;
    const sign = diff >= 0 ? "+" : "";
    const cls = diff >= 10 ? "chip ok" : (diff <= -10 ? "chip bad" : "chip warn");
    return `<span class="${cls}">${sign}${diff.toFixed(2)}%</span>`;
  };

  function card(labelKey, s){
    if(!s) return "";
    const hasPS = (s.fairPS !== null && isFinite(s.fairPS));
    const title = t(labelKey);
    const big = hasPS ? fmtMoney(s.fairPS, 2) : fmtMoney(s.equity, 0);
    const sub = hasPS
      ? `<div class="muted2">${fmtMoney(s.equity, 0)} ‚Ä¢ ${t("f_shares")}: ${fmtInt(res.inputs.shares)}</div>`
      : `<div class="muted2">${t("f_shares_s")}</div>`;

    const vs = (hasPS && price!==null && isFinite(Number(price)))
      ? `<div class="muted2"><b>${t("f_price")}:</b> ${fmtMoney(price,2)} ‚Ä¢ ${escapeHtml(CCY)}</div>`
      : "";

    return `
      <div class="resCard">
        <div class="resTop">
          <div class="resName">${escapeHtml(title)}</div>
          ${hasPS ? badge(s.fairPS) : ""}
        </div>
        <div class="resBig">${big}</div>
        <div class="resLines">
          <div><span class="muted2">Enterprise value:</span> <b>${fmtMoney(s.ev,0)}</b></div>
          <div><span class="muted2">Equity value:</span> <b>${fmtMoney(s.equity,0)}</b></div>
          ${vs}
          ${sub}
        </div>
      </div>
    `;
  }

  box.classList.remove("resultsEmpty");
  box.innerHTML = `
    <div class="resultsGrid">
      ${card("lblBear", res.bear)}
      ${card("lblBase", res.base)}
      ${card("lblBull", res.bull)}
    </div>
  `;
}

/* =======================
   Watchlist
======================= */
function loadWatch(){
  try{
    const raw = localStorage.getItem(STORE_KEY);
    if(!raw) return [];
    const data = JSON.parse(raw);
    return Array.isArray(data) ? data : [];
  } catch(e){
    return [];
  }
}
function saveWatch(list){
  localStorage.setItem(STORE_KEY, JSON.stringify(list));
}

function addToWatch(res){
  if(!res) return;
  const list = loadWatch();
  list.unshift(res);
  saveWatch(list);
  toast(t("toastSaved"));
}

function deleteFromWatch(ts){
  const list = loadWatch().filter(x => x.ts !== ts);
  saveWatch(list);
  renderWatchlist();
  toast(t("toastDeleted"));
}

function loadItemToInputs(item){
  const I = item.inputs || {};
  const setV = (id,val) => {
    const el = document.getElementById(id);
    if(!el) return;
    el.value = (val === null || val === undefined) ? "" : String(val);
  };

  setV("inTicker", I.ticker ?? "");
  setV("inFCF", I.fcf ?? "");
  setV("inYears", I.years ?? "");
  setV("inWacc", I.waccP ?? "");
  setV("inTG", I.tgP ?? "");
  setV("inNetD", I.netd ?? 0);
  setV("inShares", I.shares ?? "");
  setV("inPrice", I.price ?? "");
  setV("inGBear", I.gBearP ?? "");
  setV("inGBase", I.gBaseP ?? "");
  setV("inGBull", I.gBullP ?? "");

  if(I.ccy) CCY = I.ccy;

  LAST = item;
  renderResults(item);
  toast(t("toastLoaded"));
}

function renderWatchlist(){
  const box = document.getElementById("watchBox");
  if(!box) return;

  const list = loadWatch();
  if(list.length === 0){
    box.innerHTML = `<div class="empty">${t("emptyWatch")}</div>`;
    return;
  }

  const locale = (LANG === "cs") ? "cs-CZ" : "en-US";

  box.innerHTML = list.map(item => {
    const dt = new Date(item.ts).toLocaleDateString(locale);
    const ccy = item.ccy || "USD";
    const tick = (item.ticker || item.inputs?.ticker || "‚Äî");
    const bear = item.bear?.fairPS ?? item.bear?.equity ?? null;
    const base = item.base?.fairPS ?? item.base?.equity ?? null;
    const bull = item.bull?.fairPS ?? item.bull?.equity ?? null;

    return `
      <div class="watchItem">
        <button class="watchMain" type="button" data-ts="${item.ts}">
          <div class="watchTitle">${escapeHtml(tick)}</div>
          <div class="watchSub">
            <span>${escapeHtml(dt)}</span>
            <span class="chip">${escapeHtml(ccy)}</span>
          </div>
          <div class="watchVals">
            <span><b>${t("lblBear")}:</b> ${fmtMoney(bear,2)}</span>
            <span><b>${t("lblBase")}:</b> ${fmtMoney(base,2)}</span>
            <span><b>${t("lblBull")}:</b> ${fmtMoney(bull,2)}</span>
          </div>
        </button>
        <div class="watchBtns">
          <button class="btnMini" type="button" data-pdf="${item.ts}">${t("pdf")}</button>
          <button class="btnMini danger" type="button" data-del="${item.ts}">${t("del")}</button>
        </div>
      </div>
    `;
  }).join("");

  // bind
  box.querySelectorAll("[data-ts]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const ts = Number(btn.getAttribute("data-ts"));
      const item = loadWatch().find(x => x.ts === ts);
      if(item){
        loadItemToInputs(item);
        showScreen("dcf");
      }
    });
  });

  box.querySelectorAll("[data-del]").forEach(btn=>{
    btn.addEventListener("click", (e)=>{
      e.stopPropagation();
      const ts = Number(btn.getAttribute("data-del"));
      deleteFromWatch(ts);
    });
  });

  box.querySelectorAll("[data-pdf]").forEach(btn=>{
    btn.addEventListener("click", (e)=>{
      e.stopPropagation();
      const ts = Number(btn.getAttribute("data-pdf"));
      const item = loadWatch().find(x => x.ts === ts);
      if(item) printPdfForItems([item]);
    });
  });
}

/* =======================
   PDF (print) ‚Äî one or all
======================= */
function buildPdfHTML(items){
  const locale = (LANG === "cs") ? "cs-CZ" : "en-US";
  const title = (LANG === "cs") ? "DCF report" : "DCF report";
  const subtitle = (LANG === "cs")
    ? "Rychl√Ω v√Ωpis DCF v√Ωsledk≈Ø (Watchlist)"
    : "Quick DCF report (Watchlist)";

  const rowsFor = (item) => {
    const I = item.inputs || {};
    const hasPS = !!(I.shares && isFinite(Number(I.shares)) && Number(I.shares)>0);
    const p = I.price ?? null;

    const line = (k,v) => `<tr><td>${escapeHtml(k)}</td><td><b>${escapeHtml(v)}</b></td></tr>`;

    const bearFair = hasPS ? item.bear?.fairPS : item.bear?.equity;
    const baseFair = hasPS ? item.base?.fairPS : item.base?.equity;
    const bullFair = hasPS ? item.bull?.fairPS : item.bull?.equity;

    const out = [];
    out.push(line("Ticker", I.ticker || "‚Äî"));
    out.push(line("Date", new Date(item.ts).toLocaleString(locale)));
    out.push(line("Currency", item.ccy || CCY));
    out.push(line("FCF", fmtMoney(I.fcf,0)));
    out.push(line("Years", String(I.years ?? "‚Äî")));
    out.push(line("Discount (r)", `${I.waccP ?? "‚Äî"} %`));
    out.push(line("Terminal growth", `${I.tgP ?? "‚Äî"} %`));
    out.push(line("Net debt", fmtMoney(I.netd ?? 0,0)));
    out.push(line("Shares", I.shares ? fmtInt(I.shares) : "‚Äî"));
    out.push(line("Market price", (p!==null) ? fmtMoney(p,2) : "‚Äî"));

    out.push(line("Bear", fmtMoney(bearFair,2)));
    out.push(line("Base", fmtMoney(baseFair,2)));
    out.push(line("Bull", fmtMoney(bullFair,2)));

    return out.join("");
  };

  const cards = items.map(item => `
    <div class="card">
      <h2>${escapeHtml(item.inputs?.ticker || item.ticker || "‚Äî")}</h2>
      <div class="muted">${escapeHtml(subtitle)}</div>
      <div class="box">
        <table>${rowsFor(item)}</table>
      </div>
    </div>
  `).join("");

  return `
<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>${escapeHtml(title)}</title>
  <style>
    body{ font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial; padding:18px; }
    h1{ margin:0 0 10px; }
    h2{ margin:0 0 6px; }
    .muted{ color:#555; margin:0 0 16px; }
    .card{ border:1px solid #ddd; border-radius:14px; padding:14px; margin:0 0 14px; }
    .box{ border:1px solid #eee; border-radius:12px; padding:10px; }
    table{ width:100%; border-collapse:collapse; }
    td{ padding:8px 6px; border-bottom:1px solid #eee; vertical-align:top; }
    td:first-child{ width:240px; color:#444; }
    @media print{ button{display:none;} }
  </style>
</head>
<body>
  <h1>${escapeHtml(title)}</h1>
  <p class="muted">${escapeHtml(subtitle)}</p>
  ${cards}
  <script>window.print();<\/script>
</body>
</html>
  `;
}

function printPdfForItems(items){
  const html = buildPdfHTML(items);
  const w = window.open("", "_blank");
  if(!w){ alert("Pop-up blocked"); return; }
  w.document.open();
  w.document.write(html);
  w.document.close();
}

/* =======================
   Apply language
======================= */
function applyLang(){
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    const k = el.getAttribute("data-i18n");
    el.textContent = t(k);
  });
  document.querySelectorAll("[data-ph]").forEach(el=>{
    const k = el.getAttribute("data-ph");
    el.setAttribute("placeholder", t(k));
  });

  // rerender locale-sensitive parts
  if(LAST) renderResults(LAST);
  renderWatchlist();
}

/* =======================
   Bindings (buttons)
======================= */
document.addEventListener("click", (e)=>{
  const helpBtn = e.target.closest?.(".helpBtn");
  if(helpBtn){
    const key = helpBtn.getAttribute("data-help");
    const pack = HELP[key];
    if(pack){
      const info = pack[LANG] || pack.cs;
      openModal(info.title, info.body);
    }
  }
});

document.getElementById("modalBack")?.addEventListener("click", closeModal);
document.getElementById("modalClose")?.addEventListener("click", closeModal);

document.getElementById("btnCalc")?.addEventListener("click", ()=> computeDCF());
document.getElementById("btnSave")?.addEventListener("click", ()=>{
  const res = LAST || computeDCF();
  if(res) addToWatch(res);
});
document.getElementById("btnPdfOne")?.addEventListener("click", ()=>{
  const res = LAST || computeDCF();
  if(res) printPdfForItems([res]);
});

document.getElementById("btnPdfAll")?.addEventListener("click", ()=>{
  const items = loadWatch();
  if(items.length) printPdfForItems(items);
  else toast(t("emptyWatch"));
});

document.getElementById("backFromDCF")?.addEventListener("click", ()=> showScreen("home"));
document.getElementById("backFromWatch")?.addEventListener("click", ()=> showScreen("home"));
document.getElementById("backFromAbout")?.addEventListener("click", ()=> showScreen("home"));

document.getElementById("navGoDCF")?.addEventListener("click", ()=> showScreen("dcf"));
document.getElementById("navGoWatch")?.addEventListener("click", ()=> showScreen("watch"));
document.getElementById("navGoAbout")?.addEventListener("click", ()=> showScreen("about"));

document.getElementById("btnLangCZ")?.addEventListener("click", ()=>{
  LANG = "cs";
  document.getElementById("btnLangCZ")?.classList.add("on");
  document.getElementById("btnLangEN")?.classList.remove("on");
  applyLang();
});
document.getElementById("btnLangEN")?.addEventListener("click", ()=>{
  LANG = "en";
  document.getElementById("btnLangEN")?.classList.add("on");
  document.getElementById("btnLangCZ")?.classList.remove("on");
  applyLang();
});

document.getElementById("btnCcyUSD")?.addEventListener("click", ()=>{
  CCY = "USD";
  document.getElementById("btnCcyUSD")?.classList.add("on");
  document.getElementById("btnCcyEUR")?.classList.remove("on");
  if(LAST){ LAST.ccy = CCY; renderResults(LAST); }
  renderWatchlist();
});
document.getElementById("btnCcyEUR")?.addEventListener("click", ()=>{
  CCY = "EUR";
  document.getElementById("btnCcyEUR")?.classList.add("on");
  document.getElementById("btnCcyUSD")?.classList.remove("on");
  if(LAST){ LAST.ccy = CCY; renderResults(LAST); }
  renderWatchlist();
});

/* =======================
   Init
======================= */
applyLang();
renderWatchlist();
</script>

</body>
</html>

      

      



    
        








    

    

    

 


        


        



  


 

            

        




          

        

          





  

  

  


  


    


      

  

    

          
    

    

    
    


    





    

    

  
        

    
    

  

  





