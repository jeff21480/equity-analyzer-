<!-- =========================
     EQUITY ANALYZER (MVP)
     PART 1/5  (HTML + CSS + HOME + placeholders)
     Vlo≈æit jako ZAƒå√ÅTEK souboru index.html
========================= -->
<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Equity Analyz√©r</title>

  <!-- Chart.js naƒçteme pozdƒõji (d√≠l 4/5), zat√≠m NE -->
  <style>
    :root{
      --bg0:#070816;
      --bg1:#0b0d22;
      --card:#10143a;
      --card2:#0e1233;
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.14);
      --txt:#f3f6ff;
      --muted:rgba(243,246,255,.72);
      --muted2:rgba(243,246,255,.55);

      --violet:#6b5cff;
      --blue:#3aa6ff;
      --good:#20d38a;
      --bad:#ff5b6e;

      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --r:22px;
      --r2:16px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--txt);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(107,92,255,.28), transparent 55%),
        radial-gradient(1000px 600px at 80% 20%, rgba(58,166,255,.22), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 14px 40px;
    }

    .topCard{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius: calc(var(--r) + 6px);
      padding: 18px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }

    .badgeRow{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom: 10px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 12px;
      border-radius: 999px;
      border:1px solid var(--stroke2);
      background: rgba(10,12,30,.55);
      color: var(--muted);
      font-size: 13px;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background: linear-gradient(135deg, var(--violet), var(--blue));
      box-shadow: 0 0 16px rgba(107,92,255,.45);
    }

    h1{
      margin: 8px 0 6px;
      font-size: 36px;
      letter-spacing:.2px;
    }
    .desc{
      margin:0;
      color: var(--muted);
      line-height: 1.35;
      max-width: 62ch;
      font-size: 15px;
    }

    .drawerList{
      margin-top: 16px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .drawerBtn{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      border:1px solid var(--stroke);
      border-radius: var(--r);
      padding: 14px 14px;
      background: linear-gradient(180deg, rgba(107,92,255,.14), rgba(58,166,255,.06));
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      color: var(--txt);
      cursor:pointer;
      text-align:left;
    }
    .drawerBtn:active{ transform: translateY(1px); }
    .drawerLeft{
      display:flex; align-items:center; gap:12px;
      min-width:0;
    }
    .iconBox{
      width:44px;height:44px;border-radius: 14px;
      border:1px solid var(--stroke2);
      background: rgba(12,14,35,.55);
      display:grid; place-items:center;
      flex:0 0 auto;
    }
    .drawerText{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .drawerTitle{
      font-weight: 700;
      font-size: 18px;
      line-height: 1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      color: var(--txt);
    }
    .drawerSub{
      font-size: 13px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .chev{
      width:28px;height:28px;border-radius:10px;
      border:1px solid var(--stroke2);
      display:grid; place-items:center;
      color: var(--muted);
      flex:0 0 auto;
    }

    /* screens */
    .screen{
      display:none;
      margin-top: 14px;
    }
    .screen.active{ display:block; }

    .screenHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin: 12px 0;
    }
    .screenTitle{
      margin:0;
      font-size: 22px;
      letter-spacing:.2px;
    }

    .btnRow{ display:flex; gap:10px; flex-wrap:wrap; }
    .btn{
      border:1px solid var(--stroke2);
      background: rgba(12,14,35,.55);
      color: var(--txt);
      padding: 10px 14px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 600;
    }
    .btn.primary{
      background: linear-gradient(135deg, rgba(107,92,255,.95), rgba(58,166,255,.85));
      border-color: rgba(255,255,255,.18);
    }
    .btn:active{ transform: translateY(1px); }

    .card{
      border:1px solid var(--stroke);
      background: rgba(12,14,35,.55);
      border-radius: var(--r);
      padding: 14px;
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
    }

    .note{
      color: var(--muted);
      font-size: 14px;
      line-height: 1.35;
      margin: 0;
    }

    /* small helper for mobile */
    @media (max-width:520px){
      h1{ font-size: 30px; }
      .drawerTitle{ font-size: 17px; }
      .wrap{ padding: 14px 12px 34px; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- HOME -->
    <section id="screenHome" class="screen active" aria-hidden="false">
      <div class="topCard">
        <div class="badgeRow">
          <span class="pill"><span class="dot"></span><span id="t_beta">Anal√Ωza akci√≠ ‚Ä¢ Beta</span></span>
          <span class="pill" id="t_mvp">MVP</span>
        </div>

        <h1 id="t_appTitle">Anal√Ωza akci√≠</h1>
        <p class="desc" id="t_appDesc">
          Appka pro investory: DCF odhad vnit≈ôn√≠ hodnoty (Bear/Base/Bull) + Watchlist ulo≈æen√Ωch v√Ωsledk≈Ø.
        </p>

        <div class="drawerList">
          <button class="drawerBtn" id="goDCF" type="button">
            <div class="drawerLeft">
              <div class="iconBox" aria-hidden="true">üìà</div>
              <div class="drawerText">
                <div class="drawerTitle" id="t_drawerDCF">DCF Anal√Ωza</div>
                <div class="drawerSub" id="t_drawerDCFSub">Vnit≈ôn√≠ hodnota ‚Ä¢ Bear / Base / Bull</div>
              </div>
            </div>
            <div class="chev" aria-hidden="true">‚Ä∫</div>
          </button>

          <button class="drawerBtn" id="goWatch" type="button">
            <div class="drawerLeft">
              <div class="iconBox" aria-hidden="true">üëÄ</div>
              <div class="drawerText">
                <div class="drawerTitle" id="t_drawerWatch">Watchlist</div>
                <div class="drawerSub" id="t_drawerWatchSub">Ulo≈æen√© anal√Ωzy ‚Ä¢ kopie do Excelu ‚Ä¢ PDF</div>
              </div>
            </div>
            <div class="chev" aria-hidden="true">‚Ä∫</div>
          </button>

          <button class="drawerBtn" id="goAbout" type="button">
            <div class="drawerLeft">
              <div class="iconBox" aria-hidden="true">‚ÑπÔ∏è</div>
              <div class="drawerText">
                <div class="drawerTitle" id="t_drawerAbout">O aplikaci</div>
                <div class="drawerSub" id="t_drawerAboutSub">Metodika ‚Ä¢ tipy ‚Ä¢ pro koho to je</div>
              </div>
            </div>
            <div class="chev" aria-hidden="true">‚Ä∫</div>
          </button>
        </div>
      </div>
    </section>

    <!-- DCF (zat√≠m jen hlaviƒçka + placeholder, UI dopln√≠me v d√≠lu 2/5) -->
    <section id="screenDCF" class="screen" aria-hidden="true">
      <div class="screenHead">
        <h2 class="screenTitle" id="t_dcfTitle">DCF anal√Ωza</h2>
        <div class="btnRow">
          <button class="btn" id="btnBackDCF" type="button">Zpƒõt</button>
        </div>
      </div>

      <div class="card">
        <p class="note">
          (DCF formul√°≈ô + p≈ôep√≠naƒç CZ/EN + USD/EUR bude v <b>D√çLU 2/5</b>)
        </p>
      </div>
    </section>

    <!-- WATCHLIST (dopln√≠me v d√≠lu 3/5) -->
    <section id="screenWatch" class="screen" aria-hidden="true">
      <div class="screenHead">
        <h2 class="screenTitle" id="t_watchTitle">Watchlist</h2>
        <div class="btnRow">
          <button class="btn" id="btnBackWatch" type="button">Zpƒõt</button>
        </div>
      </div>

      <div class="card">
        <p class="note">
          (Seznam ulo≈æen√Ωch v√Ωpoƒçt≈Ø + kopie do Excelu + PDF bude v <b>D√çLU 3/5</b>)
        </p>
      </div>
    </section>

    <!-- ABOUT (dopln√≠me v d√≠lu 3/5 nebo 4/5 podle velikosti) -->
    <section id="screenAbout" class="screen" aria-hidden="true">
      <div class="screenHead">
        <h2 class="screenTitle" id="t_aboutTitle">O aplikaci</h2>
        <div class="btnRow">
          <button class="btn" id="btnBackAbout" type="button">Zpƒõt</button>
        </div>
      </div>

      <div class="card">
        <p class="note">
          (Popis aplikace, pro koho je, jak funguje DCF ‚Äì bude v <b>D√çLU 3/5</b>)
        </p>
      </div>
    </section>

    <!-- JS p≈ôijde v dal≈°√≠ch d√≠lech -->
  </div>

<!-- ============ END OF PART 1/5 ============ -->
<!-- =========================
     PART 2/5 ‚Äì DCF UI + NAVIGATION
     vlo≈æit P≈òED </body>
========================= -->
<script>
/* =========================
   BASIC NAVIGATION
========================= */
const screens = {
  home: document.getElementById("screenHome"),
  dcf: document.getElementById("screenDCF"),
  watch: document.getElementById("screenWatch"),
  about: document.getElementById("screenAbout"),
};

function showScreen(name){
  Object.values(screens).forEach(s=>{
    s.classList.remove("active");
    s.setAttribute("aria-hidden","true");
  });
  screens[name].classList.add("active");
  screens[name].setAttribute("aria-hidden","false");
  window.scrollTo({top:0, behavior:"instant"});
}

// drawer buttons
document.getElementById("goDCF").onclick   = ()=>showScreen("dcf");
document.getElementById("goWatch").onclick = ()=>showScreen("watch");
document.getElementById("goAbout").onclick = ()=>showScreen("about");

// back buttons
document.getElementById("btnBackDCF").onclick   = ()=>showScreen("home");
document.getElementById("btnBackWatch").onclick = ()=>showScreen("home");
document.getElementById("btnBackAbout").onclick = ()=>showScreen("home");

/* =========================
   LANG + CURRENCY STATE
========================= */
let LANG = "cs";
let CCY  = "USD";

function setLang(l){
  LANG = l;
  document.getElementById("langCS").classList.toggle("primary", l==="cs");
  document.getElementById("langEN").classList.toggle("primary", l==="en");
}

function setCcy(c){
  CCY = c;
  document.getElementById("ccyUSD").classList.toggle("primary", c==="USD");
  document.getElementById("ccyEUR").classList.toggle("primary", c==="EUR");
}
</script>

<style>
/* =========================
   DCF FORM
========================= */
.dcfGrid{
  display:grid;
  grid-template-columns: 1fr;
  gap:14px;
}

.field{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.field label{
  font-weight:600;
  color:var(--txt);
}
.field .hint{
  font-size:13px;
  color:var(--muted2);
}
.field input{
  padding:12px 14px;
  border-radius:14px;
  border:1px solid var(--stroke2);
  background:rgba(8,10,30,.6);
  color:var(--txt);
  font-size:15px;
}

.switchRow{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.switchRow .btn{
  padding:8px 14px;
  font-size:14px;
}
</style>

<script>
/* =========================
   DCF UI INSERT
========================= */
const dcfCard = document.querySelector("#screenDCF .card");
dcfCard.innerHTML = `
  <div class="dcfGrid">

    <div class="switchRow">
      <button id="langCS" class="btn primary" onclick="setLang('cs')">CZ</button>
      <button id="langEN" class="btn" onclick="setLang('en')">EN</button>
    </div>

    <div class="switchRow">
      <button id="ccyUSD" class="btn primary" onclick="setCcy('USD')">USD</button>
      <button id="ccyEUR" class="btn" onclick="setCcy('EUR')">EUR</button>
    </div>

    <div class="field">
      <label>Ticker</label>
      <input id="inTicker" placeholder="AAPL">
      <div class="hint">Symbol akcie</div>
    </div>

    <div class="field">
      <label>FCF (posledn√≠ rok)</label>
      <input id="inFCF" inputmode="decimal" placeholder="1000000000">
      <div class="hint">Free Cash Flow</div>
    </div>

    <div class="field">
      <label>Poƒçet akci√≠</label>
      <input id="inShares" inputmode="decimal" placeholder="16000000000">
      <div class="hint">Shares outstanding</div>
    </div>

    <div class="field">
      <label>Diskontn√≠ sazba (%)</label>
      <input id="inR" inputmode="decimal" placeholder="9">
      <div class="hint">r</div>
    </div>

    <div class="field">
      <label>R≈Øst FCF ‚Äì Bear (%)</label>
      <input id="inBear" inputmode="decimal" placeholder="2">
    </div>

    <div class="field">
      <label>R≈Øst FCF ‚Äì Base (%)</label>
      <input id="inBase" inputmode="decimal" placeholder="5">
    </div>

    <div class="field">
      <label>R≈Øst FCF ‚Äì Bull (%)</label>
      <input id="inBull" inputmode="decimal" placeholder="8">
    </div>

    <div class="switchRow">
      <button class="btn primary" id="btnCalc">Spoƒç√≠tat</button>
      <button class="btn" id="btnSave">Ulo≈æit</button>
    </div>

    <p class="note">
      V√Ωpoƒçet, graf a ukl√°d√°n√≠ se p≈ôid√° v dal≈°√≠m kroku.
    </p>

  </div>
`;
</script>
<!-- ============ END OF PART 2/5 ============ -->
<!-- =========================
PART 3/5 ‚Äì DCF LOGIC + WATCHLIST (LocalStorage) + EXPORT
vlo≈æit ZA PART 2/5
========================= -->
<script>
(function(){
  "use strict";

  // =========================
  // Helpers / protections
  // =========================
  const $ = (id)=>document.getElementById(id);
  const esc = (s)=>String(s ?? "")
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");

  const parseNum = (v)=>{
    if(v===null || v===undefined) return NaN;
    const s = String(v).trim()
      .replace(/\s+/g,"")
      .replace(",",".");
    if(!s) return NaN;
    return Number(s);
  };

  const fmt = (n, digits=2)=>{
    if(!isFinite(n)) return "‚Äî";
    return n.toLocaleString(
      (window.LANG==="en" ? "en-US" : "cs-CZ"),
      { maximumFractionDigits: digits, minimumFractionDigits: digits }
    );
  };

  const fmtMoney = (n)=>{
    if(!isFinite(n)) return "‚Äî";
    const ccy = (window.CCY || "USD");
    return `${fmt(n,2)} ${ccy}`;
  };

  const toast = (title, msg)=>{
    // fallback ‚Äì kdy≈æ nem√°≈° toast komponentu
    alert((title? title + "\n\n" : "") + (msg||""));
  };

  // =========================
  // LocalStorage ‚Äì Watchlist
  // =========================
  const KEY = "equity_analyzer_watchlist_v1";

  function loadWatchlist(){
    try {
      const raw = localStorage.getItem(KEY);
      const arr = raw ? JSON.parse(raw) : [];
      return Array.isArray(arr) ? arr : [];
    } catch(e){
      return [];
    }
  }

  function saveWatchlist(arr){
    try{
      localStorage.setItem(KEY, JSON.stringify(arr));
    }catch(e){
      // storage m≈Ø≈æe b√Ωt pln√Ω / zak√°zan√Ω
      toast("Ulo≈æen√≠ selhalo", "LocalStorage nen√≠ dostupn√Ω nebo je pln√Ω.");
    }
  }

  function addToWatchlist(item){
    const arr = loadWatchlist();
    arr.unshift(item);
    if(arr.length > 100) arr.length = 100; // max 100 z√°znam≈Ø
    saveWatchlist(arr);
    renderWatchlist();
  }

  function removeFromWatchlist(idx){
    const arr = loadWatchlist();
    arr.splice(idx, 1);
    saveWatchlist(arr);
    renderWatchlist();
  }

  function clearWatchlist(){
    saveWatchlist([]);
    renderWatchlist();
  }

  // =========================
  // DCF math (Bear/Base/Bull)
  // =========================
  function calcScenario(fcf0, years, r, g, tg, netDebt){
    let pvSum = 0;
    let fcf = fcf0;

    for(let i=1; i<=years; i++){
      fcf = fcf * (1 + g);
      pvSum += fcf / Math.pow(1 + r, i);
    }

    // Terminal value
    const denom = (r - tg);
    const tv = denom > 0 ? (fcf * (1 + tg)) / denom : NaN;
    const pvTv = isFinite(tv) ? tv / Math.pow(1 + r, years) : NaN;

    const ev = pvSum + (isFinite(pvTv) ? pvTv : 0);
    const eq = ev - netDebt;
    return { pvSum, tv, pvTv, ev, eq, fcfN: fcf };
  }

  function dcfCompute(){
    const ticker = ($("inTicker")?.value || "").trim().toUpperCase();
    const years  = parseInt(($("inYears")?.value || "10"), 10);

    const fcf0   = parseNum($("inFcf")?.value);
    const r      = parseNum($("inR")?.value) / 100;
    const tg     = parseNum($("inTg")?.value) / 100;

    const netDebt = parseNum($("inNetd")?.value || "0");
    const shares  = parseNum($("inShares")?.value);
    const price   = parseNum($("inPrice")?.value);

    const gBear = parseNum($("inBear")?.value) / 100;
    const gBase = parseNum($("inBase")?.value) / 100;
    const gBull = parseNum($("inBull")?.value) / 100;

    // validace
    if(!ticker){
      toast("Chyb√≠ ticker", "Zadej ticker (nap≈ô. AAPL).");
      return null;
    }
    if(!isFinite(fcf0) || fcf0<=0){
      toast("Chyb√≠ FCF", "Zadej FCF0 (aktu√°ln√≠ voln√© cash flow).");
      return null;
    }
    if(!isFinite(r) || r<=0){
      toast("Chyb√≠ diskont", "Zadej diskontn√≠ sazbu r (%).");
      return null;
    }
    if(!isFinite(shares) || shares<=0){
      toast("Chyb√≠ poƒçet akci√≠", "Zadej poƒçet akci√≠ (Shares outstanding).");
      return null;
    }

    const scBear = calcScenario(fcf0, years, r, gBear, tg, netDebt);
    const scBase = calcScenario(fcf0, years, r, gBase, tg, netDebt);
    const scBull = calcScenario(fcf0, years, r, gBull, tg, netDebt);

    const fairBear = scBear.eq / shares;
    const fairBase = scBase.eq / shares;
    const fairBull = scBull.eq / shares;

    const now = new Date();
    const item = {
      ts: now.toISOString(),
      date: now.toLocaleString(window.LANG==="en" ? "en-US" : "cs-CZ"),
      ticker,
      ccy: (window.CCY || "USD"),
      inputs: { years, fcf0, r, tg, netDebt, shares, price, gBear, gBase, gBull },
      results: { fairBear, fairBase, fairBull, evBase: scBase.ev, eqBase: scBase.eq }
    };

    // vyps√°n√≠ do UI (pokud existuje)
    const resBox = $("resBox");
    if(resBox){
      resBox.classList.add("show");
      const el = (id, txt)=>{ const n=$(id); if(n) n.textContent = txt; };
      el("outTicker", ticker);
      el("outBear", fmtMoney(fairBear));
      el("outBase", fmtMoney(fairBase));
      el("outBull", fmtMoney(fairBull));
      el("outPrice", isFinite(price) ? fmtMoney(price) : "‚Äî");
      el("outDate", item.date);
    }

    // jednoduch√Ω ‚Äúgraf‚Äù pokud nem√°≈° chart.js v part1 (jen text)
    const chartSub = $("t_chartSub");
    if(chartSub){
      chartSub.textContent =
        (window.LANG==="en")
          ? "Bear/Base/Bull fair value per share"
          : "F√©rov√° hodnota na akcii (Bear/Base/Bull)";
    }

    // pokud m√°≈° Chart.js p≈ôipojen√Ω v PART 1, zkus√≠me ho pou≈æ√≠t
    try{
      const canvas = $("dcfChart");
      if(canvas && window.Chart){
        const ctx = canvas.getContext("2d");
        if(window.__dcfChart) window.__dcfChart.destroy();
        window.__dcfChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["Bear","Base","Bull"],
            datasets: [{
              label: (window.LANG==="en" ? "Fair value" : "F√©rov√° hodnota"),
              data: [fairBear, fairBase, fairBull]
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: true } }
          }
        });
      }
    }catch(e){
      // ignoruj ‚Äì graf nen√≠ kritick√Ω
    }

    return item;
  }

  // =========================
  // WATCHLIST render (UI)
  // =========================
  function renderWatchlist(){
    const wrap = $("watchList");
    const empty = $("t_emptyWatch");
    if(!wrap) return;

    const arr = loadWatchlist();
    if(empty) empty.style.display = arr.length ? "none" : "block";

    // pokud m√°≈° tabulku
    const tbody = $("watchTbody");
    if(tbody){
      tbody.innerHTML = "";
      arr.forEach((it, idx)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${esc(it.ticker)}</td>
          <td>${esc(it.date || "")}</td>
          <td>${fmtMoney(it.results?.fairBear)}</td>
          <td>${fmtMoney(it.results?.fairBase)}</td>
          <td>${fmtMoney(it.results?.fairBull)}</td>
          <td>
            <button class="btn sm" data-act="copy" data-idx="${idx}">${window.LANG==="en"?"Copy":"Kop√≠rovat"}</button>
            <button class="btn sm" data-act="del" data-idx="${idx}">${window.LANG==="en"?"Delete":"Smazat"}</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      tbody.onclick = async (e)=>{
        const b = e.target.closest("button");
        if(!b) return;
        const idx = parseInt(b.getAttribute("data-idx"), 10);
        const act = b.getAttribute("data-act");
        const item = loadWatchlist()[idx];
        if(!item) return;

        if(act==="del"){
          removeFromWatchlist(idx);
        }
        if(act==="copy"){
          const line = [
            item.ticker,
            item.date,
            item.ccy,
            item.results?.fairBear,
            item.results?.fairBase,
            item.results?.fairBull
          ].join("\t");
          try{
            await navigator.clipboard.writeText(line);
            toast("OK", window.LANG==="en" ? "Copied to clipboard." : "Zkop√≠rov√°no do schr√°nky.");
          }catch(err){
            toast("Kopie", line);
          }
        }
      };
      return;
    }

    // fallback ‚Äì kdy≈æ nem√°≈° tabulku, vyrob√≠me jednoduch√Ω seznam
    wrap.innerHTML = "";
    arr.forEach((it, idx)=>{
      const div = document.createElement("div");
      div.className = "wlItem";
      div.innerHTML = `
        <div class="wlMain">
          <div class="wlTop"><strong>${esc(it.ticker)}</strong> <span class="muted">${esc(it.date||"")}</span></div>
          <div class="wlVals">
            <span>Bear: <b>${fmtMoney(it.results?.fairBear)}</b></span>
            <span>Base: <b>${fmtMoney(it.results?.fairBase)}</b></span>
            <span>Bull: <b>${fmtMoney(it.results?.fairBull)}</b></span>
          </div>
        </div>
        <div class="wlBtns">
          <button class="btn sm" data-act="del" data-idx="${idx}">${window.LANG==="en"?"Delete":"Smazat"}</button>
        </div>
      `;
      wrap.appendChild(div);
    });

    wrap.onclick = (e)=>{
      const b = e.target.closest("button");
      if(!b) return;
      const idx = parseInt(b.getAttribute("data-idx"), 10);
      const act = b.getAttribute("data-act");
      if(act==="del") removeFromWatchlist(idx);
    };
  }

  // =========================
  // EXPORT ‚Äì PDF / COPY
  // =========================
  async function exportWatchlistToClipboard(){
    const arr = loadWatchlist();
    if(!arr.length){
      toast("Watchlist", window.LANG==="en" ? "No items." : "Watchlist je pr√°zdn√Ω.");
      return;
    }
    const header = ["Ticker","Date","CCY","Bear","Base","Bull"].join("\t");
    const rows = arr.map(it=>[
      it.ticker,
      it.date || "",
      it.ccy || "",
      (it.results?.fairBear ?? ""),
      (it.results?.fairBase ?? ""),
      (it.results?.fairBull ?? "")
    ].join("\t"));
    const text = [header, ...rows].join("\n");

    try{
      await navigator.clipboard.writeText(text);
      toast("OK", window.LANG==="en" ? "Watchlist copied." : "Watchlist zkop√≠rov√°n (TSV).");
    }catch(e){
      toast("Kopie (TSV)", text);
    }
  }

  function exportWatchlistToPDF(){
    // nejjednodu≈°≈°√≠ ‚ÄúPDF export‚Äù p≈ôes print dialog (funguje v≈°ude)
    // doporuƒçuju m√≠t v CSS @media print, ale i bez toho to projde
    window.print();
  }

  // =========================
  // Bind UI events (pokud ID existuj√≠)
  // =========================
  function bind(){
    // DCF buttons
    $("btnCalc")?.addEventListener("click", ()=>{
      dcfCompute();
    });

    $("btnSave")?.addEventListener("click", ()=>{
      const item = dcfCompute();
      if(item){
        addToWatchlist(item);
        toast("Ulo≈æeno", window.LANG==="en" ? "Saved to watchlist." : "Ulo≈æeno do watchlistu.");
      }
    });

    // Watchlist buttons (pokud je m√°≈° ve sv√© HTML)
    $("btnExportPdf")?.addEventListener("click", exportWatchlistToPDF);
    $("btnCopyAll")?.addEventListener("click", exportWatchlistToClipboard);
    $("btnClearWatch")?.addEventListener("click", ()=>{
      if(confirm(window.LANG==="en" ? "Clear watchlist?" : "Smazat cel√Ω watchlist?")){
        clearWatchlist();
      }
    });

    // v≈ædy po naƒçten√≠
    renderWatchlist();
  }

  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", bind);
  } else {
    bind();
  }

  // expose pro dal≈°√≠ ƒç√°sti
  window.renderWatchlist = renderWatchlist;
  window.addToWatchlist = addToWatchlist;

})();
</script>

<!-- ============ END OF PART 3/5 ============ -->
<!-- =========================
PART 4/5 ‚Äì UI FIXES (DRAWER, SWITCHES) + WATCHLIST UI BUILD
vlo≈æit ZA PART 3/5
========================= -->
<style>
  /* --- Drawer (home cards) fix: ƒçitelnost + klikatelnost */
  .drawerItem, .drawerCard, .drawerRow, .rowCard {
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
  }
  .drawerItem *, .drawerCard * { pointer-events: none; } /* klik projde na kartu */
  .drawerItem, .drawerCard {
    color: rgba(255,255,255,.92) !important;
  }
  .drawerItem .sub, .drawerCard .sub, .drawerItem small, .drawerCard small {
    color: rgba(255,255,255,.65) !important;
  }

  /* --- Horn√≠ p≈ôep√≠naƒçe: a≈• nejsou u≈ô√≠zl√Ω a jsou vidƒõt */
  .topRow, .headerRow, .switchTop, .pillRow {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
  }
  .pill, .chip, .togglePill, .langPill, .ccyPill {
    min-width: 72px;
    text-align: center;
  }

  /* --- Watchlist UI */
  .wlToolbar{
    display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:10px;
  }
  .wlTable{
    width:100%;
    border-collapse: collapse;
    overflow:hidden;
    border-radius:14px;
  }
  .wlTable th, .wlTable td{
    padding:10px 10px;
    font-size: 14px;
    border-bottom: 1px solid rgba(255,255,255,.08);
    color: rgba(255,255,255,.92);
  }
  .wlTable th{
    color: rgba(255,255,255,.7);
    font-weight: 600;
    letter-spacing: .02em;
  }
  .wlTable tr:last-child td{ border-bottom:none; }
  .btn.sm{ padding:8px 10px; border-radius:12px; font-size: 13px; }
  .muted{ color: rgba(255,255,255,.65); }
  .note{ color: rgba(255,255,255,.75); }
</style>

<script>
(function(){
  "use strict";

  // ---------- translations (jen ty nejd≈Øle≈æitƒõj≈°√≠ texty)
  const T = {
    cs: {
      dcf: "DCF anal√Ωza",
      watch: "Watchlist",
      about: "O aplikaci",
      copy: "Kop√≠rovat",
      del: "Smazat",
      clear: "Smazat v≈°e",
      copyAll: "Kop√≠rovat v≈°e (TSV)",
      exportPdf: "Export do PDF",
      empty: "Zat√≠m tu nic nen√≠. Ulo≈æ prvn√≠ v√Ωpoƒçet v DCF.",
      wlTitle: "Ulo≈æen√© v√Ωsledky",
    },
    en: {
      dcf: "DCF analysis",
      watch: "Watchlist",
      about: "About",
      copy: "Copy",
      del: "Delete",
      clear: "Clear all",
      copyAll: "Copy all (TSV)",
      exportPdf: "Export to PDF",
      empty: "Nothing here yet. Save your first DCF result.",
      wlTitle: "Saved results",
    }
  };

  const $ = (id)=>document.getElementById(id);

  function lang(){ return (window.LANG === "en") ? "en" : "cs"; }

  // ---------- Drawer click fix (aby ≈°ly otev√≠rat ≈°upl√≠ky)
  function bindDrawer(){
    // Zkus√≠me nejƒçastƒõj≈°√≠ ID, co tam m√°≈°
    const map = [
      { ids: ["drawerDCF","goDCF","btnDCF"], screen:"dcf" },
      { ids: ["drawerWatch","goWatch","btnWatch"], screen:"watch" },
      { ids: ["drawerAbout","goAbout","btnAbout"], screen:"about" },
    ];

    map.forEach(m=>{
      m.ids.forEach(id=>{
        const el = $(id);
        if(el){
          el.style.pointerEvents = "auto";
          el.addEventListener("click", (e)=>{
            e.preventDefault();
            e.stopPropagation();
            if(typeof window.showScreen === "function"){
              window.showScreen(m.screen);
            }
          }, { passive:false });
        }
      });
    });

    // Fallback: kdy≈æ jsou to ‚Äúkarty‚Äù bez tƒõch ID,
    // tak klik na prvky, kter√© obsahuj√≠ text drawerDCF / drawerWatch / drawerAbout
    const body = document.body;
    body.addEventListener("click", (e)=>{
      const card = e.target.closest(".drawerItem, .drawerCard, .rowCard, .cardRow");
      if(!card) return;

      const txt = (card.textContent || "").toLowerCase();
      if(txt.includes("drawerdfc") || txt.includes("dcf")){
        window.showScreen?.("dcf");
      } else if(txt.includes("drawerwatch") || txt.includes("watch")){
        window.showScreen?.("watch");
      } else if(txt.includes("drawerabout") || txt.includes("about")){
        window.showScreen?.("about");
      }
    }, true);
  }

  // ---------- Watchlist UI builder (kdy≈æ chyb√≠ tabulka/btns v HTML)
  function ensureWatchlistUI(){
    const screen = $("screenWatch") || document.querySelector("#screenWatch");
    if(!screen) return;

    // kde to vykreslovat
    let wrap = $("watchList");
    if(!wrap){
      // zkus naj√≠t nƒõjak√Ω card v watch screenu
      wrap = document.createElement("div");
      wrap.id = "watchList";
      screen.querySelector(".screenBody")?.appendChild(wrap) || screen.appendChild(wrap);
    }

    // toolbar
    let toolbar = $("wlToolbar");
    if(!toolbar){
      toolbar = document.createElement("div");
      toolbar.id = "wlToolbar";
      toolbar.className = "wlToolbar";

      const title = document.createElement("div");
      title.id = "wlTitle";
      title.className = "muted";
      title.style.fontWeight = "700";
      title.textContent = T[lang()].wlTitle;

      const btnCopyAll = document.createElement("button");
      btnCopyAll.className = "btn sm";
      btnCopyAll.id = "btnCopyAll";
      btnCopyAll.type = "button";
      btnCopyAll.textContent = T[lang()].copyAll;

      const btnExport = document.createElement("button");
      btnExport.className = "btn sm";
      btnExport.id = "btnExportPdf";
      btnExport.type = "button";
      btnExport.textContent = T[lang()].exportPdf;

      const btnClear = document.createElement("button");
      btnClear.className = "btn sm";
      btnClear.id = "btnClearWatch";
      btnClear.type = "button";
      btnClear.textContent = T[lang()].clear;

      toolbar.appendChild(title);
      toolbar.appendChild(btnCopyAll);
      toolbar.appendChild(btnExport);
      toolbar.appendChild(btnClear);

      wrap.parentNode.insertBefore(toolbar, wrap);
    }

    // empty message
    let empty = $("t_emptyWatch");
    if(!empty){
      empty = document.createElement("p");
      empty.id = "t_emptyWatch";
      empty.className = "note";
      empty.textContent = T[lang()].empty;
      wrap.parentNode.insertBefore(empty, wrap);
    }

    // table
    let table = $("wlTable");
    if(!table){
      table = document.createElement("table");
      table.id = "wlTable";
      table.className = "wlTable";

      table.innerHTML = `
        <thead>
          <tr>
            <th>Ticker</th>
            <th>Datum</th>
            <th>Bear</th>
            <th>Base</th>
            <th>Bull</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="watchTbody"></tbody>
      `;
      wrap.innerHTML = "";
      wrap.appendChild(table);
    }
  }

  // ---------- Text refresh (kdy≈æ p≈ôepne≈° jazyk)
  function refreshTexts(){
    const L = lang();
    $("wlTitle") && ($("wlTitle").textContent = T[L].wlTitle);
    $("btnCopyAll") && ($("btnCopyAll").textContent = T[L].copyAll);
    $("btnExportPdf") && ($("btnExportPdf").textContent = T[L].exportPdf);
    $("btnClearWatch") && ($("btnClearWatch").textContent = T[L].clear);
    $("t_emptyWatch") && ($("t_emptyWatch").textContent = T[L].empty);
  }

  function init(){
    bindDrawer();
    ensureWatchlistUI();
    refreshTexts();

    // po p≈ôepnut√≠ jazyka (pokud ho ≈ôe≈°√≠≈° tlaƒç√≠tkem) zkus√≠me p≈ôerender
    document.addEventListener("click", ()=>{
      // jen ‚Äúsoft‚Äù update ‚Äì nic nerozbije
      refreshTexts();
      window.renderWatchlist?.();
    });

    // pro jistotu ‚Äì kdyby se watch UI vytvo≈ôilo a≈æ po p≈ôepnut√≠ screenu
    window.addEventListener("hashchange", ()=>{
      ensureWatchlistUI();
      refreshTexts();
      window.renderWatchlist?.();
    });

    // render hned
    window.renderWatchlist?.();
  }

  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }
})();
</script>

<!-- ============ END OF PART 4/5 ============ -->
  <!-- =========================
PART 5/5A ‚Äì FINAL UI HELPERS
vlo≈æit ZA END OF PART 4/5
========================= -->
<script>
/* =========================
   HELPERS
========================= */

function $(id){
  return document.getElementById(id);
}

function qs(sel, root=document){
  return root.querySelector(sel);
}

/* =========================
   MOVE LANGUAGE + CURRENCY
   INTO DCF HEADER
========================= */

function moveSwitchesIntoDCF(){
  const dcf = $("screenDCF");
  if(!dcf) return;

  const head = qs(".screenHeader", dcf);
  if(!head) return;

  let row = qs(".dcfHeaderRow", dcf);
  if(!row){
    row = document.createElement("div");
    row.className = "dcfHeaderRow";
    row.style.display = "flex";
    row.style.flexWrap = "wrap";
    row.style.gap = "8px";
    row.style.marginTop = "8px";

    const h2 = qs("h2", head);
    if(h2 && h2.parentNode){
      h2.parentNode.insertBefore(row, h2.nextSibling);
    } else {
      head.appendChild(row);
    }
  }

  const lang = qs(".langSwitch");
  const cur  = qs(".currencySwitch");

  if(lang) row.appendChild(lang);
  if(cur)  row.appendChild(cur);
}

/* =========================
   SAFE INIT
========================= */

function initPart5A(){
  moveSwitchesIntoDCF();
}
</script>
<!-- ===== END OF PART 5A ===== -->
<!-- =========================
PART 5/5B ‚Äì FINAL INIT
vlo≈æit POD PART 5A
========================= -->
<script>
/* =========================
   FINAL INIT
========================= */

function initPart5B(){
  initPart5A();

  // po p≈ôepnut√≠ obrazovky znovu p≈ôesunout
  window.addEventListener("hashchange", ()=>{
    moveSwitchesIntoDCF();
  });

  // po prvn√≠m loadu
  moveSwitchesIntoDCF();
}

/* =========================
   RUN
========================= */
if(document.readyState === "loading"){
  document.addEventListener("DOMContentLoaded", initPart5B);
}else{
  initPart5B();
}
</script>
<!-- ============ END OF PART 5/5 ============ -->
    
  



      
  

    



    





  
  


  





        


        



  


 

            

        




          

        

          





  

  

  


  


    


      

  

    

          
    

    

    
    


    





    

    

  
        

    
    

  

  





