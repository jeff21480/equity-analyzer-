i<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Anal√Ωza akci√≠ ‚Äì MVP</title>

  <style>
    :root{
      /* Vibrant background (fialovo-modr√©, ale ne vyblit√©) */
    --bgA:#0b0a16;
--bgB:#12102a;
--bgC:#1a1238;

      /* Screens / surfaces */
  --cardHome: rgba(20, 14, 45, .85);
--cardHome2: rgba(20, 14, 45, .72);

      --stroke: rgba(178, 140, 255, .28);
      --stroke2: rgba(0,0,0,.35);

      --text: rgba(255,255,255,.95);
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.55);

      --good:#2cff9a;
      --bad:#ff4d6d;
      --warn:#ffd166;

      --radius: 22px;
      --shadow: 0 22px 70px rgba(5,3,20,.75);
--shadow2: 0 14px 40px rgba(5,3,20,.6);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
      color: var(--text);
      overflow-x:hidden; /* kl√≠ƒçov√© proti posunu do strany */
      background: linear-gradient(135deg, var(--bgA) 0%, var(--bgB) 55%, var(--bgC) 100%);
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 14px 50px;
    }

    /* Screen routing */
    .screen{ display:none; }
    .screen.active{ display:block; animation: pop .18s ease-out; }
    @keyframes pop{
      from{ transform: translateY(6px); opacity:.0; }
      to{ transform: translateY(0); opacity:1; }
    }

    /* Home hero */
    .hero{
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.09));
      border: 1px solid rgba(255,255,255,.22);
      border-radius: 28px;
      box-shadow: var(--shadow);
      padding: 18px 18px 16px;
      backdrop-filter: blur(14px);
    }
    .topRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 10px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
      max-width: 100%;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: rgba(255,255,255,.95);
      background: rgba(255,255,255,.70);
      flex:0 0 auto;
    }
    .pill small{ color: var(--muted); font-weight: 650; letter-spacing: .2px; }
    .mvp{
      opacity: .92;
      font-weight: 900;
      letter-spacing: .6px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.20);
      background: rgba(0,0,0,.12);
      backdrop-filter: blur(10px);
      flex:0 0 auto;
    }

    h1{
      margin: 6px 0 8px;
      font-size: clamp(34px, 6vw, 54px);
      line-height: 1.05;
      letter-spacing: .2px;
    }
    .sub{
      margin: 0;
      color: var(--muted);
      line-height: 1.5;
      max-width: 65ch;
      font-size: 16px;
    }

    .homeCard{
  width: 100%;
  border-radius: 26px;
  padding: 16px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 14px;
  cursor: pointer;
  color: var(--text);
  text-align: left;
  text-decoration: none;

  /* TADY JE TEN D≈ÆLE≈ΩIT√ù FIX */
  background: linear-gradient(
  180deg,
  rgba(40, 28, 90, 0.92),
  rgba(22, 16, 55, 0.95)
);

border: 1px solid rgba(150, 120, 255, 0.45);

  /* ZRU≈†√çME ML√âƒåN√ù EFEKT */
  backdrop-filter: none;

  box-shadow:
    0 18px 45px rgba(0,0,0,0.45),
    inset 0 1px 0 rgba(255,255,255,0.04);
    }
    .homeCard:active{ transform: translateY(1px); }
    .homeCard:hover{ transform: translateY(-1px); box-shadow: 0 22px 60px rgba(10,6,30,.55); }

    .homeLeft{
      display:flex;
      align-items:center;
      gap: 14px;
      min-width:0;
    }
    .homeIcon{
      width: 52px;
      height: 52px;
      border-radius: 18px;
      display:grid;
      place-items:center;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.12);
      box-shadow: 0 10px 26px rgba(0,0,0,.18);
      flex:0 0 auto;
      font-size: 22px;
    }
    .homeText{ min-width:0; }
    .homeTitle{
      font-weight: 950;
      font-size: 22px;
      letter-spacing: .2px;
      margin: 0 0 3px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .homeSub{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    background: rgba(18, 12, 45, 0.85);
border: 1px solid rgba(140, 110, 255, 0.35);

    /* Inner screen shell */
    .shell{
      background: var(--surface);
      border: 1px solid var(--stroke);
      border-radius: 28px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
      overflow:hidden;
    }
    .shellHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 14px 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .backBtn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 18px;
      padding: 10px 12px;
      cursor:pointer;
      font-weight: 800;
      -webkit-tap-highlight-color: transparent;
    }
    .backBtn:active{ transform: translateY(1px); }
    .miniPill{
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-weight: 850;
      letter-spacing: .4px;
      max-width: 70%;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .shellBody{
      padding: 16px 14px 18px;
    }

    /* Sections inside screens */
    .card{
      background: var(--surface2);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 22px;
      padding: 14px;
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
    }
    .cardTitle{
      font-weight: 950;
      font-size: 20px;
      margin: 0 0 6px;
    }
    .cardSub{
      margin: 0 0 12px;
      color: var(--muted);
      line-height: 1.5;
      font-size: 14px;
    }

    .formGrid{
      display:grid;
      gap: 12px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 780px){
      .formGrid.two{ grid-template-columns: 1fr 1fr; }
      .homeList{ grid-template-columns: 1fr; }
    }

    .field{ min-width:0; }
    .labelRow{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:10px;
      margin-bottom: 6px;
    }
    label{
      font-weight: 850;
      color: #fff;
      font-size: 13px;
      letter-spacing: .2px;
    }
    .hintInline{
      color: var(--muted2);
      font-size: 12px;
      line-height: 1.3;
    }

    input, select{
      width:100%;
      background: rgba(10, 7, 30, .72);
      color: #fff;
      border: 1px solid rgba(178, 140, 255, .28);
      border-radius: 14px;
      padding: 12px 12px;
      font-size: 15px;
      outline:none;
    }
    input::placeholder{ color: rgba(255,255,255,.40); }
    input:focus, select:focus{
      border-color: rgba(190,160,255,.75);
      box-shadow: 0 0 0 2px rgba(190,160,255,.24);
    }

    .btnRow{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }
    .btn{
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: #fff;
      border-radius: 16px;
      padding: 12px 14px;
      cursor:pointer;
      font-weight: 900;
      letter-spacing: .2px;
      -webkit-tap-highlight-color: transparent;
    }
    .btn.primary{
      background: linear-gradient(180deg, rgba(200,140,255,.35), rgba(110,70,255,.18));
      border-color: rgba(200,140,255,.45);
    }
    .btn.danger{
      background: linear-gradient(180deg, rgba(255,80,120,.28), rgba(255,80,120,.12));
      border-color: rgba(255,80,120,.35);
    }
    .btn:active{ transform: translateY(1px); }

    .msg{
      margin-top: 10px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }

    .resultCard{
      margin-top: 14px;
      display:none;
    }
    .resultHeader{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .summaryBadge{
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-weight: 900;
      letter-spacing: .2px;
      font-size: 12px;
      white-space:nowrap;
    }
    .scRow{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 780px){
      .scRow{ grid-template-columns: 1fr 1fr 1fr; }
    }
    .scCard{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.10);
      border-radius: 18px;
      padding: 12px 12px;
    }
    .scTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      margin-bottom: 6px;
    }
    .scName{
      font-weight: 950;
      letter-spacing: .2px;
    }
    .tag{
      font-weight: 950;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      white-space:nowrap;
    }
    .tag.good{ color: rgba(44,255,154,.95); border-color: rgba(44,255,154,.22); }
    .tag.bad{ color: rgba(255,77,109,.95); border-color: rgba(255,77,109,.22); }
    .bigVal{
      font-size: 28px;
      font-weight: 980;
      letter-spacing: .2px;
      margin: 2px 0 6px;
    }
    .line{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      color: var(--muted);
      font-size: 13px;
      padding: 4px 0;
      border-top: 1px dashed rgba(255,255,255,.10);
    }
    .line:first-of-type{ border-top: none; }
    .mono{ font-variant-numeric: tabular-nums; font-feature-settings: "tnum" 1; }

    /* Watchlist list */
    .wlList{
      display:grid;
      gap: 10px;
      margin-top: 10px;
    }
    .wlItem{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap: 12px;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.10);
    }
    .wlLeft{ min-width:0; }
    .wlTitle{
      margin:0 0 4px;
      font-weight: 950;
      letter-spacing: .2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .wlMeta{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }
    .wlBtns{
      display:flex;
      gap: 8px;
      flex:0 0 auto;
    }
    .iconBtn{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
      border-radius: 14px;
      padding: 10px 10px;
      cursor:pointer;
      font-weight: 950;
      -webkit-tap-highlight-color: transparent;
    }
    .iconBtn.danger{
      border-color: rgba(255,80,120,.30);
      background: rgba(255,80,120,.12);
    }

    /* About text */
    .about p, .about li{
      color: var(--muted);
      line-height: 1.6;
      margin: 10px 0;
    }
    .about h3{
      margin: 14px 0 8px;
      font-size: 18px;
    }
    .divider{
      height:1px;
      background: rgba(255,255,255,.10);
      margin: 14px 0;
    }

    /* Small footer note */
    .footerNote{
      margin-top: 14px;
      color: rgba(255,255,255,.42);
      font-size: 12px;
      line-height: 1.45;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- HOME -->
    <section id="screen-home" class="screen active">
      <div class="hero">
        <div class="topRow">
          <div class="pill">
            <span class="dot"></span>
            <small>Anal√Ωza akci√≠ ‚Ä¢ Beta</small>
          </div>
          <div class="mvp">MVP</div>
        </div>

        <h1>Anal√Ωza akci√≠</h1>
        <p class="sub">
          Appka pro investory: DCF odhad vnit≈ôn√≠ hodnoty (Bear/Base/Bull) + Watchlist ulo≈æen√Ωch v√Ωsledk≈Ø.
        </p>

        <div class="homeList" style="margin-top:16px;">
          <button class="homeCard" data-open="dcf" type="button">
            <div class="homeLeft">
              <div class="homeIcon">üìà</div>
              <div class="homeText">
                <div class="homeTitle">DCF Anal√Ωza</div>
                <p class="homeSub">Vnit≈ôn√≠ hodnota ‚Ä¢ Bear / Base / Bull</p>
              </div>
            </div>
            <div class="chev">‚Ä∫</div>
          </button>

          <button class="homeCard" data-open="watchlist" type="button">
            <div class="homeLeft">
              <div class="homeIcon">üëÄ</div>
              <div class="homeText">
                <div class="homeTitle">Watchlist</div>
                <p class="homeSub">Ulo≈æen√© anal√Ωzy ‚Ä¢ maz√°n√≠ po jedn√©</p>
              </div>
            </div>
            <div class="chev">‚Ä∫</div>
          </button>

          <button class="homeCard" data-open="about" type="button">
            <div class="homeLeft">
              <div class="homeIcon">‚ÑπÔ∏è</div>
              <div class="homeText">
                <div class="homeTitle">O aplikaci</div>
                <p class="homeSub">Metodika ‚Ä¢ jak funguje DCF ‚Ä¢ tipy</p>
              </div>
            </div>
            <div class="chev">‚Ä∫</div>
          </button>
        </div>
      </div>
    </section>

    <!-- DCF -->
    <section id="screen-dcf" class="screen">
      <div class="shell">
        <div class="shellHeader">
          <button class="backBtn" data-open="home" type="button">‚Üê Zpƒõt</button>
          <div class="miniPill">DCF (Bear / Base / Bull)</div>
        </div>

        <div class="shellBody">
          <div class="card">
            <div class="cardTitle">Vstupy</div>
            <p class="cardSub">
              Tip: m≈Ø≈æe≈° ps√°t <b>desetinnou ƒç√°rkou</b> (nap≈ô. 9,5) i s mezerami (nap≈ô. 1 234,56). Appka si to sama p≈ôevede.
            </p>

            <div class="formGrid two">
              <div class="field">
                <div class="labelRow">
                  <label for="d_ticker">Ticker</label>
                  <div class="hintInline">jen pro pojmenov√°n√≠</div>
                </div>
                <input id="d_ticker" type="text" placeholder="nap≈ô. SOFI" inputmode="text" />
              </div>

              <div class="field">
                <div class="labelRow">
                  <label for="d_price">Aktu√°ln√≠ cena (na akcii)</label>
                  <div class="hintInline">pro porovn√°n√≠</div>
                </div>
                <input id="d_price" type="text" placeholder="nap≈ô. 12,50" inputmode="decimal" />
              </div>

              <div class="field">
                <div class="labelRow">
                  <label for="d_fcf">FCF na akcii (TTM / posledn√≠ rok)</label>
                  <div class="hintInline">jednodu≈°≈°√≠ ne≈æ cel√© v√Ωkazy</div>
                </div>
                <input id="d_fcf" type="text" placeholder="nap≈ô. 0,85" inputmode="decimal" />
              </div>

              <div class="field">
                <div class="labelRow">
                  <label for="d_years">Poƒçet let projekce</label>
                  <div class="hintInline">typicky 5‚Äì10</div>
                </div>
                <input id="d_years" type="text" placeholder="nap≈ô. 7" inputmode="numeric" />
              </div>

              <div class="field">
                <div class="labelRow">
                  <label for="d_r">Diskont (WACC) %</label>
                  <div class="hintInline">nap≈ô. 9</div>
                </div>
                <input id="d_r" type="text" placeholder="nap≈ô. 9" inputmode="decimal" />
              </div>

              <div class="field">
                <div class="labelRow">
                  <label for="d_mos">Margin of Safety</label>
                  <div class="hintInline">sn√≠≈æ√≠ c√≠lovou cenu</div>
                </div>
                <select id="d_mos">
                  <option value="0">0 %</option>
                  <option value="10">10 %</option>
                  <option value="15">15 %</option>
                  <option value="20" selected>20 %</option>
                  <option value="25">25 %</option>
                  <option value="30">30 %</option>
                </select>
              </div>
            </div>

            <div class="divider"></div>

            <div class="formGrid two">
              <div class="field">
                <div class="labelRow">
                  <label for="d_bear_g">Bear r≈Øst FCF %</label>
                  <div class="hintInline">roƒçnƒõ</div>
                </div>
                <input id="d_bear_g" type="text" placeholder="nap≈ô. 5" inputmode="decimal" />
              </div>

              <div class="field">
                <div class="labelRow">
                  <label for="d_bear_gt">Bear termin√°l %</label>
                  <div class="hintInline">dlouhodobƒõ</div>
                </div>
                <input id="d_bear_gt" type="text" placeholder="nap≈ô. 2" inputmode="decimal" />
              </div>

              <div class="field">
                <div class="labelRow">
                  <label for="d_base_g">Base r≈Øst FCF %</label>
                  <div class="hintInline">roƒçnƒõ</div>
                </div>
                <input id="d_base_g" type="text" placeholder="nap≈ô. 10" inputmode="decimal" />
              </div>

              <div class="field">
                <div class="labelRow">
                  <label for="d_base_gt">Base termin√°l %</label>
                  <div class="hintInline">dlouhodobƒõ</div>
                </div>
                <input id="d_base_gt" type="text" placeholder="nap≈ô. 3" inputmode="decimal" />
              </div>

              <div class="field">
                <div class="labelRow">
                  <label for="d_bull_g">Bull r≈Øst FCF %</label>
                  <div class="hintInline">roƒçnƒõ</div>
                </div>
                <input id="d_bull_g" type="text" placeholder="nap≈ô. 15" inputmode="decimal" />
              </div>

              <div class="field">
                <div class="labelRow">
                  <label for="d_bull_gt">Bull termin√°l %</label>
                  <div class="hintInline">dlouhodobƒõ</div>
                </div>
                <input id="d_bull_gt" type="text" placeholder="nap≈ô. 3" inputmode="decimal" />
              </div>
            </div>

            <div class="btnRow">
              <button class="btn primary" id="btnDcfCalc" type="button">Spoƒç√≠tat</button>
              <button class="btn" id="btnDcfExample" type="button">Doplnit p≈ô√≠klad</button>
              <button class="btn" id="btnDcfSave" type="button">Ulo≈æit do Watchlistu</button>
              <button class="btn danger" id="btnDcfReset" type="button">Reset</button>
            </div>

            <div class="msg" id="dcfMsg"></div>

          <div class="card resultCard" id="dcfResultCard">
            <div class="resultHeader">
              <div class="cardTitle" style="margin:0;">V√Ωsledek</div>
              <div class="summaryBadge" id="dcfSummary">‚Äî</div>
            </div>

            <div class="scRow" id="dcfScenarios"></div>

            <div class="footerNote">
              Pozn.: Jde o zjednodu≈°en√Ω DCF ‚Äûna akcii‚Äú (FCF na akcii). Je to rychl√Ω odhad, ne pln√° valuace.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- WATCHLIST -->
    <section id="screen-watchlist" class="screen">
      <div class="shell">
        <div class="shellHeader">
          <button class="backBtn" data-open="home" type="button">‚Üê Zpƒõt</button>
          <div class="miniPill">Watchlist (ulo≈æen√© anal√Ωzy)</div>
        </div>

        <div class="shellBody">
          <div class="card">
            <div class="cardTitle">Ulo≈æen√© polo≈æky</div>
            <p class="cardSub">
              Ka≈ædou polo≈æku m≈Ø≈æe≈° smazat zvl√°≈°≈•. Data se ukl√°daj√≠ do prohl√≠≈æeƒçe (localStorage).
            </p>

            <div class="btnRow">
              <button class="btn" id="btnWlRefresh" type="button">Obnovit</button>
              <button class="btn danger" id="btnWlClear" type="button">Smazat v≈°e</button>
            </div>

            <div class="msg" id="wlMsg"></div>
            <div class="wlList" id="wlList"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ABOUT -->
    <section id="screen-about" class="screen">
      <div class="shell">
        <div class="shellHeader">
          <button class="backBtn" data-open="home" type="button">‚Üê Zpƒõt</button>
          <div class="miniPill">O aplikaci</div>
        </div>

        <div class="shellBody">
          <div class="card about">
            <div class="cardTitle">K ƒçemu to je</div>
            <p>
              Tahle appka je rychl√Ω ‚Äûinvestiƒçn√≠ z√°pisn√≠k‚Äú pro odhad <b>vnit≈ôn√≠ hodnoty</b> akcie pomoc√≠ DCF sc√©n√°≈ô≈Ø
              <b>Bear / Base / Bull</b> a ukl√°d√°n√≠ v√Ωsledk≈Ø do Watchlistu.
            </p>

            <div class="divider"></div>

            <h3>Jak funguje DCF v t√©to appce</h3>
            <p>
              Zad√°≈° <b>FCF na akcii</b> (posledn√≠ rok), r≈Øst na nƒõkolik let, diskontn√≠ sazbu a termin√°ln√≠ r≈Øst.
              Appka spoƒç√≠t√° souƒçasnou hodnotu budouc√≠ch FCF + termin√°ln√≠ hodnotu a p≈ôevede to na odhad ‚Äûfair value‚Äú.
            </p>
            <ul>
              <li><b>Diskont</b> = ‚Äûkolik chci roƒçnƒõ vydƒõlat‚Äú / riziko (nap≈ô. 9 %).</li>
              <li><b>Termin√°ln√≠ r≈Øst</b> = dlouhodob√Ω r≈Øst po skonƒçen√≠ projekce (typicky 2‚Äì3 %).</li>
              <li><b>Margin of Safety</b> = bezpeƒçnostn√≠ sleva (nap≈ô. 20 %).</li>
            </ul>

            <div class="divider"></div>

            <h3>Pro koho to je</h3>
            <p>
              Pro investora, kter√Ω chce rychle porovnat ‚Äûco by d√°valo smysl‚Äú vs. aktu√°ln√≠ cena a dƒõlat si vlastn√≠
              konzistentn√≠ pozn√°mky (Watchlist).
            </p>

            <div class="divider"></div>

            <h3>Upozornƒõn√≠</h3>
            <p>
              Je to zjednodu≈°en√Ω model. Nenahrazuje detailn√≠ anal√Ωzu (dluh, cash, zmƒõny mar≈æ√≠, cykliƒçnost, diluce‚Ä¶).
              Ber to jako rychl√Ω filtr a orientaƒçn√≠ odhad.
            </p>
          </div>
        </div>
      </div>
    </section>

  </div>

  <script>
    // ===== Helpers =====
    const d = (id) => document.getElementById(id);

    function setMsg(el, text){
      if(!el) return;
      el.textContent = text || '';
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (c) => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[c]));
    }

    // CZ number parsing: "1 234,56" -> 1234.56
    function parseCzNumber(val){
      if(val === null || val === undefined) return NaN;
      const s = String(val).trim()
        .replace(/\s+/g,'')
        .replace(/\u00A0/g,'')
        .replace(',', '.');
      const n = Number(s);
      return Number.isFinite(n) ? n : NaN;
    }

    function fmtMoney(x){
      if(!Number.isFinite(x)) return '‚Äî';
      // Czech style with 2 decimals
      return x.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function fmtPct(x){
      if(!Number.isFinite(x)) return '‚Äî';
      return x.toLocaleString('cs-CZ', { maximumFractionDigits: 2 }) + ' %';
    }

    // ===== Routing =====
    const screens = ['home','dcf','watchlist','about'];

    function openScreen(name){
      screens.forEach(s => {
        const el = d('screen-' + s);
        if(!el) return;
        el.classList.toggle('active', s === name);
      });

      // keep URL hash simple (optional)
      try{ location.hash = name; }catch(e){}
      if(name === 'watchlist') renderWatchlist();
    }

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-open]');
      if(!btn) return;
      const target = btn.getAttribute('data-open');
      if(!target) return;
      openScreen(target);
    });

    // Open hash on load
    window.addEventListener('load', () => {
      const h = (location.hash || '').replace('#','');
      if(screens.includes(h)) openScreen(h);
    });

    // ===== DCF =====
    let lastDcfResult = null;

    function dcfScenario({ fcf0, years, r, g, gt }){
      // All in decimals (r=0.09)
      // Project FCF per share growing g each year, discount by r
      let pv = 0;
      let fcf = fcf0;

      for(let t=1; t<=years; t++){
        fcf = fcf * (1 + g);
        const disc = Math.pow(1 + r, t);
        pv += fcf / disc;
      }

      // Terminal value at end of year 'years'
      // TV = FCF_years * (1+gt) / (r-gt)
      // Discount back 'years'
      const denom = (r - gt);
      if(denom <= 0) return { ok:false, error:'Diskont mus√≠ b√Ωt vƒõt≈°√≠ ne≈æ termin√°ln√≠ r≈Øst.' };

      const tv = (fcf * (1 + gt)) / denom;
      const pvTv = tv / Math.pow(1 + r, years);

      return {
        ok:true,
        pvFcf: pv,
        pvTv: pvTv,
        fv: pv + pvTv
      };
    }

    function buildScenarioCard(name, res, price, mosPct){
      const fv = res.fv;
      const target = fv * (1 - mosPct);
      const diff = (Number.isFinite(price) ? (target - price) : NaN);
      const diffPct = (Number.isFinite(price) && price !== 0) ? (diff / price) * 100 : NaN;

      let tagClass = '';
      let tagText = '‚Äî';
      if(Number.isFinite(diffPct)){
        if(diffPct >= 10){ tagClass = 'good'; tagText = 'podhodnocen√©'; }
        else if(diffPct <= -10){ tagClass = 'bad'; tagText = 'nadhodnocen√©'; }
        else { tagClass = ''; tagText = 'ok / neutr√°ln√≠'; }
      }

      return `
        <div class="scCard">
          <div class="scTop">
            <div class="scName">${escapeHtml(name)}</div>
            <div class="tag ${tagClass}">${escapeHtml(tagText)}</div>
          </div>
          <div class="bigVal mono">${fmtMoney(target)}</div>
          <div class="line"><span>Fair Value</span><span class="mono">${fmtMoney(fv)}</span></div>
          <div class="line"><span>MoS</span><span class="mono">${fmtPct(mosPct*100)}</span></div>
          <div class="line"><span>PV FCF</span><span class="mono">${fmtMoney(res.pvFcf)}</span></div>
          <div class="line"><span>PV Terminal</span><span class="mono">${fmtMoney(res.pvTv)}</span></div>
          <div class="line"><span>Vs. cena</span><span class="mono">${Number.isFinite(diff) ? fmtMoney(diff) : '‚Äî'}</span></div>
          <div class="line"><span>Vs. cena %</span><span class="mono">${Number.isFinite(diffPct) ? diffPct.toLocaleString('cs-CZ',{maximumFractionDigits:1})+' %' : '‚Äî'}</span></div>
        </div>
      `;
    }

    function calcDcf(){
      const ticker = d('d_ticker').value.trim().toUpperCase();
      const price = parseCzNumber(d('d_price').value);
      const fcf0  = parseCzNumber(d('d_fcf').value);
      const years = parseCzNumber(d('d_years').value);
      const rPct  = parseCzNumber(d('d_r').value);
      const mosPct = parseCzNumber(d('d_mos').value) / 100;

      const bearG  = parseCzNumber(d('d_bear_g').value);
      const bearGT = parseCzNumber(d('d_bear_gt').value);

      const baseG  = parseCzNumber(d('d_base_g').value);
      const baseGT = parseCzNumber(d('d_base_gt').value);

      const bullG  = parseCzNumber(d('d_bull_g').value);
      const bullGT = parseCzNumber(d('d_bull_gt').value);

      const msgEl = d('dcfMsg');

      // Basic validation
      if(!ticker){
        setMsg(msgEl, 'Dopl≈à ticker (aspo≈à pro pojmenov√°n√≠).');
        return null;
      }
      if(!Number.isFinite(fcf0) || fcf0 <= 0){
        setMsg(msgEl, 'FCF na akcii mus√≠ b√Ωt ƒç√≠slo > 0.');
        return null;
      }
      if(!Number.isFinite(years) || years < 1 || years > 30){
        setMsg(msgEl, 'Poƒçet let projekce: zadej rozumnƒõ (1‚Äì30).');
        return null;
      }
      if(!Number.isFinite(rPct) || rPct <= 0 || rPct > 50){
        setMsg(msgEl, 'Diskont: zadej procento (nap≈ô. 9).');
        return null;
      }

      // Convert to decimals
      const r = rPct / 100;

      const inputs = [
        ['Bear r≈Øst', bearG], ['Bear termin√°l', bearGT],
        ['Base r≈Øst', baseG], ['Base termin√°l', baseGT],
        ['Bull r≈Øst', bullG], ['Bull termin√°l', bullGT]
      ];
      for(const [label, val] of inputs){
        if(!Number.isFinite(val)){
          setMsg(msgEl, `Chyb√≠: ${label}.`);
          return null;
        }
      }

      const bear = dcfScenario({ fcf0, years: Math.round(years), r, g: bearG/100, gt: bearGT/100 });
      if(!bear.ok){ setMsg(msgEl, 'Bear: ' + bear.error); return null; }

      const base = dcfScenario({ fcf0, years: Math.round(years), r, g: baseG/100, gt: baseGT/100 });
      if(!base.ok){ setMsg(msgEl, 'Base: ' + base.error); return null; }

      const bull = dcfScenario({ fcf0, years: Math.round(years), r, g: bullG/100, gt: bullGT/100 });
      if(!bull.ok){ setMsg(msgEl, 'Bull: ' + bull.error); return null; }

      // Summary badge based on BASE target vs price
      const baseTarget = base.fv * (1 - mosPct);
      let summary = 'Hotovo';
      if(Number.isFinite(price) && price > 0){
        const diffPct = ((baseTarget - price)/price)*100;
        if(diffPct >= 15) summary = `Base: podhodnocen√© (~${diffPct.toFixed(1)} %)`;
        else if(diffPct <= -15) summary = `Base: nadhodnocen√© (~${diffPct.toFixed(1)} %)`;
        else summary = `Base: neutr√°ln√≠ (~${diffPct.toFixed(1)} %)`;
      } else {
        summary = 'Hotovo (bez porovn√°n√≠ s cenou)';
      }

      // Render
      d('dcfResultCard').style.display = 'block';
      d('dcfSummary').textContent = summary;

      const sc = d('dcfScenarios');
      sc.innerHTML =
        buildScenarioCard('Bear', bear, price, mosPct) +
        buildScenarioCard('Base', base, price, mosPct) +
        buildScenarioCard('Bull', bull, price, mosPct);

      setMsg(msgEl, 'V√Ωpoƒçet hotov√Ω. Pokud chce≈°, ulo≈æ v√Ωsledek do Watchlistu.');

      lastDcfResult = {
        ticker,
        price: Number.isFinite(price) ? price : null,
        fcf0,
        years: Math.round(years),
        rPct,
        mos: mosPct*100,
        bear: { g: bearG, gt: bearGT, fv: bear.fv, target: bear.fv*(1-mosPct) },
        base: { g: baseG, gt: baseGT, fv: base.fv, target: base.fv*(1-mosPct) },
        bull: { g: bullG, gt: bullGT, fv: bull.fv, target: bull.fv*(1-mosPct) },
        ts: Date.now()
      };

      return lastDcfResult;
    }

    function fillExample(){
      d('d_ticker').value = 'SOFI';
      d('d_price').value = '8,50';
      d('d_fcf').value = '0,45';
      d('d_years').value = '7';
      d('d_r').value = '9';
      d('d_mos').value = '20';

      d('d_bear_g').value = '6';
      d('d_bear_gt').value = '2';

      d('d_base_g').value = '12';
      d('d_base_gt').value = '3';

      d('d_bull_g').value = '18';
      d('d_bull_gt').value = '3';

      setMsg(d('dcfMsg'), 'P≈ô√≠klad doplnƒõn. Klikni Spoƒç√≠tat.');
    }

    function resetDcf(){
      [
        'd_ticker','d_price','d_fcf','d_years','d_r',
        'd_bear_g','d_bear_gt','d_base_g','d_base_gt','d_bull_g','d_bull_gt'
      ].forEach(id => d(id).value = '');

      d('d_mos').value = '20';
      d('dcfResultCard').style.display = 'none';
      d('dcfScenarios').innerHTML = '';
      setMsg(d('dcfMsg'), '');
      lastDcfResult = null;
    }

    // ===== Watchlist =====
    const WL_KEY = 'equity_analyzer_watchlist_v1';

    function loadWl(){
      try{
        const raw = localStorage.getItem(WL_KEY);
        if(!raw) return [];
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      }catch(e){ return []; }
    }

    function saveWl(arr){
      localStorage.setItem(WL_KEY, JSON.stringify(arr));
    }

    function addToWl(entry){
      const arr = loadWl();
      // Add on top
      arr.unshift({
        id: cryptoRandomId(),
        ...entry
      });
      saveWl(arr);
      return arr;
    }

    function deleteWl(id){
      const arr = loadWl().filter(x => x.id !== id);
      saveWl(arr);
      return arr;
    }

    function clearWl(){
      saveWl([]);
    }

    function cryptoRandomId(){
      try{
        const a = new Uint32Array(2);
        crypto.getRandomValues(a);
        return a[0].toString(16) + a[1].toString(16);
      }catch(e){
        return String(Date.now()) + Math.random().toString(16).slice(2);
      }
    }

    function renderWatchlist(){
      const listEl = d('wlList');
      const msgEl = d('wlMsg');
      const arr = loadWl();

      if(arr.length === 0){
        listEl.innerHTML = '';
        setMsg(msgEl, 'Watchlist je pr√°zdn√Ω. Spoƒç√≠tej DCF a ulo≈æ v√Ωsledek.');
        return;
      }

      setMsg(msgEl, `Polo≈æek: ${arr.length}`);

      listEl.innerHTML = arr.map(item => {
        const dt = new Date(item.ts || Date.now());
        const dateStr = dt.toLocaleString('cs-CZ', { year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit' });

        const priceStr = (item.price === null || item.price === undefined) ? '‚Äî' : fmtMoney(item.price);
        const baseTarget = item?.base?.target;
        const baseStr = fmtMoney(baseTarget);

        return `
          <div class="wlItem">
            <div class="wlLeft">
              <p class="wlTitle">${escapeHtml(item.ticker || '‚Äî')} <span style="color:rgba(255,255,255,.35);font-weight:900;">‚Ä¢</span> Base c√≠l: <span class="mono">${baseStr}</span></p>
              <p class="wlMeta">
                Datum: ${escapeHtml(dateStr)}<br/>
                Cena: <span class="mono">${priceStr}</span> ‚Ä¢ Diskont: <span class="mono">${escapeHtml(String(item.rPct ?? '‚Äî'))}%</span> ‚Ä¢ MoS: <span class="mono">${escapeHtml(String(item.mos ?? '‚Äî'))}%</span><br/>
                FCF/akcii: <span class="mono">${fmtMoney(item.fcf0)}</span> ‚Ä¢ Roky: <span class="mono">${escapeHtml(String(item.years))}</span>
              </p>
            </div>
            <div class="wlBtns">
              <button class="iconBtn" data-wl-open="${escapeHtml(item.id)}" title="Zobrazit v DCF">‚Üó</button>
              <button class="iconBtn danger" data-wl-del="${escapeHtml(item.id)}" title="Smazat">üóë</button>
            </div>
          </div>
        `;
      }).join('');
    }

    // Click handlers
    d('btnDcfCalc').addEventListener('click', () => calcDcf());
    d('btnDcfExample').addEventListener('click', () => fillExample());

    d('btnDcfSave').addEventListener('click', () => {
      const msgEl = d('dcfMsg');
      if(!lastDcfResult){
        const res = calcDcf();
        if(!res) return;
      }
      addToWl(lastDcfResult);
      setMsg(msgEl, 'Ulo≈æeno do Watchlistu ‚úÖ');
    });

    d('btnDcfReset').addEventListener('click', () => resetDcf());

    d('btnWlRefresh').addEventListener('click', () => renderWatchlist());
    d('btnWlClear').addEventListener('click', () => {
      clearWl();
      renderWatchlist();
    });

    // Watchlist delegation
    document.addEventListener('click', (e) => {
      const del = e.target.closest('[data-wl-del]');
      if(del){
        const id = del.getAttribute('data-wl-del');
        deleteWl(id);
        renderWatchlist();
        return;
      }

      const open = e.target.closest('[data-wl-open]');
      if(open){
        const id = open.getAttribute('data-wl-open');
        const arr = loadWl();
        const item = arr.find(x => x.id === id);
        if(!item) return;

        // Fill DCF inputs from watchlist item
        d('d_ticker').value = item.ticker || '';
        d('d_price').value = (item.price === null || item.price === undefined) ? '' : String(item.price).replace('.', ',');
        d('d_fcf').value = String(item.fcf0).replace('.', ',');
        d('d_years').value = String(item.years);
        d('d_r').value = String(item.rPct).replace('.', ',');
        d('d_mos').value = String(item.mos ?? 20);

        d('d_bear_g').value = String(item.bear.g).replace('.', ',');
        d('d_bear_gt').value = String(item.bear.gt).replace('.', ',');
        d('d_base_g').value = String(item.base.g).replace('.', ',');
        d('d_base_gt').value = String(item.base.gt).replace('.', ',');
        d('d_bull_g').value = String(item.bull.g).replace('.', ',');
        d('d_bull_gt').value = String(item.bull.gt).replace('.', ',');

        openScreen('dcf');
        setMsg(d('dcfMsg'), 'Naƒçteno z Watchlistu. Klikni Spoƒç√≠tat pro znovu-v√Ωpoƒçet.');
        d('dcfResultCard').style.display = 'none';
        d('dcfScenarios').innerHTML = '';
      }
    });

    // Default values (a≈• to nen√≠ pr√°zdn√© a nep≈Øsob√≠ rozbitƒõ)
    // M≈Ø≈æe≈° klidnƒõ smazat, pokud chce≈° v≈°e pr√°zdn√©.
    d('d_years').value = '7';
    d('d_r').value = '9';
    d('d_bear_g').value = '6';
    d('d_bear_gt').value = '2';
    d('d_base_g').value = '12';
    d('d_base_gt').value = '3';
    d('d_bull_g').value = '18';
    d('d_bull_gt').value = '3';
  </script>
</body>
</html>

    

          

        


        

    
    
    

      



    
        








    

    

    

 


        


        



  


 

            

        




          

        

          





  

  

  


  


    


      

  

    

          
    

    

    
    


    





    

    

  
        

    
    

  

  





